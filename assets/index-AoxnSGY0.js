var s_=Object.defineProperty;var o_=(i,t,e)=>t in i?s_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Kl=(i,t,e)=>o_(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const c of h.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(s){if(s.ep)return;s.ep=!0;const h=e(s);fetch(s.href,h)}})();const we={ADD:"add",REMOVE:"remove"},lr={PROPERTYCHANGE:"propertychange"},ct={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class pr{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Rs(i,t){return i>t?1:i<t?-1:0}function Ts(i,t,e){if(i[0]<=t)return 0;const r=i.length;if(t<=i[r-1])return r-1;if(typeof e=="function"){for(let s=1;s<r;++s){const h=i[s];if(h===t)return s;if(h<t)return e(t,i[s-1],h)>0?s-1:s}return r-1}if(e>0){for(let s=1;s<r;++s)if(i[s]<t)return s-1;return r-1}if(e<0){for(let s=1;s<r;++s)if(i[s]<=t)return s;return r-1}for(let s=1;s<r;++s){if(i[s]==t)return s;if(i[s]<t)return i[s-1]-t<t-i[s]?s-1:s}return r-1}function a_(i,t){const e=Array.isArray(t)?t:[t],r=e.length;for(let s=0;s<r;s++)i[i.length]=e[s]}function Is(i,t){const e=i.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function l_(i,t,e){const r=t||Rs;return i.every(function(s,h){if(h===0)return!0;const c=r(i[h-1],s);return!(c>0||c===0)})}function ls(){return!0}function Cs(){return!1}function hs(){}function h_(i){let t,e,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!Is(s,e))&&(r=this,e=s,t=i.apply(this,arguments)),t}}function ta(i){function t(){let e;try{e=i()}catch(r){return Promise.reject(r)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Ss(i){for(const t in i)delete i[t]}function eu(i){let t;for(t in i)return!1;return!t}class Ne{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class mr extends pr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const r=this.listeners_||(this.listeners_={}),s=r[t]||(r[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",r=e?t:t.type,s=this.listeners_&&this.listeners_[r];if(!s)return;const h=e?new Ne(t):t;h.target||(h.target=this.eventTarget_||this);const c=this.dispatching_||(this.dispatching_={}),d=this.pendingRemovals_||(this.pendingRemovals_={});r in c||(c[r]=0,d[r]=0),++c[r];let _;for(let m=0,y=s.length;m<y;++m)if("handleEvent"in s[m]?_=s[m].handleEvent(h):_=s[m].call(this,h),_===!1||h.propagationStopped){_=!1;break}if(--c[r]===0){let m=d[r];for(delete d[r];m--;)this.removeEventListener(r,hs);delete c[r]}return _}disposeInternal(){this.listeners_&&Ss(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const r=this.listeners_[t];if(!r)return;const s=r.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[s]=hs,++this.pendingRemovals_[t]):(r.splice(s,1),r.length===0&&delete this.listeners_[t]))}}function St(i,t,e,r,s){if(s){const c=e;e=function(d){return i.removeEventListener(t,e),c.call(r??this,d)}}else r&&r!==i&&(e=e.bind(r));const h={target:i,type:t,listener:e};return i.addEventListener(t,e),h}function us(i,t,e,r){return St(i,t,e,r,!0)}function Gt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Ss(i))}class nu extends mr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ct.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const r=t.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=St(this,t[h],e);return s}return St(this,t,e)}onceInternal(t,e){let r;if(Array.isArray(t)){const s=t.length;r=new Array(s);for(let h=0;h<s;++h)r[h]=us(this,t[h],e)}else r=us(this,t,e);return e.ol_key=r,r}unInternal(t,e){const r=e.ol_key;if(r)u_(r);else if(Array.isArray(t))for(let s=0,h=t.length;s<h;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}function u_(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Gt(i[t]);else Gt(i)}function Tt(){throw new Error("Unimplemented abstract method.")}let c_=0;function ee(i){return i.ol_uid||(i.ol_uid=String(++c_))}class Hl extends Ne{constructor(t,e,r){super(t),this.key=e,this.oldValue=r}}class $e extends nu{constructor(t){super(),this.on,this.once,this.un,ee(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new Hl(r,t,e)),r=lr.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new Hl(r,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,r){const s=this.values_||(this.values_={});if(r)s[t]=e;else{const h=s[t];s[t]=e,h!==e&&this.notify(t,h)}}setProperties(t,e){for(const r in t)this.set(r,t[r],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const r=this.values_[t];delete this.values_[t],eu(this.values_)&&(this.values_=null),e||this.notify(t,r)}}}const $l={LENGTH:"length"};class $r extends Ne{constructor(t,e,r){super(t),this.element=e,this.index=r}}class Ve extends $e{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let r=0,s=this.array_.length;r<s;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,r=t.length;e<r;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let r=0,s=e.length;r<s;++r)t(e[r],r,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get($l.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new $r(we.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let r=0,s=e.length;r<s;++r)if(e[r]===t)return this.removeAt(r)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new $r(we.REMOVE,e,t)),e}setAt(t,e){const r=this.getLength();if(t>=r){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new $r(we.REMOVE,s,t)),this.dispatchEvent(new $r(we.ADD,e,t))}updateLength_(){this.set($l.LENGTH,this.array_.length)}assertUnique_(t,e){for(let r=0,s=this.array_.length;r<s;++r)if(this.array_[r]===t&&r!==e)throw new Error("Duplicate item added to a unique collection")}}class ri extends Ne{constructor(t,e,r){super(t),this.map=e,this.frameState=r!==void 0?r:null}}class fn extends ri{constructor(t,e,r,s,h,c){super(t,e,h),this.originalEvent=r,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=c}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Ut={SINGLECLICK:"singleclick",CLICK:ct.CLICK,DBLCLICK:ct.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},yn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",f_=yn.includes("firefox"),d_=yn.includes("safari")&&!yn.includes("chrom");d_&&(yn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(yn));const g_=yn.includes("webkit")&&!yn.includes("edge"),iu=yn.includes("macintosh"),ru=typeof devicePixelRatio<"u"?devicePixelRatio:1,su=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,ou=typeof Image<"u"&&Image.prototype.decode,__=typeof createImageBitmap=="function",au=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}(),zo={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class p_ extends mr{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const r=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=r,this.pointerdownListenerKey_=St(r,zo.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=St(r,zo.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ct.TOUCHMOVE,this.boundHandleTouchMove_,au?{passive:!1}:!1)}emulateClick_(t){let e=new fn(Ut.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new fn(Ut.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const r=new fn(Ut.SINGLECLICK,this.map_,t);this.dispatchEvent(r)},250)}updateActivePointers_(t){const e=t,r=e.pointerId;if(e.type==Ut.POINTERUP||e.type==Ut.POINTERCANCEL){delete this.trackedTouches_[r];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==Ut.POINTERDOWN||e.type==Ut.POINTERMOVE)&&(this.trackedTouches_[r]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new fn(Ut.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Gt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new fn(Ut.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const r=this.map_.getOwnerDocument();this.dragListenerKeys_.push(St(r,Ut.POINTERMOVE,this.handlePointerMove_,this),St(r,Ut.POINTERUP,this.handlePointerUp_,this),St(this.element_,Ut.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==r&&this.dragListenerKeys_.push(St(this.element_.getRootNode(),Ut.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new fn(Ut.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new fn(Ut.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Gt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ct.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Gt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Gt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const dn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},se={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},$={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Mt(i,t){if(!i)throw new Error(t)}const cs=1/0;class m_{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Ss(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,r=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(r);return delete this.queuedElements_[s],r}enqueue(t){Mt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=cs?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,r=this.priorities_,s=e.length,h=e[t],c=r[t],d=t;for(;t<s>>1;){const _=this.getLeftChildIndex_(t),m=this.getRightChildIndex_(t),y=m<s&&r[m]<r[_]?m:_;e[t]=e[y],r[t]=r[y],t=y}e[t]=h,r[t]=c,this.siftDown_(d,t)}siftDown_(t,e){const r=this.elements_,s=this.priorities_,h=r[e],c=s[e];for(;e>t;){const d=this.getParentIndex_(e);if(s[d]>c)r[e]=r[d],s[e]=s[d],e=d;else break}r[e]=h,s[e]=c}reprioritize(){const t=this.priorityFunction_,e=this.elements_,r=this.priorities_;let s=0;const h=e.length;let c,d,_;for(d=0;d<h;++d)c=e[d],_=t(c),_==cs?delete this.queuedElements_[this.keyFunction_(c)]:(r[s]=_,e[s++]=c);e.length=s,r.length=s,this.heapify_()}}class lu extends m_{constructor(t,e){super(r=>t.apply(null,r),r=>r[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(ct.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,r=e.getState();if(r===$.LOADED||r===$.ERROR||r===$.EMPTY){r!==$.ERROR&&e.removeEventListener(ct.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let r=0;for(;this.tilesLoading_<t&&r<e&&this.getCount()>0;){const s=this.dequeue()[0],h=s.getKey();s.getState()===$.IDLE&&!(h in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[h]=!0,++this.tilesLoading_,++r,s.load())}}}function v_(i,t,e,r,s){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return cs;const h=i.viewState.center,c=r[0]-h[0],d=r[1]-h[1];return 65536*Math.log(s)+Math.sqrt(c*c+d*d)/s}const fe={ANIMATING:0,INTERACTING:1},Se={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Kt(i,t,e){return Math.min(Math.max(i,t),e)}function y_(i,t,e,r,s,h){const c=s-e,d=h-r;if(c!==0||d!==0){const _=((i-e)*c+(t-r)*d)/(c*c+d*d);_>1?(e=s,r=h):_>0&&(e+=c*_,r+=d*_)}return li(i,t,e,r)}function li(i,t,e,r){const s=e-i,h=r-t;return s*s+h*h}function E_(i){const t=i.length;for(let r=0;r<t;r++){let s=r,h=Math.abs(i[r][r]);for(let d=r+1;d<t;d++){const _=Math.abs(i[d][r]);_>h&&(h=_,s=d)}if(h===0)return null;const c=i[s];i[s]=i[r],i[r]=c;for(let d=r+1;d<t;d++){const _=-i[d][r]/i[r][r];for(let m=r;m<t+1;m++)r==m?i[d][m]=0:i[d][m]+=_*i[r][m]}}const e=new Array(t);for(let r=t-1;r>=0;r--){e[r]=i[r][t]/i[r][r];for(let s=r-1;s>=0;s--)i[s][t]-=i[s][r]*e[r]}return e}function ql(i){return i*180/Math.PI}function pn(i){return i*Math.PI/180}function hi(i,t){const e=i%t;return e*t<0?e+t:e}function x_(i,t,e){return i+e*(t-i)}function hu(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function qr(i,t){return Math.floor(hu(i,t))}function _n(i,t){return Math.ceil(hu(i,t))}function Yo(i,t,e){if(i>=t&&i<e)return i;const r=e-t;return((i-t)%r+r)%r+t}function Jl(i,t,e){return function(r,s,h,c,d){if(!r)return;if(!s&&!t)return r;const _=t?0:h[0]*s,m=t?0:h[1]*s,y=d?d[0]:0,x=d?d[1]:0;let w=i[0]+_/2+y,C=i[2]-_/2+y,T=i[1]+m/2+x,O=i[3]-m/2+x;w>C&&(w=(C+w)/2,C=w),T>O&&(T=(O+T)/2,O=T);let M=Kt(r[0],w,C),A=Kt(r[1],T,O);if(c&&e&&s){const D=30*s;M+=-D*Math.log(1+Math.max(0,w-r[0])/D)+D*Math.log(1+Math.max(0,r[0]-C)/D),A+=-D*Math.log(1+Math.max(0,T-r[1])/D)+D*Math.log(1+Math.max(0,r[1]-O)/D)}return[M,A]}}function w_(i){return i}const te={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Ql(i){const t=En();for(let e=0,r=i.length;e<r;++e)os(t,i[e]);return t}function R_(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function uu(i,t,e){let r,s;return t<i[0]?r=i[0]-t:i[2]<t?r=t-i[2]:r=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,r*r+s*s}function As(i,t){return cu(i,t[0],t[1])}function Bo(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function cu(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function th(i,t){const e=i[0],r=i[1],s=i[2],h=i[3],c=t[0],d=t[1];let _=te.UNKNOWN;return c<e?_=_|te.LEFT:c>s&&(_=_|te.RIGHT),d<r?_=_|te.BELOW:d>h&&(_=_|te.ABOVE),_===te.UNKNOWN&&(_=te.INTERSECTING),_}function En(){return[1/0,1/0,-1/0,-1/0]}function vr(i,t,e,r,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=r,s):[i,t,e,r]}function Os(i){return vr(1/0,1/0,-1/0,-1/0,i)}function T_(i,t){const e=i[0],r=i[1];return vr(e,r,e,r,t)}function I_(i,t,e,r,s){const h=Os(s);return du(h,i,t,e,r)}function di(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function fu(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function os(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function du(i,t,e,r,s){for(;e<r;e+=s)C_(i,t[e],t[e+1]);return i}function C_(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function gu(i,t){let e;return e=t(Ls(i)),e||(e=t(Ms(i)),e)||(e=t(Ps(i)),e)||(e=t(He(i)),e)?e:!1}function hr(i){let t=0;return vi(i)||(t=yt(i)*Wt(i)),t}function Ls(i){return[i[0],i[1]]}function Ms(i){return[i[2],i[1]]}function Ke(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function S_(i,t){let e;if(t==="bottom-left")e=Ls(i);else if(t==="bottom-right")e=Ms(i);else if(t==="top-left")e=He(i);else if(t==="top-right")e=Ps(i);else throw new Error("Invalid corner");return e}function fs(i,t,e,r,s){const[h,c,d,_,m,y,x,w]=_u(i,t,e,r);return vr(Math.min(h,d,m,x),Math.min(c,_,y,w),Math.max(h,d,m,x),Math.max(c,_,y,w),s)}function _u(i,t,e,r){const s=t*r[0]/2,h=t*r[1]/2,c=Math.cos(e),d=Math.sin(e),_=s*c,m=s*d,y=h*c,x=h*d,w=i[0],C=i[1];return[w-_+x,C-m-y,w-_-x,C-m+y,w+_-x,C+m+y,w+_+x,C+m-y,w-_+x,C-m-y]}function Wt(i){return i[3]-i[1]}function pe(i,t,e){const r=e||En();return mi(i,t)?(i[0]>t[0]?r[0]=i[0]:r[0]=t[0],i[1]>t[1]?r[1]=i[1]:r[1]=t[1],i[2]<t[2]?r[2]=i[2]:r[2]=t[2],i[3]<t[3]?r[3]=i[3]:r[3]=t[3]):Os(r),r}function He(i){return[i[0],i[3]]}function Ps(i){return[i[2],i[3]]}function yt(i){return i[2]-i[0]}function mi(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function vi(i){return i[2]<i[0]||i[3]<i[1]}function A_(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function O_(i,t,e){let r=!1;const s=th(i,t),h=th(i,e);if(s===te.INTERSECTING||h===te.INTERSECTING)r=!0;else{const c=i[0],d=i[1],_=i[2],m=i[3],y=t[0],x=t[1],w=e[0],C=e[1],T=(C-x)/(w-y);let O,M;h&te.ABOVE&&!(s&te.ABOVE)&&(O=w-(C-m)/T,r=O>=c&&O<=_),!r&&h&te.RIGHT&&!(s&te.RIGHT)&&(M=C-(w-_)*T,r=M>=d&&M<=m),!r&&h&te.BELOW&&!(s&te.BELOW)&&(O=w-(C-d)/T,r=O>=c&&O<=_),!r&&h&te.LEFT&&!(s&te.LEFT)&&(M=C-(w-c)*T,r=M>=d&&M<=m)}return r}function L_(i,t){const e=t.getExtent(),r=Ke(i);if(t.canWrapX()&&(r[0]<e[0]||r[0]>=e[2])){const s=yt(e),c=Math.floor((r[0]-e[0])/s)*s;i[0]-=c,i[2]-=c}return i}function pu(i,t,e){if(t.canWrapX()){const r=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[r[0],i[1],r[2],i[3]]];L_(i,t);const s=yt(r);if(yt(i)>s,i[0]<r[0])return[[i[0]+s,i[1],r[2],i[3]],[r[0],i[1],i[2],i[3]]];if(i[2]>r[2])return[[i[0],i[1],r[2],i[3]],[r[0],i[1],i[2]-s,i[3]]]}return[i]}function M_(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function ds(i,t){let e=!0;for(let r=i.length-1;r>=0;--r)if(i[r]!=t[r]){e=!1;break}return e}function ea(i,t){const e=Math.cos(t),r=Math.sin(t),s=i[0]*e-i[1]*r,h=i[1]*e+i[0]*r;return i[0]=s,i[1]=h,i}function P_(i,t){return i[0]*=t,i[1]*=t,i}function D_(i,t){if(t.canWrapX()){const e=yt(t.getExtent()),r=F_(i,t,e);r&&(i[0]-=r*e)}return i}function F_(i,t,e){const r=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<r[0]||i[0]>r[2])&&(e=e||yt(r),s=Math.floor((i[0]-r[0])/e)),s}function mu(i){return Math.pow(i,3)}function yi(i){return 1-mu(1-i)}function b_(i){return 3*i*i-2*i*i*i}function N_(i){return i}const G_=63710088e-1;function eh(i,t,e){e=e||G_;const r=pn(i[1]),s=pn(t[1]),h=(s-r)/2,c=pn(t[0]-i[0])/2,d=Math.sin(h)*Math.sin(h)+Math.sin(c)*Math.sin(c)*Math.cos(r)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}function vu(...i){console.warn(...i)}const na={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ia{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||na[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const yr=6378137,ai=Math.PI*yr,k_=[-ai,-ai,ai,ai],X_=[-180,-85,180,85],Jr=yr*Math.log(Math.tan(Math.PI/2));class $n extends ia{constructor(t){super({code:t,units:"m",extent:k_,global:!0,worldExtent:X_,getPointResolution:function(e,r){return e/Math.cosh(r[1]/yr)}})}}const nh=[new $n("EPSG:3857"),new $n("EPSG:102100"),new $n("EPSG:102113"),new $n("EPSG:900913"),new $n("http://www.opengis.net/def/crs/EPSG/0/3857"),new $n("http://www.opengis.net/gml/srs/epsg.xml#3857")];function z_(i,t,e,r){const s=i.length;e=e>1?e:2,r=r??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let h=0;h<s;h+=r){t[h]=ai*i[h]/180;let c=yr*Math.log(Math.tan(Math.PI*(+i[h+1]+90)/360));c>Jr?c=Jr:c<-Jr&&(c=-Jr),t[h+1]=c}return t}function Y_(i,t,e,r){const s=i.length;e=e>1?e:2,r=r??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let h=0;h<s;h+=r)t[h]=180*i[h]/ai,t[h+1]=360*Math.atan(Math.exp(i[h+1]/yr))/Math.PI-90;return t}const B_=6378137,ih=[-180,-90,180,90],U_=Math.PI*B_/180;class An extends ia{constructor(t,e){super({code:t,units:"degrees",extent:ih,axisOrientation:e,global:!0,metersPerUnit:U_,worldExtent:ih})}}const rh=[new An("CRS:84"),new An("EPSG:4326","neu"),new An("urn:ogc:def:crs:OGC:1.3:CRS84"),new An("urn:ogc:def:crs:OGC:2:84"),new An("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new An("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new An("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Uo={};function W_(i){return Uo[i]||Uo[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function j_(i,t){Uo[i]=t}let ui={};function ur(i,t,e){const r=i.getCode(),s=t.getCode();r in ui||(ui[r]={}),ui[r][s]=e}function Eo(i,t){return i in ui&&t in ui[i]?ui[i][t]:null}const gs=.9996,Te=.00669438,Ds=Te*Te,Fs=Ds*Te,Mn=Te/(1-Te),sh=Math.sqrt(1-Te),gi=(1-sh)/(1+sh),yu=gi*gi,ra=yu*gi,sa=ra*gi,Eu=sa*gi,xu=1-Te/4-3*Ds/64-5*Fs/256,V_=3*Te/8+3*Ds/32+45*Fs/1024,Z_=15*Ds/256+45*Fs/1024,K_=35*Fs/3072,H_=3/2*gi-27/32*ra+269/512*Eu,$_=21/16*yu-55/32*sa,q_=151/96*ra-417/128*Eu,J_=1097/512*sa,_s=6378137;function Q_(i,t,e){const r=i-5e5,c=(e.north?t:t-1e7)/gs/(_s*xu),d=c+H_*Math.sin(2*c)+$_*Math.sin(4*c)+q_*Math.sin(6*c)+J_*Math.sin(8*c),_=Math.sin(d),m=_*_,y=Math.cos(d),x=_/y,w=x*x,C=w*w,T=1-Te*m,O=Math.sqrt(1-Te*m),M=_s/O,A=(1-Te)/T,D=Mn*y**2,z=D*D,b=r/(M*gs),F=b*b,B=F*b,V=B*b,k=V*b,K=k*b,Y=d-x/A*(F/2-V/24*(5+3*w+10*D-4*z-9*Mn))+K/720*(61+90*w+298*D+45*C-252*Mn-3*z);let st=(b-B/6*(1+2*w+D)+k/120*(5-2*D+28*w-3*z+8*Mn+24*C))/y;return st=Yo(st+pn(wu(e.number)),-Math.PI,Math.PI),[ql(st),ql(Y)]}const oh=-80,ah=84,tp=-180,ep=180;function np(i,t,e){i=Yo(i,tp,ep),t<oh?t=oh:t>ah&&(t=ah);const r=pn(t),s=Math.sin(r),h=Math.cos(r),c=s/h,d=c*c,_=d*d,m=pn(i),y=wu(e.number),x=pn(y),w=_s/Math.sqrt(1-Te*s**2),C=Mn*h**2,T=h*Yo(m-x,-Math.PI,Math.PI),O=T*T,M=O*T,A=M*T,D=A*T,z=D*T,b=_s*(xu*r-V_*Math.sin(2*r)+Z_*Math.sin(4*r)-K_*Math.sin(6*r)),F=gs*w*(T+M/6*(1-d+C)+D/120*(5-18*d+_+72*C-58*Mn))+5e5;let B=gs*(b+w*c*(O/2+A/24*(5-d+9*C+4*C**2)+z/720*(61-58*d+_+600*C-330*Mn)));return e.north||(B+=1e7),[F,B]}function wu(i){return(i-1)*6-180+3}const ip=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Ru(i){let t=0;for(const s of ip){const h=i.match(s);if(h){t=parseInt(h[1]);break}}if(!t)return null;let e=0,r=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(r=!0,e=t-32600),e?{number:e,north:r}:null}function lh(i,t){return function(e,r,s,h){const c=e.length;s=s>1?s:2,h=h??s,r||(s>2?r=e.slice():r=new Array(c));for(let d=0;d<c;d+=h){const _=e[d],m=e[d+1],y=i(_,m,t);r[d]=y[0],r[d+1]=y[1]}return r}}function rp(i){return Ru(i)?new ia({code:i,units:"m"}):null}function sp(i){const t=Ru(i.getCode());return t?{forward:lh(np,t),inverse:lh(Q_,t)}:null}const op=[sp],ap=[rp];let Wo=!0;function lp(i){Wo=!1}function oa(i,t){if(t!==void 0){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];t=t}else t=i.slice();return t}function jo(i){j_(i.getCode(),i),ur(i,i,oa)}function hp(i){i.forEach(jo)}function me(i){if(typeof i!="string")return i;const t=W_(i);if(t)return t;for(const e of ap){const r=e(i);if(r)return r}return null}function hh(i,t,e,r){i=me(i);let s;const h=i.getPointResolutionFunc();if(h)s=h(t,e);else{const c=i.getUnits();if(c=="degrees"||r=="degrees")s=t;else{const d=la(i,me("EPSG:4326"));if(!d&&c!=="degrees")s=t*i.getMetersPerUnit();else{let m=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];m=d(m,m,2);const y=eh(m.slice(0,2),m.slice(2,4)),x=eh(m.slice(4,6),m.slice(6,8));s=(y+x)/2}const _=i.getMetersPerUnit();_!==void 0&&(s/=_)}}return s}function uh(i){hp(i),i.forEach(function(t){i.forEach(function(e){t!==e&&ur(t,e,oa)})})}function up(i,t,e,r){i.forEach(function(s){t.forEach(function(h){ur(s,h,e),ur(h,s,r)})})}function aa(i,t){return i?typeof i=="string"?me(i):i:me(t)}function cp(i){return function(t,e,r,s){const h=t.length;r=r!==void 0?r:2,s=s??r,e=e!==void 0?e:new Array(h);for(let c=0;c<h;c+=s){const d=i(t.slice(c,c+r)),_=d.length;for(let m=0,y=s;m<y;++m)e[c+m]=m>=_?t[c+m]:d[m]}return e}}function ar(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||la(i,t)===oa)&&e}function la(i,t){const e=i.getCode(),r=t.getCode();let s=Eo(e,r);if(s)return s;let h=null,c=null;for(const _ of op)h||(h=_(i)),c||(c=_(t));if(!h&&!c)return null;const d="EPSG:4326";if(c)if(h)s=xo(h.inverse,c.forward);else{const _=Eo(e,d);_&&(s=xo(_,c.forward))}else{const _=Eo(d,r);_&&(s=xo(h.inverse,_))}return s&&(jo(i),jo(t),ur(i,t,s)),s}function xo(i,t){return function(e,r,s,h){return r=i(e,r,s,h),t(r,r,s,h)}}function ps(i,t){const e=me(i),r=me(t);return la(e,r)}function Tu(i,t,e){const r=ps(t,e);if(!r){const s=me(t).getCode(),h=me(e).getCode();throw new Error(`No transform available between ${s} and ${h}`)}return r(i,void 0,i.length)}function Vo(i,t){return i}function We(i,t){return Wo&&!ds(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Wo=!1,vu("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function fp(i,t){return i}function Ze(i,t){return i}function dp(){uh(nh),uh(rh),up(rh,nh,z_,Y_)}dp();new Array(6);function mn(){return[1,0,0,1,0,0]}function de(i,t){const e=t[0],r=t[1];return t[0]=i[0]*e+i[2]*r+i[4],t[1]=i[1]*e+i[3]*r+i[5],t}function _i(i,t,e,r,s,h,c,d){const _=Math.sin(h),m=Math.cos(h);return i[0]=r*m,i[1]=s*_,i[2]=-r*_,i[3]=s*m,i[4]=c*r*m-d*r*_+t,i[5]=c*s*_+d*s*m+e,i}function Iu(i,t){const e=gp(t);Mt(e!==0,"Transformation matrix cannot be inverted");const r=t[0],s=t[1],h=t[2],c=t[3],d=t[4],_=t[5];return i[0]=c/e,i[1]=-s/e,i[2]=-h/e,i[3]=r/e,i[4]=(h*_-c*d)/e,i[5]=-(r*_-s*d)/e,i}function gp(i){return i[0]*i[3]-i[1]*i[2]}const ch=[1e6,1e6,1e6,1e6,2,2];function _p(i){return"matrix("+i.map((e,r)=>Math.round(e*ch[r])/ch[r]).join(", ")+")"}function pp(i,t,e,r,s,h,c){h=h||[],c=c||2;let d=0;for(let _=t;_<e;_+=r){const m=i[_],y=i[_+1];h[d++]=s[0]*m+s[2]*y+s[4],h[d++]=s[1]*m+s[3]*y+s[5];for(let x=2;x<c;x++)h[d++]=i[_+x]}return h&&h.length!=d&&(h.length=d),h}function mp(i,t,e,r,s,h,c){c=c||[];const d=Math.cos(s),_=Math.sin(s),m=h[0],y=h[1];let x=0;for(let w=t;w<e;w+=r){const C=i[w]-m,T=i[w+1]-y;c[x++]=m+C*d-T*_,c[x++]=y+C*_+T*d;for(let O=w+2;O<w+r;++O)c[x++]=i[O]}return c&&c.length!=x&&(c.length=x),c}function vp(i,t,e,r,s,h,c,d){d=d||[];const _=c[0],m=c[1];let y=0;for(let x=t;x<e;x+=r){const w=i[x]-_,C=i[x+1]-m;d[y++]=_+s*w,d[y++]=m+h*C;for(let T=x+2;T<x+r;++T)d[y++]=i[T]}return d&&d.length!=y&&(d.length=y),d}function yp(i,t,e,r,s,h,c){c=c||[];let d=0;for(let _=t;_<e;_+=r){c[d++]=i[_]+s,c[d++]=i[_+1]+h;for(let m=_+2;m<_+r;++m)c[d++]=i[m]}return c&&c.length!=d&&(c.length=d),c}const fh=mn(),Ep=[NaN,NaN];class xp extends $e{constructor(){super(),this.extent_=En(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=h_((t,e,r)=>{if(!r)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(r),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Tt()}closestPointXY(t,e,r,s){return Tt()}containsXY(t,e){return this.closestPointXY(t,e,Ep,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Tt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Os(e),this.extentRevision_=this.getRevision()}return A_(this.extent_,t)}rotate(t,e){Tt()}scale(t,e,r){Tt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Tt()}getType(){return Tt()}applyTransform(t){Tt()}intersectsExtent(t){return Tt()}translate(t,e){Tt()}transform(t,e){const r=me(t),s=r.getUnits()=="tile-pixels"?function(h,c,d){const _=r.getExtent(),m=r.getWorldExtent(),y=Wt(m)/Wt(_);_i(fh,m[0],m[3],y,-y,0,0,0);const x=pp(h,0,h.length,d,fh,c),w=ps(r,e);return w?w(x,x,d):x}:ps(r,e);return this.applyTransform(s),this}}class ha extends xp{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return I_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Tt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=dh(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Tt()}setLayout(t,e,r){let s;if(t)s=dh(t);else{for(let h=0;h<r;++h){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=wp(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const r=this.getFlatCoordinates();if(r){const s=this.getStride();mp(r,0,r.length,s,t,e,r),this.changed()}}scale(t,e,r){e===void 0&&(e=t),r||(r=Ke(this.getExtent()));const s=this.getFlatCoordinates();if(s){const h=this.getStride();vp(s,0,s.length,h,t,e,r,s),this.changed()}}translate(t,e){const r=this.getFlatCoordinates();if(r){const s=this.getStride();yp(r,0,r.length,s,t,e,r),this.changed()}}}function wp(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function dh(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Cu(i,t,e,r){let s=0;const h=i[e-r],c=i[e-r+1];let d=0,_=0;for(;t<e;t+=r){const m=i[t]-h,y=i[t+1]-c;s+=_*m-d*y,d=m,_=y}return s/2}function Rp(i,t,e,r){let s=0;for(let h=0,c=e.length;h<c;++h){const d=e[h];s+=Cu(i,t,d,r),t=d}return s}function gh(i,t,e,r,s,h,c){const d=i[t],_=i[t+1],m=i[e]-d,y=i[e+1]-_;let x;if(m===0&&y===0)x=t;else{const w=((s-d)*m+(h-_)*y)/(m*m+y*y);if(w>1)x=e;else if(w>0){for(let C=0;C<r;++C)c[C]=x_(i[t+C],i[e+C],w);c.length=r;return}else x=t}for(let w=0;w<r;++w)c[w]=i[x+w];c.length=r}function Su(i,t,e,r,s){let h=i[t],c=i[t+1];for(t+=r;t<e;t+=r){const d=i[t],_=i[t+1],m=li(h,c,d,_);m>s&&(s=m),h=d,c=_}return s}function Tp(i,t,e,r,s){for(let h=0,c=e.length;h<c;++h){const d=e[h];s=Su(i,t,d,r,s),t=d}return s}function Au(i,t,e,r,s,h,c,d,_,m,y){if(t==e)return m;let x,w;if(s===0){if(w=li(c,d,i[t],i[t+1]),w<m){for(x=0;x<r;++x)_[x]=i[t+x];return _.length=r,w}return m}y=y||[NaN,NaN];let C=t+r;for(;C<e;)if(gh(i,C-r,C,r,c,d,y),w=li(c,d,y[0],y[1]),w<m){for(m=w,x=0;x<r;++x)_[x]=y[x];_.length=r,C+=r}else C+=r*Math.max((Math.sqrt(w)-Math.sqrt(m))/s|0,1);if(gh(i,e-r,t,r,c,d,y),w=li(c,d,y[0],y[1]),w<m){for(m=w,x=0;x<r;++x)_[x]=y[x];_.length=r}return m}function Ip(i,t,e,r,s,h,c,d,_,m,y){y=y||[NaN,NaN];for(let x=0,w=e.length;x<w;++x){const C=e[x];m=Au(i,t,C,r,s,h,c,d,_,m,y),t=C}return m}function Cp(i,t,e,r){for(let s=0,h=e.length;s<h;++s)i[t++]=e[s];return t}function Ou(i,t,e,r){for(let s=0,h=e.length;s<h;++s){const c=e[s];for(let d=0;d<r;++d)i[t++]=c[d]}return t}function Sp(i,t,e,r,s){s=s||[];let h=0;for(let c=0,d=e.length;c<d;++c){const _=Ou(i,t,e[c],r);s[h++]=_,t=_}return s.length=h,s}function Lu(i,t,e,r,s){s=s!==void 0?s:[];let h=0;for(let c=t;c<e;c+=r)s[h++]=i.slice(c,c+r);return s.length=h,s}function Ap(i,t,e,r,s){s=s!==void 0?s:[];let h=0;for(let c=0,d=e.length;c<d;++c){const _=e[c];s[h++]=Lu(i,t,_,r,s[h]),t=_}return s.length=h,s}function Op(i,t,e,r,s,h,c){const d=(e-t)/r;if(d<3){for(;t<e;t+=r)h[c++]=i[t],h[c++]=i[t+1];return c}const _=new Array(d);_[0]=1,_[d-1]=1;const m=[t,e-r];let y=0;for(;m.length>0;){const x=m.pop(),w=m.pop();let C=0;const T=i[w],O=i[w+1],M=i[x],A=i[x+1];for(let D=w+r;D<x;D+=r){const z=i[D],b=i[D+1],F=y_(z,b,T,O,M,A);F>C&&(y=D,C=F)}C>s&&(_[(y-t)/r]=1,w+r<y&&m.push(w,y),y+r<x&&m.push(y,x))}for(let x=0;x<d;++x)_[x]&&(h[c++]=i[t+x*r],h[c++]=i[t+x*r+1]);return c}function qn(i,t){return t*Math.round(i/t)}function Lp(i,t,e,r,s,h,c){if(t==e)return c;let d=qn(i[t],s),_=qn(i[t+1],s);t+=r,h[c++]=d,h[c++]=_;let m,y;do if(m=qn(i[t],s),y=qn(i[t+1],s),t+=r,t==e)return h[c++]=m,h[c++]=y,c;while(m==d&&y==_);for(;t<e;){const x=qn(i[t],s),w=qn(i[t+1],s);if(t+=r,x==m&&w==y)continue;const C=m-d,T=y-_,O=x-d,M=w-_;if(C*M==T*O&&(C<0&&O<C||C==O||C>0&&O>C)&&(T<0&&M<T||T==M||T>0&&M>T)){m=x,y=w;continue}h[c++]=m,h[c++]=y,d=m,_=y,m=x,y=w}return h[c++]=m,h[c++]=y,c}function Mp(i,t,e,r,s,h,c,d){for(let _=0,m=e.length;_<m;++_){const y=e[_];c=Lp(i,t,y,r,s,h,c),d.push(c),t=y}return c}class cr extends ha{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new cr(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,r,s){return s<uu(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Su(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Au(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,s))}getArea(){return Cu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Lu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Op(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new cr(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ou(this.flatCoordinates,0,t,this.stride),this.changed()}}class ua extends ha{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ua(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,s){const h=this.flatCoordinates,c=li(t,e,h[0],h[1]);if(c<s){const d=this.stride;for(let _=0;_<d;++_)r[_]=h[_];return r.length=d,c}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return T_(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return cu(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Cp(this.flatCoordinates,0,t,this.stride),this.changed()}}function Pp(i,t,e,r,s){return!gu(s,function(c){return!Pn(i,t,e,r,c[0],c[1])})}function Pn(i,t,e,r,s,h){let c=0,d=i[e-r],_=i[e-r+1];for(;t<e;t+=r){const m=i[t],y=i[t+1];_<=h?y>h&&(m-d)*(h-_)-(s-d)*(y-_)>0&&c++:y<=h&&(m-d)*(h-_)-(s-d)*(y-_)<0&&c--,d=m,_=y}return c!==0}function Mu(i,t,e,r,s,h){if(e.length===0||!Pn(i,t,e[0],r,s,h))return!1;for(let c=1,d=e.length;c<d;++c)if(Pn(i,e[c-1],e[c],r,s,h))return!1;return!0}function Dp(i,t,e,r,s,h,c){let d,_,m,y,x,w,C;const T=s[h+1],O=[];for(let D=0,z=e.length;D<z;++D){const b=e[D];for(y=i[b-r],w=i[b-r+1],d=t;d<b;d+=r)x=i[d],C=i[d+1],(T<=w&&C<=T||w<=T&&T<=C)&&(m=(T-w)/(C-w)*(x-y)+y,O.push(m)),y=x,w=C}let M=NaN,A=-1/0;for(O.sort(Rs),y=O[0],d=1,_=O.length;d<_;++d){x=O[d];const D=Math.abs(x-y);D>A&&(m=(y+x)/2,Mu(i,t,e,r,m,T)&&(M=m,A=D)),y=x}return isNaN(M)&&(M=s[h]),[M,T,A]}function Fp(i,t,e,r,s){let h;for(t+=r;t<e;t+=r)if(h=s(i.slice(t-r,t),i.slice(t,t+r)),h)return h;return!1}function Pu(i,t,e,r,s,h){return h=h??du(En(),i,t,e,r),mi(s,h)?h[0]>=s[0]&&h[2]<=s[2]||h[1]>=s[1]&&h[3]<=s[3]?!0:Fp(i,t,e,r,function(c,d){return O_(s,c,d)}):!1}function Du(i,t,e,r,s){return!!(Pu(i,t,e,r,s)||Pn(i,t,e,r,s[0],s[1])||Pn(i,t,e,r,s[0],s[3])||Pn(i,t,e,r,s[2],s[1])||Pn(i,t,e,r,s[2],s[3]))}function bp(i,t,e,r,s){if(!Du(i,t,e[0],r,s))return!1;if(e.length===1)return!0;for(let h=1,c=e.length;h<c;++h)if(Pp(i,e[h-1],e[h],r,s)&&!Pu(i,e[h-1],e[h],r,s))return!1;return!0}function Np(i,t,e,r){for(;t<e-r;){for(let s=0;s<r;++s){const h=i[t+s];i[t+s]=i[e-r+s],i[e-r+s]=h}t+=r,e-=r}}function Fu(i,t,e,r){let s=0,h=i[e-r],c=i[e-r+1];for(;t<e;t+=r){const d=i[t],_=i[t+1];s+=(d-h)*(_+c),h=d,c=_}return s===0?void 0:s>0}function Gp(i,t,e,r,s){s=s!==void 0?s:!1;for(let h=0,c=e.length;h<c;++h){const d=e[h],_=Fu(i,t,d,r);if(h===0){if(s&&_||!s&&!_)return!1}else if(s&&!_||!s&&_)return!1;t=d}return!0}function _h(i,t,e,r,s){s=s!==void 0?s:!1;for(let h=0,c=e.length;h<c;++h){const d=e[h],_=Fu(i,t,d,r);(h===0?s&&_||!s&&!_:s&&!_||!s&&_)&&Np(i,t,d,r),t=d}return t}class fr extends ha{constructor(t,e,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&r?(this.setFlatCoordinates(e,t),this.ends_=r):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?a_(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new fr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,s){return s<uu(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Tp(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ip(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,s))}containsXY(t,e){return Mu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Rp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),_h(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ap(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ke(this.getExtent());this.flatInteriorPoint_=Dp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ua(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new cr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,r=this.ends_,s=[];let h=0;for(let c=0,d=r.length;c<d;++c){const _=r[c],m=new cr(e.slice(h,_),t);s.push(m),h=_}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Gp(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=_h(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],r=[];return e.length=Mp(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,r),new fr(e,"XY",r)}getType(){return"Polygon"}intersectsExtent(t){return bp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=Sp(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}}function ph(i){if(vi(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],r=i[2],s=i[3],h=[t,e,t,s,r,s,r,e,t,e];return new fr(h,"XY",[h.length])}function ca(i,t,e,r){const s=yt(t)/e[0],h=Wt(t)/e[1];return r?Math.min(i,Math.max(s,h)):Math.min(i,Math.min(s,h))}function fa(i,t,e){let r=Math.min(i,t);const s=50;return r*=Math.log(1+s*Math.max(0,i/t-1))/s+1,e&&(r=Math.max(r,e),r/=Math.log(1+s*Math.max(0,e/i-1))/s+1),Kt(r,e/2,t*2)}function kp(i,t,e,r){return t=t!==void 0?t:!0,function(s,h,c,d){if(s!==void 0){const _=i[0],m=i[i.length-1],y=e?ca(_,e,c,r):_;if(d)return t?fa(s,y,m):Kt(s,m,y);const x=Math.min(y,s),w=Math.floor(Ts(i,x,h));return i[w]>y&&w<i.length-1?i[w+1]:i[w]}}}function Xp(i,t,e,r,s,h){return r=r!==void 0?r:!0,e=e!==void 0?e:0,function(c,d,_,m){if(c!==void 0){const y=s?ca(t,s,_,h):t;if(m)return r?fa(c,y,e):Kt(c,e,y);const x=1e-9,w=Math.ceil(Math.log(t/y)/Math.log(i)-x),C=-d*(.5-x)+.5,T=Math.min(y,c),O=Math.floor(Math.log(t/T)/Math.log(i)+C),M=Math.max(w,O),A=t/Math.pow(i,M);return Kt(A,e,y)}}}function mh(i,t,e,r,s){return e=e!==void 0?e:!0,function(h,c,d,_){if(h!==void 0){const m=r?ca(i,r,d,s):i;return!e||!_?Kt(h,t,m):fa(h,m,t)}}}function da(i){if(i!==void 0)return 0}function vh(i){if(i!==void 0)return i}function zp(i){const t=2*Math.PI/i;return function(e,r){if(r)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function Yp(i){const t=pn(5);return function(e,r){return r||e===void 0?e:Math.abs(e)<=t?0:e}}const Bp=42,ga=256,wo=0;class Fe extends $e{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=aa(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&lp(),t.center&&(t.center=We(t.center,this.projection_)),t.extent&&(t.extent=Ze(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const d in Se)delete e[d];this.setProperties(e,!0);const r=Wp(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;const s=Up(t),h=r.constraint,c=jp(t);this.constraints_={center:s,resolution:h,rotation:c},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const r=this.getCenterInternal();if(r){const s=t||[0,0,0,0];e=e||[0,0,0,0];const h=this.getResolution(),c=h/2*(s[3]-e[3]+e[1]-s[1]),d=h/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([r[0]+c,r[1]-d])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let r=0;r<e.length;++r){let s=arguments[r];s.center&&(s=Object.assign({},s),s.center=We(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=We(s.anchor,this.getProjection())),e[r]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,r;e>1&&typeof arguments[e-1]=="function"&&(r=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const y=arguments[s];y.center&&this.setCenterInternal(y.center),y.zoom!==void 0?this.setZoom(y.zoom):y.resolution&&this.setResolution(y.resolution),y.rotation!==void 0&&this.setRotation(y.rotation)}if(s===e){r&&Qr(r,!0);return}let h=Date.now(),c=this.targetCenter_.slice(),d=this.targetResolution_,_=this.targetRotation_;const m=[];for(;s<e;++s){const y=arguments[s],x={start:h,complete:!1,anchor:y.anchor,duration:y.duration!==void 0?y.duration:1e3,easing:y.easing||b_,callback:r};if(y.center&&(x.sourceCenter=c,x.targetCenter=y.center.slice(),c=x.targetCenter),y.zoom!==void 0?(x.sourceResolution=d,x.targetResolution=this.getResolutionForZoom(y.zoom),d=x.targetResolution):y.resolution&&(x.sourceResolution=d,x.targetResolution=y.resolution,d=x.targetResolution),y.rotation!==void 0){x.sourceRotation=_;const w=hi(y.rotation-_+Math.PI,2*Math.PI)-Math.PI;x.targetRotation=_+w,_=x.targetRotation}Vp(x)?x.complete=!0:h+=x.duration,m.push(x)}this.animations_.push(m),this.setHint(fe.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[fe.ANIMATING]>0}getInteracting(){return this.hints_[fe.INTERACTING]>0}cancelAnimations(){this.setHint(fe.ANIMATING,-this.hints_[fe.ANIMATING]);let t;for(let e=0,r=this.animations_.length;e<r;++e){const s=this.animations_[e];if(s[0].callback&&Qr(s[0].callback,!1),!t)for(let h=0,c=s.length;h<c;++h){const d=s[h];if(!d.complete){t=d.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let r=this.animations_.length-1;r>=0;--r){const s=this.animations_[r];let h=!0;for(let c=0,d=s.length;c<d;++c){const _=s[c];if(_.complete)continue;const m=t-_.start;let y=_.duration>0?m/_.duration:1;y>=1?(_.complete=!0,y=1):h=!1;const x=_.easing(y);if(_.sourceCenter){const w=_.sourceCenter[0],C=_.sourceCenter[1],T=_.targetCenter[0],O=_.targetCenter[1];this.nextCenter_=_.targetCenter;const M=w+x*(T-w),A=C+x*(O-C);this.targetCenter_=[M,A]}if(_.sourceResolution&&_.targetResolution){const w=x===1?_.targetResolution:_.sourceResolution+x*(_.targetResolution-_.sourceResolution);if(_.anchor){const C=this.getViewportSize_(this.getRotation()),T=this.constraints_.resolution(w,0,C,!0);this.targetCenter_=this.calculateCenterZoom(T,_.anchor)}this.nextResolution_=_.targetResolution,this.targetResolution_=w,this.applyTargetState_(!0)}if(_.sourceRotation!==void 0&&_.targetRotation!==void 0){const w=x===1?hi(_.targetRotation+Math.PI,2*Math.PI)-Math.PI:_.sourceRotation+x*(_.targetRotation-_.sourceRotation);if(_.anchor){const C=this.constraints_.rotation(w,!0);this.targetCenter_=this.calculateCenterRotate(C,_.anchor)}this.nextRotation_=_.targetRotation,this.targetRotation_=w}if(this.applyTargetState_(!0),e=!0,!_.complete)break}if(h){this.animations_[r]=null,this.setHint(fe.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const c=s[0].callback;c&&Qr(c,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let r;const s=this.getCenterInternal();return s!==void 0&&(r=[s[0]-e[0],s[1]-e[1]],ea(r,t-this.getRotation()),M_(r,e)),r}calculateCenterZoom(t,e){let r;const s=this.getCenterInternal(),h=this.getResolution();if(s!==void 0&&h!==void 0){const c=e[0]-t*(e[0]-s[0])/h,d=e[1]-t*(e[1]-s[1])/h;r=[c,d]}return r}getViewportSize_(t){const e=this.viewportSize_;if(t){const r=e[0],s=e[1];return[Math.abs(r*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Vo(t,this.getProjection())}getCenterInternal(){return this.get(Se.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return fp(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Mt(e,"The view center is not defined");const r=this.getResolution();Mt(r!==void 0,"The view resolution is not defined");const s=this.getRotation();return Mt(s!==void 0,"The view rotation is not defined"),fs(e,r,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Se.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ze(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const r=yt(t)/e[0],s=Wt(t)/e[1];return Math.max(r,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(e/r)/Math.log(t);return function(h){return e/Math.pow(t,h*s)}}getRotation(){return this.get(Se.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,h=Math.log(r/s)/e;return function(c){return Math.log(r/c)/e/h}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const r=this.padding_;return r&&(e=[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),r=this.getRotation();let s=this.getCenterInternal();const h=this.padding_;if(h){const c=this.getViewportSizeMinusPadding_();s=Ro(s,this.getViewportSize_(),[c[0]/2+h[3],c[1]/2+h[0]],e,r)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,r,s;if(this.resolutions_){const h=Ts(this.resolutions_,t,1);e=h,r=this.resolutions_[h],h==this.resolutions_.length-1?s=2:s=r/this.resolutions_[h+1]}else r=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(r/t)/Math.log(s)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const r=Kt(Math.floor(t),0,this.resolutions_.length-2),s=this.resolutions_[r]/this.resolutions_[r+1];return this.resolutions_[r]/Math.pow(s,Kt(t-r,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let r;if(Mt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Mt(!vi(t),"Cannot fit empty extent provided as `geometry`");const s=Ze(t,this.getProjection());r=ph(s)}else if(t.getType()==="Circle"){const s=Ze(t.getExtent(),this.getProjection());r=ph(s),r.rotate(this.getRotation(),Ke(s))}else r=t;this.fitInternal(r,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),r=Math.cos(e),s=Math.sin(-e),h=t.getFlatCoordinates(),c=t.getStride();let d=1/0,_=1/0,m=-1/0,y=-1/0;for(let x=0,w=h.length;x<w;x+=c){const C=h[x]*r-h[x+1]*s,T=h[x]*s+h[x+1]*r;d=Math.min(d,C),_=Math.min(_,T),m=Math.max(m,C),y=Math.max(y,T)}return[d,_,m,y]}fitInternal(t,e){e=e||{};let r=e.size;r||(r=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],h=e.nearest!==void 0?e.nearest:!1;let c;e.minResolution!==void 0?c=e.minResolution:e.maxZoom!==void 0?c=this.getResolutionForZoom(e.maxZoom):c=0;const d=this.rotatedExtentForGeometry(t);let _=this.getResolutionForExtentInternal(d,[r[0]-s[1]-s[3],r[1]-s[0]-s[2]]);_=isNaN(_)?c:Math.max(_,c),_=this.getConstrainedResolution(_,h?0:1);const m=this.getRotation(),y=Math.sin(m),x=Math.cos(m),w=Ke(d);w[0]+=(s[1]-s[3])/2*_,w[1]+=(s[0]-s[2])/2*_;const C=w[0]*x-w[1]*y,T=w[1]*x+w[0]*y,O=this.getConstrainedCenter([C,T],_),M=e.callback?e.callback:hs;e.duration!==void 0?this.animateInternal({resolution:_,center:O,duration:e.duration,easing:e.easing},M):(this.targetResolution_=_,this.targetCenter_=O,this.applyTargetState_(!1,!0),Qr(M,!0))}centerOn(t,e,r){this.centerOnInternal(We(t,this.getProjection()),e,r)}centerOnInternal(t,e,r){this.setCenterInternal(Ro(t,e,r,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,r,s){let h;const c=this.padding_;if(c&&t){const d=this.getViewportSizeMinusPadding_(-r),_=Ro(t,s,[d[0]/2+c[3],d[1]/2+c[0]],e,r);h=[t[0]-_[0],t[1]-_[1]]}return h}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Vo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&We(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const r=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),h=this.constraints_.resolution(this.targetResolution_*t,0,s,r);e&&(this.targetCenter_=this.calculateCenterZoom(h,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=We(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const r=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,r);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&We(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const r=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,r),h=this.getViewportSize_(s),c=this.constraints_.resolution(this.targetResolution_,0,h,r),d=this.constraints_.center(this.targetCenter_,c,h,r,this.calculateCenterShift(this.targetCenter_,c,s,h));this.get(Se.ROTATION)!==s&&this.set(Se.ROTATION,s),this.get(Se.RESOLUTION)!==c&&(this.set(Se.RESOLUTION,c),this.set("zoom",this.getZoom(),!0)),(!d||!this.get(Se.CENTER)||!ds(this.get(Se.CENTER),d))&&this.set(Se.CENTER,d),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,r){t=t!==void 0?t:200;const s=e||0,h=this.constraints_.rotation(this.targetRotation_),c=this.getViewportSize_(h),d=this.constraints_.resolution(this.targetResolution_,s,c),_=this.constraints_.center(this.targetCenter_,d,c,!1,this.calculateCenterShift(this.targetCenter_,d,h,c));if(t===0&&!this.cancelAnchor_){this.targetResolution_=d,this.targetRotation_=h,this.targetCenter_=_,this.applyTargetState_();return}r=r||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==d||this.getRotation()!==h||!this.getCenterInternal()||!ds(this.getCenterInternal(),_))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:h,center:_,resolution:d,duration:t,easing:yi,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(fe.INTERACTING,1)}endInteraction(t,e,r){r=r&&We(r,this.getProjection()),this.endInteractionInternal(t,e,r)}endInteractionInternal(t,e,r){this.getInteracting()&&(this.setHint(fe.INTERACTING,-1),this.resolveConstraints(t,e,r))}getConstrainedCenter(t,e){const r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),r)}getConstrainedZoom(t,e){const r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,e))}getConstrainedResolution(t,e){e=e||0;const r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,r)}}function Qr(i,t){setTimeout(function(){i(t)},0)}function Up(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Jl(i.extent,i.constrainOnlyCenter,e)}const t=aa(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Jl(e,!1,!1)}return w_}function Wp(i){let t,e,r,c=i.minZoom!==void 0?i.minZoom:wo,d=i.maxZoom!==void 0?i.maxZoom:28;const _=i.zoomFactor!==void 0?i.zoomFactor:2,m=i.multiWorld!==void 0?i.multiWorld:!1,y=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,x=i.showFullExtent!==void 0?i.showFullExtent:!1,w=aa(i.projection,"EPSG:3857"),C=w.getExtent();let T=i.constrainOnlyCenter,O=i.extent;if(!m&&!O&&w.isGlobal()&&(T=!1,O=C),i.resolutions!==void 0){const M=i.resolutions;e=M[c],r=M[d]!==void 0?M[d]:M[M.length-1],i.constrainResolution?t=kp(M,y,!T&&O,x):t=mh(e,r,y,!T&&O,x)}else{const A=(C?Math.max(yt(C),Wt(C)):360*na.degrees/w.getMetersPerUnit())/ga/Math.pow(2,wo),D=A/Math.pow(2,28-wo);e=i.maxResolution,e!==void 0?c=0:e=A/Math.pow(_,c),r=i.minResolution,r===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?r=e/Math.pow(_,d):r=A/Math.pow(_,d):r=D),d=c+Math.floor(Math.log(e/r)/Math.log(_)),r=e/Math.pow(_,d-c),i.constrainResolution?t=Xp(_,e,r,y,!T&&O,x):t=mh(e,r,y,!T&&O,x)}return{constraint:t,maxResolution:e,minResolution:r,minZoom:c,zoomFactor:_}}function jp(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?Yp():e===!1?vh:typeof e=="number"?zp(e):vh}return da}function Vp(i){return!(i.sourceCenter&&i.targetCenter&&!ds(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Ro(i,t,e,r,s){const h=Math.cos(-s);let c=Math.sin(-s),d=i[0]*h-i[1]*c,_=i[1]*h+i[0]*c;d+=(t[0]/2-e[0])*r,_+=(e[1]-t[1]/2)*r,c=-c;const m=d*h-_*c,y=_*h+d*c;return[m,y]}const ts="ol-hidden",bs="ol-unselectable",_a="ol-control",yh="ol-collapsed";function Qt(i,t,e,r){let s;return e&&e.length?s=e.shift():su?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",r)}let To;function ms(){return To||(To=Qt(1,1)),To}function pa(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Eh(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function Zp(i){for(;i.lastChild;)i.lastChild.remove()}function Kp(i,t){const e=i.childNodes;for(let r=0;;++r){const s=e[r],h=t[r];if(!s&&!h)break;if(s!==h){if(!s){i.appendChild(h);continue}if(!h){i.removeChild(s),--r;continue}i.insertBefore(h,s)}}}class ma extends $e{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let r=0,s=this.listenerKeys.length;r<s;++r)Gt(this.listenerKeys[r]);if(this.listenerKeys.length=0,this.map_=t,t){const r=this.target_??t.getOverlayContainerStopEvent();this.element&&r.appendChild(this.element),this.render!==hs&&this.listenerKeys.push(St(t,dn.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class Hp extends ma{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",r=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",h=t.collapseLabel!==void 0?t.collapseLabel:"›",c=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof h=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=h,this.collapseLabel_.className=c):this.collapseLabel_=h;const d=t.label!==void 0?t.label:"i";typeof d=="string"?(this.label_=document.createElement("span"),this.label_.textContent=d,this.label_.className=s):this.label_=d;const _=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=r,this.toggleButton_.appendChild(_),this.toggleButton_.addEventListener(ct.CLICK,this.handleClick_.bind(this),!1);const m=e+" "+bs+" "+_a+(this.collapsed_&&this.collapsible_?" "+yh:"")+(this.collapsible_?"":" ol-uncollapsible"),y=this.element;y.className=m,y.appendChild(this.toggleButton_),y.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),r=new Set(e.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>r.add(s)):r.add(this.attributions_)),!this.overrideCollapsible_){const s=!e.some(h=>{var c;return((c=h.getSource())==null?void 0:c.getAttributionsCollapsible())===!1});this.setCollapsible(s)}return Array.from(r)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>ta(()=>s))),r=e.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!Is(e,this.renderedAttributions_)){Zp(this.ulElement_);for(let s=0,h=e.length;s<h;++s){const c=document.createElement("li");c.innerHTML=e[s],this.ulElement_.appendChild(c)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(yh),this.collapsed_?Eh(this.collapseLabel_,this.label_):Eh(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class $p extends ma{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",r=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof r=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=r):(this.label_=r,this.label_.classList.add(s));const h=t.tipLabel?t.tipLabel:"Reset rotation",c=document.createElement("button");c.className=e+"-reset",c.setAttribute("type","button"),c.title=h,c.appendChild(this.label_),c.addEventListener(ct.CLICK,this.handleClick_.bind(this),!1);const d=e+" "+bs+" "+_a,_=this.element;_.className=d,_.appendChild(c),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ts)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const r=e.getRotation();r!==void 0&&(this.duration_>0&&r%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:yi}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const r=e.viewState.rotation;if(r!=this.rotation_){const s="rotate("+r+"rad)";if(this.autoHide_){const h=this.element.classList.contains(ts);!h&&r===0?this.element.classList.add(ts):h&&r!==0&&this.element.classList.remove(ts)}this.label_.style.transform=s}this.rotation_=r}}class qp extends ma{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",r=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",h=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",c=t.zoomInLabel!==void 0?t.zoomInLabel:"+",d=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",_=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",m=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",y=document.createElement("button");y.className=s,y.setAttribute("type","button"),y.title=_,y.appendChild(typeof c=="string"?document.createTextNode(c):c),y.addEventListener(ct.CLICK,this.handleClick_.bind(this,r),!1);const x=document.createElement("button");x.className=h,x.setAttribute("type","button"),x.title=m,x.appendChild(typeof d=="string"?document.createTextNode(d):d),x.addEventListener(ct.CLICK,this.handleClick_.bind(this,-r),!1);const w=e+" "+bs+" "+_a,C=this.element;C.className=w,C.appendChild(y),C.appendChild(x),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const r=this.getMap().getView();if(!r)return;const s=r.getZoom();if(s!==void 0){const h=r.getConstrainedZoom(s+t);this.duration_>0?(r.getAnimating()&&r.cancelAnimations(),r.animate({zoom:h,duration:this.duration_,easing:yi})):r.setZoom(h)}}}function Jp(i){i=i||{};const t=new Ve;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new qp(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new $p(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new Hp(i.attributionOptions)),t}class Qp{constructor(t,e,r){this.decay_=t,this.minVelocity_=e,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let r=e-3;for(;r>0&&this.points_[r+2]>t;)r-=3;const s=this.points_[e+2]-this.points_[r+2];if(s<1e3/60)return!1;const h=this.points_[e]-this.points_[r],c=this.points_[e+1]-this.points_[r+1];return this.angle_=Math.atan2(c,h),this.initialVelocity_=Math.sqrt(h*h+c*c)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const xh={ACTIVE:"active"};class Er extends $e{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(xh.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(xh.ACTIVE,t)}setMap(t){this.map_=t}}function tm(i,t,e){const r=i.getCenterInternal();if(r){const s=[r[0]+t[0],r[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:N_,center:i.getConstrainedCenter(s)})}}function va(i,t,e,r){const s=i.getZoom();if(s===void 0)return;const h=i.getConstrainedZoom(s+t),c=i.getResolutionForZoom(h);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:c,anchor:e,duration:r!==void 0?r:250,easing:yi})}class em extends Er{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Ut.DBLCLICK){const r=t.originalEvent,s=t.map,h=t.coordinate,c=r.shiftKey?-this.delta_:this.delta_,d=s.getView();va(d,c,h,this.duration_),r.preventDefault(),e=!0}return!e}}function Zo(i){const t=arguments;return function(e){let r=!0;for(let s=0,h=t.length;s<h&&(r=r&&t[s](e),!!r);++s);return r}}const nm=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},im=function(i){const t=i.map.getTargetElement(),e=t.getRootNode(),r=i.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(r):t.contains(r)},bu=function(i){const t=i.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?im(i):!0},rm=ls,Nu=function(i){const t=i.originalEvent;return t.button==0&&!(g_&&iu&&t.ctrlKey)},Gu=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},sm=function(i){const t=i.originalEvent;return iu?t.metaKey:t.ctrlKey},om=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ku=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Io=function(i){const t=i.originalEvent;return Mt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},am=function(i){const t=i.originalEvent;return Mt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class xr extends Er{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ut.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Ut.POINTERUP){const r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==Ut.POINTERDOWN){const r=this.handleDownEvent(t);this.handlingDownUpSequence=r,e=this.stopDown(r)}else t.type==Ut.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function ya(i){const t=i.length;let e=0,r=0;for(let s=0;s<t;s++)e+=i[s].clientX,r+=i[s].clientY;return{clientX:e/t,clientY:r/t}}class lm extends xr{constructor(t){super({stopDown:Cs}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Zo(Gu,am);this.condition_=t.onFocusOnly?Zo(bu,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const r=this.targetPointers,s=e.getEventPixel(ya(r));if(r.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const h=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],d=t.map.getView();P_(h,d.getResolution()),ea(h,d.getRotation()),d.adjustCenterInternal(h)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=r.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,r=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),h=this.kinetic_.getAngle(),c=r.getCenterInternal(),d=e.getPixelFromCoordinateInternal(c),_=e.getCoordinateFromPixelInternal([d[0]-s*Math.cos(h),d[1]-s*Math.sin(h)]);r.animateInternal({center:r.getConstrainedCenter(_),duration:500,easing:yi})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const r=t.map.getView();return this.lastCentroid=null,r.getAnimating()&&r.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class hm extends xr{constructor(t){t=t||{},super({stopDown:Cs}),this.condition_=t.condition?t.condition:nm,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Io(t))return;const e=t.map,r=e.getView();if(r.getConstraints().rotation===da)return;const s=e.getSize(),h=t.pixel,c=Math.atan2(s[1]/2-h[1],h[0]-s[0]/2);if(this.lastAngle_!==void 0){const d=c-this.lastAngle_;r.adjustRotationInternal(-d)}this.lastAngle_=c}handleUpEvent(t){return Io(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Io(t)&&Nu(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class um extends pr{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,r="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+r,s.top=Math.min(t[1],e[1])+r,s.width=Math.abs(e[0]-t[0])+r,s.height=Math.abs(e[1]-t[1])+r}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new fr([s])}getGeometry(){return this.geometry_}}const Jn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class qi extends Ne{constructor(t,e,r){super(t),this.coordinate=e,this.mapBrowserEvent=r}}class cm extends xr{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new um(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??Nu,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,r){const s=r[0]-e[0],h=r[1]-e[1];return s*s+h*h>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new qi(Jn.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new qi(e?Jn.BOXEND:Jn.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new qi(Jn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new qi(Jn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new qi(Jn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class fm extends cm{constructor(t){t=t||{};const e=t.condition?t.condition:om;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const r=this.getMap().getView();let s=this.getGeometry();if(this.out_){const h=r.rotatedExtentForGeometry(s),c=r.getResolutionForExtentInternal(h),d=r.getResolution()/c;s=s.clone(),s.scale(d*d)}r.fitInternal(s,{duration:this.duration_,easing:yi})}}const On={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class dm extends Er{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Gu(e)&&ku(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==ct.KEYDOWN){const r=t.originalEvent,s=r.key;if(this.condition_(t)&&(s==On.DOWN||s==On.LEFT||s==On.RIGHT||s==On.UP)){const c=t.map.getView(),d=c.getResolution()*this.pixelDelta_;let _=0,m=0;s==On.DOWN?m=-d:s==On.LEFT?_=-d:s==On.RIGHT?_=d:m=d;const y=[_,m];ea(y,c.getRotation()),tm(c,y,this.duration_),r.preventDefault(),e=!0}}return!e}}class gm extends Er{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!sm(e)&&ku(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==ct.KEYDOWN||t.type==ct.KEYPRESS){const r=t.originalEvent,s=r.key;if(this.condition_(t)&&(s==="+"||s==="-")){const h=t.map,c=s==="+"?this.delta_:-this.delta_,d=h.getView();va(d,c,void 0,this.duration_),r.preventDefault(),e=!0}}return!e}}class _m extends Er{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:rm;this.condition_=t.onFocusOnly?Zo(bu,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==ct.WHEEL)return!0;const r=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let h;if(t.type==ct.WHEEL&&(h=s.deltaY,f_&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(h/=ru),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(h*=40)),h===0)return!1;this.lastDelta_=h;const c=Date.now();this.startTime_===void 0&&(this.startTime_=c),(!this.mode_||c-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(h)<4?"trackpad":"wheel");const d=r.getView();if(this.mode_==="trackpad"&&!(d.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(d.getAnimating()&&d.cancelAnimations(),d.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),d.adjustZoom(-h/this.deltaPerZoom_,this.lastAnchor_?r.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=c,!1;this.totalDelta_+=h;const _=Math.max(this.timeout_-(c-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),_),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let r=-Kt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),va(e,r,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class pm extends xr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Cs),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const r=this.targetPointers[0],s=this.targetPointers[1],h=Math.atan2(s.clientY-r.clientY,s.clientX-r.clientX);if(this.lastAngle_!==void 0){const _=h-this.lastAngle_;this.rotationDelta_+=_,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=_}this.lastAngle_=h;const c=t.map,d=c.getView();d.getConstraints().rotation!==da&&(this.anchor_=c.getCoordinateFromPixelInternal(c.getEventPixel(ya(this.targetPointers))),this.rotating_&&(c.render(),d.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class mm extends xr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Cs),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const r=this.targetPointers[0],s=this.targetPointers[1],h=r.clientX-s.clientX,c=r.clientY-s.clientY,d=Math.sqrt(h*h+c*c);this.lastDistance_!==void 0&&(e=this.lastDistance_/d),this.lastDistance_=d;const _=t.map,m=_.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=_.getCoordinateFromPixelInternal(_.getEventPixel(ya(this.targetPointers))),_.render(),m.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const r=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return r.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function vm(i){i=i||{};const t=new Ve,e=new Qp(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new hm),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new em({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new lm({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new pm),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new mm({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new dm),t.push(new gm({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new _m({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new fm({duration:i.zoomDuration})),t}const Ot={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Xu extends $e{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Ot.OPACITY]=t.opacity!==void 0?t.opacity:1,Mt(typeof e[Ot.OPACITY]=="number","Layer opacity must be a number"),e[Ot.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Ot.Z_INDEX]=t.zIndex,e[Ot.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Ot.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Ot.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Ot.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},r=this.getZIndex();return e.opacity=Kt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=r===void 0&&!e.managed?1/0:r,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Tt()}getLayerStatesArray(t){return Tt()}getExtent(){return this.get(Ot.EXTENT)}getMaxResolution(){return this.get(Ot.MAX_RESOLUTION)}getMinResolution(){return this.get(Ot.MIN_RESOLUTION)}getMinZoom(){return this.get(Ot.MIN_ZOOM)}getMaxZoom(){return this.get(Ot.MAX_ZOOM)}getOpacity(){return this.get(Ot.OPACITY)}getSourceState(){return Tt()}getVisible(){return this.get(Ot.VISIBLE)}getZIndex(){return this.get(Ot.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ot.EXTENT,t)}setMaxResolution(t){this.set(Ot.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Ot.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Ot.MAX_ZOOM,t)}setMinZoom(t){this.set(Ot.MIN_ZOOM,t)}setOpacity(t){Mt(typeof t=="number","Layer opacity must be a number"),this.set(Ot.OPACITY,t)}setVisible(t){this.set(Ot.VISIBLE,t)}setZIndex(t){this.set(Ot.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class gn extends Ne{constructor(t,e){super(t),this.layer=e}}const Co={LAYERS:"layers"};class Ei extends Xu{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let r=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Co.LAYERS,this.handleLayersChanged_),r?Array.isArray(r)?r=new Ve(r.slice(),{unique:!0}):Mt(typeof r.getArray=="function","Expected `layers` to be an array or a `Collection`"):r=new Ve(void 0,{unique:!0}),this.setLayers(r)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Gt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(St(t,we.ADD,this.handleLayersAdd_,this),St(t,we.REMOVE,this.handleLayersRemove_,this));for(const r in this.listenerKeys_)this.listenerKeys_[r].forEach(Gt);Ss(this.listenerKeys_);const e=t.getArray();for(let r=0,s=e.length;r<s;r++){const h=e[r];this.registerLayerListeners_(h),this.dispatchEvent(new gn("addlayer",h))}this.changed()}registerLayerListeners_(t){const e=[St(t,lr.PROPERTYCHANGE,this.handleLayerChange_,this),St(t,ct.CHANGE,this.handleLayerChange_,this)];t instanceof Ei&&e.push(St(t,"addlayer",this.handleLayerGroupAdd_,this),St(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ee(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new gn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new gn("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new gn("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,r=ee(e);this.listenerKeys_[r].forEach(Gt),delete this.listenerKeys_[r],this.dispatchEvent(new gn("removelayer",e)),this.changed()}getLayers(){return this.get(Co.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const r=e.getArray();for(let s=0,h=r.length;s<h;++s)this.dispatchEvent(new gn("removelayer",r[s]))}this.set(Co.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],r=e.length;this.getLayers().forEach(function(c){c.getLayerStatesArray(e)});const s=this.getLayerState();let h=s.zIndex;!t&&s.zIndex===void 0&&(h=0);for(let c=r,d=e.length;c<d;c++){const _=e[c];_.opacity*=s.opacity,_.visible=_.visible&&s.visible,_.maxResolution=Math.min(_.maxResolution,s.maxResolution),_.minResolution=Math.max(_.minResolution,s.minResolution),_.minZoom=Math.max(_.minZoom,s.minZoom),_.maxZoom=Math.min(_.maxZoom,s.maxZoom),s.extent!==void 0&&(_.extent!==void 0?_.extent=pe(_.extent,s.extent):_.extent=s.extent),_.zIndex===void 0&&(_.zIndex=h)}return e}getSourceState(){return"ready"}}const be={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class wr extends Xu{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Ot.SOURCE,this.handleSourcePropertyChange_);const r=t.source?t.source:null;this.setSource(r)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Ot.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Gt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=St(t,ct.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const r=this.getMapInternal();!t&&r&&(t=r.getView()),t instanceof Fe?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&r&&(e.layerStatesArray=r.getLayerGroup().getLayerStatesArray());let s;if(e.layerStatesArray){if(s=e.layerStatesArray.find(c=>c.layer===this),!s)return!1}else s=this.getLayerState();const h=this.getExtent();return Ea(s,e.viewState)&&(!h||mi(h,e.extent))}getAttributions(t){var h;if(!this.isVisible(t))return[];const e=(h=this.getSource())==null?void 0:h.getAttributions();if(!e)return[];const r=t instanceof Fe?t.getViewStateAndExtent():t;let s=e(r);return Array.isArray(s)||(s=[s]),s}render(t,e){const r=this.getRenderer();return r.prepareFrame(t)?(this.rendered=!0,r.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Ot.MAP,t)}getMapInternal(){return this.get(Ot.MAP)}setMap(t){this.mapPrecomposeKey_&&(Gt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Gt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=St(t,be.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=St(this,ct.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,r=this.getLayerState(!1);Mt(!e.some(s=>s.layer===r.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(r)}setSource(t){this.set(Ot.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Ea(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const r=t.zoom;return r>i.minZoom&&r<=i.maxZoom}function zu(i,t,e=0,r=i.length-1,s=ym){for(;r>e;){if(r-e>600){const _=r-e+1,m=t-e+1,y=Math.log(_),x=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*x*(_-x)/_)*(m-_/2<0?-1:1),C=Math.max(e,Math.floor(t-m*x/_+w)),T=Math.min(r,Math.floor(t+(_-m)*x/_+w));zu(i,t,C,T,s)}const h=i[t];let c=e,d=r;for(Ji(i,e,t),s(i[r],h)>0&&Ji(i,e,r);c<d;){for(Ji(i,c,d),c++,d--;s(i[c],h)<0;)c++;for(;s(i[d],h)>0;)d--}s(i[e],h)===0?Ji(i,e,d):(d++,Ji(i,d,r)),d<=t&&(e=d+1),t<=d&&(r=d-1)}}function Ji(i,t,e){const r=i[t];i[t]=i[e],i[e]=r}function ym(i,t){return i<t?-1:i>t?1:0}class Em{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!ns(t,e))return r;const s=this.toBBox,h=[];for(;e;){for(let c=0;c<e.children.length;c++){const d=e.children[c],_=e.leaf?s(d):d;ns(t,_)&&(e.leaf?r.push(d):Ao(t,_)?this._all(d,r):h.push(d))}e=h.pop()}return r}collides(t){let e=this.data;if(!ns(t,e))return!1;const r=[];for(;e;){for(let s=0;s<e.children.length;s++){const h=e.children[s],c=e.leaf?this.toBBox(h):h;if(ns(t,c)){if(e.leaf||Ao(t,c))return!0;r.push(h)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=si([]),this}remove(t,e){if(!t)return this;let r=this.data;const s=this.toBBox(t),h=[],c=[];let d,_,m;for(;r||h.length;){if(r||(r=h.pop(),_=h[h.length-1],d=c.pop(),m=!0),r.leaf){const y=xm(t,r.children,e);if(y!==-1)return r.children.splice(y,1),h.push(r),this._condense(h),this}!m&&!r.leaf&&Ao(r,s)?(h.push(r),c.push(d),d=0,_=r,r=r.children[0]):_?(d++,r=_.children[d],m=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,s){const h=r-e+1;let c=this._maxEntries,d;if(h<=c)return d=si(t.slice(e,r+1)),Qn(d,this.toBBox),d;s||(s=Math.ceil(Math.log(h)/Math.log(c)),c=Math.ceil(h/Math.pow(c,s-1))),d=si([]),d.leaf=!1,d.height=s;const _=Math.ceil(h/c),m=_*Math.ceil(Math.sqrt(c));wh(t,e,r,m,this.compareMinX);for(let y=e;y<=r;y+=m){const x=Math.min(y+m-1,r);wh(t,y,x,_,this.compareMinY);for(let w=y;w<=x;w+=_){const C=Math.min(w+_-1,x);d.children.push(this._build(t,w,C,s-1))}}return Qn(d,this.toBBox),d}_chooseSubtree(t,e,r,s){for(;s.push(e),!(e.leaf||s.length-1===r);){let h=1/0,c=1/0,d;for(let _=0;_<e.children.length;_++){const m=e.children[_],y=So(m),x=Tm(t,m)-y;x<c?(c=x,h=y<h?y:h,d=m):x===c&&y<h&&(h=y,d=m)}e=d||e.children[0]}return e}_insert(t,e,r){const s=r?t:this.toBBox(t),h=[],c=this._chooseSubtree(s,this.data,e,h);for(c.children.push(t),nr(c,s);e>=0&&h[e].children.length>this._maxEntries;)this._split(h,e),e--;this._adjustParentBBoxes(s,h,e)}_split(t,e){const r=t[e],s=r.children.length,h=this._minEntries;this._chooseSplitAxis(r,h,s);const c=this._chooseSplitIndex(r,h,s),d=si(r.children.splice(c,r.children.length-c));d.height=r.height,d.leaf=r.leaf,Qn(r,this.toBBox),Qn(d,this.toBBox),e?t[e-1].children.push(d):this._splitRoot(r,d)}_splitRoot(t,e){this.data=si([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Qn(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let s,h=1/0,c=1/0;for(let d=e;d<=r-e;d++){const _=er(t,0,d,this.toBBox),m=er(t,d,r,this.toBBox),y=Im(_,m),x=So(_)+So(m);y<h?(h=y,s=d,c=x<c?x:c):y===h&&x<c&&(c=x,s=d)}return s||r-e}_chooseSplitAxis(t,e,r){const s=t.leaf?this.compareMinX:wm,h=t.leaf?this.compareMinY:Rm,c=this._allDistMargin(t,e,r,s),d=this._allDistMargin(t,e,r,h);c<d&&t.children.sort(s)}_allDistMargin(t,e,r,s){t.children.sort(s);const h=this.toBBox,c=er(t,0,e,h),d=er(t,r-e,r,h);let _=es(c)+es(d);for(let m=e;m<r-e;m++){const y=t.children[m];nr(c,t.leaf?h(y):y),_+=es(c)}for(let m=r-e-1;m>=e;m--){const y=t.children[m];nr(d,t.leaf?h(y):y),_+=es(d)}return _}_adjustParentBBoxes(t,e,r){for(let s=r;s>=0;s--)nr(e[s],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():Qn(t[e],this.toBBox)}}function xm(i,t,e){if(!e)return t.indexOf(i);for(let r=0;r<t.length;r++)if(e(i,t[r]))return r;return-1}function Qn(i,t){er(i,0,i.children.length,t,i)}function er(i,t,e,r,s){s||(s=si(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let h=t;h<e;h++){const c=i.children[h];nr(s,i.leaf?r(c):c)}return s}function nr(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function wm(i,t){return i.minX-t.minX}function Rm(i,t){return i.minY-t.minY}function So(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function es(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Tm(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function Im(i,t){const e=Math.max(i.minX,t.minX),r=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),h=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,h-r)}function Ao(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function ns(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function si(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wh(i,t,e,r,s){const h=[t,e];for(;h.length;){if(e=h.pop(),t=h.pop(),e-t<=r)continue;const c=t+Math.ceil((e-t)/r/2)*r;zu(i,c,t,e,s),h.push(t,c,c,e)}}const Rh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Th={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Cm(i){var y,x;var t,e=[],r=1,s;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Rh[i])e=Rh[i].slice(),s="rgb";else if(i==="transparent")r=0,s="rgb",e=[0,0,0];else if(i[0]==="#"){var h=i.slice(1),c=h.length,d=c<=4;r=1,d?(e=[parseInt(h[0]+h[0],16),parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16)],c===4&&(r=parseInt(h[3]+h[3],16)/255)):(e=[parseInt(h[0]+h[1],16),parseInt(h[2]+h[3],16),parseInt(h[4]+h[5],16)],c===8&&(r=parseInt(h[6]+h[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),s="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var _=t[1];s=_.replace(/a$/,"");var m=s==="cmyk"?4:s==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=e.shift()),e=e.map(function(w,C){if(w[w.length-1]==="%")return w=parseFloat(w)/100,C===3?w:s==="rgb"?w*255:s[0]==="h"||s[0]==="l"&&!C?w*100:s==="lab"?w*125:s==="lch"?C<2?w*150:w*360:s[0]==="o"&&!C?w:s==="oklab"?w*.4:s==="oklch"?C<2?w*.4:w*360:w;if(s[C]==="h"||C===2&&s[s.length-1]==="h"){if(Th[w]!==void 0)return Th[w];if(w.endsWith("deg"))return parseFloat(w);if(w.endsWith("turn"))return parseFloat(w)*360;if(w.endsWith("grad"))return parseFloat(w)*360/400;if(w.endsWith("rad"))return parseFloat(w)*180/Math.PI}return w==="none"?0:parseFloat(w)}),r=e.length>m?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(w){return parseFloat(w)}),s=((x=(y=i.match(/([a-z])/ig))==null?void 0:y.join(""))==null?void 0:x.toLowerCase())||"rgb");return{space:s,values:e,alpha:r}}const dr={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Oo={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,r=i[2]/100,s,h,c,d,_,m=0;if(e===0)return _=r*255,[_,_,_];for(h=r<.5?r*(1+e):r+e-r*e,s=2*r-h,d=[0,0,0];m<3;)c=t+1/3*-(m-1),c<0?c++:c>1&&c--,_=6*c<1?s+(h-s)*6*c:2*c<1?h:3*c<2?s+(h-s)*(2/3-c)*6:s,d[m++]=_*255;return d}};dr.hsl=function(i){var t=i[0]/255,e=i[1]/255,r=i[2]/255,s=Math.min(t,e,r),h=Math.max(t,e,r),c=h-s,d,_,m;return h===s?d=0:t===h?d=(e-r)/c:e===h?d=2+(r-t)/c:r===h&&(d=4+(t-e)/c),d=Math.min(d*60,360),d<0&&(d+=360),m=(s+h)/2,h===s?_=0:m<=.5?_=c/(h+s):_=c/(2-h-s),[d,_*100,m*100]};function Sm(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=Cm(i);if(!e.space)return[];const r=e.space[0]==="h"?Oo.min:dr.min,s=e.space[0]==="h"?Oo.max:dr.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],r[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],r[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],r[2]),s[2]),e.space[0]==="h"&&(t=Oo.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const oe={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};oe.max=oe.whitepoint[2].D65;oe.rgb=function(i,t){t=t||oe.whitepoint[2].E;var e=i[0]/t[0],r=i[1]/t[1],s=i[2]/t[2],h,c,d;return h=e*3.240969941904521+r*-1.537383177570093+s*-.498610760293,c=e*-.96924363628087+r*1.87596750150772+s*.041555057407175,d=e*.055630079696993+r*-.20397695888897+s*1.056971514242878,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:h=h*12.92,c=c>.0031308?1.055*Math.pow(c,1/2.4)-.055:c=c*12.92,d=d>.0031308?1.055*Math.pow(d,1/2.4)-.055:d=d*12.92,h=Math.min(Math.max(0,h),1),c=Math.min(Math.max(0,c),1),d=Math.min(Math.max(0,d),1),[h*255,c*255,d*255]};dr.xyz=function(i,t){var e=i[0]/255,r=i[1]/255,s=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var h=e*.41239079926595+r*.35758433938387+s*.18048078840183,c=e*.21263900587151+r*.71516867876775+s*.072192315360733,d=e*.019330818715591+r*.11919477979462+s*.95053215224966;return t=t||oe.whitepoint[2].E,[h*t[0],c*t[1],d*t[2]]};var xa={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var r,s,h,c,d,_,m,y,x,w,C,T,O;if(h=i[0],c=i[1],d=i[2],h===0)return[0,0,0];var M=.0011070564598794539;return t=t||"D65",e=e||2,x=oe.whitepoint[e][t][0],w=oe.whitepoint[e][t][1],C=oe.whitepoint[e][t][2],T=4*x/(x+15*w+3*C),O=9*w/(x+15*w+3*C),r=c/(13*h)+T||0,s=d/(13*h)+O||0,m=h>8?w*Math.pow((h+16)/116,3):w*h*M,_=m*9*r/(4*s)||0,y=m*(12-3*r-20*s)/(4*s)||0,[_,m,y]}};oe.luv=function(i,t,e){var r,s,h,c,d,_,m,y,x,w,C,T,O,M=.008856451679035631,A=903.2962962962961;t=t||"D65",e=e||2,x=oe.whitepoint[e][t][0],w=oe.whitepoint[e][t][1],C=oe.whitepoint[e][t][2],T=4*x/(x+15*w+3*C),O=9*w/(x+15*w+3*C),_=i[0],m=i[1],y=i[2],r=4*_/(_+15*m+3*y)||0,s=9*m/(_+15*m+3*y)||0;var D=m/w;return h=D<=M?A*D:116*Math.pow(D,1/3)-16,c=13*h*(r-T),d=13*h*(s-O),[h,c,d]};var Yu={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var t=i[0],e=i[1],r=i[2],s,h,c;return c=r/360*2*Math.PI,s=e*Math.cos(c),h=e*Math.sin(c),[t,s,h]},xyz:function(i){return xa.xyz(Yu.luv(i))}};xa.lchuv=function(i){var t=i[0],e=i[1],r=i[2],s=Math.sqrt(e*e+r*r),h=Math.atan2(r,e),c=h*360/2/Math.PI;return c<0&&(c+=360),[t,s,c]};oe.lchuv=function(i){return xa.lchuv(oe.luv(i))};const wa=[NaN,NaN,NaN,0];function Am(i){return typeof i=="string"?i:Ta(i)}const Om=1024,Qi={};let Lo=0;function Lm(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function Ih(i){const t=oe.lchuv(dr.xyz(i));return t[3]=i[3],t}function Mm(i){const t=oe.rgb(Yu.xyz(i));return t[3]=i[3],t}function Ra(i){if(i==="none")return wa;if(Qi.hasOwnProperty(i))return Qi[i];if(Lo>=Om){let e=0;for(const r in Qi)(e++&3)===0&&(delete Qi[r],--Lo)}const t=Sm(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return Bu(t),Qi[i]=t,++Lo,t}function pi(i){return Array.isArray(i)?i:Ra(i)}function Bu(i){return i[0]=Kt(i[0]+.5|0,0,255),i[1]=Kt(i[1]+.5|0,0,255),i[2]=Kt(i[2]+.5|0,0,255),i[3]=Kt(i[3],0,1),i}function Ta(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let r=i[2];r!=(r|0)&&(r=r+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+r+","+s+")"}function Ch(i){return i[0]>0&&i[1]>0}function Pm(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function ne(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}let Fn=0;const he=1<<Fn++,vt=1<<Fn++,ge=1<<Fn++,Ae=1<<Fn++,Dn=1<<Fn++,ir=1<<Fn++,is=Math.pow(2,Fn)-1,Ia={[he]:"boolean",[vt]:"number",[ge]:"string",[Ae]:"color",[Dn]:"number[]",[ir]:"size"},Dm=Object.keys(Ia).map(Number).sort(Rs);function Fm(i){return i in Ia}function rr(i){const t=[];for(const e of Dm)sr(i,e)&&t.push(Ia[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function sr(i,t){return(i&t)===t}function un(i,t){return i===t}class Jt{constructor(t,e){if(!Fm(t))throw new Error(`literal expressions must have a specific type, got ${rr(t)}`);this.type=t,this.value=e}}class bm{constructor(t,e,...r){this.type=t,this.operator=e,this.args=r}}function Uu(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function ie(i,t,e){switch(typeof i){case"boolean":{if(un(t,ge))return new Jt(ge,i?"true":"false");if(!sr(t,he))throw new Error(`got a boolean, but expected ${rr(t)}`);return new Jt(he,i)}case"number":{if(un(t,ir))return new Jt(ir,ne(i));if(un(t,he))return new Jt(he,!!i);if(un(t,ge))return new Jt(ge,i.toString());if(!sr(t,vt))throw new Error(`got a number, but expected ${rr(t)}`);return new Jt(vt,i)}case"string":{if(un(t,Ae))return new Jt(Ae,Ra(i));if(un(t,he))return new Jt(he,!!i);if(!sr(t,ge))throw new Error(`got a string, but expected ${rr(t)}`);return new Jt(ge,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return Vm(i,t,e);for(const r of i)if(typeof r!="number")throw new Error("expected an array of numbers");if(un(t,ir)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new Jt(ir,i)}if(un(t,Ae)){if(i.length===3)return new Jt(Ae,[...i,1]);if(i.length===4)return new Jt(Ae,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!sr(t,Dn))throw new Error(`got an array of numbers, but expected ${rr(t)}`);return new Jt(Dn,i)}const N={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Nm={[N.Get]:ht(dt(1,1/0),Sh),[N.Var]:ht(dt(1,1),Gm),[N.Has]:ht(dt(1,1/0),Sh),[N.Id]:ht(km,ti),[N.Concat]:ht(dt(2,1/0),Ct(ge)),[N.GeometryType]:ht(Xm,ti),[N.LineMetric]:ht(ti),[N.Resolution]:ht(Mo,ti),[N.Zoom]:ht(Mo,ti),[N.Time]:ht(Mo,ti),[N.Any]:ht(dt(2,1/0),Ct(he)),[N.All]:ht(dt(2,1/0),Ct(he)),[N.Not]:ht(dt(1,1),Ct(he)),[N.Equal]:ht(dt(2,2),Ct(is)),[N.NotEqual]:ht(dt(2,2),Ct(is)),[N.GreaterThan]:ht(dt(2,2),Ct(vt)),[N.GreaterThanOrEqualTo]:ht(dt(2,2),Ct(vt)),[N.LessThan]:ht(dt(2,2),Ct(vt)),[N.LessThanOrEqualTo]:ht(dt(2,2),Ct(vt)),[N.Multiply]:ht(dt(2,1/0),Ah),[N.Coalesce]:ht(dt(2,1/0),Ah),[N.Divide]:ht(dt(2,2),Ct(vt)),[N.Add]:ht(dt(2,1/0),Ct(vt)),[N.Subtract]:ht(dt(2,2),Ct(vt)),[N.Clamp]:ht(dt(3,3),Ct(vt)),[N.Mod]:ht(dt(2,2),Ct(vt)),[N.Pow]:ht(dt(2,2),Ct(vt)),[N.Abs]:ht(dt(1,1),Ct(vt)),[N.Floor]:ht(dt(1,1),Ct(vt)),[N.Ceil]:ht(dt(1,1),Ct(vt)),[N.Round]:ht(dt(1,1),Ct(vt)),[N.Sin]:ht(dt(1,1),Ct(vt)),[N.Cos]:ht(dt(1,1),Ct(vt)),[N.Atan]:ht(dt(1,2),Ct(vt)),[N.Sqrt]:ht(dt(1,1),Ct(vt)),[N.Match]:ht(dt(4,1/0),Oh,Ym),[N.Between]:ht(dt(3,3),Ct(vt)),[N.Interpolate]:ht(dt(6,1/0),Oh,Bm),[N.Case]:ht(dt(3,1/0),zm,Um),[N.In]:ht(dt(2,2),Wm),[N.Number]:ht(dt(1,1/0),Ct(is)),[N.String]:ht(dt(1,1/0),Ct(is)),[N.Array]:ht(dt(1,1/0),Ct(vt)),[N.Color]:ht(dt(1,4),Ct(vt)),[N.Band]:ht(dt(1,3),Ct(vt)),[N.Palette]:ht(dt(2,2),jm),[N.ToString]:ht(dt(1,1),Ct(he|vt|ge|Ae))};function Sh(i,t,e){const r=i.length-1,s=new Array(r);for(let h=0;h<r;++h){const c=i[h+1];switch(typeof c){case"number":{s[h]=new Jt(vt,c);break}case"string":{s[h]=new Jt(ge,c);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${c}`)}h===0&&e.properties.add(String(c))}return s}function Gm(i,t,e){const r=i[1];if(typeof r!="string")throw new Error("expected a string argument for var operation");return e.variables.add(r),[new Jt(ge,r)]}function km(i,t,e){e.featureId=!0}function Xm(i,t,e){e.geometryType=!0}function Mo(i,t,e){e.mapState=!0}function ti(i,t,e){const r=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${r} operation`);return[]}function dt(i,t){return function(e,r,s){const h=e[0],c=e.length-1;if(i===t){if(c!==i){const d=i===1?"":"s";throw new Error(`expected ${i} argument${d} for ${h}, got ${c}`)}}else if(c<i||c>t){const d=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${d} arguments for ${h}, got ${c}`)}}}function Ah(i,t,e){const r=i.length-1,s=new Array(r);for(let h=0;h<r;++h){const c=ie(i[h+1],t,e);s[h]=c}return s}function Ct(i){return function(t,e,r){const s=t.length-1,h=new Array(s);for(let c=0;c<s;++c){const d=ie(t[c+1],i,r);h[c]=d}return h}}function zm(i,t,e){const r=i[0],s=i.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${r}, got ${s} instead`)}function Oh(i,t,e){const r=i[0],s=i.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${r}, got ${s} instead`)}function Ym(i,t,e){const r=i.length-1,s=ge|vt|he,h=ie(i[1],s,e),c=ie(i[i.length-1],t,e),d=new Array(r-2);for(let _=0;_<r-2;_+=2){try{const m=ie(i[_+2],h.type,e);d[_]=m}catch(m){throw new Error(`failed to parse argument ${_+1} of match expression: ${m.message}`)}try{const m=ie(i[_+3],c.type,e);d[_+1]=m}catch(m){throw new Error(`failed to parse argument ${_+2} of match expression: ${m.message}`)}}return[h,...d,c]}function Bm(i,t,e){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":const _=r[1];if(typeof _!="number"||_<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(_)} instead`);s=_;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(r)}`)}const h=new Jt(vt,s);let c;try{c=ie(i[2],vt,e)}catch(_){throw new Error(`failed to parse argument 1 in interpolate expression: ${_.message}`)}const d=new Array(i.length-3);for(let _=0;_<d.length;_+=2){try{const m=ie(i[_+3],vt,e);d[_]=m}catch(m){throw new Error(`failed to parse argument ${_+2} for interpolate expression: ${m.message}`)}try{const m=ie(i[_+4],t,e);d[_+1]=m}catch(m){throw new Error(`failed to parse argument ${_+3} for interpolate expression: ${m.message}`)}}return[h,c,...d]}function Um(i,t,e){const r=ie(i[i.length-1],t,e),s=new Array(i.length-1);for(let h=0;h<s.length-1;h+=2){try{const c=ie(i[h+1],he,e);s[h]=c}catch(c){throw new Error(`failed to parse argument ${h} of case expression: ${c.message}`)}try{const c=ie(i[h+2],r.type,e);s[h+1]=c}catch(c){throw new Error(`failed to parse argument ${h+1} of case expression: ${c.message}`)}}return s[s.length-1]=r,s}function Wm(i,t,e){let r=i[2];if(!Array.isArray(r))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof r[0]=="string"){if(r[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(r[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');r=r[1],s=ge}else s=vt;const h=new Array(r.length);for(let d=0;d<h.length;d++)try{const _=ie(r[d],s,e);h[d]=_}catch(_){throw new Error(`failed to parse haystack item ${d} for "in" expression: ${_.message}`)}return[ie(i[1],s,e),...h]}function jm(i,t,e){let r;try{r=ie(i[1],vt,e)}catch(c){throw new Error(`failed to parse first argument in palette expression: ${c.message}`)}const s=i[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const h=new Array(s.length);for(let c=0;c<h.length;c++){let d;try{d=ie(s[c],Ae,e)}catch(_){throw new Error(`failed to parse color at index ${c} in palette expression: ${_.message}`)}if(!(d instanceof Jt))throw new Error(`the palette color at index ${c} must be a literal value`);h[c]=d}return[r,...h]}function ht(...i){return function(t,e,r){const s=t[0];let h;for(let c=0;c<i.length;c++){const d=i[c](t,e,r);if(c==i.length-1){if(!d)throw new Error("expected last argument validator to return the parsed args");h=d}}return new bm(e,s,...h)}}function Vm(i,t,e){const r=i[0],s=Nm[r];if(!s)throw new Error(`unknown operator: ${r}`);return s(i,t,e)}function Wu(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Wu(i.getGeometries()[0]);default:return""}}function ju(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function qe(i,t,e){const r=ie(i,t,e);return Oe(r)}function Oe(i,t){if(i instanceof Jt){if(i.type===Ae&&typeof i.value=="string"){const r=Ra(i.value);return function(){return r}}return function(){return i.value}}const e=i.operator;switch(e){case N.Number:case N.String:case N.Coalesce:return Zm(i);case N.Get:case N.Var:case N.Has:return Km(i);case N.Id:return r=>r.featureId;case N.GeometryType:return r=>r.geometryType;case N.Concat:{const r=i.args.map(s=>Oe(s));return s=>"".concat(...r.map(h=>h(s).toString()))}case N.Resolution:return r=>r.resolution;case N.Any:case N.All:case N.Between:case N.In:case N.Not:return $m(i);case N.Equal:case N.NotEqual:case N.LessThan:case N.LessThanOrEqualTo:case N.GreaterThan:case N.GreaterThanOrEqualTo:return Hm(i);case N.Multiply:case N.Divide:case N.Add:case N.Subtract:case N.Clamp:case N.Mod:case N.Pow:case N.Abs:case N.Floor:case N.Ceil:case N.Round:case N.Sin:case N.Cos:case N.Atan:case N.Sqrt:return qm(i);case N.Case:return Jm(i);case N.Match:return Qm(i);case N.Interpolate:return tv(i);case N.ToString:return ev(i);default:throw new Error(`Unsupported operator ${e}`)}}function Zm(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case N.Coalesce:return h=>{for(let c=0;c<r;++c){const d=s[c](h);if(typeof d<"u"&&d!==null)return d}throw new Error("Expected one of the values to be non-null")};case N.Number:case N.String:return h=>{for(let c=0;c<r;++c){const d=s[c](h);if(typeof d===e)return d}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function Km(i,t){const r=i.args[0].value;switch(i.operator){case N.Get:return s=>{const h=i.args;let c=s.properties[r];for(let d=1,_=h.length;d<_;++d){const y=h[d].value;c=c[y]}return c};case N.Var:return s=>s.variables[r];case N.Has:return s=>{const h=i.args;if(!(r in s.properties))return!1;let c=s.properties[r];for(let d=1,_=h.length;d<_;++d){const y=h[d].value;if(!c||!Object.hasOwn(c,y))return!1;c=c[y]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function Hm(i,t){const e=i.operator,r=Oe(i.args[0]),s=Oe(i.args[1]);switch(e){case N.Equal:return h=>r(h)===s(h);case N.NotEqual:return h=>r(h)!==s(h);case N.LessThan:return h=>r(h)<s(h);case N.LessThanOrEqualTo:return h=>r(h)<=s(h);case N.GreaterThan:return h=>r(h)>s(h);case N.GreaterThanOrEqualTo:return h=>r(h)>=s(h);default:throw new Error(`Unsupported comparison operator ${e}`)}}function $m(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case N.Any:return h=>{for(let c=0;c<r;++c)if(s[c](h))return!0;return!1};case N.All:return h=>{for(let c=0;c<r;++c)if(!s[c](h))return!1;return!0};case N.Between:return h=>{const c=s[0](h),d=s[1](h),_=s[2](h);return c>=d&&c<=_};case N.In:return h=>{const c=s[0](h);for(let d=1;d<r;++d)if(c===s[d](h))return!0;return!1};case N.Not:return h=>!s[0](h);default:throw new Error(`Unsupported logical operator ${e}`)}}function qm(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case N.Multiply:return h=>{let c=1;for(let d=0;d<r;++d)c*=s[d](h);return c};case N.Divide:return h=>s[0](h)/s[1](h);case N.Add:return h=>{let c=0;for(let d=0;d<r;++d)c+=s[d](h);return c};case N.Subtract:return h=>s[0](h)-s[1](h);case N.Clamp:return h=>{const c=s[0](h),d=s[1](h);if(c<d)return d;const _=s[2](h);return c>_?_:c};case N.Mod:return h=>s[0](h)%s[1](h);case N.Pow:return h=>Math.pow(s[0](h),s[1](h));case N.Abs:return h=>Math.abs(s[0](h));case N.Floor:return h=>Math.floor(s[0](h));case N.Ceil:return h=>Math.ceil(s[0](h));case N.Round:return h=>Math.round(s[0](h));case N.Sin:return h=>Math.sin(s[0](h));case N.Cos:return h=>Math.cos(s[0](h));case N.Atan:return r===2?h=>Math.atan2(s[0](h),s[1](h)):h=>Math.atan(s[0](h));case N.Sqrt:return h=>Math.sqrt(s[0](h));default:throw new Error(`Unsupported numeric operator ${e}`)}}function Jm(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=Oe(i.args[s]);return s=>{for(let h=0;h<e-1;h+=2)if(r[h](s))return r[h+1](s);return r[e-1](s)}}function Qm(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=Oe(i.args[s]);return s=>{const h=r[0](s);for(let c=1;c<e;c+=2)if(h===r[c](s))return r[c+1](s);return r[e-1](s)}}function tv(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=Oe(i.args[s]);return s=>{const h=r[0](s),c=r[1](s);let d,_;for(let m=2;m<e;m+=2){const y=r[m](s);let x=r[m+1](s);const w=Array.isArray(x);if(w&&(x=Lm(x)),y>=c)return m===2?x:w?nv(h,c,d,_,y,x):or(h,c,d,_,y,x);d=y,_=x}return _}}function ev(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case N.ToString:return h=>{const c=s[0](h);return i.args[0].type===Ae?Ta(c):c.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function or(i,t,e,r,s,h){const c=s-e;if(c===0)return r;const d=t-e,_=i===1?d/c:(Math.pow(i,d)-1)/(Math.pow(i,c)-1);return r+_*(h-r)}function nv(i,t,e,r,s,h){if(s-e===0)return r;const d=Ih(r),_=Ih(h);let m=_[2]-d[2];m>180?m-=360:m<-180&&(m+=360);const y=[or(i,t,e,d[0],s,_[0]),or(i,t,e,d[1],s,_[1]),d[2]+or(i,t,e,0,s,m),or(i,t,e,r[3],s,h[3])];return Bu(Mm(y))}const J={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Ca extends mr{constructor(t,e,r,s){super(),this.extent=t,this.pixelRatio_=r,this.resolution=e,this.state=typeof s=="function"?J.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(ct.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==J.IDLE&&this.loader){this.state=J.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;ta(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(r=>{"image"in r&&(this.image_=r.image),"extent"in r&&(this.extent=r.extent),"resolution"in r&&(this.resolution=r.resolution),"pixelRatio"in r&&(this.pixelRatio_=r.pixelRatio),(r instanceof HTMLImageElement||__&&r instanceof ImageBitmap||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)&&(this.image_=r),this.state=J.LOADED}).catch(r=>{this.state=J.ERROR,console.error(r)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function iv(i,t,e){const r=i;let s=!0,h=!1,c=!1;const d=[us(r,ct.LOAD,function(){c=!0,h||t()})];return r.src&&ou?(h=!0,r.decode().then(function(){s&&t()}).catch(function(_){s&&(c?t():e())})):d.push(us(r,ct.ERROR,e)),function(){s=!1,d.forEach(Gt)}}function rv(i,t){return new Promise((e,r)=>{function s(){c(),e(i)}function h(){c(),r(new Error("Image load error"))}function c(){i.removeEventListener("load",s),i.removeEventListener("error",h)}i.addEventListener("load",s),i.addEventListener("error",h)})}function sv(i,t){return t&&(i.src=t),i.src&&ou?new Promise((e,r)=>i.decode().then(()=>e(i)).catch(s=>i.complete&&i.width?e(i):r(s))):rv(i)}class ov{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const r=this.cache_[e];(t++&3)===0&&!r.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,r){const s=Po(t,e,r);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,r){const s=Po(t,e,r);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,r,s,h){const c=Po(t,e,r),d=c in this.cache_;this.cache_[c]=s,h&&(s.getImageState()===J.IDLE&&s.load(),s.getImageState()===J.LOADING?s.ready().then(()=>{this.patternCache_[c]=ms().createPattern(s.getImage(1),"repeat")}):this.patternCache_[c]=ms().createPattern(s.getImage(1),"repeat")),d||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Po(i,t,e){const r=e?pi(e):"null";return t+":"+i+":"+r}const Re=new ov;let tr=null;class Vu extends mr{constructor(t,e,r,s,h){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=r,this.canvas_={},this.color_=h,this.imageState_=s===void 0?J.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===J.LOADED){tr||(tr=Qt(1,1,void 0,{willReadFrequently:!0})),tr.drawImage(this.image_,0,0);try{tr.getImageData(0,0,1,1),this.tainted_=!1}catch{tr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ct.CHANGE)}handleImageError_(){this.imageState_=J.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=J.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],r=Qt(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===J.IDLE){this.image_||this.initializeImage_(),this.imageState_=J.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&sv(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==J.LOADED)return;const e=this.image_,r=Qt(Math.ceil(e.width*t),Math.ceil(e.height*t)),s=r.canvas;r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=Am(this.color_),r.fillRect(0,0,s.width/t,s.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===J.LOADED||this.imageState_===J.ERROR)t();else{const e=()=>{(this.imageState_===J.LOADED||this.imageState_===J.ERROR)&&(this.removeEventListener(ct.CHANGE,e),t())};this.addEventListener(ct.CHANGE,e)}})),this.ready_}}function Sa(i,t,e,r,s,h){let c=t===void 0?void 0:Re.get(t,e,s);return c||(c=new Vu(i,i&&"src"in i?i.src||void 0:t,e,r,s),Re.set(t,e,s,c,h)),h&&c&&!Re.getPattern(t,e,s)&&Re.set(t,e,s,c,h),c}function Lh(i){return i?Array.isArray(i)?Ta(i):typeof i=="object"&&"src"in i?av(i):i:null}function av(i){if(!i.offset||!i.size)return Re.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=Re.getPattern(t,void 0,i.color);if(e)return e;const r=Re.get(i.src,"anonymous",null);if(r.getImageState()!==J.LOADED)return null;const s=Qt(i.size[0],i.size[1]);return s.drawImage(r.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Sa(s.canvas,t,void 0,J.LOADED,i.color,!0),Re.getPattern(t,void 0,i.color)}const Mh="#000",Ph="round",Dh="round",lv=10,hv="#000",uv=1,cv=new $e;class Ns{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ne(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ns({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Tt()}getImage(t){return Tt()}getHitDetectionImage(){return Tt()}getPixelRatio(t){return 1}getImageState(){return Tt()}getImageSize(){return Tt()}getOrigin(){return Tt()}getSize(){return Tt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ne(t)}listenImageChange(t){Tt()}load(){Tt()}unlistenImageChange(t){Tt()}ready(){return Promise.resolve()}}class Gs extends Ns{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?J.LOADING:J.LOADED,this.imageState_===J.LOADING&&this.ready().then(()=>this.imageState_=J.LOADED),this.render()}clone(){const t=this.getScale(),e=new Gs({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),r=this.getScaleArray();return[t[0]/2-e[0]/r[0],t[1]/2+e[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var h,c;const e=(h=this.fill_)==null?void 0:h.getKey(),r=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let s=(c=Re.get(r,null,null))==null?void 0:c.getImage(1);if(!s){const d=this.renderOptions_,_=Math.ceil(d.size*t),m=Qt(_,_);this.draw_(d,m,t),s=m.canvas,Re.set(r,null,null,new Vu(s,void 0,null,J.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,r){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius,h=this.radius2_===void 0?s:this.radius2_;if(s<h){const B=s;s=h,h=B}const c=this.radius2_===void 0?this.points_:this.points_*2,d=2*Math.PI/c,_=h*Math.sin(d),m=Math.sqrt(h*h-_*_),y=s-m,x=Math.sqrt(_*_+y*y),w=x/_;if(t==="miter"&&w<=r)return w*e;const C=e/2/w,T=e/2*(y/x),M=Math.sqrt((s+C)*(s+C)+T*T)-s;if(this.radius2_===void 0||t==="bevel")return M*2;const A=s*Math.sin(d),D=Math.sqrt(s*s-A*A),z=h-D,F=Math.sqrt(A*A+z*z)/A;if(F<=r){const B=F*e/2-h-s;return 2*Math.max(M,B)}return M*2}createRenderOptions(){let t=Ph,e=Dh,r=0,s=null,h=0,c,d=0;this.stroke_&&(c=Lh(this.stroke_.getColor()??hv),d=this.stroke_.getWidth()??uv,s=this.stroke_.getLineDash(),h=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Dh,t=this.stroke_.getLineCap()??Ph,r=this.stroke_.getMiterLimit()??lv);const _=this.calculateLineJoinSize_(e,d,r),m=Math.max(this.radius,this.radius2_||0),y=Math.ceil(2*m+_);return{strokeStyle:c,strokeWidth:d,size:y,lineCap:t,lineDash:s,lineDashOffset:h,lineJoin:e,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=Mh),e.fillStyle=Lh(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let r=this.fill_.getColor(),s=0;typeof r=="string"&&(r=pi(r)),r===null?s=1:Array.isArray(r)&&(s=r.length===4?r[3]:1),s===0&&(e=Qt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const r=this.radius;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{const s=this.radius2_===void 0?r:this.radius2_;this.radius2_!==void 0&&(e*=2);const h=this.angle_-Math.PI/2,c=2*Math.PI/e;for(let d=0;d<e;d++){const _=h+d*c,m=d%2===0?r:s;t.lineTo(m*Math.cos(_),m*Math.sin(_))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Mh,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class ks extends Gs{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new ks({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class Rr{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Rr({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Sa(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===J.IDLE&&e.load(),e.getImageState()===J.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?ee(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:pi(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Fh(i,t,e,r){return e!==void 0&&r!==void 0?[e/i,r/t]:e!==void 0?e/i:r!==void 0?r/t:1}class Xs extends Ns{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,r=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,h=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:r,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:h,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const c=t.img!==void 0?t.img:null;let d=t.src;Mt(!(d!==void 0&&c),"`image` and `src` cannot be provided at the same time"),(d===void 0||d.length===0)&&c&&(d=c.src||ee(c)),Mt(d!==void 0&&d.length>0,"A defined and non-empty `src` or `image` must be provided"),Mt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let _;if(t.src!==void 0?_=J.IDLE:c!==void 0&&("complete"in c?c.complete?_=c.src?J.LOADED:J.IDLE:_=J.LOADING:_=J.LOADED),this.color_=t.color!==void 0?pi(t.color):null,this.iconImage_=Sa(c,d,this.crossOrigin_,_,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let m,y;if(t.size)[m,y]=t.size;else{const x=this.getImage(1);if(x.width&&x.height)m=x.width,y=x.height;else if(x instanceof HTMLImageElement){this.initialOptions_=t;const w=()=>{if(this.unlistenImageChange(w),!this.initialOptions_)return;const C=this.iconImage_.getSize();this.setScale(Fh(C[0],C[1],t.width,t.height))};this.listenImageChange(w);return}}m!==void 0&&this.setScale(Fh(m,y,t.width,t.height))}}clone(){let t,e,r;return this.initialOptions_?(e=this.initialOptions_.width,r=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Xs({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:r,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),r=this.getScaleArray();return[t[0]-e[0]/r[0],t[1]+e[1]/r[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=r[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==J.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==J.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(ct.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(ct.CHANGE,t)}ready(){return this.iconImage_.ready()}}class zs{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new zs({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class vn{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=bh,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new vn({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=bh,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function fv(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(Mt(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let Do=null;function Zu(i,t){if(!Do){const e=new Rr({color:"rgba(255,255,255,0.4)"}),r=new zs({color:"#3399CC",width:1.25});Do=[new vn({image:new ks({fill:e,stroke:r,radius:5}),fill:e,stroke:r})]}return Do}function bh(i){return i.getGeometry()}const dv="#333";class Aa{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=ne(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Rr({color:dv}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Aa({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ne(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function gv(i){return!0}function _v(i){const t=Uu(),e=pv(i,t),r=ju();return function(s,h){if(r.properties=s.getPropertiesInternal(),r.resolution=h,t.featureId){const c=s.getId();c!==void 0?r.featureId=c:r.featureId=null}return t.geometryType&&(r.geometryType=Wu(s.getGeometry())),e(r)}}function Nh(i){const t=Uu(),e=i.length,r=new Array(e);for(let c=0;c<e;++c)r[c]=Ko(i[c],t);const s=ju(),h=new Array(e);return function(c,d){if(s.properties=c.getPropertiesInternal(),s.resolution=d,t.featureId){const m=c.getId();m!==void 0?s.featureId=m:s.featureId=null}let _=0;for(let m=0;m<e;++m){const y=r[m](s);y&&(h[_]=y,_+=1)}return h.length=_,h}}function pv(i,t){const e=i.length,r=new Array(e);for(let s=0;s<e;++s){const h=i[s],c="filter"in h?qe(h.filter,he,t):gv;let d;if(Array.isArray(h.style)){const _=h.style.length;d=new Array(_);for(let m=0;m<_;++m)d[m]=Ko(h.style[m],t)}else d=[Ko(h.style,t)];r[s]={filter:c,styles:d}}return function(s){const h=[];let c=!1;for(let d=0;d<e;++d){const _=r[d].filter;if(_(s)&&!(i[d].else&&c)){c=!0;for(const m of r[d].styles){const y=m(s);y&&h.push(y)}}}return h}}function Ko(i,t){const e=gr(i,"",t),r=_r(i,"",t),s=mv(i,t),h=vv(i,t),c=_e(i,"z-index",t);if(!e&&!r&&!s&&!h&&!eu(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const d=new vn;return function(_){let m=!0;if(e){const y=e(_);y&&(m=!1),d.setFill(y)}if(r){const y=r(_);y&&(m=!1),d.setStroke(y)}if(s){const y=s(_);y&&(m=!1),d.setText(y)}if(h){const y=h(_);y&&(m=!1),d.setImage(y)}return c&&d.setZIndex(c(_)),m?null:d}}function gr(i,t,e){let r;if(t+"fill-pattern-src"in i)r=wv(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return h=>null;r=Oa(i,t+"fill-color",e)}if(!r)return null;const s=new Rr;return function(h){const c=r(h);return c===wa?null:(s.setColor(c),s)}}function _r(i,t,e){const r=_e(i,t+"stroke-width",e),s=Oa(i,t+"stroke-color",e);if(!r&&!s)return null;const h=je(i,t+"stroke-line-cap",e),c=je(i,t+"stroke-line-join",e),d=Ku(i,t+"stroke-line-dash",e),_=_e(i,t+"stroke-line-dash-offset",e),m=_e(i,t+"stroke-miter-limit",e),y=new zs;return function(x){if(s){const w=s(x);if(w===wa)return null;y.setColor(w)}if(r&&y.setWidth(r(x)),h){const w=h(x);if(w!=="butt"&&w!=="round"&&w!=="square")throw new Error("Expected butt, round, or square line cap");y.setLineCap(w)}if(c){const w=c(x);if(w!=="bevel"&&w!=="round"&&w!=="miter")throw new Error("Expected bevel, round, or miter line join");y.setLineJoin(w)}return d&&y.setLineDash(d(x)),_&&y.setLineDashOffset(_(x)),m&&y.setMiterLimit(m(x)),y}}function mv(i,t){const e="text-",r=je(i,e+"value",t);if(!r)return null;const s=gr(i,e,t),h=gr(i,e+"background-",t),c=_r(i,e,t),d=_r(i,e+"background-",t),_=je(i,e+"font",t),m=_e(i,e+"max-angle",t),y=_e(i,e+"offset-x",t),x=_e(i,e+"offset-y",t),w=ci(i,e+"overflow",t),C=je(i,e+"placement",t),T=_e(i,e+"repeat",t),O=Ys(i,e+"scale",t),M=ci(i,e+"rotate-with-view",t),A=_e(i,e+"rotation",t),D=je(i,e+"align",t),z=je(i,e+"justify",t),b=je(i,e+"baseline",t),F=ci(i,e+"keep-upright",t),B=Ku(i,e+"padding",t),V=Bs(i,e+"declutter-mode"),k=new Aa({declutterMode:V});return function(K){if(k.setText(r(K)),s&&k.setFill(s(K)),h&&k.setBackgroundFill(h(K)),c&&k.setStroke(c(K)),d&&k.setBackgroundStroke(d(K)),_&&k.setFont(_(K)),m&&k.setMaxAngle(m(K)),y&&k.setOffsetX(y(K)),x&&k.setOffsetY(x(K)),w&&k.setOverflow(w(K)),C){const Y=C(K);if(Y!=="point"&&Y!=="line")throw new Error("Expected point or line for text-placement");k.setPlacement(Y)}if(T&&k.setRepeat(T(K)),O&&k.setScale(O(K)),M&&k.setRotateWithView(M(K)),A&&k.setRotation(A(K)),D){const Y=D(K);if(Y!=="left"&&Y!=="center"&&Y!=="right"&&Y!=="end"&&Y!=="start")throw new Error("Expected left, right, center, start, or end for text-align");k.setTextAlign(Y)}if(z){const Y=z(K);if(Y!=="left"&&Y!=="right"&&Y!=="center")throw new Error("Expected left, right, or center for text-justify");k.setJustify(Y)}if(b){const Y=b(K);if(Y!=="bottom"&&Y!=="top"&&Y!=="middle"&&Y!=="alphabetic"&&Y!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");k.setTextBaseline(Y)}return B&&k.setPadding(B(K)),F&&k.setKeepUpright(F(K)),k}}function vv(i,t){return"icon-src"in i?yv(i,t):"shape-points"in i?Ev(i,t):"circle-radius"in i?xv(i,t):null}function yv(i,t){const e="icon-",r=e+"src",s=Hu(i[r],r),h=vs(i,e+"anchor",t),c=Ys(i,e+"scale",t),d=_e(i,e+"opacity",t),_=vs(i,e+"displacement",t),m=_e(i,e+"rotation",t),y=ci(i,e+"rotate-with-view",t),x=kh(i,e+"anchor-origin"),w=Xh(i,e+"anchor-x-units"),C=Xh(i,e+"anchor-y-units"),T=Cv(i,e+"color"),O=Tv(i,e+"cross-origin"),M=Iv(i,e+"offset"),A=kh(i,e+"offset-origin"),D=ys(i,e+"width"),z=ys(i,e+"height"),b=Rv(i,e+"size"),F=Bs(i,e+"declutter-mode"),B=new Xs({src:s,anchorOrigin:x,anchorXUnits:w,anchorYUnits:C,color:T,crossOrigin:O,offset:M,offsetOrigin:A,height:z,width:D,size:b,declutterMode:F});return function(V){return d&&B.setOpacity(d(V)),_&&B.setDisplacement(_(V)),m&&B.setRotation(m(V)),y&&B.setRotateWithView(y(V)),c&&B.setScale(c(V)),h&&B.setAnchor(h(V)),B}}function Ev(i,t){const e="shape-",r=e+"points",s=e+"radius",h=Ho(i[r],r),c=Ho(i[s],s),d=gr(i,e,t),_=_r(i,e,t),m=Ys(i,e+"scale",t),y=vs(i,e+"displacement",t),x=_e(i,e+"rotation",t),w=ci(i,e+"rotate-with-view",t),C=ys(i,e+"radius2"),T=ys(i,e+"angle"),O=Bs(i,e+"declutter-mode"),M=new Gs({points:h,radius:c,radius2:C,angle:T,declutterMode:O});return function(A){return d&&M.setFill(d(A)),_&&M.setStroke(_(A)),y&&M.setDisplacement(y(A)),x&&M.setRotation(x(A)),w&&M.setRotateWithView(w(A)),m&&M.setScale(m(A)),M}}function xv(i,t){const e="circle-",r=gr(i,e,t),s=_r(i,e,t),h=_e(i,e+"radius",t),c=Ys(i,e+"scale",t),d=vs(i,e+"displacement",t),_=_e(i,e+"rotation",t),m=ci(i,e+"rotate-with-view",t),y=Bs(i,e+"declutter-mode"),x=new ks({radius:5,declutterMode:y});return function(w){return h&&x.setRadius(h(w)),r&&x.setFill(r(w)),s&&x.setStroke(s(w)),d&&x.setDisplacement(d(w)),_&&x.setRotation(_(w)),m&&x.setRotateWithView(m(w)),c&&x.setScale(c(w)),x}}function _e(i,t,e){if(!(t in i))return;const r=qe(i[t],vt,e);return function(s){return Ho(r(s),t)}}function je(i,t,e){if(!(t in i))return null;const r=qe(i[t],ge,e);return function(s){return Hu(r(s),t)}}function wv(i,t,e){const r=je(i,t+"pattern-src",e),s=Gh(i,t+"pattern-offset",e),h=Gh(i,t+"pattern-size",e),c=Oa(i,t+"color",e);return function(d){return{src:r(d),offset:s&&s(d),size:h&&h(d),color:c&&c(d)}}}function ci(i,t,e){if(!(t in i))return null;const r=qe(i[t],he,e);return function(s){const h=r(s);if(typeof h!="boolean")throw new Error(`Expected a boolean for ${t}`);return h}}function Oa(i,t,e){if(!(t in i))return null;const r=qe(i[t],Ae,e);return function(s){return $u(r(s),t)}}function Ku(i,t,e){if(!(t in i))return null;const r=qe(i[t],Dn,e);return function(s){return Tr(r(s),t)}}function vs(i,t,e){if(!(t in i))return null;const r=qe(i[t],Dn,e);return function(s){const h=Tr(r(s),t);if(h.length!==2)throw new Error(`Expected two numbers for ${t}`);return h}}function Gh(i,t,e){if(!(t in i))return null;const r=qe(i[t],Dn,e);return function(s){return qu(r(s),t)}}function Ys(i,t,e){if(!(t in i))return null;const r=qe(i[t],Dn|vt,e);return function(s){return Sv(r(s),t)}}function ys(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Rv(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return ne(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Tv(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function kh(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function Xh(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Iv(i,t){const e=i[t];if(e!==void 0)return Tr(e,t)}function Bs(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Cv(i,t){const e=i[t];if(e!==void 0)return $u(e,t)}function Tr(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let r=0;r<e;++r)if(typeof i[r]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function Hu(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function Ho(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function $u(i,t){if(typeof i=="string")return i;const e=Tr(i,t),r=e.length;if(r<3||r>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function qu(i,t){const e=Tr(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Sv(i,t){return typeof i=="number"?i:qu(i,t)}const zh={RENDER_ORDER:"renderOrder"};class Av extends wr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(zh.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const r=this.getDeclutter();r in t.declutter||(t.declutter[r]=new Em(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(zh.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Zu:t;const e=Ov(t);this.styleFunction_=t===null?void 0:fv(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function Ov(i){if(i===void 0)return Zu;if(!i)return null;if(typeof i=="function"||i instanceof vn)return i;if(!Array.isArray(i))return Nh([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof vn){const s=new Array(t);for(let h=0;h<t;++h){const c=i[h];if(!(c instanceof vn))throw new Error("Expected a list of style instances");s[h]=c}return s}if("style"in e){const s=new Array(t);for(let h=0;h<t;++h){const c=i[h];if(!("style"in c))throw new Error("Expected a list of rules with a style property");s[h]=c}return _v(s)}return Nh(i)}class Ju extends Ne{constructor(t,e,r,s){super(t),this.inversePixelTransform=e,this.frameState=r,this.context=s}}class Lv extends pr{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){Tt()}calculateMatrices2D(t){const e=t.viewState,r=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;_i(r,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Iu(s,r)}forEachFeatureAtCoordinate(t,e,r,s,h,c,d,_){let m;const y=e.viewState;function x(b,F,B,V){return h.call(c,F,b?B:null,V)}const w=y.projection,C=D_(t.slice(),w),T=[[0,0]];if(w.canWrapX()&&s){const b=w.getExtent(),F=yt(b);T.push([-F,0],[F,0])}const O=e.layerStatesArray,M=O.length,A=[],D=[];for(let b=0;b<T.length;b++)for(let F=M-1;F>=0;--F){const B=O[F],V=B.layer;if(V.hasRenderer()&&Ea(B,y)&&d.call(_,V)){const k=V.getRenderer(),K=V.getSource();if(k&&K){const Y=K.getWrapX()?C:t,st=x.bind(null,B.managed);D[0]=Y[0]+T[b][0],D[1]=Y[1]+T[b][1],m=k.forEachFeatureAtCoordinate(D,e,r,st,A)}if(m)return m}}if(A.length===0)return;const z=1/A.length;return A.forEach((b,F)=>b.distanceSq+=F*z),A.sort((b,F)=>b.distanceSq-F.distanceSq),A.some(b=>m=b.callback(b.feature,b.layer,b.geometry)),m}hasFeatureAtCoordinate(t,e,r,s,h,c){return this.forEachFeatureAtCoordinate(t,e,r,s,ls,this,h,c)!==void 0}getMap(){return this.map_}renderFrame(t){Tt()}scheduleExpireIconCache(t){Re.canExpireCache()&&t.postRenderFunctions.push(Mv)}}function Mv(i,t){Re.expire()}class Pv extends Lv{constructor(t){super(t),this.fontChangeListenerKey_=St(cv,lr.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=bs+" ol-layers";const r=t.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const r=this.getMap();if(r.hasListener(t)){const s=new Ju(t,void 0,e);r.dispatchEvent(s)}}disposeInternal(){Gt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(be.PRECOMPOSE,t);const e=t.layerStatesArray.sort((d,_)=>d.zIndex-_.zIndex);e.some(d=>d.layer instanceof Av&&d.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const h=[];let c=null;for(let d=0,_=e.length;d<_;++d){const m=e[d];t.layerIndex=d;const y=m.layer,x=y.getSourceState();if(!Ea(m,s)||x!="ready"&&x!="undefined"){y.unrender();continue}const w=y.render(t,c);w&&(w!==c&&(this.children_.push(w),c=w),h.push(m))}this.declutter(t,h),Kp(this.element_,this.children_),this.dispatchRenderEvent(be.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let r=e.length-1;r>=0;--r){const s=e[r],h=s.layer;h.getDeclutter()&&h.renderDeclutter(t,s)}e.forEach(r=>r.layer.renderDeferred(t))}}}function Qu(i){if(i instanceof wr){i.setMapInternal(null);return}i instanceof Ei&&i.getLayers().forEach(Qu)}function tc(i,t){if(i instanceof wr){i.setMapInternal(t);return}if(i instanceof Ei){const e=i.getLayers().getArray();for(let r=0,s=e.length;r<s;++r)tc(e[r],t)}}class Dv extends $e{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Fv(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:ru,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=mn(),this.pixelToCoordinateTransform_=mn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||Jp(),this.interactions=e.interactions||vm({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new lu(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(se.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(se.VIEW,this.handleViewChanged_),this.addChangeListener(se.SIZE,this.handleSizeChanged_),this.addChangeListener(se.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const r=this;t.view&&!(t.view instanceof Fe)&&t.view.then(function(s){r.setView(new Fe(s))}),this.controls.addEventListener(we.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(we.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(we.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(we.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(we.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(we.REMOVE,s=>{const h=s.element.getId();h!==void 0&&delete this.overlayIdIndex_[h.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){tc(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,r){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};const h=r.hitTolerance!==void 0?r.hitTolerance:0,c=r.layerFilter!==void 0?r.layerFilter:ls,d=r.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,h,d,e,null,c,null)}getFeaturesAtPixel(t,e){const r=[];return this.forEachFeatureAtPixel(t,function(s){r.push(s)},e),r}getAllLayers(){const t=[];function e(r){r.forEach(function(s){s instanceof Ei?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const r=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:ls,h=e.hitTolerance!==void 0?e.hitTolerance:0,c=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,h,c,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const r=this.viewport_.getBoundingClientRect(),s=this.getSize(),h=r.width/s[0],c=r.height/s[1],d="changedTouches"in t?t.changedTouches[0]:t;return[(d.clientX-r.left)/h,(d.clientY-r.top)/c]}getTarget(){return this.get(se.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Vo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?de(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(se.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Ve){e.setLayers(t);return}const r=e.getLayers();r.clear(),r.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,r=t.length;e<r;++e){const s=t[e];if(!s.visible)continue;const h=s.layer.getRenderer();if(h&&!h.ready)return!0;const c=s.layer.getSource();if(c&&c.loading)return!0}return!1}getPixelFromCoordinate(t){const e=We(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?de(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(se.SIZE)}getView(){return this.get(se.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,r,s){return v_(this.frameState_,t,e,r,s)}handleBrowserEvent(t,e){e=e||t.type;const r=new fn(e,this,t);this.handleMapBrowserEvent(r)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,r=e.type;if(r===zo.POINTERDOWN||r===ct.WHEEL||r===ct.KEYDOWN){const s=this.getOwnerDocument(),h=this.viewport_.getRootNode?this.viewport_.getRootNode():s,c=e.target,d=h instanceof ShadowRoot?h.host===c?h.host.ownerDocument:h:h===s?s.documentElement:h;if(this.overlayContainerStopEvent_.contains(c)||!d.contains(c))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let h=s.length-1;h>=0;h--){const c=s[h];if(c.getMap()!==this||!c.getActive()||!this.getTargetElement())continue;if(!c.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,h=s;if(t){const c=t.viewHints;if(c[fe.ANIMATING]||c[fe.INTERACTING]){const d=Date.now()-t.time>8;s=d?0:8,h=d?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,h))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(be.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(be.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ri(dn.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ri(dn.LOADSTART,this,t))));const r=this.postRenderFunctions_;if(t)for(let s=0,h=r.length;s<h;++s)r[s](this,t);r.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let r=0,s=this.targetChangeHandlerKeys_.length;r<s;++r)Gt(this.targetChangeHandlerKeys_[r]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ct.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ct.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const r=this.targetElement_.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.unobserve(r.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Pv(this)),this.mapBrowserEventHandler_=new p_(this,this.moveTolerance_);for(const h in Ut)this.mapBrowserEventHandler_.addEventListener(Ut[h],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ct.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ct.WHEEL,this.boundHandleBrowserEvent_,au?{passive:!1}:!1);let r;if(this.keyboardEventTarget_)r=this.keyboardEventTarget_;else{const h=e.getRootNode();r=h instanceof ShadowRoot?h.host:e}this.targetChangeHandlerKeys_=[St(r,ct.KEYDOWN,this.handleBrowserEvent,this),St(r,ct.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Gt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Gt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=St(t,lr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=St(t,ct.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Gt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new gn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[St(t,lr.PROPERTYCHANGE,this.render,this),St(t,ct.CHANGE,this.render,this),St(t,"addlayer",this.handleLayerAdd_,this),St(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,r=t.length;e<r;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Qu(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),r=this.getView(),s=this.frameState_;let h=null;if(e!==void 0&&Ch(e)&&r&&r.isDef()){const c=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),d=r.getState();if(h={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:fs(d.center,d.resolution,d.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:d,viewHints:c,wantedTiles:{},mapId:ee(this),renderTargets:{}},d.nextCenter&&d.nextResolution){const _=isNaN(d.nextRotation)?d.rotation:d.nextRotation;h.nextExtent=fs(d.nextCenter,d.nextResolution,_,e)}}this.frameState_=h,this.renderer_.renderFrame(h),h&&(h.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,h.postRenderFunctions),s&&(!this.previousExtent_||!vi(this.previousExtent_)&&!di(h.extent,this.previousExtent_))&&(this.dispatchEvent(new ri(dn.MOVESTART,this,s)),this.previousExtent_=Os(this.previousExtent_)),this.previousExtent_&&!h.viewHints[fe.ANIMATING]&&!h.viewHints[fe.INTERACTING]&&!di(h.extent,this.previousExtent_)&&(this.dispatchEvent(new ri(dn.MOVEEND,this,h)),R_(h.extent,this.previousExtent_))),this.dispatchEvent(new ri(dn.POSTRENDER,this,h)),this.renderComplete_=(this.hasListener(dn.LOADSTART)||this.hasListener(dn.LOADEND)||this.hasListener(be.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new gn("removelayer",e)),this.set(se.LAYERGROUP,t)}setSize(t){this.set(se.SIZE,t)}setTarget(t){this.set(se.TARGET,t)}setView(t){if(!t||t instanceof Fe){this.set(se.VIEW,t);return}this.set(se.VIEW,new Fe);const e=this;t.then(function(r){e.setView(new Fe(r))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),h=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),c=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(h)&&!isNaN(c)&&(e=[Math.max(0,h),Math.max(0,c)],!Ch(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&vu("No map visible because the map container's width or height are 0."))}const r=this.getSize();e&&(!r||!Is(e,r))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}}function Fv(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},r=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Ei({layers:i.layers});e[se.LAYERGROUP]=r,e[se.TARGET]=i.target,e[se.VIEW]=i.view instanceof Fe?i.view:new Fe;let s;i.controls!==void 0&&(Array.isArray(i.controls)?s=new Ve(i.controls.slice()):(Mt(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=i.controls));let h;i.interactions!==void 0&&(Array.isArray(i.interactions)?h=new Ve(i.interactions.slice()):(Mt(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),h=i.interactions));let c;return i.overlays!==void 0?Array.isArray(i.overlays)?c=new Ve(i.overlays.slice()):(Mt(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),c=i.overlays):c=new Ve,{controls:s,interactions:h,keyboardEventTarget:t,overlays:c,values:e}}class bv{constructor(){Kl(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(ms(),{get:(t,e)=>{if(typeof ms()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,r)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,r),!0)})}pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let r=0,s=e.length;r<s;++r){const h=e[r];if(typeof h=="function"){h(t);continue}const c=e[++r];if(typeof t[h]=="function")t[h](...c);else{if(typeof c=="function"){t[h]=c(t);continue}t[h]=c}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Nv=5;class Gv extends nu{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Nv}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Tt()}getData(t){return null}prepareFrame(t){return Tt()}renderFrame(t,e){return Tt()}forEachFeatureAtCoordinate(t,e,r,s,h){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===J.LOADED||e.getState()===J.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=J.LOADED&&e!=J.ERROR&&t.addEventListener(ct.CHANGE,this.boundHandleImageChange_),e==J.IDLE&&(t.load(),e=t.getState()),e==J.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}let oi=null;function kv(){oi=Qt(1,1,void 0,{willReadFrequently:!0})}class ec extends Gv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=mn(),this.pixelTransform=mn(),this.inversePixelTransform=mn(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,r){oi||kv(),oi.clearRect(0,0,1,1);let s;try{oi.drawImage(t,e,r,1,1,0,0,1,1),s=oi.getImageData(0,0,1,1).data}catch{return oi=null,null}return s}getBackground(t){let r=this.getLayer().getBackground();return typeof r=="function"&&(r=r(t.viewState.resolution)),r||void 0}useContainer(t,e,r){const s=this.getLayer().getClassName();let h,c;if(t&&t.className===s&&(!r||t&&t.style.backgroundColor&&Is(pi(t.style.backgroundColor),pi(r)))){const d=t.firstElementChild;d instanceof HTMLCanvasElement&&(c=d.getContext("2d"))}if(c&&c.canvas.style.transform===e?(this.container=t,this.context=c,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){h=document.createElement("div"),h.className=s;let d=h.style;d.position="absolute",d.width="100%",d.height="100%",c=Qt();const _=c.canvas;h.appendChild(_),d=_.style,d.position="absolute",d.left="0",d.transformOrigin="top left",this.container=h,this.context=c}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(t,e,r){const s=He(r),h=Ps(r),c=Ms(r),d=Ls(r);de(e.coordinateToPixelTransform,s),de(e.coordinateToPixelTransform,h),de(e.coordinateToPixelTransform,c),de(e.coordinateToPixelTransform,d);const _=this.inversePixelTransform;de(_,s),de(_,h),de(_,c),de(_,d),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(h[0]),Math.round(h[1])),t.lineTo(Math.round(c[0]),Math.round(c[1])),t.lineTo(Math.round(d[0]),Math.round(d[1])),t.clip()}prepareContainer(t,e){const r=t.extent,s=t.viewState.resolution,h=t.viewState.rotation,c=t.pixelRatio,d=Math.round(yt(r)/s*c),_=Math.round(Wt(r)/s*c);_i(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,h,-d/2,-_/2),Iu(this.inversePixelTransform,this.pixelTransform);const m=_p(this.pixelTransform);if(this.useContainer(e,m,this.getBackground(t)),!this.containerReused){const y=this.context.canvas;y.width!=d||y.height!=_?(y.width=d,y.height=_):this.context.clearRect(0,0,d,_),m!==y.style.transform&&(y.style.transform=m)}}dispatchRenderEvent_(t,e,r){const s=this.getLayer();if(s.hasListener(t)){const h=new Ju(t,this.inversePixelTransform,r,e);s.dispatchEvent(h)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(be.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(be.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new bv),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(be.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(be.POSTRENDER,this.context,t))}getRenderTransform(t,e,r,s,h,c,d){const _=h/2,m=c/2,y=s/e,x=-y,w=-t[0]+d,C=-t[1];return _i(this.tempTransform,_,m,y,x,-r,w,C)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Xv extends ec{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,s=t.viewState,h=s.resolution,c=this.getLayer().getSource(),d=t.viewHints;let _=t.extent;if(e.extent!==void 0&&(_=pe(_,Ze(e.extent,s.projection))),!d[fe.ANIMATING]&&!d[fe.INTERACTING]&&!vi(_))if(c){const m=s.projection,y=c.getImage(_,h,r,m);y&&(this.loadImage(y)?this.image=y:y.getState()===J.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const r=this.getLayer(),s=de(e.pixelToCoordinateTransform,t.slice()),h=r.getExtent();if(h&&!As(h,s))return null;const c=this.image.getExtent(),d=this.image.getImage(),_=yt(c),m=Math.floor(d.width*((s[0]-c[0])/_));if(m<0||m>=d.width)return null;const y=Wt(c),x=Math.floor(d.height*((c[3]-s[1])/y));return x<0||x>=d.height?null:this.getImageData(d,m,x)}renderFrame(t,e){const r=this.image,s=r.getExtent(),h=r.getResolution(),[c,d]=Array.isArray(h)?h:[h,h],_=r.getPixelRatio(),m=t.layerStatesArray[t.layerIndex],y=t.pixelRatio,x=t.viewState,w=x.center,C=x.resolution,T=y*c/(C*_),O=y*d/(C*_);this.prepareContainer(t,e);const M=this.context.canvas.width,A=this.context.canvas.height,D=this.getRenderContext(t);let z=!1,b=!0;if(m.extent){const K=Ze(m.extent,x.projection);b=mi(K,t.extent),z=b&&!Bo(K,t.extent),z&&this.clipUnrotated(D,t,K)}const F=r.getImage(),B=_i(this.tempTransform,M/2,A/2,T,O,0,_*(s[0]-w[0])/c,_*(w[1]-s[3])/d);this.renderedResolution=d*y/_;const V=F.width*B[0],k=F.height*B[3];if(this.getLayer().getSource().getInterpolate()||(D.imageSmoothingEnabled=!1),this.preRender(D,t),b&&V>=.5&&k>=.5){const K=B[4],Y=B[5],st=m.opacity;st!==1&&(D.save(),D.globalAlpha=st),D.drawImage(F,0,0,+F.width,+F.height,K,Y,V,k),st!==1&&D.restore()}return this.postRender(this.context,t),z&&D.restore(),D.imageSmoothingEnabled=!0,this.container}}class zv extends wr{constructor(t){t=t||{},super(t)}}class nc extends zv{constructor(t){super(t)}createRenderer(){return new Xv(this)}getData(t){return super.getData(t)}}class Yv extends Ca{constructor(t,e,r,s,h){const c=h!==void 0?J.IDLE:J.LOADED;super(t,e,r,c),this.loader_=h!==void 0?h:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=J.ERROR):this.state=J.LOADED,this.changed()}load(){this.state==J.IDLE&&(this.state=J.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class La extends mr{constructor(t,e,r){super(),r=r||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent(ct.CHANGE)}release(){this.setState($.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==$.EMPTY){if(this.state!==$.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Tt()}getAlpha(t,e){if(!this.transition_)return 1;let r=this.transitionStarts_[t];if(!r)r=e,this.transitionStarts_[t]=r;else if(r===-1)return 1;const s=e-r+1e3/60;return s>=this.transition_?1:mu(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function Es(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function Bv(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}const Uv=new Error("disposed");let ei=null;function Wv(i){ei||(ei=Qt(i.width,i.height,void 0,{willReadFrequently:!0}));const t=ei.canvas,e=i.width;t.width!==e&&(t.width=e);const r=i.height;return t.height!==r&&(t.height=r),ei.clearRect(0,0,e,r),ei.drawImage(i,0,0),ei.getImageData(0,0,e,r).data}const jv=[256,256];class xs extends La{constructor(t){const e=$.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=Es(this.data_);return t?[t.width,t.height]:jv}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==$.IDLE&&this.state!==$.ERROR)return;this.state=$.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=$.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=$.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Uv),this.controller_=null),super.disposeInternal()}}class Vv extends La{constructor(t,e,r,s,h,c){super(t,e,c),this.crossOrigin_=s,this.src_=r,this.key=r,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=h}getImage(){return this.image_}setImage(t){this.image_=t,this.state=$.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=$.ERROR,this.unlistenImage_(),this.image_=Zv(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=$.LOADED:this.state=$.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==$.ERROR&&(this.state=$.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==$.IDLE&&(this.state=$.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=iv(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function Zv(){const i=Qt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}class Ma{constructor(t,e,r,s){this.minX=t,this.maxX=e,this.minY=r,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ni(i,t,e,r,s){return s!==void 0?(s.minX=i,s.maxX=t,s.minY=e,s.maxY=r,s):new Ma(i,t,e,r)}let Fo;const fi=[];function Yh(i,t,e,r,s){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(r,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,r)+1,Math.max(e,s)),i.restore()}function bo(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function Kv(){if(Fo===void 0){const i=Qt(6,6,fi);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Yh(i,4,5,4,0),Yh(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Fo=bo(t,0)||bo(t,4)||bo(t,8),pa(i),fi.push(i.canvas)}return Fo}function $o(i,t,e,r){const s=Tu(e,t,i);let h=hh(t,r,e);const c=t.getMetersPerUnit();c!==void 0&&(h*=c);const d=i.getMetersPerUnit();d!==void 0&&(h/=d);const _=i.getExtent();if(!_||As(_,s)){const m=hh(i,h,s)/h;isFinite(m)&&m>0&&(h/=m)}return h}function ic(i,t,e,r){const s=Ke(e);let h=$o(i,t,s,r);return(!isFinite(h)||h<=0)&&gu(e,function(c){return h=$o(i,t,c,r),isFinite(h)&&h>0}),h}function rc(i,t,e,r,s,h,c,d,_,m,y,x,w,C){const T=Qt(Math.round(e*i),Math.round(e*t),fi);if(x||(T.imageSmoothingEnabled=!1),_.length===0)return T.canvas;T.scale(e,e);function O(F){return Math.round(F*e)/e}T.globalCompositeOperation="lighter";const M=En();_.forEach(function(F,B,V){fu(M,F.extent)});let A;const D=e/r,z=(x?1:1+Math.pow(2,-24))/D;if(!w||_.length!==1||m!==0){if(A=Qt(Math.round(yt(M)*D),Math.round(Wt(M)*D),fi),x||(A.imageSmoothingEnabled=!1),s&&C){const F=(s[0]-M[0])*D,B=-(s[3]-M[3])*D,V=yt(s)*D,k=Wt(s)*D;A.rect(F,B,V,k),A.clip()}_.forEach(function(F,B,V){if(F.image.width>0&&F.image.height>0){if(F.clipExtent){A.save();const et=(F.clipExtent[0]-M[0])*D,Z=-(F.clipExtent[3]-M[3])*D,ot=yt(F.clipExtent)*D,Q=Wt(F.clipExtent)*D;A.rect(x?et:Math.round(et),x?Z:Math.round(Z),x?ot:Math.round(et+ot)-Math.round(et),x?Q:Math.round(Z+Q)-Math.round(Z)),A.clip()}const k=(F.extent[0]-M[0])*D,K=-(F.extent[3]-M[3])*D,Y=yt(F.extent)*D,st=Wt(F.extent)*D;A.drawImage(F.image,m,m,F.image.width-2*m,F.image.height-2*m,x?k:Math.round(k),x?K:Math.round(K),x?Y:Math.round(k+Y)-Math.round(k),x?st:Math.round(K+st)-Math.round(K)),F.clipExtent&&A.restore()}})}const b=He(c);return d.getTriangles().forEach(function(F,B,V){const k=F.source,K=F.target;let Y=k[0][0],st=k[0][1],et=k[1][0],Z=k[1][1],ot=k[2][0],Q=k[2][1];const wt=O((K[0][0]-b[0])/h),gt=O(-(K[0][1]-b[1])/h),Nt=O((K[1][0]-b[0])/h),_t=O(-(K[1][1]-b[1])/h),ut=O((K[2][0]-b[0])/h),Et=O(-(K[2][1]-b[1])/h),Ht=Y,Rt=st;Y=0,st=0,et-=Ht,Z-=Rt,ot-=Ht,Q-=Rt;const Yt=[[et,Z,0,0,Nt-wt],[ot,Q,0,0,ut-wt],[0,0,et,Z,_t-gt],[0,0,ot,Q,Et-gt]],nt=E_(Yt);if(!nt)return;if(T.save(),T.beginPath(),Kv()||!x){T.moveTo(Nt,_t);const $t=4,ae=wt-Nt,Vt=gt-_t;for(let kt=0;kt<$t;kt++)T.lineTo(Nt+O((kt+1)*ae/$t),_t+O(kt*Vt/($t-1))),kt!=$t-1&&T.lineTo(Nt+O((kt+1)*ae/$t),_t+O((kt+1)*Vt/($t-1)));T.lineTo(ut,Et)}else T.moveTo(Nt,_t),T.lineTo(wt,gt),T.lineTo(ut,Et);T.clip(),T.transform(nt[0],nt[2],nt[1],nt[3],wt,gt),T.translate(M[0]-Ht,M[3]-Rt);let jt;if(A)jt=A.canvas,T.scale(z,-z);else{const $t=_[0],ae=$t.extent;jt=$t.image,T.scale(yt(ae)/jt.width,-Wt(ae)/jt.height)}T.drawImage(jt,0,0),T.restore()}),A&&(pa(A),fi.push(A.canvas)),y&&(T.save(),T.globalCompositeOperation="source-over",T.strokeStyle="black",T.lineWidth=1,d.getTriangles().forEach(function(F,B,V){const k=F.target,K=(k[0][0]-b[0])/h,Y=-(k[0][1]-b[1])/h,st=(k[1][0]-b[0])/h,et=-(k[1][1]-b[1])/h,Z=(k[2][0]-b[0])/h,ot=-(k[2][1]-b[1])/h;T.beginPath(),T.moveTo(st,et),T.lineTo(K,Y),T.lineTo(Z,ot),T.closePath(),T.stroke()}),T.restore()),T.canvas}const Hv=10,Bh=.25;class Pa{constructor(t,e,r,s,h,c,d){this.sourceProj_=t,this.targetProj_=e;let _={};const m=d?cp(z=>de(d,Tu(z,this.targetProj_,this.sourceProj_))):ps(this.targetProj_,this.sourceProj_);this.transformInv_=function(z){const b=z[0]+"/"+z[1];return _[b]||(_[b]=m(z)),_[b]},this.maxSourceExtent_=s,this.errorThresholdSquared_=h*h,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&yt(s)>=yt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?yt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?yt(this.targetProj_.getExtent()):null;const y=He(r),x=Ps(r),w=Ms(r),C=Ls(r),T=this.transformInv_(y),O=this.transformInv_(x),M=this.transformInv_(w),A=this.transformInv_(C),D=Hv+(c?Math.max(0,Math.ceil(Math.log2(hr(r)/(c*c*256*256)))):0);if(this.addQuad_(y,x,w,C,T,O,M,A,D),this.wrapsXInSource_){let z=1/0;this.triangles_.forEach(function(b,F,B){z=Math.min(z,b.source[0][0],b.source[1][0],b.source[2][0])}),this.triangles_.forEach(b=>{if(Math.max(b.source[0][0],b.source[1][0],b.source[2][0])-z>this.sourceWorldWidth_/2){const F=[[b.source[0][0],b.source[0][1]],[b.source[1][0],b.source[1][1]],[b.source[2][0],b.source[2][1]]];F[0][0]-z>this.sourceWorldWidth_/2&&(F[0][0]-=this.sourceWorldWidth_),F[1][0]-z>this.sourceWorldWidth_/2&&(F[1][0]-=this.sourceWorldWidth_),F[2][0]-z>this.sourceWorldWidth_/2&&(F[2][0]-=this.sourceWorldWidth_);const B=Math.min(F[0][0],F[1][0],F[2][0]);Math.max(F[0][0],F[1][0],F[2][0])-B<this.sourceWorldWidth_/2&&(b.source=F)}})}_={}}addTriangle_(t,e,r,s,h,c){this.triangles_.push({source:[s,h,c],target:[t,e,r]})}addQuad_(t,e,r,s,h,c,d,_,m){const y=Ql([h,c,d,_]),x=this.sourceWorldWidth_?yt(y)/this.sourceWorldWidth_:null,w=this.sourceWorldWidth_,C=this.sourceProj_.canWrapX()&&x>.5&&x<1;let T=!1;if(m>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const M=Ql([t,e,r,s]);T=yt(M)/this.targetWorldWidth_>Bh||T}!C&&this.sourceProj_.isGlobal()&&x&&(T=x>Bh||T)}if(!T&&this.maxSourceExtent_&&isFinite(y[0])&&isFinite(y[1])&&isFinite(y[2])&&isFinite(y[3])&&!mi(y,this.maxSourceExtent_))return;let O=0;if(!T&&(!isFinite(h[0])||!isFinite(h[1])||!isFinite(c[0])||!isFinite(c[1])||!isFinite(d[0])||!isFinite(d[1])||!isFinite(_[0])||!isFinite(_[1]))){if(m>0)T=!0;else if(O=(!isFinite(h[0])||!isFinite(h[1])?8:0)+(!isFinite(c[0])||!isFinite(c[1])?4:0)+(!isFinite(d[0])||!isFinite(d[1])?2:0)+(!isFinite(_[0])||!isFinite(_[1])?1:0),O!=1&&O!=2&&O!=4&&O!=8)return}if(m>0){if(!T){const M=[(t[0]+r[0])/2,(t[1]+r[1])/2],A=this.transformInv_(M);let D;C?D=(hi(h[0],w)+hi(d[0],w))/2-hi(A[0],w):D=(h[0]+d[0])/2-A[0];const z=(h[1]+d[1])/2-A[1];T=D*D+z*z>this.errorThresholdSquared_}if(T){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){const M=[(e[0]+r[0])/2,(e[1]+r[1])/2],A=this.transformInv_(M),D=[(s[0]+t[0])/2,(s[1]+t[1])/2],z=this.transformInv_(D);this.addQuad_(t,e,M,D,h,c,A,z,m-1),this.addQuad_(D,M,r,s,z,A,d,_,m-1)}else{const M=[(t[0]+e[0])/2,(t[1]+e[1])/2],A=this.transformInv_(M),D=[(r[0]+s[0])/2,(r[1]+s[1])/2],z=this.transformInv_(D);this.addQuad_(t,M,D,s,h,A,z,_,m-1),this.addQuad_(M,e,r,D,A,c,d,z,m-1)}return}}if(C){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(O&11)==0&&this.addTriangle_(t,r,s,h,d,_),(O&14)==0&&this.addTriangle_(t,r,e,h,d,c),O&&((O&13)==0&&this.addTriangle_(e,s,t,c,_,h),(O&7)==0&&this.addTriangle_(e,s,r,c,_,d))}calculateSourceExtent(){const t=En();return this.triangles_.forEach(function(e,r,s){const h=e.source;os(t,h[0]),os(t,h[1]),os(t,h[2])}),t}getTriangles(){return this.triangles_}}const Da=.5;class $v extends La{constructor(t,e,r,s,h,c,d,_,m,y,x,w){super(h,$.IDLE,w),this.renderEdges_=x!==void 0?x:!1,this.pixelRatio_=d,this.gutter_=_,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=c||h,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const C=s.getTileCoordExtent(this.wrappedTileCoord_),T=this.targetTileGrid_.getExtent();let O=this.sourceTileGrid_.getExtent();const M=T?pe(C,T):C;if(hr(M)===0){this.state=$.EMPTY;return}const A=t.getExtent();A&&(O?O=pe(O,A):O=A);const D=s.getResolution(this.wrappedTileCoord_[0]),z=ic(t,r,M,D);if(!isFinite(z)||z<=0){this.state=$.EMPTY;return}const b=y!==void 0?y:Da;if(this.triangulation_=new Pa(t,r,M,O,z*b,D),this.triangulation_.getTriangles().length===0){this.state=$.EMPTY;return}this.sourceZ_=e.getZForResolution(z);let F=this.triangulation_.calculateSourceExtent();if(O&&(t.canWrapX()?(F[1]=Kt(F[1],O[1],O[3]),F[3]=Kt(F[3],O[1],O[3])):F=pe(F,O)),!hr(F))this.state=$.EMPTY;else{let B=0,V=0;t.canWrapX()&&(B=yt(A),V=Math.floor((F[0]-A[0])/B)),pu(F.slice(),t).forEach(K=>{const Y=e.getTileRangeForExtentAndZ(K,this.sourceZ_);for(let st=Y.minX;st<=Y.maxX;st++)for(let et=Y.minY;et<=Y.maxY;et++){const Z=m(this.sourceZ_,st,et,d);if(Z){const ot=V*B;this.sourceTiles_.push({tile:Z,offset:ot})}}++V}),this.sourceTiles_.length===0&&(this.state=$.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var s;const r=e.tile;if(r&&r.getState()==$.LOADED){const h=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);h[0]+=e.offset,h[2]+=e.offset;const c=(s=this.clipExtent_)==null?void 0:s.slice();c&&(c[0]+=e.offset,c[2]+=e.offset),t.push({extent:h,clipExtent:c,image:r.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=$.ERROR;else{const e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),s=typeof r=="number"?r:r[0],h=typeof r=="number"?r:r[1],c=this.targetTileGrid_.getResolution(e),d=this.sourceTileGrid_.getResolution(this.sourceZ_),_=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=rc(s,h,this.pixelRatio_,d,this.sourceTileGrid_.getExtent(),c,_,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=$.LOADED}this.changed()}load(){if(this.state==$.IDLE){this.state=$.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const r=e.getState();if(r==$.IDLE||r==$.LOADING){t++;const s=St(e,ct.CHANGE,h=>{const c=e.getState();(c==$.LOADED||c==$.ERROR||c==$.EMPTY)&&(Gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},r,s){e.getState()==$.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Gt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(pa(this.canvas_.getContext("2d")),fi.push(this.canvas_),this.canvas_=null),super.release()}}class qv{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof pr&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const r=this.entries_[t];return Mt(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(t){const e=this.entries_[t];return Mt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.key_;return t}getValues(){const t=new Array(this.count_);let e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Mt(!(t in this.entries_),"Tried to set a value for a key that is used already");const r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}setSize(t){this.highWaterMark=t}}function ws(i,t,e,r){return r!==void 0?(r[0]=i,r[1]=t,r[2]=e,r):[i,t,e]}function Jv(i,t,e){return i+"/"+t+"/"+e}function Qv(i,t,e){return(t<<i)+e}function ty(i,t){const e=i[0],r=i[1],s=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const h=t.getFullTileRange(e);return h?h.containsXY(r,s):!0}function No(i,t,e,r){return`${i},${Jv(t,e,r)}`}function Go(i,t,e){if(!(e in i))return i[e]=new Set([t]),!0;const r=i[e],s=r.has(t);return s||r.add(t),!s}function ey(i,t,e){const r=i[e];return r?r.delete(t):!1}function Uh(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=pe(t,Ze(e.extent,i.viewState.projection)));const r=e.layer.getRenderSource();if(!r.getWrapX()){const s=r.getTileGridForProjection(i.viewState.projection).getExtent();s&&(t=pe(t,s))}return t}class ny extends ec{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=En(),this.tempTileRange_=new Ma(0,0,0,0),this.tempTileCoord_=ws(0,0,0);const r=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new qv(r),this.maxStaleKeys=r*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,r,s){const h=this.tileCache_,d=this.getLayer().getSource(),_=No(d.getKey(),t,e,r);let m;if(h.containsKey(_))m=h.get(_);else{if(m=d.getTile(t,e,r,s.pixelRatio,s.viewState.projection),!m)return null;h.set(_,m)}return m}getTile(t,e,r,s){const h=this.getOrCreateTile(t,e,r,s);return h||null}getData(t){const e=this.frameState;if(!e)return null;const r=this.getLayer(),s=de(e.pixelToCoordinateTransform,t.slice()),h=r.getExtent();if(h&&!As(h,s))return null;const c=e.viewState,d=r.getRenderSource(),_=d.getTileGridForProjection(c.projection),m=d.getTilePixelRatio(e.pixelRatio);for(let y=_.getZForResolution(c.resolution);y>=_.getMinZoom();--y){const x=_.getTileCoordForCoordAndZ(s,y),w=this.getTile(y,x[1],x[2],e);if(!w||w.getState()!==$.LOADED)continue;const C=_.getOrigin(y),T=ne(_.getTileSize(y)),O=_.getResolution(y);let M;if(w instanceof Vv||w instanceof $v)M=w.getImage();else if(w instanceof xs){if(M=Es(w.getData()),!M)continue}else continue;const A=Math.floor(m*((s[0]-C[0])/O-x[1]*T[0])),D=Math.floor(m*((C[1]-s[1])/O-x[2]*T[1])),z=Math.round(m*d.getGutterForProjection(c.projection));return this.getImageData(M,A+z,D+z)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const r=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==r&&(this.renderedRevision_=r,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=r,!0}enqueueTiles(t,e,r,s,h){const c=t.viewState,d=this.getLayer(),_=d.getRenderSource(),m=_.getTileGridForProjection(c.projection),y=ee(_);y in t.wantedTiles||(t.wantedTiles[y]={});const x=t.wantedTiles[y],w=d.getMapInternal(),C=Math.max(r-h,m.getMinZoom(),m.getZForResolution(Math.min(d.getMaxResolution(),w?w.getView().getResolutionForZoom(Math.max(d.getMinZoom(),0)):m.getResolution(0)),_.zDirection)),T=c.rotation,O=T?_u(c.center,c.resolution,T,t.size):void 0;for(let M=r;M>=C;--M){const A=m.getTileRangeForExtentAndZ(e,M,this.tempTileRange_),D=m.getResolution(M);for(let z=A.minX;z<=A.maxX;++z)for(let b=A.minY;b<=A.maxY;++b){if(T&&!m.tileCoordIntersectsViewport([M,z,b],O))continue;const F=this.getTile(M,z,b,t);if(!F||!Go(s,F,M))continue;const V=F.getKey();if(x[V]=!0,F.getState()===$.IDLE&&!t.tileQueue.isKeyQueued(V)){const k=ws(M,z,b,this.tempTileCoord_);t.tileQueue.enqueue([F,y,m.getTileCoordCenter(k),D])}}}}findStaleTile_(t,e){const r=this.tileCache_,s=t[0],h=t[1],c=t[2],d=this.getStaleKeys();for(let _=0;_<d.length;++_){const m=No(d[_],s,h,c);if(r.containsKey(m)){const y=r.peek(m);if(y.getState()===$.LOADED)return y.endTransition(ee(this)),Go(e,y,s),!0}}return!1}findAltTiles_(t,e,r,s){const h=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!h)return!1;let c=!0;const d=this.tileCache_,m=this.getLayer().getRenderSource().getKey();for(let y=h.minX;y<=h.maxX;++y)for(let x=h.minY;x<=h.maxY;++x){const w=No(m,r,y,x);let C=!1;if(d.containsKey(w)){const T=d.peek(w);T.getState()===$.LOADED&&(Go(s,T,r),C=!0)}C||(c=!1)}return c}renderFrame(t,e){let r=!0;this.renderComplete=!0;const s=t.layerStatesArray[t.layerIndex],h=t.viewState,c=h.projection,d=h.resolution,_=h.center,m=t.pixelRatio,y=this.getLayer(),x=y.getSource(),w=x.getTileGridForProjection(c),C=w.getZForResolution(d,x.zDirection),T=w.getResolution(C),O=x.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==O&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=O):this.renderedSourceKey_=O;let M=t.extent;const A=x.getTilePixelRatio(m);this.prepareContainer(t,e);const D=this.context.canvas.width,z=this.context.canvas.height,b=s.extent&&Ze(s.extent);b&&(M=pe(M,Ze(s.extent)));const F=T*D/2/A,B=T*z/2/A,V=[_[0]-F,_[1]-B,_[0]+F,_[1]+B],k={};this.renderedTiles.length=0;const K=y.getPreload();if(t.nextExtent){const _t=w.getZForResolution(h.nextResolution,x.zDirection),ut=Uh(t,t.nextExtent);this.enqueueTiles(t,ut,_t,k,K)}const Y=Uh(t,M);if(this.enqueueTiles(t,Y,C,k,0),K>0&&setTimeout(()=>{this.enqueueTiles(t,Y,C-1,k,K-1)},0),!(C in k))return this.container;const st=ee(this),et=t.time;for(const _t of k[C]){const ut=_t.getState();if(ut===$.EMPTY)continue;const Et=_t.tileCoord;if(ut===$.LOADED&&_t.getAlpha(st,et)===1){_t.endTransition(st);continue}if(ut!==$.IDLE&&(r=!1),ut!==$.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Et,k)){ey(k,_t,C),t.animate=!0;continue}if(this.findAltTiles_(w,Et,C+1,k))continue;const Yt=w.getMinZoom();for(let nt=C-1;nt>=Yt&&!this.findAltTiles_(w,Et,nt,k);--nt);}const Z=T/d*m/A,ot=this.getRenderContext(t);_i(this.tempTransform,D/2,z/2,Z,Z,0,-D/2,-z/2),s.extent&&this.clipUnrotated(ot,t,b),x.getInterpolate()||(ot.imageSmoothingEnabled=!1),this.preRender(ot,t);const Q=Object.keys(k).map(Number);Q.sort(Rs);let wt;const gt=[],Nt=[];for(let _t=Q.length-1;_t>=0;--_t){const ut=Q[_t],Et=x.getTilePixelSize(ut,m,c),Rt=w.getResolution(ut)/T,Yt=Et[0]*Rt*Z,nt=Et[1]*Rt*Z,jt=w.getTileCoordForCoordAndZ(He(V),ut),$t=w.getTileCoordExtent(jt),ae=de(this.tempTransform,[A*($t[0]-V[0])/T,A*(V[3]-$t[3])/T]),Vt=A*x.getGutterForProjection(c);for(const kt of k[ut]){if(kt.getState()!==$.LOADED)continue;const bn=kt.tileCoord,xn=jt[1]-bn[1],wn=Math.round(ae[0]-(xn-1)*Yt),Ie=jt[2]-bn[2],xi=Math.round(ae[1]-(Ie-1)*nt),ve=Math.round(ae[0]-xn*Yt),Le=Math.round(ae[1]-Ie*nt),Je=wn-ve,Ge=xi-Le,Ir=Q.length===1;let wi=!1;wt=[ve,Le,ve+Je,Le,ve+Je,Le+Ge,ve,Le+Ge];for(let Nn=0,js=gt.length;Nn<js;++Nn)if(!Ir&&ut<Nt[Nn]){const le=gt[Nn];mi([ve,Le,ve+Je,Le+Ge],[le[0],le[3],le[4],le[7]])&&(wi||(ot.save(),wi=!0),ot.beginPath(),ot.moveTo(wt[0],wt[1]),ot.lineTo(wt[2],wt[3]),ot.lineTo(wt[4],wt[5]),ot.lineTo(wt[6],wt[7]),ot.moveTo(le[6],le[7]),ot.lineTo(le[4],le[5]),ot.lineTo(le[2],le[3]),ot.lineTo(le[0],le[1]),ot.clip())}gt.push(wt),Nt.push(ut),this.drawTile(kt,t,ve,Le,Je,Ge,Vt,Ir),wi&&ot.restore(),this.renderedTiles.unshift(kt),this.updateUsedTiles(t.usedTiles,x,kt)}}if(this.renderedResolution=T,this.extentChanged=!this.renderedExtent_||!di(this.renderedExtent_,V),this.renderedExtent_=V,this.renderedPixelRatio=m,this.postRender(this.context,t),s.extent&&ot.restore(),ot.imageSmoothingEnabled=!0,this.renderComplete){const _t=(ut,Et)=>{const Ht=ee(x),Rt=Et.wantedTiles[Ht],Yt=Rt?Object.keys(Rt).length:0;this.updateCacheSize(Yt),this.tileCache_.expireCache()};t.postRenderFunctions.push(_t)}return!this.renderComplete&&!r&&(t.animate=!0),this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,r,s,h,c,d,_){let m;if(t instanceof xs){if(m=Es(t.getData()),!m)throw new Error("Rendering array data is not yet supported")}else m=this.getTileImage(t);if(!m)return;const y=this.getRenderContext(e),x=ee(this),w=e.layerStatesArray[e.layerIndex],C=w.opacity*(_?t.getAlpha(x,e.time):1),T=C!==y.globalAlpha;T&&(y.save(),y.globalAlpha=C),y.drawImage(m,d,d,m.width-2*d,m.height-2*d,r,s,h,c),T&&y.restore(),C!==w.opacity?e.animate=!0:_&&t.endTransition(x)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,r){const s=ee(e);s in t||(t[s]={}),t[s][r.getKey()]=!0}}const rs={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class iy extends wr{constructor(t){t=t||{};const e=Object.assign({},t),r=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=r,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(rs.PRELOAD)}setPreload(t){this.set(rs.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(rs.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(rs.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class ry extends iy{constructor(t){super(t)}createRenderer(){return new ny(this,{cacheSize:this.getCacheSize()})}}function qo(i){return Array.isArray(i)?Math.min(...i):i}class sy extends Ca{constructor(t,e,r,s,h,c,d){let _=t.getExtent();_&&t.canWrapX()&&(_=_.slice(),_[0]=-1/0,_[2]=1/0);let m=e.getExtent();m&&e.canWrapX()&&(m=m.slice(),m[0]=-1/0,m[2]=1/0);const y=m?pe(r,m):r,x=Ke(y),w=$o(t,e,x,s),C=Da,T=new Pa(t,e,y,_,w*C,s),O=T.calculateSourceExtent(),M=vi(O)?null:c(O,w,h),A=M?J.IDLE:J.EMPTY,D=M?M.getPixelRatio():1;super(r,s,D,A),this.targetProj_=e,this.maxSourceExtent_=_,this.triangulation_=T,this.targetResolution_=s,this.targetExtent_=r,this.sourceImage_=M,this.sourcePixelRatio_=D,this.interpolate_=d,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==J.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==J.LOADED){const e=yt(this.targetExtent_)/this.targetResolution_,r=Wt(this.targetExtent_)/this.targetResolution_;this.canvas_=rc(e,r,this.sourcePixelRatio_,qo(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==J.IDLE){this.state=J.LOADING,this.changed();const t=this.sourceImage_.getState();t==J.LOADED||t==J.ERROR?this.reproject_():(this.sourceListenerKey_=St(this.sourceImage_,ct.CHANGE,e=>{const r=this.sourceImage_.getState();(r==J.LOADED||r==J.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){Gt(this.sourceListenerKey_),this.sourceListenerKey_=null}}class Us extends $e{constructor(t){super(),this.projection=me(t.projection),this.attributions_=Wh(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(r,s){e.viewResolver=r,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Wh(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Wh(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}const ss=4,ko={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class oy extends Ne{constructor(t,e){super(t),this.image=e}}class sc extends Us{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const r=Ts(e,t,0);t=e[r]}return t}getImage(t,e,r,s){const h=this.getProjection();if(!h||!s||ar(h,s))return h&&(s=h),this.getImageInternal(t,e,r,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ar(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==e&&di(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new sy(h,s,t,e,r,(c,d,_)=>this.getImageInternal(c,d,_,h),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,r,s){if(this.loader){const h=ay(t,e,r,1),c=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&Bo(this.wantedExtent_,h)||Bo(this.image.getExtent(),h))&&(this.wantedResolution_&&qo(this.wantedResolution_)===c||qo(this.image.getResolution())===c)))return this.image;this.wantedProjection_=s,this.wantedExtent_=h,this.wantedResolution_=c,this.image=new Ca(h,c,r,this.loader),this.image.addEventListener(ct.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let r;switch(e.getState()){case J.LOADING:this.loading=!0,r=ko.IMAGELOADSTART;break;case J.LOADED:this.loading=!1,r=ko.IMAGELOADEND;break;case J.ERROR:this.loading=!1,r=ko.IMAGELOADERROR;break;default:return}this.hasListener(r)&&this.dispatchEvent(new oy(r,e))}}function ay(i,t,e,r){const s=t/e,h=Ke(i),c=_n(yt(i)/s,ss),d=_n(Wt(i)/s,ss),_=_n((r-1)*c/2,ss),m=c+2*_,y=_n((r-1)*d/2,ss),x=d+2*y;return fs(h,s,0,[m,x])}const ii=[0,0,0],cn=5;class oc{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Mt(l_(this.resolutions_,(s,h)=>h-s),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,h=this.resolutions_.length-1;s<h;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Mt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const r=t.extent;r!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=He(r)),Mt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Mt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:ga,Mt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=r!==void 0?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,h)=>{const c=new Ma(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(r){const d=this.getTileRangeForExtentAndZ(r,h);c.minX=Math.max(d.minX,c.minX),c.maxX=Math.min(d.maxX,c.maxX),c.minY=Math.max(d.minY,c.minY),c.maxY=Math.min(d.maxY,c.maxY)}return c}):r&&this.calculateTileRanges_(r)}forEachTileCoord(t,e,r){const s=this.getTileRangeForExtentAndZ(t,e);for(let h=s.minX,c=s.maxX;h<=c;++h)for(let d=s.minY,_=s.maxY;d<=_;++d)r([e,h,d])}forEachTileCoordParentTileRange(t,e,r,s){let h,c,d,_=null,m=t[0]-1;for(this.zoomFactor_===2?(c=t[1],d=t[2]):_=this.getTileCoordExtent(t,s);m>=this.minZoom;){if(c!==void 0&&d!==void 0?(c=Math.floor(c/2),d=Math.floor(d/2),h=ni(c,c,d,d,r)):h=this.getTileRangeForExtentAndZ(_,m,r),e(m,h))return!0;--m}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,r){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const h=t[1]*2,c=t[2]*2;return ni(h,h+1,c,c+1,e)}const s=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],h=t[1],c=t[2];if(e===s)return ni(h,c,h,c,r);if(this.zoomFactor_){const _=Math.pow(this.zoomFactor_,e-s),m=Math.floor(h*_),y=Math.floor(c*_);if(e<s)return ni(m,m,y,y,r);const x=Math.floor(_*(h+1))-1,w=Math.floor(_*(c+1))-1;return ni(m,x,y,w,r)}const d=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(d,e,r)}getTileRangeForExtentAndZ(t,e,r){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ii);const s=ii[1],h=ii[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ii);const c=ii[1],d=ii[2];return ni(s,c,h,d,r)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=ne(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*r,e[1]-(t[2]+.5)*s[1]*r]}getTileCoordExtent(t,e){const r=this.getOrigin(t[0]),s=this.getResolution(t[0]),h=ne(this.getTileSize(t[0]),this.tmpSize_),c=r[0]+t[1]*h[0]*s,d=r[1]-(t[2]+1)*h[1]*s,_=c+h[0]*s,m=d+h[1]*s;return vr(c,d,_,m,e)}getTileCoordForCoordAndResolution(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)}getTileCoordForXYAndResolution_(t,e,r,s,h){const c=this.getZForResolution(r),d=r/this.getResolution(c),_=this.getOrigin(c),m=ne(this.getTileSize(c),this.tmpSize_);let y=d*(t-_[0])/r/m[0],x=d*(_[1]-e)/r/m[1];return s?(y=_n(y,cn)-1,x=_n(x,cn)-1):(y=qr(y,cn),x=qr(x,cn)),ws(c,y,x,h)}getTileCoordForXYAndZ_(t,e,r,s,h){const c=this.getOrigin(r),d=this.getResolution(r),_=ne(this.getTileSize(r),this.tmpSize_);let m=(t-c[0])/d/_[0],y=(c[1]-e)/d/_[1];return s?(m=_n(m,cn)-1,y=_n(y,cn)-1):(m=qr(m,cn),y=qr(y,cn)),ws(r,m,y,h)}getTileCoordForCoordAndZ(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const r=Ts(this.resolutions_,t,e||0);return Kt(r,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Du(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,r=new Array(e);for(let s=this.minZoom;s<e;++s)r[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=r}}function ac(i){let t=i.getDefaultTileGrid();return t||(t=cy(i),i.setDefaultTileGrid(t)),t}function ly(i,t,e){const r=t[0],s=i.getTileCoordCenter(t),h=Fa(e);if(!As(h,s)){const c=yt(h),d=Math.ceil((h[0]-s[0])/c);return s[0]+=c*d,i.getTileCoordForCoordAndZ(s,r)}return t}function hy(i,t,e,r){r=r!==void 0?r:"top-left";const s=lc(i,t,e);return new oc({extent:i,origin:S_(i,r),resolutions:s,tileSize:e})}function uy(i){const t=i||{},e=t.extent||me("EPSG:3857").getExtent(),r={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:lc(e,t.maxZoom,t.tileSize,t.maxResolution)};return new oc(r)}function lc(i,t,e,r){t=t!==void 0?t:Bp,e=ne(e!==void 0?e:ga);const s=Wt(i),h=yt(i);r=r>0?r:Math.max(h/e[0],s/e[1]);const c=t+1,d=new Array(c);for(let _=0;_<c;++_)d[_]=r/Math.pow(2,_);return d}function cy(i,t,e,r){const s=Fa(i);return hy(s,t,e,r)}function Fa(i){i=me(i);let t=i.getExtent();if(!t){const e=180*na.degrees/i.getMetersPerUnit();t=vr(-e,-e,e,e)}return t}class hc extends Us{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ne(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||ee(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,r,s,h){return Tt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:ac(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,r){const s=this.getTileGridForProjection(r),h=this.getTilePixelRatio(e),c=ne(s.getTileSize(t),this.tmpSize);return h==1?c:Pm(c,h,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const r=e!==void 0?e:this.getProjection(),s=e!==void 0?this.getTileGridForProjection(r):this.tileGrid||this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=ly(s,t,r)),ty(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class fy extends Ne{constructor(t,e){super(t),this.tile=e}}function uc(i){return function(t){const e=t.buffers,r=t.meta,s=t.imageOps,h=t.width,c=t.height,d=e.length,_=e[0].byteLength;if(s){const w=new Array(d);for(let T=0;T<d;++T)w[T]=new ImageData(new Uint8ClampedArray(e[T]),h,c);return i(w,r).data.buffer}const m=new Uint8ClampedArray(_),y=new Array(d),x=new Array(d);for(let w=0;w<d;++w)y[w]=new Uint8ClampedArray(e[w]),x[w]=[0,0,0,0];for(let w=0;w<_;w+=4){for(let T=0;T<d;++T){const O=y[T];x[T][0]=O[w],x[T][1]=O[w+1],x[T][2]=O[w+2],x[T][3]=O[w+3]}const C=i(x,r);m[w]=C[0],m[w+1]=C[1],m[w+2]=C[2],m[w+3]=C[3]}return m.buffer}}function dy(i,t){const r=Object.keys(i.lib||{}).map(function(h){return"const "+h+" = "+i.lib[h].toString()+";"}).concat(["const __minion__ = ("+uc.toString()+")(",i.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),s=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return s.addEventListener("message",t),s}function gy(i,t){const e=uc(i.operation);let r=!1;return{postMessage:function(s){setTimeout(function(){r||t({data:{buffer:e(s),meta:s.meta}})},0)},terminate:function(){r=!0}}}class _y extends pr{constructor(t){super(),this.imageOps_=!!t.imageOps;let e;t.threads===0?e=0:this.imageOps_?e=1:e=t.threads||1;const r=new Array(e);if(e)for(let s=0;s<e;++s)r[s]=dy(t,this.onWorkerMessage_.bind(this,s));else r[0]=gy(t,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=t.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(t,e,r){this.enqueue_({inputs:t,meta:e,callback:r}),this.dispatch_()}enqueue_(t){for(this.queue_.push(t);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const t=this.queue_.shift();this.job_=t;const e=t.inputs[0].width,r=t.inputs[0].height,s=t.inputs.map(function(_){return _.data.buffer}),h=this.workers_.length;if(this.running_=h,h===1){this.workers_[0].postMessage({buffers:s,meta:t.meta,imageOps:this.imageOps_,width:e,height:r},s);return}const c=t.inputs[0].data.length,d=4*Math.ceil(c/4/h);for(let _=0;_<h;++_){const m=_*d,y=[];for(let x=0,w=s.length;x<w;++x)y.push(s[x].slice(m,m+d));this.workers_[_].postMessage({buffers:y,meta:t.meta,imageOps:this.imageOps_,width:e,height:r},y)}}onWorkerMessage_(t,e){this.disposed||(this.dataLookup_[t]=e.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const t=this.job_,e=this.workers_.length;let r,s;if(e===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),s=this.dataLookup_[0].meta;else{const h=t.inputs[0].data.length;r=new Uint8ClampedArray(h),s=new Array(e);const c=4*Math.ceil(h/4/e);for(let d=0;d<e;++d){const _=this.dataLookup_[d].buffer,m=d*c;r.set(new Uint8ClampedArray(_),m),s[d]=this.dataLookup_[d].meta}}this.job_=null,this.dataLookup_={},t.callback(null,new ImageData(r,t.inputs[0].width,t.inputs[0].height),s),this.dispatch_()}disposeInternal(){for(let t=0;t<this.workers_.length;++t)this.workers_[t].terminate();this.workers_.length=0}}const jh={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Vh extends Ne{constructor(t,e,r){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=r}}class py extends sc{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=yy(t.sources);const e=this.changed.bind(this);for(let r=0,s=this.layers_.length;r<s;++r)this.layers_[r].addEventListener(ct.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new lu(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:mn(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:vy(this.layers_),pixelRatio:1,pixelToCoordinateTransform:mn(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:ee(this),renderTargets:{}},this.setAttributions(function(r){var h;const s=[];for(let c=0,d=t.sources.length;c<d;++c){const _=t.sources[c],m=_ instanceof Us?_:_.getSource();if(!m)continue;const y=(h=m.getAttributions())==null?void 0:h(r);typeof y=="string"?s.push(y):y!==void 0&&s.push(...y)}return s}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new _y({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,r){const s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);const h=Ke(t);s.size[0]=Math.ceil(yt(t)/e),s.size[1]=Math.ceil(Wt(t)/e),s.extent=[h[0]-s.size[0]*e/2,h[1]-s.size[1]*e/2,h[0]+s.size[0]*e/2,h[1]+s.size[1]*e/2],s.time=Date.now();const c=s.viewState;return c.center=h,c.projection=r,c.resolution=e,s}allSourcesReady_(){let t=!0,e;for(let r=0,s=this.layers_.length;r<s;++r)if(e=this.layers_[r].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,r,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const h=this.updateFrameState_(t,e,s);if(this.requestedFrameState_=h,this.renderedImageCanvas_){const c=this.renderedImageCanvas_.getResolution(),d=this.renderedImageCanvas_.getExtent();(e!==c||!di(h.extent,d))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),h.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,r=new Array(e);for(let h=0;h<e;++h){t.layerIndex=h,t.renderTargets={};const c=my(this.layers_[h],t);if(c)r[h]=c;else return}const s={};this.dispatchEvent(new Vh(jh.BEFOREOPERATIONS,t,s)),this.processor_.process(r,s,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,r,s){if(e||!r)return;const h=t.extent,c=t.viewState.resolution;if(c!==this.requestedFrameState_.viewState.resolution||!di(h,this.requestedFrameState_.extent))return;let d;if(this.renderedImageCanvas_)d=this.renderedImageCanvas_.getImage().getContext("2d");else{const _=Math.round(yt(h)/c),m=Math.round(Wt(h)/c);d=Qt(_,m),this.renderedImageCanvas_=new Yv(h,c,1,d.canvas)}d.putImageData(r,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Vh(jh.AFTEROPERATIONS,t,s))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let r=0,s=this.layers_.length;r<s&&(e=this.layers_[r].getSource().getResolutions(t),!e);++r);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}let Ln=null;function my(i,t){const e=i.getRenderer();if(!e)throw new Error("Unsupported layer type: "+i);if(!e.prepareFrame(t))return null;const r=t.size[0],s=t.size[1];if(r===0||s===0)return null;const h=e.renderFrame(t,null);let c;if(h instanceof HTMLCanvasElement)c=h;else{if(h&&(c=h.firstElementChild),!(c instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+c);if(c.width===r&&c.height===s)return c.getContext("2d").getImageData(0,0,r,s)}if(!Ln)Ln=Qt(r,s,void 0,{willReadFrequently:!0});else{const d=Ln.canvas;d.width!==r||d.height!==s?Ln=Qt(r,s,void 0,{willReadFrequently:!0}):Ln.clearRect(0,0,r,s)}return Ln.drawImage(c,0,0,r,s),Ln.getImageData(0,0,r,s)}function vy(i){return i.map(function(t){return t.getLayerState()})}function yy(i){const t=i.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=Ey(i[r]);return e}function Ey(i){let t;return i instanceof Us?i instanceof hc?t=new ry({source:i}):i instanceof sc&&(t=new nc({source:i})):t=i,t}const xy=/\{z\}/g,wy=/\{x\}/g,Ry=/\{y\}/g,Ty=/\{-y\}/g;function Iy(i,t,e,r,s){return i.replace(xy,t.toString()).replace(wy,e.toString()).replace(Ry,r.toString()).replace(Ty,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-r).toString()})}function Cy(i,t,e,r){const s=Qv(t,e,r),h=hi(s,i.length);return i[h]}function Sy(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const r=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let h;for(h=r;h<=s;++h)t.push(i.replace(e[0],String.fromCharCode(h)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const r=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=r;s++)t.push(i.replace(e[0],s.toString()));return t}return t.push(i),t}function Ws(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jo(i,t,e,r,s,h,c){c=c??Ws();const d=1/(i-t),_=1/(e-r),m=1/(s-h);return c[0]=-2*d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*m,c[11]=0,c[12]=(i+t)*d,c[13]=(r+e)*_,c[14]=(h+s)*m,c[15]=1,c}function Zh(i,t,e,r,s){return s=s??Ws(),s[0]=i[0]*t,s[1]=i[1]*t,s[2]=i[2]*t,s[3]=i[3]*t,s[4]=i[4]*e,s[5]=i[5]*e,s[6]=i[6]*e,s[7]=i[7]*e,s[8]=i[8]*r,s[9]=i[9]*r,s[10]=i[10]*r,s[11]=i[11]*r,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Ay(i,t,e,r,s){s=s??Ws();let h,c,d,_,m,y,x,w,C,T,O,M;return i===s?(s[12]=i[0]*t+i[4]*e+i[8]*r+i[12],s[13]=i[1]*t+i[5]*e+i[9]*r+i[13],s[14]=i[2]*t+i[6]*e+i[10]*r+i[14],s[15]=i[3]*t+i[7]*e+i[11]*r+i[15]):(h=i[0],c=i[1],d=i[2],_=i[3],m=i[4],y=i[5],x=i[6],w=i[7],C=i[8],T=i[9],O=i[10],M=i[11],s[0]=h,s[1]=c,s[2]=d,s[3]=_,s[4]=m,s[5]=y,s[6]=x,s[7]=w,s[8]=C,s[9]=T,s[10]=O,s[11]=M,s[12]=h*t+m*e+C*r+i[12],s[13]=c*t+y*e+T*r+i[13],s[14]=d*t+x*e+O*r+i[14],s[15]=_*t+w*e+M*r+i[15]),s}function Oy(i,t,e,r){return r=r??Ws(),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=i,r[13]=t,r[14]=e,r[15]=1,r}const Ly=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,My=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Py{constructor(t){this.gl_=t,this.program_=Qo(t,My,Ly),this.positionLocation=t.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=t.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=t.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=t.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positions),t.STATIC_DRAW),this.texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.texcoords),t.STATIC_DRAW)}drawImage(t,e,r,s,h,c,d,_,m,y,x,w,C){const T=this.gl_;_===void 0&&(_=s),m===void 0&&(m=h),c===void 0&&(c=e),d===void 0&&(d=r),y===void 0&&(y=c),x===void 0&&(x=d),w===void 0&&(w=T.canvas.width),C===void 0&&(C=T.canvas.height),T.bindTexture(T.TEXTURE_2D,t),T.useProgram(this.program_),T.bindBuffer(T.ARRAY_BUFFER,this.positionBuffer),T.enableVertexAttribArray(this.positionLocation),T.vertexAttribPointer(this.positionLocation,2,T.FLOAT,!1,0,0),T.bindBuffer(T.ARRAY_BUFFER,this.texcoordBuffer),T.enableVertexAttribArray(this.texcoordLocation),T.vertexAttribPointer(this.texcoordLocation,2,T.FLOAT,!1,0,0);let O=Jo(0,w,0,C,-1,1);O=Ay(O,_,m,0),O=Zh(O,y,x,1),T.uniformMatrix4fv(this.matrixLocation,!1,O);let M=Oy(s/e,h/r,0);M=Zh(M,c/e,d/r,1),T.uniformMatrix4fv(this.textureMatrixLocation,!1,M),T.uniform1i(this.textureLocation,0),T.drawArrays(T.TRIANGLES,0,this.positions.length/2)}}function Kh(i,t,e){const r=i.createShader(t);if(r===null)throw new Error("Shader compilation failed");if(i.shaderSource(r,e),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS)){const s=i.getShaderInfoLog(r);throw s===null?new Error("Shader info log creation failed"):new Error(s)}return r}function Qo(i,t,e){const r=i.createProgram(),s=Kh(i,i.VERTEX_SHADER,e),h=Kh(i,i.FRAGMENT_SHADER,t);if(r===null)throw new Error("Program creation failed");if(i.attachShader(r,s),i.attachShader(r,h),i.linkProgram(r),!i.getProgramParameter(r,i.LINK_STATUS))throw i.getProgramInfoLog(r)===null?new Error("Program info log creation failed"):new Error;return r}const Dy=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,Fy=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,by=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,Ny=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Gy(i,t,e,r){let s;return e&&e.length?s=e.shift():su?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("webgl",r)}function ky(i){const t=i.canvas;t.width=1,t.height=1,i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}const Hh=[];function Xy(i,t,e,r,s,h,c,d,_,m,y,x,w,C){const T=Math.round(r*t),O=Math.round(r*e);i.canvas.width=T,i.canvas.height=O;let M,A;if(A=i.createTexture(),i.bindTexture(i.TEXTURE_2D,A),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),w?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,T,O,0,i.RGBA,y,null),M=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,M),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,A,0),M===null)throw new Error("Could not create framebuffer");if(A===null)throw new Error("Could not create texture");if(_.length===0)return{width:T,height:O,framebuffer:M,texture:A};const D=En();_.forEach(function(Y,st,et){fu(D,Y.extent)});let z,b,F;const B=1/s;{if(z=i.createTexture(),A===null)throw new Error("Could not create texture");b=Math.round(yt(D)*B),F=Math.round(Wt(D)*B);const Y=i.getParameter(i.MAX_TEXTURE_SIZE),st=Math.max(b,F),et=st>Y?Y/st:1,Z=Math.round(b*et),ot=Math.round(F*et);i.bindTexture(i.TEXTURE_2D,z),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),w?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,Z,ot,0,i.RGBA,y,null);const Q=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,Q),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,z,0);const wt=new Py(i);_.forEach(function(gt,Nt,_t){const ut=(gt.extent[0]-D[0])*B*et,Et=-(gt.extent[3]-D[3])*B*et,Ht=yt(gt.extent)*B*et,Rt=Wt(gt.extent)*B*et;if(i.bindFramebuffer(i.FRAMEBUFFER,Q),i.viewport(0,0,Z,ot),gt.clipExtent){const Yt=(gt.clipExtent[0]-D[0])*B*et,nt=-(gt.clipExtent[3]-D[3])*B*et,jt=yt(gt.clipExtent)*B*et,$t=Wt(gt.clipExtent)*B*et;i.enable(i.SCISSOR_TEST),i.scissor(w?Yt:Math.round(Yt),w?nt:Math.round(nt),w?jt:Math.round(Yt+jt)-Math.round(Yt),w?$t:Math.round(nt+$t)-Math.round(nt))}wt.drawImage(gt.texture,gt.width,gt.height,m,m,gt.width-2*m,gt.height-2*m,w?ut:Math.round(ut),w?Et:Math.round(Et),w?Ht:Math.round(ut+Ht)-Math.round(ut),w?Rt:Math.round(Et+Rt)-Math.round(Et),Z,ot),i.disable(i.SCISSOR_TEST)}),i.deleteFramebuffer(Q)}const V=He(c),k=He(D),K=Y=>{const st=(Y[0][0]-V[0])/h*r,et=-(Y[0][1]-V[1])/h*r,Z=(Y[1][0]-V[0])/h*r,ot=-(Y[1][1]-V[1])/h*r,Q=(Y[2][0]-V[0])/h*r,wt=-(Y[2][1]-V[1])/h*r;return{u1:Z,v1:ot,u0:st,v0:et,u2:Q,v2:wt}};i.bindFramebuffer(i.FRAMEBUFFER,M),i.viewport(0,0,T,O);{const Y=[],st=[],et=Qo(i,Ny,by);i.useProgram(et);const Z=i.getUniformLocation(et,"u_texture");i.bindTexture(i.TEXTURE_2D,z),i.uniform1i(Z,0),d.getTriangles().forEach(function(ut,Et,Ht){const Rt=ut.source,Yt=ut.target,{u1:nt,v1:jt,u0:$t,v0:ae,u2:Vt,v2:kt}=K(Yt),bn=(Rt[0][0]-k[0])/s/b,xn=-(Rt[0][1]-k[1])/s/F,wn=(Rt[1][0]-k[0])/s/b,Ie=-(Rt[1][1]-k[1])/s/F,xi=(Rt[2][0]-k[0])/s/b,ve=-(Rt[2][1]-k[1])/s/F;Y.push(nt,jt,$t,ae,Vt,kt),st.push(wn,Ie,bn,xn,xi,ve)});const ot=Jo(0,T,O,0,-1,1),Q=i.getUniformLocation(et,"u_matrix");i.uniformMatrix4fv(Q,!1,ot);const wt=i.getAttribLocation(et,"a_position"),gt=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,gt),i.bufferData(i.ARRAY_BUFFER,new Float32Array(Y),i.STATIC_DRAW),i.vertexAttribPointer(wt,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(wt);const Nt=i.getAttribLocation(et,"a_texcoord"),_t=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,_t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(st),i.STATIC_DRAW),i.vertexAttribPointer(Nt,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(Nt),i.drawArrays(i.TRIANGLES,0,Y.length/2)}if(x){const Y=Qo(i,Fy,Dy);i.useProgram(Y);const st=Jo(0,T,O,0,-1,1),et=i.getUniformLocation(Y,"u_matrix");i.uniformMatrix4fv(et,!1,st);const Z=Array.isArray(x)?x:[0,0,0,255],ot=i.getUniformLocation(Y,"u_val");i.uniform4fv(ot,Z);const Q=i.getAttribLocation(Y,"a_position"),wt=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,wt),i.vertexAttribPointer(Q,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(Q);const gt=d.getTriangles().reduce(function(Nt,_t){const ut=_t.target,{u1:Et,v1:Ht,u0:Rt,v0:Yt,u2:nt,v2:jt}=K(ut);return Nt.concat([Et,Ht,Rt,Yt,Rt,Yt,nt,jt,nt,jt,Et,Ht])},[]);i.bufferData(i.ARRAY_BUFFER,new Float32Array(gt),i.STATIC_DRAW),i.drawArrays(i.LINES,0,gt.length/2)}return{width:T,height:O,framebuffer:M,texture:A}}class zy extends xs{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.renderEdges_=t.renderEdges!==void 0?t.renderEdges:!1,this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,r=e.getExtent(),s=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?s?pe(r,s):r:s;const h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),c=this.targetTileGrid_.getExtent();let d=this.sourceTileGrid_.getExtent();const _=c?pe(h,c):h;if(hr(_)===0){this.state=$.EMPTY;return}r&&(d?d=pe(d,r):d=r);const m=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),y=t.targetProj,x=ic(e,y,_,m);if(!isFinite(x)||x<=0){this.state=$.EMPTY;return}const w=t.errorThreshold!==void 0?t.errorThreshold:Da;if(this.triangulation_=new Pa(e,y,_,d,x*w,m,t.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=$.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(x);let C=this.triangulation_.calculateSourceExtent();if(d&&(e.canWrapX()?(C[1]=Kt(C[1],d[1],d[3]),C[3]=Kt(C[3],d[1],d[3])):C=pe(C,d)),!hr(C))this.state=$.EMPTY;else{let T=0,O=0;e.canWrapX()&&(T=yt(r),O=Math.floor((C[0]-r[0])/T)),pu(C.slice(),e).forEach(A=>{const D=this.sourceTileGrid_.getTileRangeForExtentAndZ(A,this.sourceZ_),z=t.getTileFunction;for(let b=D.minX;b<=D.maxX;b++)for(let F=D.minY;F<=D.maxY;F++){const B=z(this.sourceZ_,b,F,this.pixelRatio_);if(B){const V=O*T;this.sourceTiles_.push({tile:B,offset:V})}}++O}),this.sourceTiles_.length===0&&(this.state=$.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];let e=!1;if(this.sourceTiles_.forEach(b=>{var Et;const F=b.tile;if(!F||F.getState()!==$.LOADED)return;const B=F.getSize(),V=this.gutter_;let k;const K=Bv(F.getData());K?k=K:(e=!0,k=Wv(Es(F.getData())));const Y=[B[0]+2*V,B[1]+2*V],st=k instanceof Float32Array,et=Y[0]*Y[1],Z=st?Float32Array:Uint8ClampedArray,ot=new Z(k.buffer),Q=Z.BYTES_PER_ELEMENT,wt=Q*ot.length/et,gt=ot.byteLength/Y[1],Nt=Math.floor(gt/Q/Y[0]),_t=this.sourceTileGrid_.getTileCoordExtent(F.tileCoord);_t[0]+=b.offset,_t[2]+=b.offset;const ut=(Et=this.clipExtent_)==null?void 0:Et.slice();ut&&(ut[0]+=b.offset,ut[2]+=b.offset),t.push({extent:_t,clipExtent:ut,data:ot,dataType:Z,bytesPerPixel:wt,pixelSize:Y,bandCount:Nt})}),this.sourceTiles_.length=0,t.length===0){this.state=$.ERROR,this.changed();return}const r=this.wrappedTileCoord_[0],s=this.targetTileGrid_.getTileSize(r),h=typeof s=="number"?s:s[0],c=typeof s=="number"?s:s[1],d=h*this.pixelRatio_,_=c*this.pixelRatio_,m=this.targetTileGrid_.getResolution(r),y=this.sourceTileGrid_.getResolution(this.sourceZ_),x=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),w=t[0].bandCount,C=new t[0].dataType(w*d*_),T=Gy(d,_,Hh,{premultipliedAlpha:!1,antialias:!1});let O;const M=T.RGBA;let A;t[0].dataType==Float32Array?(A=T.FLOAT,T.getExtension("WEBGL_color_buffer_float"),T.getExtension("OES_texture_float"),T.getExtension("EXT_float_blend"),O=T.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(A=T.UNSIGNED_BYTE,O=this.interpolate);const D=4,z=Math.ceil(w/D);for(let b=z-1;b>=0;--b){const F=[];for(let Z=0,ot=t.length;Z<ot;++Z){const Q=t[Z],wt=Q.pixelSize,gt=wt[0],Nt=wt[1],_t=new Q.dataType(D*gt*Nt),ut=Q.data;let Et=b*D;for(let Rt=0,Yt=_t.length;Rt<Yt;Rt+=D)_t[Rt]=ut[Et],_t[Rt+1]=ut[Et+1],_t[Rt+2]=ut[Et+2],_t[Rt+3]=ut[Et+3],Et+=w;const Ht=T.createTexture();T.bindTexture(T.TEXTURE_2D,Ht),O?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR)):(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST)),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texImage2D(T.TEXTURE_2D,0,M,gt,Nt,0,M,A,_t),F.push({extent:Q.extent,clipExtent:Q.clipExtent,texture:Ht,width:gt,height:Nt})}const{framebuffer:B,width:V,height:k}=Xy(T,h,c,this.pixelRatio_,y,m,x,this.triangulation_,F,this.gutter_,A,this.renderEdges_,O),K=V,Y=k*D,st=new t[0].dataType(K*Y);T.bindFramebuffer(T.FRAMEBUFFER,B),T.readPixels(0,0,V,k,T.RGBA,A,st);let et=b*D;for(let Z=0,ot=st.length;Z<ot;Z+=D){const Q=(K-1-(Z/Y|0))*Y+Z%Y;C[et]=st[Q],C[et+1]=st[Q+1],C[et+2]=st[Q+2],C[et+3]=st[Q+3],et+=w}}if(ky(T),Hh.push(T.canvas),e){const b=Qt(h,c),F=new ImageData(C,h);b.putImageData(F,0,0),this.reprojData_=b.canvas}else this.reprojData_=C;this.reprojSize_=[Math.round(d),Math.round(_)],this.state=$.LOADED,this.changed()}load(){if(this.state!==$.IDLE&&this.state!==$.ERROR)return;this.state=$.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const r=e.getState();if(r!==$.IDLE&&r!==$.LOADING)return;t++;const s=St(e,ct.CHANGE,()=>{const h=e.getState();(h==$.LOADED||h==$.ERROR||h==$.EMPTY)&&(Gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==$.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Gt),this.sourcesListenerKeys_=null}}const Xo={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Yy extends hc{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let r=t.tileGrid;r===void 0&&e&&(r=uy({extent:Fa(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:r,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?ne(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?ne(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return(!e||ar(e,t))&&!this.transformMatrix?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,r,s,h){const c=this.tileGrid||this.getTileGridForProjection(h||s),d=Math.max.apply(null,c.getResolutions().map((C,T)=>{const O=ne(c.getTileSize(T)),M=this.getTileSize(T);return Math.max(M[0]/O[0],M[1]/O[1])})),_=this.getTileGridForProjection(s),m=[t,e,r],y=this.getTileCoordForTileUrlFunction(m,s),x=Object.assign({sourceProj:h||s,sourceTileGrid:c,targetProj:s,targetTileGrid:_,tileCoord:m,wrappedTileCoord:y,pixelRatio:d,gutter:this.gutter_,getTileFunction:(C,T,O,M)=>this.getTile(C,T,O,M),transformMatrix:this.transformMatrix},this.tileOptions),w=new zy(x);return w.key=this.getKey(),w}getTile(t,e,r,s,h){var z;const c=this.getProjection();if(h&&(c&&!ar(c,h)||this.transformMatrix))return this.getReprojTile_(t,e,r,h,c);const d=this.getTileSize(t),_=this.loader_,m=new AbortController,y={signal:m.signal,crossOrigin:this.crossOrigin_},x=this.getTileCoordForTileUrlFunction([t,e,r]);if(!x)return null;const w=x[0],C=x[1],T=x[2],O=(z=this.getTileGrid())==null?void 0:z.getFullTileRange(w);O&&(y.maxY=O.getHeight()-1);function M(){return ta(function(){return _(w,C,T,y)})}const A=Object.assign({tileCoord:[t,e,r],loader:M,size:d,controller:m},this.tileOptions),D=new xs(A);return D.key=this.getKey(),D.addEventListener(ct.CHANGE,this.handleTileChange_),D}handleTileChange_(t){const e=t.target,r=ee(e),s=e.getState();let h;s==$.LOADING?(this.tileLoadingKeys_[r]=!0,h=Xo.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],h=s==$.ERROR?Xo.TILELOADERROR:s==$.LOADED?Xo.TILELOADEND:void 0),h&&this.dispatchEvent(new fy(h,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||ar(e,t))&&!this.transformMatrix)return this.tileGrid;const r=ee(t);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=ac(t)),this.tileGridForProjection_[r]}setTileGridForProjection(t,e){const r=me(t);if(r){const s=ee(r);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=e)}}}const By=new Error("Image failed to load");function cc(i,t,e,r,s){return new Promise((h,c)=>{const d=new Image;d.crossOrigin=s.crossOrigin??null,d.addEventListener("load",()=>h(d)),d.addEventListener("error",()=>c(By)),d.src=Iy(i,t,e,r,s.maxY)})}function $h(i){return function(t,e,r,s){const h=Cy(i,t,e,r);return cc(h,t,e,r,s)}}function Uy(i){return function(t,e,r,s){const h=i(t,e,r,s);return cc(h,t,e,r,s)}}function qh(i){let t;if(Array.isArray(i))t=$h(i);else if(typeof i=="string"){const e=Sy(i);t=$h(e)}else if(typeof i=="function")t=Uy(i);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return t}let Jh=0;function Qh(i){return Array.isArray(i)?i.join(`
`):typeof i=="string"?i:(++Jh,"url-function-key-"+Jh)}class Wy extends Yy{constructor(t){t=t||{};let e=t.loader,r;t.url&&(e=qh(t.url),r=Qh(t.url));const s=e?t.state:"loading",h=t.wrapX===void 0?!0:t.wrapX;super({loader:e,key:r,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize,gutter:t.gutter,maxResolution:t.maxResolution,projection:t.projection,tileGrid:t.tileGrid,state:s,wrapX:h,transition:t.transition,interpolate:t.interpolate!==!1,crossOrigin:t.crossOrigin,zDirection:t.zDirection})}setUrl(t){const e=qh(t);this.setLoader(e),this.setKey(Qh(t)),this.getState()!=="ready"&&this.setState("ready")}}function jy(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var as={exports:{}},Vy=as.exports,tu;function Zy(){return tu||(tu=1,function(i,t){(function(e,r){i.exports=r()})(Vy,function(){var e=function(){function u(o){this.propagationStopped,this.defaultPrevented,this.type=o,this.target=null}return u.prototype.preventDefault=function(){this.defaultPrevented=!0},u.prototype.stopPropagation=function(){this.propagationStopped=!0},u}(),r=e,s={PROPERTYCHANGE:"propertychange"},h=function(){function u(){this.disposed=!1}return u.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},u.prototype.disposeInternal=function(){},u}(),c=h;function d(u,o){return u>o?1:u<o?-1:0}function _(u,o,n){for(;o<n;){var a=u[o];u[o]=u[n],u[n]=a,++o,--n}}function m(u,o){for(var n=Array.isArray(o)?o:[o],a=n.length,l=0;l<a;l++)u[u.length]=n[l]}function y(u,o){var n=u.length;if(n!==o.length)return!1;for(var a=0;a<n;a++)if(u[a]!==o[a])return!1;return!0}function x(){return!0}function w(){}function C(u){var o=!1,n,a,l;return function(){var f=Array.prototype.slice.call(arguments);return(!o||this!==l||!y(f,a))&&(o=!0,l=this,a=f,n=u.apply(this,arguments)),n}}var T=typeof Object.assign=="function"?Object.assign:function(u,o){if(u==null)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(u),a=1,l=arguments.length;a<l;++a){var f=arguments[a];if(f!=null)for(var g in f)f.hasOwnProperty(g)&&(n[g]=f[g])}return n};function O(u){for(var o in u)delete u[o]}var M=typeof Object.values=="function"?Object.values:function(u){var o=[];for(var n in u)o.push(u[n]);return o};function A(u){var o;for(o in u)return!1;return!o}var D=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),z=function(u){D(o,u);function o(n){var a=u.call(this)||this;return a.eventTarget_=n,a.pendingRemovals_=null,a.dispatching_=null,a.listeners_=null,a}return o.prototype.addEventListener=function(n,a){if(!(!n||!a)){var l=this.listeners_||(this.listeners_={}),f=l[n]||(l[n]=[]);f.indexOf(a)===-1&&f.push(a)}},o.prototype.dispatchEvent=function(n){var a=typeof n=="string",l=a?n:n.type,f=this.listeners_&&this.listeners_[l];if(f){var g=a?new r(n):n;g.target||(g.target=this.eventTarget_||this);var p=this.dispatching_||(this.dispatching_={}),v=this.pendingRemovals_||(this.pendingRemovals_={});l in p||(p[l]=0,v[l]=0),++p[l];for(var E,R=0,I=f.length;R<I;++R)if("handleEvent"in f[R]?E=f[R].handleEvent(g):E=f[R].call(this,g),E===!1||g.propagationStopped){E=!1;break}if(--p[l]===0){var S=v[l];for(delete v[l];S--;)this.removeEventListener(l,w);delete p[l]}return E}},o.prototype.disposeInternal=function(){this.listeners_&&O(this.listeners_)},o.prototype.getListeners=function(n){return this.listeners_&&this.listeners_[n]||void 0},o.prototype.hasListener=function(n){return this.listeners_?n?n in this.listeners_:Object.keys(this.listeners_).length>0:!1},o.prototype.removeEventListener=function(n,a){var l=this.listeners_&&this.listeners_[n];if(l){var f=l.indexOf(a);f!==-1&&(this.pendingRemovals_&&n in this.pendingRemovals_?(l[f]=w,++this.pendingRemovals_[n]):(l.splice(f,1),l.length===0&&delete this.listeners_[n]))}},o}(c),b=z,F={CHANGE:"change",ERROR:"error",LOAD:"load"};function B(u,o,n,a,l){if(a&&a!==u&&(n=n.bind(a)),l){var f=n;n=function(){u.removeEventListener(o,n),f.apply(this,arguments)}}var g={target:u,type:o,listener:n};return u.addEventListener(o,n),g}function V(u,o,n,a){return B(u,o,n,a,!0)}function k(u){u&&u.target&&(u.target.removeEventListener(u.type,u.listener),O(u))}var K=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Y=function(u){K(o,u);function o(){var n=u.call(this)||this;return n.on=n.onInternal,n.once=n.onceInternal,n.un=n.unInternal,n.revision_=0,n}return o.prototype.changed=function(){++this.revision_,this.dispatchEvent(F.CHANGE)},o.prototype.getRevision=function(){return this.revision_},o.prototype.onInternal=function(n,a){if(Array.isArray(n)){for(var l=n.length,f=new Array(l),g=0;g<l;++g)f[g]=B(this,n[g],a);return f}else return B(this,n,a)},o.prototype.onceInternal=function(n,a){var l;if(Array.isArray(n)){var f=n.length;l=new Array(f);for(var g=0;g<f;++g)l[g]=V(this,n[g],a)}else l=V(this,n,a);return a.ol_key=l,l},o.prototype.unInternal=function(n,a){var l=a.ol_key;if(l)st(l);else if(Array.isArray(n))for(var f=0,g=n.length;f<g;++f)this.removeEventListener(n[f],a);else this.removeEventListener(n,a)},o}(b);Y.prototype.on,Y.prototype.once,Y.prototype.un;function st(u){if(Array.isArray(u))for(var o=0,n=u.length;o<n;++o)k(u[o]);else k(u)}var et=Y;function Z(){return function(){throw new Error("Unimplemented abstract method.")}()}var ot=0;function Q(u){return u.ol_uid||(u.ol_uid=String(++ot))}var wt="6.14.1",gt=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Nt=function(u){gt(o,u);function o(n,a,l){var f=u.call(this,n)||this;return f.key=a,f.oldValue=l,f}return o}(r),_t=function(u){gt(o,u);function o(n){var a=u.call(this)||this;return a.on,a.once,a.un,Q(a),a.values_=null,n!==void 0&&a.setProperties(n),a}return o.prototype.get=function(n){var a;return this.values_&&this.values_.hasOwnProperty(n)&&(a=this.values_[n]),a},o.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},o.prototype.getProperties=function(){return this.values_&&T({},this.values_)||{}},o.prototype.hasProperties=function(){return!!this.values_},o.prototype.notify=function(n,a){var l;l="change:".concat(n),this.hasListener(l)&&this.dispatchEvent(new Nt(l,n,a)),l=s.PROPERTYCHANGE,this.hasListener(l)&&this.dispatchEvent(new Nt(l,n,a))},o.prototype.addChangeListener=function(n,a){this.addEventListener("change:".concat(n),a)},o.prototype.removeChangeListener=function(n,a){this.removeEventListener("change:".concat(n),a)},o.prototype.set=function(n,a,l){var f=this.values_||(this.values_={});if(l)f[n]=a;else{var g=f[n];f[n]=a,g!==a&&this.notify(n,g)}},o.prototype.setProperties=function(n,a){for(var l in n)this.set(l,n[l],a)},o.prototype.applyProperties=function(n){n.values_&&T(this.values_||(this.values_={}),n.values_)},o.prototype.unset=function(n,a){if(this.values_&&n in this.values_){var l=this.values_[n];delete this.values_[n],A(this.values_)&&(this.values_=null),a||this.notify(n,l)}},o}(et),ut=_t,Et={ACTIVE:"active"},Ht=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Rt=function(u){Ht(o,u);function o(n){var a=u.call(this)||this;return a.on,a.once,a.un,n&&n.handleEvent&&(a.handleEvent=n.handleEvent),a.map_=null,a.setActive(!0),a}return o.prototype.getActive=function(){return this.get(Et.ACTIVE)},o.prototype.getMap=function(){return this.map_},o.prototype.handleEvent=function(n){return!0},o.prototype.setActive=function(n){this.set(Et.ACTIVE,n)},o.prototype.setMap=function(n){this.map_=n},o}(ut),Yt=Rt,nt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"},jt=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),$t=function(u){jt(o,u);function o(n){var a=this,l="v"+wt.split("-")[0],f="Assertion failed. See https://openlayers.org/en/"+l+"/doc/errors/#"+n+" for details.";return a=u.call(this,f)||this,a.code=n,a.name="AssertionError",a.message=f,a}return o}(Error),ae=$t;function Vt(u,o){if(!u)throw new ae(o)}function kt(u,o,n){return Math.min(Math.max(u,o),n)}var bn=function(){var u;return"cosh"in Math?u=Math.cosh:u=function(o){var n=Math.exp(o);return(n+1/n)/2},u}();function xn(u,o,n,a){var l=n-u,f=a-o;return l*l+f*f}function wn(u){return u*Math.PI/180}function Ie(u,o,n){return u+n*(o-u)}var xi=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ve=function(u){xi(o,u);function o(n){var a=u.call(this)||this;a.on,a.once,a.un,a.background_=n.background;var l=T({},n);return typeof n.properties=="object"&&(delete l.properties,T(l,n.properties)),l[nt.OPACITY]=n.opacity!==void 0?n.opacity:1,Vt(typeof l[nt.OPACITY]=="number",64),l[nt.VISIBLE]=n.visible!==void 0?n.visible:!0,l[nt.Z_INDEX]=n.zIndex,l[nt.MAX_RESOLUTION]=n.maxResolution!==void 0?n.maxResolution:1/0,l[nt.MIN_RESOLUTION]=n.minResolution!==void 0?n.minResolution:0,l[nt.MIN_ZOOM]=n.minZoom!==void 0?n.minZoom:-1/0,l[nt.MAX_ZOOM]=n.maxZoom!==void 0?n.maxZoom:1/0,a.className_=l.className!==void 0?l.className:"ol-layer",delete l.className,a.setProperties(l),a.state_=null,a}return o.prototype.getBackground=function(){return this.background_},o.prototype.getClassName=function(){return this.className_},o.prototype.getLayerState=function(n){var a=this.state_||{layer:this,managed:n===void 0?!0:n},l=this.getZIndex();return a.opacity=kt(Math.round(this.getOpacity()*100)/100,0,1),a.visible=this.getVisible(),a.extent=this.getExtent(),a.zIndex=l===void 0&&!a.managed?1/0:l,a.maxResolution=this.getMaxResolution(),a.minResolution=Math.max(this.getMinResolution(),0),a.minZoom=this.getMinZoom(),a.maxZoom=this.getMaxZoom(),this.state_=a,a},o.prototype.getLayersArray=function(n){return Z()},o.prototype.getLayerStatesArray=function(n){return Z()},o.prototype.getExtent=function(){return this.get(nt.EXTENT)},o.prototype.getMaxResolution=function(){return this.get(nt.MAX_RESOLUTION)},o.prototype.getMinResolution=function(){return this.get(nt.MIN_RESOLUTION)},o.prototype.getMinZoom=function(){return this.get(nt.MIN_ZOOM)},o.prototype.getMaxZoom=function(){return this.get(nt.MAX_ZOOM)},o.prototype.getOpacity=function(){return this.get(nt.OPACITY)},o.prototype.getSourceState=function(){return Z()},o.prototype.getVisible=function(){return this.get(nt.VISIBLE)},o.prototype.getZIndex=function(){return this.get(nt.Z_INDEX)},o.prototype.setBackground=function(n){this.background_=n,this.changed()},o.prototype.setExtent=function(n){this.set(nt.EXTENT,n)},o.prototype.setMaxResolution=function(n){this.set(nt.MAX_RESOLUTION,n)},o.prototype.setMinResolution=function(n){this.set(nt.MIN_RESOLUTION,n)},o.prototype.setMaxZoom=function(n){this.set(nt.MAX_ZOOM,n)},o.prototype.setMinZoom=function(n){this.set(nt.MIN_ZOOM,n)},o.prototype.setOpacity=function(n){Vt(typeof n=="number",64),this.set(nt.OPACITY,n)},o.prototype.setVisible=function(n){this.set(nt.VISIBLE,n)},o.prototype.setZIndex=function(n){this.set(nt.Z_INDEX,n)},o.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),u.prototype.disposeInternal.call(this)},o}(ut),Le=ve,Je={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose"},Ge={UNDEFINED:"undefined",READY:"ready"},Ir=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),wi=function(u){Ir(o,u);function o(n){var a=this,l=T({},n);delete l.source,a=u.call(this,l)||this,a.on,a.once,a.un,a.mapPrecomposeKey_=null,a.mapRenderKey_=null,a.sourceChangeKey_=null,a.renderer_=null,a.rendered=!1,n.render&&(a.render=n.render),n.map&&a.setMap(n.map),a.addChangeListener(nt.SOURCE,a.handleSourcePropertyChange_);var f=n.source?n.source:null;return a.setSource(f),a}return o.prototype.getLayersArray=function(n){var a=n||[];return a.push(this),a},o.prototype.getLayerStatesArray=function(n){var a=n||[];return a.push(this.getLayerState()),a},o.prototype.getSource=function(){return this.get(nt.SOURCE)||null},o.prototype.getRenderSource=function(){return this.getSource()},o.prototype.getSourceState=function(){var n=this.getSource();return n?n.getState():Ge.UNDEFINED},o.prototype.handleSourceChange_=function(){this.changed()},o.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(k(this.sourceChangeKey_),this.sourceChangeKey_=null);var n=this.getSource();n&&(this.sourceChangeKey_=B(n,F.CHANGE,this.handleSourceChange_,this)),this.changed()},o.prototype.getFeatures=function(n){return this.renderer_?this.renderer_.getFeatures(n):new Promise(function(a){return a([])})},o.prototype.getData=function(n){return!this.renderer_||!this.rendered?null:this.renderer_.getData(n)},o.prototype.render=function(n,a){var l=this.getRenderer();if(l.prepareFrame(n))return this.rendered=!0,l.renderFrame(n,a)},o.prototype.unrender=function(){this.rendered=!1},o.prototype.setMapInternal=function(n){n||this.unrender(),this.set(nt.MAP,n)},o.prototype.getMapInternal=function(){return this.get(nt.MAP)},o.prototype.setMap=function(n){this.mapPrecomposeKey_&&(k(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),n||this.changed(),this.mapRenderKey_&&(k(this.mapRenderKey_),this.mapRenderKey_=null),n&&(this.mapPrecomposeKey_=B(n,Je.PRECOMPOSE,function(a){var l=a,f=l.frameState.layerStatesArray,g=this.getLayerState(!1);Vt(!f.some(function(p){return p.layer===g.layer}),67),f.push(g)},this),this.mapRenderKey_=B(this,F.CHANGE,n.render,n),this.changed())},o.prototype.setSource=function(n){this.set(nt.SOURCE,n)},o.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},o.prototype.hasRenderer=function(){return!!this.renderer_},o.prototype.createRenderer=function(){return null},o.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),u.prototype.disposeInternal.call(this)},o}(Le),Nn=wi;function js(u,o,n,a,l){le(u,o,n||0,a||u.length-1,l||fc)}function le(u,o,n,a,l){for(;a>n;){if(a-n>600){var f=a-n+1,g=o-n+1,p=Math.log(f),v=.5*Math.exp(2*p/3),E=.5*Math.sqrt(p*v*(f-v)/f)*(g-f/2<0?-1:1),R=Math.max(n,Math.floor(o-g*v/f+E)),I=Math.min(a,Math.floor(o+(f-g)*v/f+E));le(u,o,R,I,l)}var S=u[o],L=n,P=a;for(Ri(u,n,o),l(u[a],S)>0&&Ri(u,n,a);L<P;){for(Ri(u,L,P),L++,P--;l(u[L],S)<0;)L++;for(;l(u[P],S)>0;)P--}l(u[n],S)===0?Ri(u,n,P):(P++,Ri(u,P,a)),P<=o&&(n=P+1),o<=P&&(a=P-1)}}function Ri(u,o,n){var a=u[o];u[o]=u[n],u[n]=a}function fc(u,o){return u<o?-1:u>o?1:0}class ba{constructor(o=9){this._maxEntries=Math.max(4,o),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(o){let n=this.data;const a=[];if(!Sr(o,n))return a;const l=this.toBBox,f=[];for(;n;){for(let g=0;g<n.children.length;g++){const p=n.children[g],v=n.leaf?l(p):p;Sr(o,v)&&(n.leaf?a.push(p):Zs(o,v)?this._all(p,a):f.push(p))}n=f.pop()}return a}collides(o){let n=this.data;if(!Sr(o,n))return!1;const a=[];for(;n;){for(let l=0;l<n.children.length;l++){const f=n.children[l],g=n.leaf?this.toBBox(f):f;if(Sr(o,g)){if(n.leaf||Zs(o,g))return!0;a.push(f)}}n=a.pop()}return!1}load(o){if(!(o&&o.length))return this;if(o.length<this._minEntries){for(let a=0;a<o.length;a++)this.insert(o[a]);return this}let n=this._build(o.slice(),0,o.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const a=this.data;this.data=n,n=a}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(o){return o&&this._insert(o,this.data.height-1),this}clear(){return this.data=kn([]),this}remove(o,n){if(!o)return this;let a=this.data;const l=this.toBBox(o),f=[],g=[];let p,v,E;for(;a||f.length;){if(a||(a=f.pop(),v=f[f.length-1],p=g.pop(),E=!0),a.leaf){const R=dc(o,a.children,n);if(R!==-1)return a.children.splice(R,1),f.push(a),this._condense(f),this}!E&&!a.leaf&&Zs(a,l)?(f.push(a),g.push(p),p=0,v=a,a=a.children[0]):v?(p++,a=v.children[p],E=!1):a=null}return this}toBBox(o){return o}compareMinX(o,n){return o.minX-n.minX}compareMinY(o,n){return o.minY-n.minY}toJSON(){return this.data}fromJSON(o){return this.data=o,this}_all(o,n){const a=[];for(;o;)o.leaf?n.push(...o.children):a.push(...o.children),o=a.pop();return n}_build(o,n,a,l){const f=a-n+1;let g=this._maxEntries,p;if(f<=g)return p=kn(o.slice(n,a+1)),Gn(p,this.toBBox),p;l||(l=Math.ceil(Math.log(f)/Math.log(g)),g=Math.ceil(f/Math.pow(g,l-1))),p=kn([]),p.leaf=!1,p.height=l;const v=Math.ceil(f/g),E=v*Math.ceil(Math.sqrt(g));Na(o,n,a,E,this.compareMinX);for(let R=n;R<=a;R+=E){const I=Math.min(R+E-1,a);Na(o,R,I,v,this.compareMinY);for(let S=R;S<=I;S+=v){const L=Math.min(S+v-1,I);p.children.push(this._build(o,S,L,l-1))}}return Gn(p,this.toBBox),p}_chooseSubtree(o,n,a,l){for(;l.push(n),!(n.leaf||l.length-1===a);){let f=1/0,g=1/0,p;for(let v=0;v<n.children.length;v++){const E=n.children[v],R=Vs(E),I=pc(o,E)-R;I<g?(g=I,f=R<f?R:f,p=E):I===g&&R<f&&(f=R,p=E)}n=p||n.children[0]}return n}_insert(o,n,a){const l=a?o:this.toBBox(o),f=[],g=this._chooseSubtree(l,this.data,n,f);for(g.children.push(o),Ii(g,l);n>=0&&f[n].children.length>this._maxEntries;)this._split(f,n),n--;this._adjustParentBBoxes(l,f,n)}_split(o,n){const a=o[n],l=a.children.length,f=this._minEntries;this._chooseSplitAxis(a,f,l);const g=this._chooseSplitIndex(a,f,l),p=kn(a.children.splice(g,a.children.length-g));p.height=a.height,p.leaf=a.leaf,Gn(a,this.toBBox),Gn(p,this.toBBox),n?o[n-1].children.push(p):this._splitRoot(a,p)}_splitRoot(o,n){this.data=kn([o,n]),this.data.height=o.height+1,this.data.leaf=!1,Gn(this.data,this.toBBox)}_chooseSplitIndex(o,n,a){let l,f=1/0,g=1/0;for(let p=n;p<=a-n;p++){const v=Ti(o,0,p,this.toBBox),E=Ti(o,p,a,this.toBBox),R=mc(v,E),I=Vs(v)+Vs(E);R<f?(f=R,l=p,g=I<g?I:g):R===f&&I<g&&(g=I,l=p)}return l||a-n}_chooseSplitAxis(o,n,a){const l=o.leaf?this.compareMinX:gc,f=o.leaf?this.compareMinY:_c,g=this._allDistMargin(o,n,a,l),p=this._allDistMargin(o,n,a,f);g<p&&o.children.sort(l)}_allDistMargin(o,n,a,l){o.children.sort(l);const f=this.toBBox,g=Ti(o,0,n,f),p=Ti(o,a-n,a,f);let v=Cr(g)+Cr(p);for(let E=n;E<a-n;E++){const R=o.children[E];Ii(g,o.leaf?f(R):R),v+=Cr(g)}for(let E=a-n-1;E>=n;E--){const R=o.children[E];Ii(p,o.leaf?f(R):R),v+=Cr(p)}return v}_adjustParentBBoxes(o,n,a){for(let l=a;l>=0;l--)Ii(n[l],o)}_condense(o){for(let n=o.length-1,a;n>=0;n--)o[n].children.length===0?n>0?(a=o[n-1].children,a.splice(a.indexOf(o[n]),1)):this.clear():Gn(o[n],this.toBBox)}}function dc(u,o,n){if(!n)return o.indexOf(u);for(let a=0;a<o.length;a++)if(n(u,o[a]))return a;return-1}function Gn(u,o){Ti(u,0,u.children.length,o,u)}function Ti(u,o,n,a,l){l||(l=kn(null)),l.minX=1/0,l.minY=1/0,l.maxX=-1/0,l.maxY=-1/0;for(let f=o;f<n;f++){const g=u.children[f];Ii(l,u.leaf?a(g):g)}return l}function Ii(u,o){return u.minX=Math.min(u.minX,o.minX),u.minY=Math.min(u.minY,o.minY),u.maxX=Math.max(u.maxX,o.maxX),u.maxY=Math.max(u.maxY,o.maxY),u}function gc(u,o){return u.minX-o.minX}function _c(u,o){return u.minY-o.minY}function Vs(u){return(u.maxX-u.minX)*(u.maxY-u.minY)}function Cr(u){return u.maxX-u.minX+(u.maxY-u.minY)}function pc(u,o){return(Math.max(o.maxX,u.maxX)-Math.min(o.minX,u.minX))*(Math.max(o.maxY,u.maxY)-Math.min(o.minY,u.minY))}function mc(u,o){const n=Math.max(u.minX,o.minX),a=Math.max(u.minY,o.minY),l=Math.min(u.maxX,o.maxX),f=Math.min(u.maxY,o.maxY);return Math.max(0,l-n)*Math.max(0,f-a)}function Zs(u,o){return u.minX<=o.minX&&u.minY<=o.minY&&o.maxX<=u.maxX&&o.maxY<=u.maxY}function Sr(u,o){return o.minX<=u.maxX&&o.minY<=u.maxY&&o.maxX>=u.minX&&o.maxY>=u.minY}function kn(u){return{children:u,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Na(u,o,n,a,l){const f=[o,n];for(;f.length;){if(n=f.pop(),o=f.pop(),n-o<=a)continue;const g=o+Math.ceil((n-o)/a/2)*a;js(u,g,o,n,l),f.push(o,g,g,n)}}var Pt={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function Ga(u,o){return Array.isArray(u)?u:(o===void 0?o=[u,u]:(o[0]=u,o[1]=u),o)}var vc=function(){function u(o){this.opacity_=o.opacity,this.rotateWithView_=o.rotateWithView,this.rotation_=o.rotation,this.scale_=o.scale,this.scaleArray_=Ga(o.scale),this.displacement_=o.displacement}return u.prototype.clone=function(){var o=this.getScale();return new u({opacity:this.getOpacity(),scale:Array.isArray(o)?o.slice():o,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},u.prototype.getOpacity=function(){return this.opacity_},u.prototype.getRotateWithView=function(){return this.rotateWithView_},u.prototype.getRotation=function(){return this.rotation_},u.prototype.getScale=function(){return this.scale_},u.prototype.getScaleArray=function(){return this.scaleArray_},u.prototype.getDisplacement=function(){return this.displacement_},u.prototype.getAnchor=function(){return Z()},u.prototype.getImage=function(o){return Z()},u.prototype.getHitDetectionImage=function(){return Z()},u.prototype.getPixelRatio=function(o){return 1},u.prototype.getImageState=function(){return Z()},u.prototype.getImageSize=function(){return Z()},u.prototype.getOrigin=function(){return Z()},u.prototype.getSize=function(){return Z()},u.prototype.setDisplacement=function(o){this.displacement_=o},u.prototype.setOpacity=function(o){this.opacity_=o},u.prototype.setRotateWithView=function(o){this.rotateWithView_=o},u.prototype.setRotation=function(o){this.rotation_=o},u.prototype.setScale=function(o){this.scale_=o,this.scaleArray_=Ga(o)},u.prototype.listenImageChange=function(o){Z()},u.prototype.load=function(){Z()},u.prototype.unlistenImageChange=function(o){Z()},u}(),ka=vc,yc=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Ec=/^([a-z]*)$|^hsla?\(.*\)$/i;function Xa(u){return typeof u=="string"?u:Ya(u)}function xc(u){var o=document.createElement("div");if(o.style.color=u,o.style.color!==""){document.body.appendChild(o);var n=getComputedStyle(o).color;return document.body.removeChild(o),n}else return""}var wc=function(){var u=1024,o={},n=0;return function(a){var l;if(o.hasOwnProperty(a))l=o[a];else{if(n>=u){var f=0;for(var g in o)(f++&3)===0&&(delete o[g],--n)}l=Rc(a),o[a]=l,++n}return l}}();function Ar(u){return Array.isArray(u)?u:wc(u)}function Rc(u){var o,n,a,l,f;if(Ec.exec(u)&&(u=xc(u)),yc.exec(u)){var g=u.length-1,p=void 0;g<=4?p=1:p=2;var v=g===4||g===8;o=parseInt(u.substr(1+0*p,p),16),n=parseInt(u.substr(1+1*p,p),16),a=parseInt(u.substr(1+2*p,p),16),v?l=parseInt(u.substr(1+3*p,p),16):l=255,p==1&&(o=(o<<4)+o,n=(n<<4)+n,a=(a<<4)+a,v&&(l=(l<<4)+l)),f=[o,n,a,l/255]}else u.indexOf("rgba(")==0?(f=u.slice(5,-1).split(",").map(Number),za(f)):u.indexOf("rgb(")==0?(f=u.slice(4,-1).split(",").map(Number),f.push(1),za(f)):Vt(!1,14);return f}function za(u){return u[0]=kt(u[0]+.5|0,0,255),u[1]=kt(u[1]+.5|0,0,255),u[2]=kt(u[2]+.5|0,0,255),u[3]=kt(u[3],0,1),u}function Ya(u){var o=u[0];o!=(o|0)&&(o=o+.5|0);var n=u[1];n!=(n|0)&&(n=n+.5|0);var a=u[2];a!=(a|0)&&(a=a+.5|0);var l=u[3]===void 0?1:Math.round(u[3]*100)/100;return"rgba("+o+","+n+","+a+","+l+")"}function Me(u){return Array.isArray(u)?Ya(u):u}var Qe=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";Qe.indexOf("firefox");var Tc=Qe.indexOf("safari")!==-1&&Qe.indexOf("chrom")==-1;Tc&&(Qe.indexOf("version/15.4")>=0||Qe.match(/cpu (os|iphone os) 15_4 like mac os x/)),Qe.indexOf("webkit")!==-1&&Qe.indexOf("edge")==-1,Qe.indexOf("macintosh");var Or=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ic=typeof Image<"u"&&Image.prototype.decode;(function(){var u=!1;try{var o=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("_",null,o),window.removeEventListener("_",null,o)}catch{}return u})();function ke(u,o,n,a){var l;return Or?l=new OffscreenCanvas(u||300,o||300):l=document.createElement("canvas"),u&&(l.width=u),o&&(l.height=o),l.getContext("2d",a)}var Cc=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Ba=["style","variant","weight","size","lineHeight","family"],Ua=function(u){var o=u.match(Cc);if(!o)return null;for(var n={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},a=0,l=Ba.length;a<l;++a){var f=o[a+1];f!==void 0&&(n[Ba[a]]=f)}return n.families=n.family.split(/,\s?/),n};function Sc(u){return u===1?"":String(Math.round(u*100)/100)}var Wa="10px sans-serif",Xe="#000",Lr="round",Ci=[],Si=0,Xn="round",Ai=10,Oi="#000",Li="center",Mr="middle",Rn=[0,0,0,0],Mi=1,tn=new ut,Ac=new b;Ac.setSize=function(){console.warn("labelCache is deprecated.")};var zn=null,Ks,Hs={},Oc=function(){var u=100,o="32px ",n=["monospace","serif"],a=n.length,l="wmytzilWMYTZIL@#/&?$%10",f,g;function p(E,R,I){for(var S=!0,L=0;L<a;++L){var P=n[L];if(g=Pr(E+" "+R+" "+o+P,l),I!=P){var G=Pr(E+" "+R+" "+o+I+","+P,l);S=S&&G!=g}}return!!S}function v(){for(var E=!0,R=tn.getKeys(),I=0,S=R.length;I<S;++I){var L=R[I];tn.get(L)<u&&(p.apply(this,L.split(`
`))?(O(Hs),zn=null,Ks=void 0,tn.set(L,u)):(tn.set(L,tn.get(L)+1,!0),E=!1))}E&&(clearInterval(f),f=void 0)}return function(E){var R=Ua(E);if(R)for(var I=R.families,S=0,L=I.length;S<L;++S){var P=I[S],G=R.style+`
`+R.weight+`
`+P;tn.get(G)===void 0&&(tn.set(G,u,!0),p(R.style,R.weight,P)||(tn.set(G,0,!0),f===void 0&&(f=setInterval(v,32))))}}}(),Lc=function(){var u;return function(o){var n=Hs[o];if(n==null){if(Or){var a=Ua(o),l=ja(o,"Žg"),f=isNaN(Number(a.lineHeight))?1.2:Number(a.lineHeight);n=f*(l.actualBoundingBoxAscent+l.actualBoundingBoxDescent)}else u||(u=document.createElement("div"),u.innerHTML="M",u.style.minHeight="0",u.style.maxHeight="none",u.style.height="auto",u.style.padding="0",u.style.border="none",u.style.position="absolute",u.style.display="block",u.style.left="-99999px"),u.style.font=o,document.body.appendChild(u),n=u.offsetHeight,document.body.removeChild(u);Hs[o]=n}return n}}();function ja(u,o){return zn||(zn=ke(1,1)),u!=Ks&&(zn.font=u,Ks=zn.font),zn.measureText(o)}function Pr(u,o){return ja(u,o).width}function Va(u,o,n){if(o in n)return n[o];var a=Pr(u,o);return n[o]=a,a}function Mc(u,o){for(var n=[],a=[],l=[],f=0,g=0,p=0,v=0,E=0,R=o.length;E<=R;E+=2){var I=o[E];if(I===`
`||E===R){f=Math.max(f,g),l.push(g),g=0,p+=v;continue}var S=o[E+1]||u.font,L=Pr(S,I);n.push(L),g+=L;var P=Lc(S);a.push(P),v=Math.max(v,P)}return{width:f,height:p,widths:n,heights:a,lineWidths:l}}function Pc(u,o,n,a,l,f,g,p,v,E,R){u.save(),n!==1&&(u.globalAlpha*=n),o&&u.setTransform.apply(u,o),a.contextInstructions?(u.translate(v,E),u.scale(R[0],R[1]),Dc(a,u)):R[0]<0||R[1]<0?(u.translate(v,E),u.scale(R[0],R[1]),u.drawImage(a,l,f,g,p,0,0,g,p)):u.drawImage(a,l,f,g,p,v,E,g*R[0],p*R[1]),u.restore()}function Dc(u,o){for(var n=u.contextInstructions,a=0,l=n.length;a<l;a+=2)Array.isArray(n[a+1])?o[n[a]].apply(o,n[a+1]):o[n[a]]=n[a+1]}var Fc=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),bc=function(u){Fc(o,u);function o(n){var a=this,l=n.rotateWithView!==void 0?n.rotateWithView:!1;return a=u.call(this,{opacity:1,rotateWithView:l,rotation:n.rotation!==void 0?n.rotation:0,scale:n.scale!==void 0?n.scale:1,displacement:n.displacement!==void 0?n.displacement:[0,0]})||this,a.canvas_=void 0,a.hitDetectionCanvas_=null,a.fill_=n.fill!==void 0?n.fill:null,a.origin_=[0,0],a.points_=n.points,a.radius_=n.radius!==void 0?n.radius:n.radius1,a.radius2_=n.radius2,a.angle_=n.angle!==void 0?n.angle:0,a.stroke_=n.stroke!==void 0?n.stroke:null,a.size_=null,a.renderOptions_=null,a.render(),a}return o.prototype.clone=function(){var n=this.getScale(),a=new o({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(n)?n.slice():n,displacement:this.getDisplacement().slice()});return a.setOpacity(this.getOpacity()),a},o.prototype.getAnchor=function(){var n=this.size_;if(!n)return null;var a=this.getDisplacement();return[n[0]/2-a[0],n[1]/2+a[1]]},o.prototype.getAngle=function(){return this.angle_},o.prototype.getFill=function(){return this.fill_},o.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},o.prototype.getImage=function(n){var a=this.canvas_[n];if(!a){var l=this.renderOptions_,f=ke(l.size*n,l.size*n);this.draw_(l,f,n),a=f.canvas,this.canvas_[n]=a}return a},o.prototype.getPixelRatio=function(n){return n},o.prototype.getImageSize=function(){return this.size_},o.prototype.getImageState=function(){return Pt.LOADED},o.prototype.getOrigin=function(){return this.origin_},o.prototype.getPoints=function(){return this.points_},o.prototype.getRadius=function(){return this.radius_},o.prototype.getRadius2=function(){return this.radius2_},o.prototype.getSize=function(){return this.size_},o.prototype.getStroke=function(){return this.stroke_},o.prototype.listenImageChange=function(n){},o.prototype.load=function(){},o.prototype.unlistenImageChange=function(n){},o.prototype.calculateLineJoinSize_=function(n,a,l){if(a===0||this.points_===1/0||n!=="bevel"&&n!=="miter")return a;var f=this.radius_,g=this.radius2_===void 0?f:this.radius2_;if(f<g){var p=f;f=g,g=p}var v=this.radius2_===void 0?this.points_:this.points_*2,E=2*Math.PI/v,R=g*Math.sin(E),I=Math.sqrt(g*g-R*R),S=f-I,L=Math.sqrt(R*R+S*S),P=L/R;if(n==="miter"&&P<=l)return P*a;var G=a/2/P,X=a/2*(S/L),j=Math.sqrt((f+G)*(f+G)+X*X),U=j-f;if(this.radius2_===void 0||n==="bevel")return U*2;var H=f*Math.sin(E),at=Math.sqrt(f*f-H*H),it=g-at,q=Math.sqrt(H*H+it*it),lt=q/H;if(lt<=l){var tt=lt*a/2-g-f;return 2*Math.max(U,tt)}return U*2},o.prototype.createRenderOptions=function(){var n=Xn,a=0,l=null,f=0,g,p=0;this.stroke_&&(g=this.stroke_.getColor(),g===null&&(g=Oi),g=Me(g),p=this.stroke_.getWidth(),p===void 0&&(p=Mi),l=this.stroke_.getLineDash(),f=this.stroke_.getLineDashOffset(),n=this.stroke_.getLineJoin(),n===void 0&&(n=Xn),a=this.stroke_.getMiterLimit(),a===void 0&&(a=Ai));var v=this.calculateLineJoinSize_(n,p,a),E=Math.max(this.radius_,this.radius2_||0),R=Math.ceil(2*E+v);return{strokeStyle:g,strokeWidth:p,size:R,lineDash:l,lineDashOffset:f,lineJoin:n,miterLimit:a}},o.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var n=this.renderOptions_.size;this.canvas_={},this.size_=[n,n]},o.prototype.draw_=function(n,a,l){if(a.scale(l,l),a.translate(n.size/2,n.size/2),this.createPath_(a),this.fill_){var f=this.fill_.getColor();f===null&&(f=Xe),a.fillStyle=Me(f),a.fill()}this.stroke_&&(a.strokeStyle=n.strokeStyle,a.lineWidth=n.strokeWidth,a.setLineDash&&n.lineDash&&(a.setLineDash(n.lineDash),a.lineDashOffset=n.lineDashOffset),a.lineJoin=n.lineJoin,a.miterLimit=n.miterLimit,a.stroke())},o.prototype.createHitDetectionCanvas_=function(n){if(this.fill_){var a=this.fill_.getColor(),l=0;if(typeof a=="string"&&(a=Ar(a)),a===null?l=1:Array.isArray(a)&&(l=a.length===4?a[3]:1),l===0){var f=ke(n.size,n.size);this.hitDetectionCanvas_=f.canvas,this.drawHitDetectionCanvas_(n,f)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},o.prototype.createPath_=function(n){var a=this.points_,l=this.radius_;if(a===1/0)n.arc(0,0,l,0,2*Math.PI);else{var f=this.radius2_===void 0?l:this.radius2_;this.radius2_!==void 0&&(a*=2);for(var g=this.angle_-Math.PI/2,p=2*Math.PI/a,v=0;v<a;v++){var E=g+v*p,R=v%2===0?l:f;n.lineTo(R*Math.cos(E),R*Math.sin(E))}n.closePath()}},o.prototype.drawHitDetectionCanvas_=function(n,a){a.translate(n.size/2,n.size/2),this.createPath_(a),a.fillStyle=Xe,a.fill(),this.stroke_&&(a.strokeStyle=n.strokeStyle,a.lineWidth=n.strokeWidth,n.lineDash&&(a.setLineDash(n.lineDash),a.lineDashOffset=n.lineDashOffset),a.lineJoin=n.lineJoin,a.miterLimit=n.miterLimit,a.stroke())},o}(ka),Nc=bc,Gc=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),kc=function(u){Gc(o,u);function o(n){var a=n||{};return u.call(this,{points:1/0,fill:a.fill,radius:a.radius,stroke:a.stroke,scale:a.scale!==void 0?a.scale:1,rotation:a.rotation!==void 0?a.rotation:0,rotateWithView:a.rotateWithView!==void 0?a.rotateWithView:!1,displacement:a.displacement!==void 0?a.displacement:[0,0]})||this}return o.prototype.clone=function(){var n=this.getScale(),a=new o({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(n)?n.slice():n,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return a.setOpacity(this.getOpacity()),a},o.prototype.setRadius=function(n){this.radius_=n,this.render()},o}(Nc),Xc=kc,zc=function(){function u(o){var n=o||{};this.color_=n.color!==void 0?n.color:null}return u.prototype.clone=function(){var o=this.getColor();return new u({color:Array.isArray(o)?o.slice():o||void 0})},u.prototype.getColor=function(){return this.color_},u.prototype.setColor=function(o){this.color_=o},u}(),Yc=zc,pt={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Bc=function(){function u(o){var n=o||{};this.color_=n.color!==void 0?n.color:null,this.lineCap_=n.lineCap,this.lineDash_=n.lineDash!==void 0?n.lineDash:null,this.lineDashOffset_=n.lineDashOffset,this.lineJoin_=n.lineJoin,this.miterLimit_=n.miterLimit,this.width_=n.width}return u.prototype.clone=function(){var o=this.getColor();return new u({color:Array.isArray(o)?o.slice():o||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},u.prototype.getColor=function(){return this.color_},u.prototype.getLineCap=function(){return this.lineCap_},u.prototype.getLineDash=function(){return this.lineDash_},u.prototype.getLineDashOffset=function(){return this.lineDashOffset_},u.prototype.getLineJoin=function(){return this.lineJoin_},u.prototype.getMiterLimit=function(){return this.miterLimit_},u.prototype.getWidth=function(){return this.width_},u.prototype.setColor=function(o){this.color_=o},u.prototype.setLineCap=function(o){this.lineCap_=o},u.prototype.setLineDash=function(o){this.lineDash_=o},u.prototype.setLineDashOffset=function(o){this.lineDashOffset_=o},u.prototype.setLineJoin=function(o){this.lineJoin_=o},u.prototype.setMiterLimit=function(o){this.miterLimit_=o},u.prototype.setWidth=function(o){this.width_=o},u}(),Uc=Bc,Wc=function(){function u(o){var n=o||{};this.geometry_=null,this.geometryFunction_=Za,n.geometry!==void 0&&this.setGeometry(n.geometry),this.fill_=n.fill!==void 0?n.fill:null,this.image_=n.image!==void 0?n.image:null,this.renderer_=n.renderer!==void 0?n.renderer:null,this.hitDetectionRenderer_=n.hitDetectionRenderer!==void 0?n.hitDetectionRenderer:null,this.stroke_=n.stroke!==void 0?n.stroke:null,this.text_=n.text!==void 0?n.text:null,this.zIndex_=n.zIndex}return u.prototype.clone=function(){var o=this.getGeometry();return o&&typeof o=="object"&&(o=o.clone()),new u({geometry:o,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},u.prototype.getRenderer=function(){return this.renderer_},u.prototype.setRenderer=function(o){this.renderer_=o},u.prototype.setHitDetectionRenderer=function(o){this.hitDetectionRenderer_=o},u.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},u.prototype.getGeometry=function(){return this.geometry_},u.prototype.getGeometryFunction=function(){return this.geometryFunction_},u.prototype.getFill=function(){return this.fill_},u.prototype.setFill=function(o){this.fill_=o},u.prototype.getImage=function(){return this.image_},u.prototype.setImage=function(o){this.image_=o},u.prototype.getStroke=function(){return this.stroke_},u.prototype.setStroke=function(o){this.stroke_=o},u.prototype.getText=function(){return this.text_},u.prototype.setText=function(o){this.text_=o},u.prototype.getZIndex=function(){return this.zIndex_},u.prototype.setGeometry=function(o){typeof o=="function"?this.geometryFunction_=o:typeof o=="string"?this.geometryFunction_=function(n){return n.get(o)}:o?o!==void 0&&(this.geometryFunction_=function(){return o}):this.geometryFunction_=Za,this.geometry_=o},u.prototype.setZIndex=function(o){this.zIndex_=o},u}();function jc(u){var o;if(typeof u=="function")o=u;else{var n;if(Array.isArray(u))n=u;else{Vt(typeof u.getZIndex=="function",41);var a=u;n=[a]}o=function(){return n}}return o}var $s=null;function Vc(u,o){if(!$s){var n=new Yc({color:"rgba(255,255,255,0.4)"}),a=new Uc({color:"#3399CC",width:1.25});$s=[new Wc({image:new Xc({fill:n,stroke:a,radius:5}),fill:n,stroke:a})]}return $s}function Za(u){return u.getGeometry()}var Zc=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ka={RENDER_ORDER:"renderOrder"},Kc=function(u){Zc(o,u);function o(n){var a=this,l=n||{},f=T({},l);return delete f.style,delete f.renderBuffer,delete f.updateWhileAnimating,delete f.updateWhileInteracting,a=u.call(this,f)||this,a.declutter_=l.declutter!==void 0?l.declutter:!1,a.renderBuffer_=l.renderBuffer!==void 0?l.renderBuffer:100,a.style_=null,a.styleFunction_=void 0,a.setStyle(l.style),a.updateWhileAnimating_=l.updateWhileAnimating!==void 0?l.updateWhileAnimating:!1,a.updateWhileInteracting_=l.updateWhileInteracting!==void 0?l.updateWhileInteracting:!1,a}return o.prototype.getDeclutter=function(){return this.declutter_},o.prototype.getFeatures=function(n){return u.prototype.getFeatures.call(this,n)},o.prototype.getRenderBuffer=function(){return this.renderBuffer_},o.prototype.getRenderOrder=function(){return this.get(Ka.RENDER_ORDER)},o.prototype.getStyle=function(){return this.style_},o.prototype.getStyleFunction=function(){return this.styleFunction_},o.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},o.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},o.prototype.renderDeclutter=function(n){n.declutterTree||(n.declutterTree=new ba(9)),this.getRenderer().renderDeclutter(n)},o.prototype.setRenderOrder=function(n){this.set(Ka.RENDER_ORDER,n)},o.prototype.setStyle=function(n){this.style_=n!==void 0?n:Vc,this.styleFunction_=n===null?void 0:jc(this.style_),this.changed()},o}(Nn),Hc=Kc,Pi={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Dr=[Pi.FILL],en=[Pi.STROKE],Tn=[Pi.BEGIN_PATH],Ha=[Pi.CLOSE_PATH],rt=Pi,nn={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},$c=function(){function u(){}return u.prototype.drawCustom=function(o,n,a,l){},u.prototype.drawGeometry=function(o){},u.prototype.setStyle=function(o){},u.prototype.drawCircle=function(o,n){},u.prototype.drawFeature=function(o,n){},u.prototype.drawGeometryCollection=function(o,n){},u.prototype.drawLineString=function(o,n){},u.prototype.drawMultiLineString=function(o,n){},u.prototype.drawMultiPoint=function(o,n){},u.prototype.drawMultiPolygon=function(o,n){},u.prototype.drawPoint=function(o,n){},u.prototype.drawPolygon=function(o,n){},u.prototype.drawText=function(o,n){},u.prototype.setFillStrokeStyle=function(o,n){},u.prototype.setImageStyle=function(o,n){},u.prototype.setTextStyle=function(o,n){},u}(),$a=$c;function qs(u,o,n){return n?(n[0]=u[0]-o,n[1]=u[1]-o,n[2]=u[2]+o,n[3]=u[3]+o,n):[u[0]-o,u[1]-o,u[2]+o,u[3]+o]}function qc(u,o){return u.slice()}function Jc(u,o,n){var a,l;return o<u[0]?a=u[0]-o:u[2]<o?a=o-u[2]:a=0,n<u[1]?l=u[1]-n:u[3]<n?l=n-u[3]:l=0,a*a+l*l}function qa(u,o){return Js(u,o[0],o[1])}function Di(u,o){return u[0]<=o[0]&&o[2]<=u[2]&&u[1]<=o[1]&&o[3]<=u[3]}function Js(u,o,n){return u[0]<=o&&o<=u[2]&&u[1]<=n&&n<=u[3]}function Qc(u,o){var n=u[0],a=u[1],l=u[2],f=u[3],g=o[0],p=o[1],v=nn.UNKNOWN;return g<n?v=v|nn.LEFT:g>l&&(v=v|nn.RIGHT),p<a?v=v|nn.BELOW:p>f&&(v=v|nn.ABOVE),v===nn.UNKNOWN&&(v=nn.INTERSECTING),v}function Fi(){return[1/0,1/0,-1/0,-1/0]}function bi(u,o,n,a,l){return l?(l[0]=u,l[1]=o,l[2]=n,l[3]=a,l):[u,o,n,a]}function Ja(u){return bi(1/0,1/0,-1/0,-1/0,u)}function tf(u,o){var n=u[0],a=u[1];return bi(n,a,n,a,o)}function ef(u,o,n,a,l){var f=Ja(l);return rf(f,u,o,n,a)}function Qa(u,o){return u[0]==o[0]&&u[2]==o[2]&&u[1]==o[1]&&u[3]==o[3]}function nf(u,o){o[0]<u[0]&&(u[0]=o[0]),o[0]>u[2]&&(u[2]=o[0]),o[1]<u[1]&&(u[1]=o[1]),o[1]>u[3]&&(u[3]=o[1])}function rf(u,o,n,a,l){for(;n<a;n+=l)sf(u,o[n],o[n+1]);return u}function sf(u,o,n){u[0]=Math.min(u[0],o),u[1]=Math.min(u[1],n),u[2]=Math.max(u[2],o),u[3]=Math.max(u[3],n)}function of(u){return[u[0],u[1]]}function af(u){return[u[2],u[1]]}function Qs(u){return[(u[0]+u[2])/2,(u[1]+u[3])/2]}function Fr(u){return u[3]-u[1]}function lf(u){return[u[0],u[3]]}function hf(u){return[u[2],u[3]]}function In(u){return u[2]-u[0]}function Pe(u,o){return u[0]<=o[2]&&u[2]>=o[0]&&u[1]<=o[3]&&u[3]>=o[1]}function uf(u,o){return o?(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o):u}function cf(u,o){var n=o.getExtent(),a=Qs(u);if(o.canWrapX()&&(a[0]<n[0]||a[0]>=n[2])){var l=In(n),f=Math.floor((a[0]-n[0])/l),g=f*l;u[0]-=g,u[2]-=g}return u}function Yn(u,o,n,a,l){for(var f=l!==void 0?l:[],g=0,p=o;p<n;p+=a)f[g++]=u.slice(p,p+a);return f.length=g,f}function to(u,o,n,a,l){for(var f=l!==void 0?l:[],g=0,p=0,v=n.length;p<v;++p){var E=n[p];f[g++]=Yn(u,o,E,a,f[g]),o=E}return f.length=g,f}function tl(u,o,n,a,l){for(var f=l!==void 0?l:[],g=0,p=0,v=n.length;p<v;++p){var E=n[p];f[g++]=to(u,o,E,a,f[g]),o=E[E.length-1]}return f.length=g,f}var ff=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),df=function(u){ff(o,u);function o(n,a,l,f){var g=u.call(this)||this;return g.tolerance=n,g.maxExtent=a,g.pixelRatio=f,g.maxLineWidth=0,g.resolution=l,g.beginGeometryInstruction1_=null,g.beginGeometryInstruction2_=null,g.bufferedMaxExtent_=null,g.instructions=[],g.coordinates=[],g.tmpCoordinate_=[],g.hitDetectionInstructions=[],g.state={},g}return o.prototype.applyPixelRatio=function(n){var a=this.pixelRatio;return a==1?n:n.map(function(l){return l*a})},o.prototype.appendFlatPointCoordinates=function(n,a){for(var l=this.getBufferedMaxExtent(),f=this.tmpCoordinate_,g=this.coordinates,p=g.length,v=0,E=n.length;v<E;v+=a)f[0]=n[v],f[1]=n[v+1],qa(l,f)&&(g[p++]=f[0],g[p++]=f[1]);return p},o.prototype.appendFlatLineCoordinates=function(n,a,l,f,g,p){var v=this.coordinates,E=v.length,R=this.getBufferedMaxExtent();p&&(a+=f);var I=n[a],S=n[a+1],L=this.tmpCoordinate_,P=!0,G,X,j;for(G=a+f;G<l;G+=f)L[0]=n[G],L[1]=n[G+1],j=Qc(R,L),j!==X?(P&&(v[E++]=I,v[E++]=S,P=!1),v[E++]=L[0],v[E++]=L[1]):j===nn.INTERSECTING?(v[E++]=L[0],v[E++]=L[1],P=!1):P=!0,I=L[0],S=L[1],X=j;return(g&&P||G===a+f)&&(v[E++]=I,v[E++]=S),E},o.prototype.drawCustomCoordinates_=function(n,a,l,f,g){for(var p=0,v=l.length;p<v;++p){var E=l[p],R=this.appendFlatLineCoordinates(n,a,E,f,!1,!1);g.push(R),a=E}return a},o.prototype.drawCustom=function(n,a,l,f){this.beginGeometry(n,a);var g=n.getType(),p=n.getStride(),v=this.coordinates.length,E,R,I,S,L;switch(g){case pt.MULTI_POLYGON:E=n.getOrientedFlatCoordinates(),S=[];var P=n.getEndss();L=0;for(var G=0,X=P.length;G<X;++G){var j=[];L=this.drawCustomCoordinates_(E,L,P[G],p,j),S.push(j)}this.instructions.push([rt.CUSTOM,v,S,n,l,tl]),this.hitDetectionInstructions.push([rt.CUSTOM,v,S,n,f||l,tl]);break;case pt.POLYGON:case pt.MULTI_LINE_STRING:I=[],E=g==pt.POLYGON?n.getOrientedFlatCoordinates():n.getFlatCoordinates(),L=this.drawCustomCoordinates_(E,0,n.getEnds(),p,I),this.instructions.push([rt.CUSTOM,v,I,n,l,to]),this.hitDetectionInstructions.push([rt.CUSTOM,v,I,n,f||l,to]);break;case pt.LINE_STRING:case pt.CIRCLE:E=n.getFlatCoordinates(),R=this.appendFlatLineCoordinates(E,0,E.length,p,!1,!1),this.instructions.push([rt.CUSTOM,v,R,n,l,Yn]),this.hitDetectionInstructions.push([rt.CUSTOM,v,R,n,f||l,Yn]);break;case pt.MULTI_POINT:E=n.getFlatCoordinates(),R=this.appendFlatPointCoordinates(E,p),R>v&&(this.instructions.push([rt.CUSTOM,v,R,n,l,Yn]),this.hitDetectionInstructions.push([rt.CUSTOM,v,R,n,f||l,Yn]));break;case pt.POINT:E=n.getFlatCoordinates(),this.coordinates.push(E[0],E[1]),R=this.coordinates.length,this.instructions.push([rt.CUSTOM,v,R,n,l]),this.hitDetectionInstructions.push([rt.CUSTOM,v,R,n,f||l]);break}this.endGeometry(a)},o.prototype.beginGeometry=function(n,a){this.beginGeometryInstruction1_=[rt.BEGIN_GEOMETRY,a,0,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[rt.BEGIN_GEOMETRY,a,0,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},o.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},o.prototype.reverseHitDetectionInstructions=function(){var n=this.hitDetectionInstructions;n.reverse();var a,l=n.length,f,g,p=-1;for(a=0;a<l;++a)f=n[a],g=f[0],g==rt.END_GEOMETRY?p=a:g==rt.BEGIN_GEOMETRY&&(f[2]=a,_(this.hitDetectionInstructions,p,a),p=-1)},o.prototype.setFillStrokeStyle=function(n,a){var l=this.state;if(n){var f=n.getColor();l.fillStyle=Me(f||Xe)}else l.fillStyle=void 0;if(a){var g=a.getColor();l.strokeStyle=Me(g||Oi);var p=a.getLineCap();l.lineCap=p!==void 0?p:Lr;var v=a.getLineDash();l.lineDash=v?v.slice():Ci;var E=a.getLineDashOffset();l.lineDashOffset=E||Si;var R=a.getLineJoin();l.lineJoin=R!==void 0?R:Xn;var I=a.getWidth();l.lineWidth=I!==void 0?I:Mi;var S=a.getMiterLimit();l.miterLimit=S!==void 0?S:Ai,l.lineWidth>this.maxLineWidth&&(this.maxLineWidth=l.lineWidth,this.bufferedMaxExtent_=null)}else l.strokeStyle=void 0,l.lineCap=void 0,l.lineDash=null,l.lineDashOffset=void 0,l.lineJoin=void 0,l.lineWidth=void 0,l.miterLimit=void 0},o.prototype.createFill=function(n){var a=n.fillStyle,l=[rt.SET_FILL_STYLE,a];return typeof a!="string"&&l.push(!0),l},o.prototype.applyStroke=function(n){this.instructions.push(this.createStroke(n))},o.prototype.createStroke=function(n){return[rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth*this.pixelRatio,n.lineCap,n.lineJoin,n.miterLimit,this.applyPixelRatio(n.lineDash),n.lineDashOffset*this.pixelRatio]},o.prototype.updateFillStyle=function(n,a){var l=n.fillStyle;(typeof l!="string"||n.currentFillStyle!=l)&&(l!==void 0&&this.instructions.push(a.call(this,n)),n.currentFillStyle=l)},o.prototype.updateStrokeStyle=function(n,a){var l=n.strokeStyle,f=n.lineCap,g=n.lineDash,p=n.lineDashOffset,v=n.lineJoin,E=n.lineWidth,R=n.miterLimit;(n.currentStrokeStyle!=l||n.currentLineCap!=f||g!=n.currentLineDash&&!y(n.currentLineDash,g)||n.currentLineDashOffset!=p||n.currentLineJoin!=v||n.currentLineWidth!=E||n.currentMiterLimit!=R)&&(l!==void 0&&a.call(this,n),n.currentStrokeStyle=l,n.currentLineCap=f,n.currentLineDash=g,n.currentLineDashOffset=p,n.currentLineJoin=v,n.currentLineWidth=E,n.currentMiterLimit=R)},o.prototype.endGeometry=function(n){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var a=[rt.END_GEOMETRY,n];this.instructions.push(a),this.hitDetectionInstructions.push(a)},o.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=qc(this.maxExtent),this.maxLineWidth>0)){var n=this.resolution*(this.maxLineWidth+1)/2;qs(this.bufferedMaxExtent_,n,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},o}($a),Ni=df,gf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),_f=function(u){gf(o,u);function o(n,a,l,f){var g=u.call(this,n,a,l,f)||this;return g.hitDetectionImage_=null,g.image_=null,g.imagePixelRatio_=void 0,g.anchorX_=void 0,g.anchorY_=void 0,g.height_=void 0,g.opacity_=void 0,g.originX_=void 0,g.originY_=void 0,g.rotateWithView_=void 0,g.rotation_=void 0,g.scale_=void 0,g.width_=void 0,g.declutterImageWithText_=void 0,g}return o.prototype.drawPoint=function(n,a){if(this.image_){this.beginGeometry(n,a);var l=n.getFlatCoordinates(),f=n.getStride(),g=this.coordinates.length,p=this.appendFlatPointCoordinates(l,f);this.instructions.push([rt.DRAW_IMAGE,g,p,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,g,p,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(a)}},o.prototype.drawMultiPoint=function(n,a){if(this.image_){this.beginGeometry(n,a);var l=n.getFlatCoordinates(),f=n.getStride(),g=this.coordinates.length,p=this.appendFlatPointCoordinates(l,f);this.instructions.push([rt.DRAW_IMAGE,g,p,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,g,p,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(a)}},o.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,u.prototype.finish.call(this)},o.prototype.setImageStyle=function(n,a){var l=n.getAnchor(),f=n.getSize(),g=n.getHitDetectionImage(),p=n.getImage(this.pixelRatio),v=n.getOrigin();this.imagePixelRatio_=n.getPixelRatio(this.pixelRatio),this.anchorX_=l[0],this.anchorY_=l[1],this.hitDetectionImage_=g,this.image_=p,this.height_=f[1],this.opacity_=n.getOpacity(),this.originX_=v[0]*this.imagePixelRatio_,this.originY_=v[1]*this.imagePixelRatio_,this.rotateWithView_=n.getRotateWithView(),this.rotation_=n.getRotation(),this.scale_=n.getScaleArray(),this.width_=f[0],this.declutterImageWithText_=a},o}(Ni),pf=_f,mf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),vf=function(u){mf(o,u);function o(n,a,l,f){return u.call(this,n,a,l,f)||this}return o.prototype.drawFlatCoordinates_=function(n,a,l,f){var g=this.coordinates.length,p=this.appendFlatLineCoordinates(n,a,l,f,!1,!1),v=[rt.MOVE_TO_LINE_TO,g,p];return this.instructions.push(v),this.hitDetectionInstructions.push(v),l},o.prototype.drawLineString=function(n,a){var l=this.state,f=l.strokeStyle,g=l.lineWidth;if(!(f===void 0||g===void 0)){this.updateStrokeStyle(l,this.applyStroke),this.beginGeometry(n,a),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,Ci,Si],Tn);var p=n.getFlatCoordinates(),v=n.getStride();this.drawFlatCoordinates_(p,0,p.length,v),this.hitDetectionInstructions.push(en),this.endGeometry(a)}},o.prototype.drawMultiLineString=function(n,a){var l=this.state,f=l.strokeStyle,g=l.lineWidth;if(!(f===void 0||g===void 0)){this.updateStrokeStyle(l,this.applyStroke),this.beginGeometry(n,a),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset],Tn);for(var p=n.getEnds(),v=n.getFlatCoordinates(),E=n.getStride(),R=0,I=0,S=p.length;I<S;++I)R=this.drawFlatCoordinates_(v,R,p[I],E);this.hitDetectionInstructions.push(en),this.endGeometry(a)}},o.prototype.finish=function(){var n=this.state;return n.lastStroke!=null&&n.lastStroke!=this.coordinates.length&&this.instructions.push(en),this.reverseHitDetectionInstructions(),this.state=null,u.prototype.finish.call(this)},o.prototype.applyStroke=function(n){n.lastStroke!=null&&n.lastStroke!=this.coordinates.length&&(this.instructions.push(en),n.lastStroke=this.coordinates.length),n.lastStroke=0,u.prototype.applyStroke.call(this,n),this.instructions.push(Tn)},o}(Ni),yf=vf;function Ef(u,o){return o*Math.round(u/o)}var xf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),wf=function(u){xf(o,u);function o(n,a,l,f){return u.call(this,n,a,l,f)||this}return o.prototype.drawFlatCoordinatess_=function(n,a,l,f){var g=this.state,p=g.fillStyle!==void 0,v=g.strokeStyle!==void 0,E=l.length;this.instructions.push(Tn),this.hitDetectionInstructions.push(Tn);for(var R=0;R<E;++R){var I=l[R],S=this.coordinates.length,L=this.appendFlatLineCoordinates(n,a,I,f,!0,!v),P=[rt.MOVE_TO_LINE_TO,S,L];this.instructions.push(P),this.hitDetectionInstructions.push(P),v&&(this.instructions.push(Ha),this.hitDetectionInstructions.push(Ha)),a=I}return p&&(this.instructions.push(Dr),this.hitDetectionInstructions.push(Dr)),v&&(this.instructions.push(en),this.hitDetectionInstructions.push(en)),a},o.prototype.drawCircle=function(n,a){var l=this.state,f=l.fillStyle,g=l.strokeStyle;if(!(f===void 0&&g===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(n,a),l.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Xe]),l.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset]);var p=n.getFlatCoordinates(),v=n.getStride(),E=this.coordinates.length;this.appendFlatLineCoordinates(p,0,p.length,v,!1,!1);var R=[rt.CIRCLE,E];this.instructions.push(Tn,R),this.hitDetectionInstructions.push(Tn,R),l.fillStyle!==void 0&&(this.instructions.push(Dr),this.hitDetectionInstructions.push(Dr)),l.strokeStyle!==void 0&&(this.instructions.push(en),this.hitDetectionInstructions.push(en)),this.endGeometry(a)}},o.prototype.drawPolygon=function(n,a){var l=this.state,f=l.fillStyle,g=l.strokeStyle;if(!(f===void 0&&g===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(n,a),l.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Xe]),l.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset]);var p=n.getEnds(),v=n.getOrientedFlatCoordinates(),E=n.getStride();this.drawFlatCoordinatess_(v,0,p,E),this.endGeometry(a)}},o.prototype.drawMultiPolygon=function(n,a){var l=this.state,f=l.fillStyle,g=l.strokeStyle;if(!(f===void 0&&g===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(n,a),l.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Xe]),l.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset]);for(var p=n.getEndss(),v=n.getOrientedFlatCoordinates(),E=n.getStride(),R=0,I=0,S=p.length;I<S;++I)R=this.drawFlatCoordinatess_(v,R,p[I],E);this.endGeometry(a)}},o.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var n=this.tolerance;if(n!==0)for(var a=this.coordinates,l=0,f=a.length;l<f;++l)a[l]=Ef(a[l],n);return u.prototype.finish.call(this)},o.prototype.setFillStrokeStyles_=function(){var n=this.state,a=n.fillStyle;a!==void 0&&this.updateFillStyle(n,this.createFill),n.strokeStyle!==void 0&&this.updateStrokeStyle(n,this.applyStroke)},o}(Ni),el=wf,Rf={LINE:"line"};function Tf(u,o,n,a,l){var f=n,g=n,p=0,v=0,E=n,R,I,S,L,P,G,X,j,U,H;for(I=n;I<a;I+=l){var at=o[I],it=o[I+1];P!==void 0&&(U=at-P,H=it-G,L=Math.sqrt(U*U+H*H),X!==void 0&&(v+=S,R=Math.acos((X*U+j*H)/(S*L)),R>u&&(v>p&&(p=v,f=E,g=I),v=0,E=I-l)),S=L,X=U,j=H),P=at,G=it}return v+=L,v>p?[E,I]:[f,g]}var If=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),br={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Cf=function(u){If(o,u);function o(n,a,l,f){var g=u.call(this,n,a,l,f)||this;return g.labels_=null,g.text_="",g.textOffsetX_=0,g.textOffsetY_=0,g.textRotateWithView_=void 0,g.textRotation_=0,g.textFillState_=null,g.fillStates={},g.textStrokeState_=null,g.strokeStates={},g.textState_={},g.textStates={},g.textKey_="",g.fillKey_="",g.strokeKey_="",g.declutterImageWithText_=void 0,g}return o.prototype.finish=function(){var n=u.prototype.finish.call(this);return n.textStates=this.textStates,n.fillStates=this.fillStates,n.strokeStates=this.strokeStates,n},o.prototype.drawText=function(n,a){var l=this.textFillState_,f=this.textStrokeState_,g=this.textState_;if(!(this.text_===""||!g||!l&&!f)){var p=this.coordinates,v=p.length,E=n.getType(),R=null,I=n.getStride();if(g.placement===Rf.LINE&&(E==pt.LINE_STRING||E==pt.MULTI_LINE_STRING||E==pt.POLYGON||E==pt.MULTI_POLYGON)){if(!Pe(this.getBufferedMaxExtent(),n.getExtent()))return;var S=void 0;if(R=n.getFlatCoordinates(),E==pt.LINE_STRING)S=[R.length];else if(E==pt.MULTI_LINE_STRING)S=n.getEnds();else if(E==pt.POLYGON)S=n.getEnds().slice(0,1);else if(E==pt.MULTI_POLYGON){var L=n.getEndss();S=[];for(var P=0,G=L.length;P<G;++P)S.push(L[P][0])}this.beginGeometry(n,a);for(var X=g.textAlign,j=0,U=void 0,H=0,at=S.length;H<at;++H){if(X==null){var it=Tf(g.maxAngle,R,j,S[H],I);j=it[0],U=it[1]}else U=S[H];for(var P=j;P<U;P+=I)p.push(R[P],R[P+1]);var q=p.length;j=S[H],this.drawChars_(v,q),v=q}this.endGeometry(a)}else{var lt=g.overflow?null:[];switch(E){case pt.POINT:case pt.MULTI_POINT:R=n.getFlatCoordinates();break;case pt.LINE_STRING:R=n.getFlatMidpoint();break;case pt.CIRCLE:R=n.getCenter();break;case pt.MULTI_LINE_STRING:R=n.getFlatMidpoints(),I=2;break;case pt.POLYGON:R=n.getFlatInteriorPoint(),g.overflow||lt.push(R[2]/this.resolution),I=3;break;case pt.MULTI_POLYGON:var tt=n.getFlatInteriorPoints();R=[];for(var P=0,G=tt.length;P<G;P+=3)g.overflow||lt.push(tt[P+2]/this.resolution),R.push(tt[P],tt[P+1]);if(R.length===0)return;I=2;break}var q=this.appendFlatPointCoordinates(R,I);if(q===v)return;if(lt&&(q-v)/2!==R.length/I){var ft=v/2;lt=lt.filter(function(zt,Lt){var Ft=p[(ft+Lt)*2]===R[Lt*I]&&p[(ft+Lt)*2+1]===R[Lt*I+1];return Ft||--ft,Ft})}this.saveTextStates_(),(g.backgroundFill||g.backgroundStroke)&&(this.setFillStrokeStyle(g.backgroundFill,g.backgroundStroke),g.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),g.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(n,a);var At=g.padding;if(At!=Rn&&(g.scale[0]<0||g.scale[1]<0)){var Dt=g.padding[0],mt=g.padding[1],xt=g.padding[2],bt=g.padding[3];g.scale[0]<0&&(mt=-mt,bt=-bt),g.scale[1]<0&&(Dt=-Dt,xt=-xt),At=[Dt,mt,xt,bt]}var Zt=this.pixelRatio;this.instructions.push([rt.DRAW_IMAGE,v,q,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,At==Rn?Rn:At.map(function(zt){return zt*Zt}),!!g.backgroundFill,!!g.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,lt]);var Bt=1/Zt;this.hitDetectionInstructions.push([rt.DRAW_IMAGE,v,q,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[Bt,Bt],NaN,this.declutterImageWithText_,At,!!g.backgroundFill,!!g.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,lt]),this.endGeometry(a)}}},o.prototype.saveTextStates_=function(){var n=this.textStrokeState_,a=this.textState_,l=this.textFillState_,f=this.strokeKey_;n&&(f in this.strokeStates||(this.strokeStates[f]={strokeStyle:n.strokeStyle,lineCap:n.lineCap,lineDashOffset:n.lineDashOffset,lineWidth:n.lineWidth,lineJoin:n.lineJoin,miterLimit:n.miterLimit,lineDash:n.lineDash}));var g=this.textKey_;g in this.textStates||(this.textStates[g]={font:a.font,textAlign:a.textAlign||Li,textBaseline:a.textBaseline||Mr,scale:a.scale});var p=this.fillKey_;l&&(p in this.fillStates||(this.fillStates[p]={fillStyle:l.fillStyle}))},o.prototype.drawChars_=function(n,a){var l=this.textStrokeState_,f=this.textState_,g=this.strokeKey_,p=this.textKey_,v=this.fillKey_;this.saveTextStates_();var E=this.pixelRatio,R=br[f.textBaseline],I=this.textOffsetY_*E,S=this.text_,L=l?l.lineWidth*Math.abs(f.scale[0])/2:0;this.instructions.push([rt.DRAW_CHARS,n,a,R,f.overflow,v,f.maxAngle,E,I,g,L*E,S,p,1]),this.hitDetectionInstructions.push([rt.DRAW_CHARS,n,a,R,f.overflow,v,f.maxAngle,1,I,g,L,S,p,1/E])},o.prototype.setTextStyle=function(n,a){var l,f,g;if(!n)this.text_="";else{var p=n.getFill();p?(f=this.textFillState_,f||(f={},this.textFillState_=f),f.fillStyle=Me(p.getColor()||Xe)):(f=null,this.textFillState_=f);var v=n.getStroke();if(!v)g=null,this.textStrokeState_=g;else{g=this.textStrokeState_,g||(g={},this.textStrokeState_=g);var E=v.getLineDash(),R=v.getLineDashOffset(),I=v.getWidth(),S=v.getMiterLimit();g.lineCap=v.getLineCap()||Lr,g.lineDash=E?E.slice():Ci,g.lineDashOffset=R===void 0?Si:R,g.lineJoin=v.getLineJoin()||Xn,g.lineWidth=I===void 0?Mi:I,g.miterLimit=S===void 0?Ai:S,g.strokeStyle=Me(v.getColor()||Oi)}l=this.textState_;var L=n.getFont()||Wa;Oc(L);var P=n.getScaleArray();l.overflow=n.getOverflow(),l.font=L,l.maxAngle=n.getMaxAngle(),l.placement=n.getPlacement(),l.textAlign=n.getTextAlign(),l.textBaseline=n.getTextBaseline()||Mr,l.backgroundFill=n.getBackgroundFill(),l.backgroundStroke=n.getBackgroundStroke(),l.padding=n.getPadding()||Rn,l.scale=P===void 0?[1,1]:P;var G=n.getOffsetX(),X=n.getOffsetY(),j=n.getRotateWithView(),U=n.getRotation();this.text_=n.getText()||"",this.textOffsetX_=G===void 0?0:G,this.textOffsetY_=X===void 0?0:X,this.textRotateWithView_=j===void 0?!1:j,this.textRotation_=U===void 0?0:U,this.strokeKey_=g?(typeof g.strokeStyle=="string"?g.strokeStyle:Q(g.strokeStyle))+g.lineCap+g.lineDashOffset+"|"+g.lineWidth+g.lineJoin+g.miterLimit+"["+g.lineDash.join()+"]":"",this.textKey_=l.font+l.scale+(l.textAlign||"?")+(l.textBaseline||"?"),this.fillKey_=f?typeof f.fillStyle=="string"?f.fillStyle:"|"+Q(f.fillStyle):""}this.declutterImageWithText_=a},o}(Ni),Sf=Cf,Af={Circle:el,Default:Ni,Image:pf,LineString:yf,Polygon:el,Text:Sf},Of=function(){function u(o,n,a,l){this.tolerance_=o,this.maxExtent_=n,this.pixelRatio_=l,this.resolution_=a,this.buildersByZIndex_={}}return u.prototype.finish=function(){var o={};for(var n in this.buildersByZIndex_){o[n]=o[n]||{};var a=this.buildersByZIndex_[n];for(var l in a){var f=a[l].finish();o[n][l]=f}}return o},u.prototype.getBuilder=function(o,n){var a=o!==void 0?o.toString():"0",l=this.buildersByZIndex_[a];l===void 0&&(l={},this.buildersByZIndex_[a]=l);var f=l[n];if(f===void 0){var g=Af[n];f=new g(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),l[n]=f}return f},u}(),nl=Of,Lf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Mf=function(u){Lf(o,u);function o(n){var a=u.call(this)||this;return a.ready=!0,a.boundHandleImageChange_=a.handleImageChange_.bind(a),a.layer_=n,a.declutterExecutorGroup=null,a}return o.prototype.getFeatures=function(n){return Z()},o.prototype.getData=function(n){return null},o.prototype.prepareFrame=function(n){return Z()},o.prototype.renderFrame=function(n,a){return Z()},o.prototype.loadedTileCallback=function(n,a,l){n[a]||(n[a]={}),n[a][l.tileCoord.toString()]=l},o.prototype.createLoadedTileFinder=function(n,a,l){return(function(f,g){var p=this.loadedTileCallback.bind(this,l,f);return n.forEachLoadedTile(a,f,g,p)}).bind(this)},o.prototype.forEachFeatureAtCoordinate=function(n,a,l,f,g){},o.prototype.getDataAtPixel=function(n,a,l){return null},o.prototype.getLayer=function(){return this.layer_},o.prototype.handleFontsChanged=function(){},o.prototype.handleImageChange_=function(n){var a=n.target;a.getState()===Pt.LOADED&&this.renderIfReadyAndVisible()},o.prototype.loadImage=function(n){var a=n.getState();return a!=Pt.LOADED&&a!=Pt.ERROR&&n.addEventListener(F.CHANGE,this.boundHandleImageChange_),a==Pt.IDLE&&(n.load(),a=n.getState()),a==Pt.LOADED},o.prototype.renderIfReadyAndVisible=function(){var n=this.getLayer();n.getVisible()&&n.getSourceState()==Ge.READY&&n.changed()},o.prototype.disposeInternal=function(){delete this.layer_,u.prototype.disposeInternal.call(this)},o}(et),Pf=Mf,Df=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ff=function(u){Df(o,u);function o(n,a,l,f){var g=u.call(this,n)||this;return g.inversePixelTransform=a,g.frameState=l,g.context=f,g}return o}(r),bf=Ff;new Array(6);function rn(){return[1,0,0,1,0,0]}function Nf(u,o,n,a,l,f,g){return u[0]=o,u[1]=n,u[2]=a,u[3]=l,u[4]=f,u[5]=g,u}function Gf(u,o){return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u}function re(u,o){var n=o[0],a=o[1];return o[0]=u[0]*n+u[2]*a+u[4],o[1]=u[1]*n+u[3]*a+u[5],o}function kf(u,o,n){return Nf(u,o,0,0,n,0,0)}function Bn(u,o,n,a,l,f,g,p){var v=Math.sin(f),E=Math.cos(f);return u[0]=a*E,u[1]=l*v,u[2]=-a*v,u[3]=l*E,u[4]=g*a*E-p*a*v+o,u[5]=g*l*v+p*l*E+n,u}function Xf(u,o){var n=zf(o);Vt(n!==0,32);var a=o[0],l=o[1],f=o[2],g=o[3],p=o[4],v=o[5];return u[0]=g/n,u[1]=-l/n,u[2]=-f/n,u[3]=a/n,u[4]=(f*v-g*p)/n,u[5]=-(a*v-l*p)/n,u}function zf(u){return u[0]*u[3]-u[1]*u[2]}var il;function Yf(u){var o="matrix("+u.join(", ")+")";if(Or)return o;var n=il||(il=document.createElement("div"));return n.style.transform=o,n.style.transform}var Bf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Gi=null;function Uf(){var u=document.createElement("canvas");u.width=1,u.height=1,Gi=u.getContext("2d")}var Wf=function(u){Bf(o,u);function o(n){var a=u.call(this,n)||this;return a.container=null,a.renderedResolution,a.tempTransform=rn(),a.pixelTransform=rn(),a.inversePixelTransform=rn(),a.context=null,a.containerReused=!1,a.pixelContext_=null,a.frameState=null,a}return o.prototype.getImageData=function(n,a,l){Gi||Uf(),Gi.clearRect(0,0,1,1);var f;try{Gi.drawImage(n,a,l,1,1,0,0,1,1),f=Gi.getImageData(0,0,1,1).data}catch{return null}return f},o.prototype.getBackground=function(n){var a=this.getLayer(),l=a.getBackground();return typeof l=="function"&&(l=l(n.viewState.resolution)),l||void 0},o.prototype.useContainer=function(n,a,l,f){var g=this.getLayer().getClassName(),p,v;if(n&&n.className===g&&n.style.opacity===""&&l===1&&(!f||n.style.backgroundColor&&y(Ar(n.style.backgroundColor),Ar(f)))){var E=n.firstElementChild;E instanceof HTMLCanvasElement&&(v=E.getContext("2d"))}if(v&&v.canvas.style.transform===a?(this.container=n,this.context=v,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){p=document.createElement("div"),p.className=g;var R=p.style;R.position="absolute",R.width="100%",R.height="100%",f&&(R.backgroundColor=f),v=ke();var E=v.canvas;p.appendChild(E),R=E.style,R.position="absolute",R.left="0",R.transformOrigin="top left",this.container=p,this.context=v}},o.prototype.clipUnrotated=function(n,a,l){var f=lf(l),g=hf(l),p=af(l),v=of(l);re(a.coordinateToPixelTransform,f),re(a.coordinateToPixelTransform,g),re(a.coordinateToPixelTransform,p),re(a.coordinateToPixelTransform,v);var E=this.inversePixelTransform;re(E,f),re(E,g),re(E,p),re(E,v),n.save(),n.beginPath(),n.moveTo(Math.round(f[0]),Math.round(f[1])),n.lineTo(Math.round(g[0]),Math.round(g[1])),n.lineTo(Math.round(p[0]),Math.round(p[1])),n.lineTo(Math.round(v[0]),Math.round(v[1])),n.clip()},o.prototype.dispatchRenderEvent_=function(n,a,l){var f=this.getLayer();if(f.hasListener(n)){var g=new bf(n,this.inversePixelTransform,l,a);f.dispatchEvent(g)}},o.prototype.preRender=function(n,a){this.frameState=a,this.dispatchRenderEvent_(Je.PRERENDER,n,a)},o.prototype.postRender=function(n,a){this.dispatchRenderEvent_(Je.POSTRENDER,n,a)},o.prototype.getRenderTransform=function(n,a,l,f,g,p,v){var E=g/2,R=p/2,I=f/a,S=-I,L=-n[0]+v,P=-n[1];return Bn(this.tempTransform,E,R,I,S,-l,L,P)},o.prototype.getDataAtPixel=function(n,a,l){var f=re(this.inversePixelTransform,n.slice()),g=this.context,p=this.getLayer(),v=p.getExtent();if(v){var E=re(a.pixelToCoordinateTransform,n.slice());if(!qa(v,E))return null}var R=Math.round(f[0]),I=Math.round(f[1]),S=this.pixelContext_;if(!S){var L=document.createElement("canvas");L.width=1,L.height=1,S=L.getContext("2d"),this.pixelContext_=S}S.clearRect(0,0,1,1);var P;try{S.drawImage(g.canvas,R,I,1,1,0,0,1,1),P=S.getImageData(0,0,1,1).data}catch(G){return G.name==="SecurityError"?(this.pixelContext_=null,new Uint8Array):P}return P[3]===0?null:P},o.prototype.disposeInternal=function(){delete this.frameState,u.prototype.disposeInternal.call(this)},o}(Pf),jf=Wf,Xt={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function Cn(u,o,n,a,l,f){for(var g=f||[],p=0,v=o;v<n;v+=a){var E=u[v],R=u[v+1];g[p++]=l[0]*E+l[2]*R+l[4],g[p++]=l[1]*E+l[3]*R+l[5]}return f&&g.length!=p&&(g.length=p),g}function rl(u,o,n,a,l,f,g){for(var p=g||[],v=Math.cos(l),E=Math.sin(l),R=f[0],I=f[1],S=0,L=o;L<n;L+=a){var P=u[L]-R,G=u[L+1]-I;p[S++]=R+P*v-G*E,p[S++]=I+P*E+G*v;for(var X=L+2;X<L+a;++X)p[S++]=u[X]}return g&&p.length!=S&&(p.length=S),p}function Vf(u,o,n,a,l,f,g,p){for(var v=p||[],E=g[0],R=g[1],I=0,S=o;S<n;S+=a){var L=u[S]-E,P=u[S+1]-R;v[I++]=E+l*L,v[I++]=R+f*P;for(var G=S+2;G<S+a;++G)v[I++]=u[G]}return p&&v.length!=I&&(v.length=I),v}function Zf(u,o,n,a,l,f,g){for(var p=g||[],v=0,E=o;E<n;E+=a){p[v++]=u[E]+l,p[v++]=u[E+1]+f;for(var R=E+2;R<E+a;++R)p[v++]=u[R]}return g&&p.length!=v&&(p.length=v),p}function Kf(u,o,n,a,l,f,g,p,v,E,R,I){var S=u[o],L=u[o+1],P=0,G=0,X=0,j=0;function U(){P=S,G=L,o+=a,S=u[o],L=u[o+1],j+=X,X=Math.sqrt((S-P)*(S-P)+(L-G)*(L-G))}do U();while(o<n-a&&j+X<f);for(var H=X===0?0:(f-j)/X,at=Ie(P,S,H),it=Ie(G,L,H),q=o-a,lt=j,tt=f+p*v(E,l,R);o<n-a&&j+X<tt;)U();H=X===0?0:(tt-j)/X;var ft=Ie(P,S,H),At=Ie(G,L,H),Dt;if(I){var mt=[at,it,ft,At];rl(mt,0,4,2,I,mt,mt),Dt=mt[0]>mt[2]}else Dt=at>ft;var xt=Math.PI,bt=[],Zt=q+a===o;o=q,X=0,j=lt,S=u[o],L=u[o+1];var Bt;if(Zt){U(),Bt=Math.atan2(L-G,S-P),Dt&&(Bt+=Bt>0?-xt:xt);var It=(ft+at)/2,zt=(At+it)/2;return bt[0]=[It,zt,(tt-f)/2,Bt,l],bt}for(var Lt=0,Ft=l.length;Lt<Ft;){U();var qt=Math.atan2(L-G,S-P);if(Dt&&(qt+=qt>0?-xt:xt),Bt!==void 0){var W=qt-Bt;if(W+=W>xt?-2*xt:W<-xt?2*xt:0,Math.abs(W)>g)return null}Bt=qt;for(var ue=Lt,Ee=0;Lt<Ft;++Lt){var Ui=Dt?Ft-Lt-1:Lt,Br=p*v(E,l[Ui],R);if(o+a<n&&j+X<f+Ee+Br/2)break;Ee+=Br}if(Lt!==ue){var lo=Dt?l.substring(Ft-ue,Ft-Lt):l.substring(ue,Lt);H=X===0?0:(f+Ee/2-j)/X;var It=Ie(P,S,H),zt=Ie(G,L,H);bt.push([It,zt,Ee/2,qt,lo]),f+=Ee}}return bt}function Hf(u,o,n,a){for(var l=u[o],f=u[o+1],g=0,p=o+a;p<n;p+=a){var v=u[p],E=u[p+1];g+=Math.sqrt((v-l)*(v-l)+(E-f)*(E-f)),l=v,f=E}return g}var Un=Fi(),sn=[],ze=[],Ye=[],on=[];function sl(u){return u[3].declutterBox}var $f=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function ol(u,o){return(o==="start"||o==="end")&&!$f.test(u)&&(o=o==="start"?"left":"right"),br[o]}function qf(u,o,n){return n>0&&u.push(`
`,""),u.push(o,""),u}var Jf=function(){function u(o,n,a,l){this.overlaps=a,this.pixelRatio=n,this.resolution=o,this.alignFill_,this.instructions=l.instructions,this.coordinates=l.coordinates,this.coordinateCache_={},this.renderedTransform_=rn(),this.hitDetectionInstructions=l.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=l.fillStates||{},this.strokeStates=l.strokeStates||{},this.textStates=l.textStates||{},this.widths_={},this.labels_={}}return u.prototype.createLabel=function(o,n,a,l){var f=o+n+a+l;if(this.labels_[f])return this.labels_[f];var g=l?this.strokeStates[l]:null,p=a?this.fillStates[a]:null,v=this.textStates[n],E=this.pixelRatio,R=[v.scale[0]*E,v.scale[1]*E],I=Array.isArray(o),S=ol(I?o[0]:o,v.textAlign||Li),L=l&&g.lineWidth?g.lineWidth:0,P=I?o:o.split(`
`).reduce(qf,[]),G=Mc(v,P),X=G.width,j=G.height,U=G.widths,H=G.heights,at=G.lineWidths,it=X+L,q=[],lt=(it+2)*R[0],tt=(j+L)*R[1],ft={width:lt<0?Math.floor(lt):Math.ceil(lt),height:tt<0?Math.floor(tt):Math.ceil(tt),contextInstructions:q};if((R[0]!=1||R[1]!=1)&&q.push("scale",R),l){q.push("strokeStyle",g.strokeStyle),q.push("lineWidth",L),q.push("lineCap",g.lineCap),q.push("lineJoin",g.lineJoin),q.push("miterLimit",g.miterLimit);var At=Or?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;At.prototype.setLineDash&&(q.push("setLineDash",[g.lineDash]),q.push("lineDashOffset",g.lineDashOffset))}a&&q.push("fillStyle",p.fillStyle),q.push("textBaseline","middle"),q.push("textAlign","center");for(var Dt=.5-S,mt=S*it+Dt*L,xt=[],bt=[],Zt=0,Bt=0,It=0,zt=0,Lt,Ft=0,qt=P.length;Ft<qt;Ft+=2){var W=P[Ft];if(W===`
`){Bt+=Zt,Zt=0,mt=S*it+Dt*L,++zt;continue}var ue=P[Ft+1]||v.font;ue!==Lt&&(l&&xt.push("font",ue),a&&bt.push("font",ue),Lt=ue),Zt=Math.max(Zt,H[It]);var Ee=[W,mt+Dt*U[It]+S*(U[It]-at[zt]),.5*(L+Zt)+Bt];mt+=U[It],l&&xt.push("strokeText",Ee),a&&bt.push("fillText",Ee),++It}return Array.prototype.push.apply(q,xt),Array.prototype.push.apply(q,bt),this.labels_[f]=ft,ft},u.prototype.replayTextBackground_=function(o,n,a,l,f,g,p){o.beginPath(),o.moveTo.apply(o,n),o.lineTo.apply(o,a),o.lineTo.apply(o,l),o.lineTo.apply(o,f),o.lineTo.apply(o,n),g&&(this.alignFill_=g[2],this.fill_(o)),p&&(this.setStrokeStyle_(o,p),o.stroke())},u.prototype.calculateImageOrLabelDimensions_=function(o,n,a,l,f,g,p,v,E,R,I,S,L,P,G,X){p*=S[0],v*=S[1];var j=a-p,U=l-v,H=f+E>o?o-E:f,at=g+R>n?n-R:g,it=P[3]+H*S[0]+P[1],q=P[0]+at*S[1]+P[2],lt=j-P[3],tt=U-P[0];(G||I!==0)&&(sn[0]=lt,on[0]=lt,sn[1]=tt,ze[1]=tt,ze[0]=lt+it,Ye[0]=ze[0],Ye[1]=tt+q,on[1]=Ye[1]);var ft;return I!==0?(ft=Bn(rn(),a,l,1,1,I,-a,-l),re(ft,sn),re(ft,ze),re(ft,Ye),re(ft,on),bi(Math.min(sn[0],ze[0],Ye[0],on[0]),Math.min(sn[1],ze[1],Ye[1],on[1]),Math.max(sn[0],ze[0],Ye[0],on[0]),Math.max(sn[1],ze[1],Ye[1],on[1]),Un)):bi(Math.min(lt,lt+it),Math.min(tt,tt+q),Math.max(lt,lt+it),Math.max(tt,tt+q),Un),L&&(j=Math.round(j),U=Math.round(U)),{drawImageX:j,drawImageY:U,drawImageW:H,drawImageH:at,originX:E,originY:R,declutterBox:{minX:Un[0],minY:Un[1],maxX:Un[2],maxY:Un[3],value:X},canvasTransform:ft,scale:S}},u.prototype.replayImageOrLabel_=function(o,n,a,l,f,g,p){var v=!!(g||p),E=l.declutterBox,R=o.canvas,I=p?p[2]*l.scale[0]/2:0,S=E.minX-I<=R.width/n&&E.maxX+I>=0&&E.minY-I<=R.height/n&&E.maxY+I>=0;return S&&(v&&this.replayTextBackground_(o,sn,ze,Ye,on,g,p),Pc(o,l.canvasTransform,f,a,l.originX,l.originY,l.drawImageW,l.drawImageH,l.drawImageX,l.drawImageY,l.scale)),!0},u.prototype.fill_=function(o){if(this.alignFill_){var n=re(this.renderedTransform_,[0,0]),a=512*this.pixelRatio;o.save(),o.translate(n[0]%a,n[1]%a),o.rotate(this.viewRotation_)}o.fill(),this.alignFill_&&o.restore()},u.prototype.setStrokeStyle_=function(o,n){o.strokeStyle=n[1],o.lineWidth=n[2],o.lineCap=n[3],o.lineJoin=n[4],o.miterLimit=n[5],o.setLineDash&&(o.lineDashOffset=n[7],o.setLineDash(n[6]))},u.prototype.drawLabelWithPointPlacement_=function(o,n,a,l){var f=this.textStates[n],g=this.createLabel(o,n,l,a),p=this.strokeStates[a],v=this.pixelRatio,E=ol(Array.isArray(o)?o[0]:o,f.textAlign||Li),R=br[f.textBaseline||Mr],I=p&&p.lineWidth?p.lineWidth:0,S=g.width/v-2*f.scale[0],L=E*S+2*(.5-E)*I,P=R*g.height/v+2*(.5-R)*I;return{label:g,anchorX:L,anchorY:P}},u.prototype.execute_=function(o,n,a,l,f,g,p,v){var E;this.pixelCoordinates_&&y(a,this.renderedTransform_)?E=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),E=Cn(this.coordinates,0,this.coordinates.length,2,a,this.pixelCoordinates_),Gf(this.renderedTransform_,a));for(var R=0,I=l.length,S=0,L,P,G,X,j,U,H,at,it,q,lt,tt,ft=0,At=0,Dt=null,mt=null,xt=this.coordinateCache_,bt=this.viewRotation_,Zt=Math.round(Math.atan2(-a[1],a[0])*1e12)/1e12,Bt={context:o,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:bt},It=this.instructions!=l||this.overlaps?0:200,zt,Lt,Ft,qt;R<I;){var W=l[R],ue=W[0];switch(ue){case rt.BEGIN_GEOMETRY:zt=W[1],qt=W[3],zt.getGeometry()?p!==void 0&&!Pe(p,qt.getExtent())?R=W[2]+1:++R:R=W[2];break;case rt.BEGIN_PATH:ft>It&&(this.fill_(o),ft=0),At>It&&(o.stroke(),At=0),!ft&&!At&&(o.beginPath(),X=NaN,j=NaN),++R;break;case rt.CIRCLE:S=W[1];var Ee=E[S],Ui=E[S+1],Br=E[S+2],lo=E[S+3],Fl=Br-Ee,bl=lo-Ui,Nl=Math.sqrt(Fl*Fl+bl*bl);o.moveTo(Ee+Nl,Ui),o.arc(Ee,Ui,Nl,0,2*Math.PI,!0),++R;break;case rt.CLOSE_PATH:o.closePath(),++R;break;case rt.CUSTOM:S=W[1],L=W[2];var jg=W[3],Vg=W[4],Gl=W.length==6?W[5]:void 0;Bt.geometry=jg,Bt.feature=zt,R in xt||(xt[R]=[]);var Wi=xt[R];Gl?Gl(E,S,L,2,Wi):(Wi[0]=E[S],Wi[1]=E[S+1],Wi.length=2),Vg(Wi,Bt),++R;break;case rt.DRAW_IMAGE:S=W[1],L=W[2],at=W[3],P=W[4],G=W[5];var ho=W[6],Zg=W[7],Kg=W[8],Hg=W[9],kl=W[10],uo=W[11],$g=W[12],Ur=W[13],ji=W[14];if(!at&&W.length>=19){it=W[18],q=W[19],lt=W[20],tt=W[21];var co=this.drawLabelWithPointPlacement_(it,q,lt,tt);at=co.label,W[3]=at;var qg=W[22];P=(co.anchorX-qg)*this.pixelRatio,W[4]=P;var Jg=W[23];G=(co.anchorY-Jg)*this.pixelRatio,W[5]=G,ho=at.height,W[6]=ho,Ur=at.width,W[13]=Ur}var fo=void 0;W.length>24&&(fo=W[24]);var go=void 0,Wr=void 0,jr=void 0;W.length>16?(go=W[15],Wr=W[16],jr=W[17]):(go=Rn,Wr=!1,jr=!1),kl&&Zt?uo+=bt:!kl&&!Zt&&(uo-=bt);for(var Qg=0;S<L;S+=2)if(!(fo&&fo[Qg++]<Ur/this.pixelRatio)){var Ue=this.calculateImageOrLabelDimensions_(at.width,at.height,E[S],E[S+1],Ur,ho,P,G,Kg,Hg,uo,$g,f,go,Wr||jr,zt),Xl=[o,n,at,Ue,Zg,Wr?Dt:null,jr?mt:null],Vr=void 0,_o=void 0;if(v&&ji){var Zr=L-S;if(!ji[Zr]){ji[Zr]=Xl;continue}if(Vr=ji[Zr],delete ji[Zr],_o=sl(Vr),v.collides(_o))continue}v&&v.collides(Ue.declutterBox)||(Vr&&(v&&v.insert(_o),this.replayImageOrLabel_.apply(this,Vr)),v&&v.insert(Ue.declutterBox),this.replayImageOrLabel_.apply(this,Xl))}++R;break;case rt.DRAW_CHARS:var zl=W[1],Yl=W[2],po=W[3],t_=W[4];tt=W[5];var e_=W[6],Bl=W[7],Ul=W[8];lt=W[9];var mo=W[10];it=W[11],q=W[12];var Wl=[W[13],W[13]],vo=this.textStates[q],Vi=vo.font,Zi=[vo.scale[0]*Bl,vo.scale[1]*Bl],Ki=void 0;Vi in this.widths_?Ki=this.widths_[Vi]:(Ki={},this.widths_[Vi]=Ki);var jl=Hf(E,zl,Yl,2),Vl=Math.abs(Zi[0])*Va(Vi,it,Ki);if(t_||Vl<=jl){var n_=this.textStates[q].textAlign,i_=(jl-Vl)*br[n_],Hi=Kf(E,zl,Yl,2,it,i_,e_,Math.abs(Zi[0]),Va,Vi,Ki,Zt?0:this.viewRotation_);t:if(Hi){var $i=[],hn=void 0,Kr=void 0,Hr=void 0,ce=void 0,xe=void 0;if(lt)for(hn=0,Kr=Hi.length;hn<Kr;++hn){xe=Hi[hn],Hr=xe[4],ce=this.createLabel(Hr,q,"",lt),P=xe[2]+(Zi[0]<0?-mo:mo),G=po*ce.height+(.5-po)*2*mo*Zi[1]/Zi[0]-Ul;var Ue=this.calculateImageOrLabelDimensions_(ce.width,ce.height,xe[0],xe[1],ce.width,ce.height,P,G,0,0,xe[3],Wl,!1,Rn,!1,zt);if(v&&v.collides(Ue.declutterBox))break t;$i.push([o,n,ce,Ue,1,null,null])}if(tt)for(hn=0,Kr=Hi.length;hn<Kr;++hn){xe=Hi[hn],Hr=xe[4],ce=this.createLabel(Hr,q,tt,""),P=xe[2],G=po*ce.height-Ul;var Ue=this.calculateImageOrLabelDimensions_(ce.width,ce.height,xe[0],xe[1],ce.width,ce.height,P,G,0,0,xe[3],Wl,!1,Rn,!1,zt);if(v&&v.collides(Ue.declutterBox))break t;$i.push([o,n,ce,Ue,1,null,null])}v&&v.load($i.map(sl));for(var yo=0,r_=$i.length;yo<r_;++yo)this.replayImageOrLabel_.apply(this,$i[yo])}}++R;break;case rt.END_GEOMETRY:if(g!==void 0){zt=W[1];var Zl=g(zt,qt);if(Zl)return Zl}++R;break;case rt.FILL:It?ft++:this.fill_(o),++R;break;case rt.MOVE_TO_LINE_TO:for(S=W[1],L=W[2],Lt=E[S],Ft=E[S+1],U=Lt+.5|0,H=Ft+.5|0,(U!==X||H!==j)&&(o.moveTo(Lt,Ft),X=U,j=H),S+=2;S<L;S+=2)Lt=E[S],Ft=E[S+1],U=Lt+.5|0,H=Ft+.5|0,(S==L-2||U!==X||H!==j)&&(o.lineTo(Lt,Ft),X=U,j=H);++R;break;case rt.SET_FILL_STYLE:Dt=W,this.alignFill_=W[2],ft&&(this.fill_(o),ft=0,At&&(o.stroke(),At=0)),o.fillStyle=W[1],++R;break;case rt.SET_STROKE_STYLE:mt=W,At&&(o.stroke(),At=0),this.setStrokeStyle_(o,W),++R;break;case rt.STROKE:It?At++:o.stroke(),++R;break;default:++R;break}}ft&&this.fill_(o),At&&o.stroke()},u.prototype.execute=function(o,n,a,l,f,g){this.viewRotation_=l,this.execute_(o,n,a,this.instructions,f,void 0,void 0,g)},u.prototype.executeHitDetection=function(o,n,a,l,f){return this.viewRotation_=a,this.execute_(o,1,n,this.hitDetectionInstructions,!0,l,f)},u}(),Qf=Jf,eo=[Xt.POLYGON,Xt.CIRCLE,Xt.LINE_STRING,Xt.IMAGE,Xt.TEXT,Xt.DEFAULT],td=function(){function u(o,n,a,l,f,g){this.maxExtent_=o,this.overlaps_=l,this.pixelRatio_=a,this.resolution_=n,this.renderBuffer_=g,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=rn(),this.createExecutors_(f)}return u.prototype.clip=function(o,n){var a=this.getClipCoords(n);o.beginPath(),o.moveTo(a[0],a[1]),o.lineTo(a[2],a[3]),o.lineTo(a[4],a[5]),o.lineTo(a[6],a[7]),o.clip()},u.prototype.createExecutors_=function(o){for(var n in o){var a=this.executorsByZIndex_[n];a===void 0&&(a={},this.executorsByZIndex_[n]=a);var l=o[n];for(var f in l){var g=l[f];a[f]=new Qf(this.resolution_,this.pixelRatio_,this.overlaps_,g)}}},u.prototype.hasExecutors=function(o){for(var n in this.executorsByZIndex_)for(var a=this.executorsByZIndex_[n],l=0,f=o.length;l<f;++l)if(o[l]in a)return!0;return!1},u.prototype.forEachFeatureAtCoordinate=function(o,n,a,l,f,g){l=Math.round(l);var p=l*2+1,v=Bn(this.hitDetectionTransform_,l+.5,l+.5,1/n,-1/n,-a,-o[0],-o[1]),E=!this.hitDetectionContext_;E&&(this.hitDetectionContext_=ke(p,p));var R=this.hitDetectionContext_;R.canvas.width!==p||R.canvas.height!==p?(R.canvas.width=p,R.canvas.height=p):E||R.clearRect(0,0,p,p);var I;this.renderBuffer_!==void 0&&(I=Fi(),nf(I,o),qs(I,n*(this.renderBuffer_+l),I));var S=ed(l),L;function P(q,lt){for(var tt=R.getImageData(0,0,p,p).data,ft=0,At=S.length;ft<At;ft++)if(tt[S[ft]]>0){if(!g||L!==Xt.IMAGE&&L!==Xt.TEXT||g.indexOf(q)!==-1){var Dt=(S[ft]-3)/4,mt=l-Dt%p,xt=l-(Dt/p|0),bt=f(q,lt,mt*mt+xt*xt);if(bt)return bt}R.clearRect(0,0,p,p);break}}var G=Object.keys(this.executorsByZIndex_).map(Number);G.sort(d);var X,j,U,H,at;for(X=G.length-1;X>=0;--X){var it=G[X].toString();for(U=this.executorsByZIndex_[it],j=eo.length-1;j>=0;--j)if(L=eo[j],H=U[L],H!==void 0&&(at=H.executeHitDetection(R,v,a,P,I),at))return at}},u.prototype.getClipCoords=function(o){var n=this.maxExtent_;if(!n)return null;var a=n[0],l=n[1],f=n[2],g=n[3],p=[a,l,a,g,f,g,f,l];return Cn(p,0,8,2,o,p),p},u.prototype.isEmpty=function(){return A(this.executorsByZIndex_)},u.prototype.execute=function(o,n,a,l,f,g,p){var v=Object.keys(this.executorsByZIndex_).map(Number);v.sort(d),this.maxExtent_&&(o.save(),this.clip(o,a));var E=g||eo,R,I,S,L,P,G;for(p&&v.reverse(),R=0,I=v.length;R<I;++R){var X=v[R].toString();for(P=this.executorsByZIndex_[X],S=0,L=E.length;S<L;++S){var j=E[S];G=P[j],G!==void 0&&G.execute(o,n,a,l,f,p)}}this.maxExtent_&&o.restore()},u}(),no={};function ed(u){if(no[u]!==void 0)return no[u];for(var o=u*2+1,n=u*u,a=new Array(n+1),l=0;l<=u;++l)for(var f=0;f<=u;++f){var g=l*l+f*f;if(g>n)break;var p=a[g];p||(p=[],a[g]=p),p.push(((u+l)*o+(u+f))*4+3),l>0&&p.push(((u-l)*o+(u+f))*4+3),f>0&&(p.push(((u+l)*o+(u-f))*4+3),l>0&&p.push(((u-l)*o+(u-f))*4+3))}for(var v=[],l=0,E=a.length;l<E;++l)a[l]&&v.push.apply(v,a[l]);return no[u]=v,v}var al=td,Nr={ANIMATING:0,INTERACTING:1},Wn={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},jn={};jn[Wn.RADIANS]=6370997/(2*Math.PI),jn[Wn.DEGREES]=2*Math.PI*6370997/360,jn[Wn.FEET]=.3048,jn[Wn.METERS]=1,jn[Wn.USFEET]=1200/3937;var io=Wn,nd=function(){function u(o){this.code_=o.code,this.units_=o.units,this.extent_=o.extent!==void 0?o.extent:null,this.worldExtent_=o.worldExtent!==void 0?o.worldExtent:null,this.axisOrientation_=o.axisOrientation!==void 0?o.axisOrientation:"enu",this.global_=o.global!==void 0?o.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=o.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=o.metersPerUnit}return u.prototype.canWrapX=function(){return this.canWrapX_},u.prototype.getCode=function(){return this.code_},u.prototype.getExtent=function(){return this.extent_},u.prototype.getUnits=function(){return this.units_},u.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||jn[this.units_]},u.prototype.getWorldExtent=function(){return this.worldExtent_},u.prototype.getAxisOrientation=function(){return this.axisOrientation_},u.prototype.isGlobal=function(){return this.global_},u.prototype.setGlobal=function(o){this.global_=o,this.canWrapX_=!!(o&&this.extent_)},u.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},u.prototype.setDefaultTileGrid=function(o){this.defaultTileGrid_=o},u.prototype.setExtent=function(o){this.extent_=o,this.canWrapX_=!!(this.global_&&o)},u.prototype.setWorldExtent=function(o){this.worldExtent_=o},u.prototype.setGetPointResolution=function(o){this.getPointResolutionFunc_=o},u.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},u}(),ll=nd,id=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ki=6378137,Vn=Math.PI*ki,rd=[-Vn,-Vn,Vn,Vn],sd=[-180,-85,180,85],Gr=ki*Math.log(Math.tan(Math.PI/2)),Zn=function(u){id(o,u);function o(n){return u.call(this,{code:n,units:io.METERS,extent:rd,global:!0,worldExtent:sd,getPointResolution:function(a,l){return a/bn(l[1]/ki)}})||this}return o}(ll),hl=[new Zn("EPSG:3857"),new Zn("EPSG:102100"),new Zn("EPSG:102113"),new Zn("EPSG:900913"),new Zn("http://www.opengis.net/def/crs/EPSG/0/3857"),new Zn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function od(u,o,n){var a=u.length,l=n>1?n:2,f=o;f===void 0&&(l>2?f=u.slice():f=new Array(a));for(var g=0;g<a;g+=l){f[g]=Vn*u[g]/180;var p=ki*Math.log(Math.tan(Math.PI*(+u[g+1]+90)/360));p>Gr?p=Gr:p<-Gr&&(p=-Gr),f[g+1]=p}return f}function ad(u,o,n){var a=u.length,l=n>1?n:2,f=o;f===void 0&&(l>2?f=u.slice():f=new Array(a));for(var g=0;g<a;g+=l)f[g]=180*u[g]/Vn,f[g+1]=360*Math.atan(Math.exp(u[g+1]/ki))/Math.PI-90;return f}var ld=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),hd=6378137,ul=[-180,-90,180,90],ud=Math.PI*hd/180,Sn=function(u){ld(o,u);function o(n,a){return u.call(this,{code:n,units:io.DEGREES,extent:ul,axisOrientation:a,global:!0,metersPerUnit:ud,worldExtent:ul})||this}return o}(ll),cl=[new Sn("CRS:84"),new Sn("EPSG:4326","neu"),new Sn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Sn("urn:ogc:def:crs:OGC:2:84"),new Sn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Sn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Sn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],ro={};function cd(u){return ro[u]||ro[u.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function fd(u,o){ro[u]=o}var Kn={};function kr(u,o,n){var a=u.getCode(),l=o.getCode();a in Kn||(Kn[a]={}),Kn[a][l]=n}function dd(u,o){var n;return u in Kn&&o in Kn[u]&&(n=Kn[u][o]),n}function gd(u,o){if(o.canWrapX()){var n=In(o.getExtent()),a=_d(u,o,n);a&&(u[0]-=a*n)}return u}function _d(u,o,n){var a=o.getExtent(),l=0;if(o.canWrapX()&&(u[0]<a[0]||u[0]>a[2])){var f=n||In(a);l=Math.floor((u[0]-a[0])/f)}return l}var pd=63710088e-1;function Xi(u,o,n){var a=pd,l=wn(u[1]),f=wn(o[1]),g=(f-l)/2,p=wn(o[0]-u[0])/2,v=Math.sin(g)*Math.sin(g)+Math.sin(p)*Math.sin(p)*Math.cos(l)*Math.cos(f);return 2*a*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))}function fl(u,o,n){var a;if(o!==void 0){for(var l=0,f=u.length;l<f;++l)o[l]=u[l];a=o}else a=u.slice();return a}function md(u,o,n){if(o!==void 0&&u!==o){for(var a=0,l=u.length;a<l;++a)o[a]=u[a];u=o}return u}function vd(u){fd(u.getCode(),u),kr(u,u,fl)}function yd(u){u.forEach(vd)}function Xr(u){return typeof u=="string"?cd(u):u||null}function dl(u){yd(u),u.forEach(function(o){u.forEach(function(n){o!==n&&kr(o,n,fl)})})}function Ed(u,o,n,a){u.forEach(function(l){o.forEach(function(f){kr(l,f,n),kr(f,l,a)})})}function xd(u,o){var n=u.getCode(),a=o.getCode(),l=dd(n,a);return l||(l=md),l}function so(u,o){var n=Xr(u),a=Xr(o);return xd(n,a)}function gl(u,o,n){var a=so(o,n);return a(u,void 0,u.length)}function wd(u,o){return u}function Rd(u,o){return u}function Td(){dl(hl),dl(cl),Ed(cl,hl,od,ad)}Td();var Id=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),_l=rn(),Cd=function(u){Id(o,u);function o(){var n=u.call(this)||this;return n.extent_=Fi(),n.extentRevision_=-1,n.simplifiedGeometryMaxMinSquaredTolerance=0,n.simplifiedGeometryRevision=0,n.simplifyTransformedInternal=C(function(a,l,f){if(!f)return this.getSimplifiedGeometry(l);var g=this.clone();return g.applyTransform(f),g.getSimplifiedGeometry(l)}),n}return o.prototype.simplifyTransformed=function(n,a){return this.simplifyTransformedInternal(this.getRevision(),n,a)},o.prototype.clone=function(){return Z()},o.prototype.closestPointXY=function(n,a,l,f){return Z()},o.prototype.containsXY=function(n,a){var l=this.getClosestPoint([n,a]);return l[0]===n&&l[1]===a},o.prototype.getClosestPoint=function(n,a){var l=a||[NaN,NaN];return this.closestPointXY(n[0],n[1],l,1/0),l},o.prototype.intersectsCoordinate=function(n){return this.containsXY(n[0],n[1])},o.prototype.computeExtent=function(n){return Z()},o.prototype.getExtent=function(n){if(this.extentRevision_!=this.getRevision()){var a=this.computeExtent(this.extent_);(isNaN(a[0])||isNaN(a[1]))&&Ja(a),this.extentRevision_=this.getRevision()}return uf(this.extent_,n)},o.prototype.rotate=function(n,a){Z()},o.prototype.scale=function(n,a,l){Z()},o.prototype.simplify=function(n){return this.getSimplifiedGeometry(n*n)},o.prototype.getSimplifiedGeometry=function(n){return Z()},o.prototype.getType=function(){return Z()},o.prototype.applyTransform=function(n){Z()},o.prototype.intersectsExtent=function(n){return Z()},o.prototype.translate=function(n,a){Z()},o.prototype.transform=function(n,a){var l=Xr(n),f=l.getUnits()==io.TILE_PIXELS?function(g,p,v){var E=l.getExtent(),R=l.getWorldExtent(),I=Fr(R)/Fr(E);return Bn(_l,R[0],R[3],I,-I,0,0,0),Cn(g,0,g.length,v,_l,p),so(l,a)(g,p,v)}:so(l,a);return this.applyTransform(f),this},o}(ut),Sd=Cd,Be={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},Ad=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Od=function(u){Ad(o,u);function o(){var n=u.call(this)||this;return n.layout=Be.XY,n.stride=2,n.flatCoordinates=null,n}return o.prototype.computeExtent=function(n){return ef(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,n)},o.prototype.getCoordinates=function(){return Z()},o.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},o.prototype.getFlatCoordinates=function(){return this.flatCoordinates},o.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},o.prototype.getLayout=function(){return this.layout},o.prototype.getSimplifiedGeometry=function(n){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),n<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&n<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var a=this.getSimplifiedGeometryInternal(n),l=a.getFlatCoordinates();return l.length<this.flatCoordinates.length?a:(this.simplifiedGeometryMaxMinSquaredTolerance=n,this)},o.prototype.getSimplifiedGeometryInternal=function(n){return this},o.prototype.getStride=function(){return this.stride},o.prototype.setFlatCoordinates=function(n,a){this.stride=pl(n),this.layout=n,this.flatCoordinates=a},o.prototype.setCoordinates=function(n,a){Z()},o.prototype.setLayout=function(n,a,l){var f;if(n)f=pl(n);else{for(var g=0;g<l;++g)if(a.length===0){this.layout=Be.XY,this.stride=2;return}else a=a[0];f=a.length,n=Ld(f)}this.layout=n,this.stride=f},o.prototype.applyTransform=function(n){this.flatCoordinates&&(n(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},o.prototype.rotate=function(n,a){var l=this.getFlatCoordinates();if(l){var f=this.getStride();rl(l,0,l.length,f,n,a,l),this.changed()}},o.prototype.scale=function(n,a,l){var f=a;f===void 0&&(f=n);var g=l;g||(g=Qs(this.getExtent()));var p=this.getFlatCoordinates();if(p){var v=this.getStride();Vf(p,0,p.length,v,n,f,g,p),this.changed()}},o.prototype.translate=function(n,a){var l=this.getFlatCoordinates();if(l){var f=this.getStride();Zf(l,0,l.length,f,n,a,l),this.changed()}},o}(Sd);function Ld(u){var o;return u==2?o=Be.XY:u==3?o=Be.XYZ:u==4&&(o=Be.XYZM),o}function pl(u){var o;return u==Be.XY?o=2:u==Be.XYZ||u==Be.XYM?o=3:u==Be.XYZM&&(o=4),o}function Md(u,o,n){var a=u.getFlatCoordinates();if(a){var l=u.getStride();return Cn(a,0,a.length,l,o,n)}else return null}var ml=Od,Pd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Dd=function(u){Pd(o,u);function o(n,a,l,f,g,p,v){var E=u.call(this)||this;return E.context_=n,E.pixelRatio_=a,E.extent_=l,E.transform_=f,E.viewRotation_=g,E.squaredTolerance_=p,E.userTransform_=v,E.contextFillState_=null,E.contextStrokeState_=null,E.contextTextState_=null,E.fillState_=null,E.strokeState_=null,E.image_=null,E.imageAnchorX_=0,E.imageAnchorY_=0,E.imageHeight_=0,E.imageOpacity_=0,E.imageOriginX_=0,E.imageOriginY_=0,E.imageRotateWithView_=!1,E.imageRotation_=0,E.imageScale_=[0,0],E.imageWidth_=0,E.text_="",E.textOffsetX_=0,E.textOffsetY_=0,E.textRotateWithView_=!1,E.textRotation_=0,E.textScale_=[0,0],E.textFillState_=null,E.textStrokeState_=null,E.textState_=null,E.pixelCoordinates_=[],E.tmpLocalTransform_=rn(),E}return o.prototype.drawImages_=function(n,a,l,f){if(this.image_){var g=Cn(n,a,l,f,this.transform_,this.pixelCoordinates_),p=this.context_,v=this.tmpLocalTransform_,E=p.globalAlpha;this.imageOpacity_!=1&&(p.globalAlpha=E*this.imageOpacity_);var R=this.imageRotation_;this.imageRotateWithView_&&(R+=this.viewRotation_);for(var I=0,S=g.length;I<S;I+=2){var L=g[I]-this.imageAnchorX_,P=g[I+1]-this.imageAnchorY_;if(R!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var G=L+this.imageAnchorX_,X=P+this.imageAnchorY_;Bn(v,G,X,1,1,R,-G,-X),p.setTransform.apply(p,v),p.translate(G,X),p.scale(this.imageScale_[0],this.imageScale_[1]),p.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),p.setTransform(1,0,0,1,0,0)}else p.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,L,P,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(p.globalAlpha=E)}},o.prototype.drawText_=function(n,a,l,f){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var g=Cn(n,a,l,f,this.transform_,this.pixelCoordinates_),p=this.context_,v=this.textRotation_;for(this.textRotateWithView_&&(v+=this.viewRotation_);a<l;a+=f){var E=g[a]+this.textOffsetX_,R=g[a+1]+this.textOffsetY_;if(v!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var I=Bn(this.tmpLocalTransform_,E,R,1,1,v,-E,-R);p.setTransform.apply(p,I),p.translate(E,R),p.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&p.strokeText(this.text_,0,0),this.textFillState_&&p.fillText(this.text_,0,0),p.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&p.strokeText(this.text_,E,R),this.textFillState_&&p.fillText(this.text_,E,R)}}},o.prototype.moveToLineTo_=function(n,a,l,f,g){var p=this.context_,v=Cn(n,a,l,f,this.transform_,this.pixelCoordinates_);p.moveTo(v[0],v[1]);var E=v.length;g&&(E-=2);for(var R=2;R<E;R+=2)p.lineTo(v[R],v[R+1]);return g&&p.closePath(),l},o.prototype.drawRings_=function(n,a,l,f){for(var g=0,p=l.length;g<p;++g)a=this.moveToLineTo_(n,a,l[g],f,!0);return a},o.prototype.drawCircle=function(n){if(Pe(this.extent_,n.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var a=Md(n,this.transform_,this.pixelCoordinates_),l=a[2]-a[0],f=a[3]-a[1],g=Math.sqrt(l*l+f*f),p=this.context_;p.beginPath(),p.arc(a[0],a[1],g,0,2*Math.PI),this.fillState_&&p.fill(),this.strokeState_&&p.stroke()}this.text_!==""&&this.drawText_(n.getCenter(),0,2,2)}},o.prototype.setStyle=function(n){this.setFillStrokeStyle(n.getFill(),n.getStroke()),this.setImageStyle(n.getImage()),this.setTextStyle(n.getText())},o.prototype.setTransform=function(n){this.transform_=n},o.prototype.drawGeometry=function(n){var a=n.getType();switch(a){case pt.POINT:this.drawPoint(n);break;case pt.LINE_STRING:this.drawLineString(n);break;case pt.POLYGON:this.drawPolygon(n);break;case pt.MULTI_POINT:this.drawMultiPoint(n);break;case pt.MULTI_LINE_STRING:this.drawMultiLineString(n);break;case pt.MULTI_POLYGON:this.drawMultiPolygon(n);break;case pt.GEOMETRY_COLLECTION:this.drawGeometryCollection(n);break;case pt.CIRCLE:this.drawCircle(n);break}},o.prototype.drawFeature=function(n,a){var l=a.getGeometryFunction()(n);!l||!Pe(this.extent_,l.getExtent())||(this.setStyle(a),this.drawGeometry(l))},o.prototype.drawGeometryCollection=function(n){for(var a=n.getGeometriesArray(),l=0,f=a.length;l<f;++l)this.drawGeometry(a[l])},o.prototype.drawPoint=function(n){this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var a=n.getFlatCoordinates(),l=n.getStride();this.image_&&this.drawImages_(a,0,a.length,l),this.text_!==""&&this.drawText_(a,0,a.length,l)},o.prototype.drawMultiPoint=function(n){this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var a=n.getFlatCoordinates(),l=n.getStride();this.image_&&this.drawImages_(a,0,a.length,l),this.text_!==""&&this.drawText_(a,0,a.length,l)},o.prototype.drawLineString=function(n){if(this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pe(this.extent_,n.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var a=this.context_,l=n.getFlatCoordinates();a.beginPath(),this.moveToLineTo_(l,0,l.length,n.getStride(),!1),a.stroke()}if(this.text_!==""){var f=n.getFlatMidpoint();this.drawText_(f,0,2,2)}}},o.prototype.drawMultiLineString=function(n){this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var a=n.getExtent();if(Pe(this.extent_,a)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var l=this.context_,f=n.getFlatCoordinates(),g=0,p=n.getEnds(),v=n.getStride();l.beginPath();for(var E=0,R=p.length;E<R;++E)g=this.moveToLineTo_(f,g,p[E],v,!1);l.stroke()}if(this.text_!==""){var I=n.getFlatMidpoints();this.drawText_(I,0,I.length,2)}}},o.prototype.drawPolygon=function(n){if(this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pe(this.extent_,n.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var a=this.context_;a.beginPath(),this.drawRings_(n.getOrientedFlatCoordinates(),0,n.getEnds(),n.getStride()),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}if(this.text_!==""){var l=n.getFlatInteriorPoint();this.drawText_(l,0,2,2)}}},o.prototype.drawMultiPolygon=function(n){if(this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pe(this.extent_,n.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var a=this.context_,l=n.getOrientedFlatCoordinates(),f=0,g=n.getEndss(),p=n.getStride();a.beginPath();for(var v=0,E=g.length;v<E;++v){var R=g[v];f=this.drawRings_(l,f,R,p)}this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}if(this.text_!==""){var I=n.getFlatInteriorPoints();this.drawText_(I,0,I.length,2)}}},o.prototype.setContextFillState_=function(n){var a=this.context_,l=this.contextFillState_;l?l.fillStyle!=n.fillStyle&&(l.fillStyle=n.fillStyle,a.fillStyle=n.fillStyle):(a.fillStyle=n.fillStyle,this.contextFillState_={fillStyle:n.fillStyle})},o.prototype.setContextStrokeState_=function(n){var a=this.context_,l=this.contextStrokeState_;l?(l.lineCap!=n.lineCap&&(l.lineCap=n.lineCap,a.lineCap=n.lineCap),a.setLineDash&&(y(l.lineDash,n.lineDash)||a.setLineDash(l.lineDash=n.lineDash),l.lineDashOffset!=n.lineDashOffset&&(l.lineDashOffset=n.lineDashOffset,a.lineDashOffset=n.lineDashOffset)),l.lineJoin!=n.lineJoin&&(l.lineJoin=n.lineJoin,a.lineJoin=n.lineJoin),l.lineWidth!=n.lineWidth&&(l.lineWidth=n.lineWidth,a.lineWidth=n.lineWidth),l.miterLimit!=n.miterLimit&&(l.miterLimit=n.miterLimit,a.miterLimit=n.miterLimit),l.strokeStyle!=n.strokeStyle&&(l.strokeStyle=n.strokeStyle,a.strokeStyle=n.strokeStyle)):(a.lineCap=n.lineCap,a.setLineDash&&(a.setLineDash(n.lineDash),a.lineDashOffset=n.lineDashOffset),a.lineJoin=n.lineJoin,a.lineWidth=n.lineWidth,a.miterLimit=n.miterLimit,a.strokeStyle=n.strokeStyle,this.contextStrokeState_={lineCap:n.lineCap,lineDash:n.lineDash,lineDashOffset:n.lineDashOffset,lineJoin:n.lineJoin,lineWidth:n.lineWidth,miterLimit:n.miterLimit,strokeStyle:n.strokeStyle})},o.prototype.setContextTextState_=function(n){var a=this.context_,l=this.contextTextState_,f=n.textAlign?n.textAlign:Li;l?(l.font!=n.font&&(l.font=n.font,a.font=n.font),l.textAlign!=f&&(l.textAlign=f,a.textAlign=f),l.textBaseline!=n.textBaseline&&(l.textBaseline=n.textBaseline,a.textBaseline=n.textBaseline)):(a.font=n.font,a.textAlign=f,a.textBaseline=n.textBaseline,this.contextTextState_={font:n.font,textAlign:f,textBaseline:n.textBaseline})},o.prototype.setFillStrokeStyle=function(n,a){var l=this;if(!n)this.fillState_=null;else{var f=n.getColor();this.fillState_={fillStyle:Me(f||Xe)}}if(!a)this.strokeState_=null;else{var g=a.getColor(),p=a.getLineCap(),v=a.getLineDash(),E=a.getLineDashOffset(),R=a.getLineJoin(),I=a.getWidth(),S=a.getMiterLimit(),L=v||Ci;this.strokeState_={lineCap:p!==void 0?p:Lr,lineDash:this.pixelRatio_===1?L:L.map(function(P){return P*l.pixelRatio_}),lineDashOffset:(E||Si)*this.pixelRatio_,lineJoin:R!==void 0?R:Xn,lineWidth:(I!==void 0?I:Mi)*this.pixelRatio_,miterLimit:S!==void 0?S:Ai,strokeStyle:Me(g||Oi)}}},o.prototype.setImageStyle=function(n){var a;if(!n||!(a=n.getSize())){this.image_=null;return}var l=n.getAnchor(),f=n.getOrigin();this.image_=n.getImage(this.pixelRatio_),this.imageAnchorX_=l[0]*this.pixelRatio_,this.imageAnchorY_=l[1]*this.pixelRatio_,this.imageHeight_=a[1]*this.pixelRatio_,this.imageOpacity_=n.getOpacity(),this.imageOriginX_=f[0],this.imageOriginY_=f[1],this.imageRotateWithView_=n.getRotateWithView(),this.imageRotation_=n.getRotation(),this.imageScale_=n.getScaleArray(),this.imageWidth_=a[0]*this.pixelRatio_},o.prototype.setTextStyle=function(n){if(!n)this.text_="";else{var a=n.getFill();if(!a)this.textFillState_=null;else{var l=a.getColor();this.textFillState_={fillStyle:Me(l||Xe)}}var f=n.getStroke();if(!f)this.textStrokeState_=null;else{var g=f.getColor(),p=f.getLineCap(),v=f.getLineDash(),E=f.getLineDashOffset(),R=f.getLineJoin(),I=f.getWidth(),S=f.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Lr,lineDash:v||Ci,lineDashOffset:E||Si,lineJoin:R!==void 0?R:Xn,lineWidth:I!==void 0?I:Mi,miterLimit:S!==void 0?S:Ai,strokeStyle:Me(g||Oi)}}var L=n.getFont(),P=n.getOffsetX(),G=n.getOffsetY(),X=n.getRotateWithView(),j=n.getRotation(),U=n.getScaleArray(),H=n.getText(),at=n.getTextAlign(),it=n.getTextBaseline();this.textState_={font:L!==void 0?L:Wa,textAlign:at!==void 0?at:Li,textBaseline:it!==void 0?it:Mr},this.text_=H!==void 0?Array.isArray(H)?H.reduce(function(q,lt,tt){return q+=tt%2?" ":lt},""):H:"",this.textOffsetX_=P!==void 0?this.pixelRatio_*P:0,this.textOffsetY_=G!==void 0?this.pixelRatio_*G:0,this.textRotateWithView_=X!==void 0?X:!1,this.textRotation_=j!==void 0?j:0,this.textScale_=[this.pixelRatio_*U[0],this.pixelRatio_*U[1]]}},o}($a),Fd=Dd,an={FRACTION:"fraction",PIXELS:"pixels"},ye={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},bd=function(){function u(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return u.prototype.clear=function(){this.cache_={},this.cacheSize_=0},u.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},u.prototype.expire=function(){if(this.canExpireCache()){var o=0;for(var n in this.cache_){var a=this.cache_[n];(o++&3)===0&&!a.hasListener()&&(delete this.cache_[n],--this.cacheSize_)}}},u.prototype.get=function(o,n,a){var l=vl(o,n,a);return l in this.cache_?this.cache_[l]:null},u.prototype.set=function(o,n,a,l){var f=vl(o,n,a);this.cache_[f]=l,++this.cacheSize_},u.prototype.setSize=function(o){this.maxCacheSize_=o,this.expire()},u}();function vl(u,o,n){var a=n?Xa(n):"null";return o+":"+u+":"+a}var yl=new bd,Nd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Gd=function(u){Nd(o,u);function o(n,a,l,f){var g=u.call(this)||this;return g.extent=n,g.pixelRatio_=l,g.resolution=a,g.state=f,g}return o.prototype.changed=function(){this.dispatchEvent(F.CHANGE)},o.prototype.getExtent=function(){return this.extent},o.prototype.getImage=function(){return Z()},o.prototype.getPixelRatio=function(){return this.pixelRatio_},o.prototype.getResolution=function(){return this.resolution},o.prototype.getState=function(){return this.state},o.prototype.load=function(){Z()},o}(b),kd=Gd,Xd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();(function(u){Xd(o,u);function o(n,a,l,f,g,p){var v=u.call(this,n,a,l,Pt.IDLE)||this;return v.src_=f,v.image_=new Image,g!==null&&(v.image_.crossOrigin=g),v.unlisten_=null,v.state=Pt.IDLE,v.imageLoadFunction_=p,v}return o.prototype.getImage=function(){return this.image_},o.prototype.handleImageError_=function(){this.state=Pt.ERROR,this.unlistenImage_(),this.changed()},o.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=Fr(this.extent)/this.image_.height),this.state=Pt.LOADED,this.unlistenImage_(),this.changed()},o.prototype.load=function(){(this.state==Pt.IDLE||this.state==Pt.ERROR)&&(this.state=Pt.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=El(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},o.prototype.setImage=function(n){this.image_=n,this.resolution=Fr(this.extent)/this.image_.height},o.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},o})(kd);function El(u,o,n){var a=u,l=!0,f=!1,g=!1,p=[V(a,F.LOAD,function(){g=!0,f||o()})];return a.src&&Ic?(f=!0,a.decode().then(function(){l&&o()}).catch(function(v){l&&(g?o():n())})):p.push(V(a,F.ERROR,n)),function(){l=!1,p.forEach(k)}}var zd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),zi=null,Yd=function(u){zd(o,u);function o(n,a,l,f,g,p){var v=u.call(this)||this;return v.hitDetectionImage_=null,v.image_=n||new Image,f!==null&&(v.image_.crossOrigin=f),v.canvas_={},v.color_=p,v.unlisten_=null,v.imageState_=g,v.size_=l,v.src_=a,v.tainted_,v}return o.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===Pt.LOADED){zi||(zi=ke(1,1)),zi.drawImage(this.image_,0,0);try{zi.getImageData(0,0,1,1),this.tainted_=!1}catch{zi=null,this.tainted_=!0}}return this.tainted_===!0},o.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(F.CHANGE)},o.prototype.handleImageError_=function(){this.imageState_=Pt.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},o.prototype.handleImageLoad_=function(){this.imageState_=Pt.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},o.prototype.getImage=function(n){return this.replaceColor_(n),this.canvas_[n]?this.canvas_[n]:this.image_},o.prototype.getPixelRatio=function(n){return this.replaceColor_(n),this.canvas_[n]?n:1},o.prototype.getImageState=function(){return this.imageState_},o.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var n=this.size_[0],a=this.size_[1],l=ke(n,a);l.fillRect(0,0,n,a),this.hitDetectionImage_=l.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},o.prototype.getSize=function(){return this.size_},o.prototype.getSrc=function(){return this.src_},o.prototype.load=function(){if(this.imageState_==Pt.IDLE){this.imageState_=Pt.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=El(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},o.prototype.replaceColor_=function(n){if(!(!this.color_||this.canvas_[n]||this.imageState_!==Pt.LOADED)){var a=document.createElement("canvas");this.canvas_[n]=a,a.width=Math.ceil(this.image_.width*n),a.height=Math.ceil(this.image_.height*n);var l=a.getContext("2d");if(l.scale(n,n),l.drawImage(this.image_,0,0),l.globalCompositeOperation="multiply",l.globalCompositeOperation==="multiply"||this.isTainted_())l.fillStyle=Xa(this.color_),l.fillRect(0,0,a.width/n,a.height/n),l.globalCompositeOperation="destination-in",l.drawImage(this.image_,0,0);else{for(var f=l.getImageData(0,0,a.width,a.height),g=f.data,p=this.color_[0]/255,v=this.color_[1]/255,E=this.color_[2]/255,R=this.color_[3],I=0,S=g.length;I<S;I+=4)g[I]*=p,g[I+1]*=v,g[I+2]*=E,g[I+3]*=R;l.putImageData(f,0,0)}}},o.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},o}(b);function Bd(u,o,n,a,l,f){var g=yl.get(o,a,f);return g||(g=new Yd(u,o,n,a,l,f),yl.set(o,a,f,g)),g}var Ud=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Wd=function(u){Ud(o,u);function o(n){var a=this,l=n||{},f=l.opacity!==void 0?l.opacity:1,g=l.rotation!==void 0?l.rotation:0,p=l.scale!==void 0?l.scale:1,v=l.rotateWithView!==void 0?l.rotateWithView:!1;a=u.call(this,{opacity:f,rotation:g,scale:p,displacement:l.displacement!==void 0?l.displacement:[0,0],rotateWithView:v})||this,a.anchor_=l.anchor!==void 0?l.anchor:[.5,.5],a.normalizedAnchor_=null,a.anchorOrigin_=l.anchorOrigin!==void 0?l.anchorOrigin:ye.TOP_LEFT,a.anchorXUnits_=l.anchorXUnits!==void 0?l.anchorXUnits:an.FRACTION,a.anchorYUnits_=l.anchorYUnits!==void 0?l.anchorYUnits:an.FRACTION,a.crossOrigin_=l.crossOrigin!==void 0?l.crossOrigin:null;var E=l.img!==void 0?l.img:null;a.imgSize_=l.imgSize;var R=l.src;Vt(!(R!==void 0&&E),4),Vt(!E||E&&a.imgSize_,5),(R===void 0||R.length===0)&&E&&(R=E.src||Q(E)),Vt(R!==void 0&&R.length>0,6);var I=l.src!==void 0?Pt.IDLE:Pt.LOADED;return a.color_=l.color!==void 0?Ar(l.color):null,a.iconImage_=Bd(E,R,a.imgSize_!==void 0?a.imgSize_:null,a.crossOrigin_,I,a.color_),a.offset_=l.offset!==void 0?l.offset:[0,0],a.offsetOrigin_=l.offsetOrigin!==void 0?l.offsetOrigin:ye.TOP_LEFT,a.origin_=null,a.size_=l.size!==void 0?l.size:null,a}return o.prototype.clone=function(){var n=this.getScale();return new o({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(n)?n.slice():n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc()})},o.prototype.getAnchor=function(){var n=this.normalizedAnchor_;if(!n){n=this.anchor_;var a=this.getSize();if(this.anchorXUnits_==an.FRACTION||this.anchorYUnits_==an.FRACTION){if(!a)return null;n=this.anchor_.slice(),this.anchorXUnits_==an.FRACTION&&(n[0]*=a[0]),this.anchorYUnits_==an.FRACTION&&(n[1]*=a[1])}if(this.anchorOrigin_!=ye.TOP_LEFT){if(!a)return null;n===this.anchor_&&(n=this.anchor_.slice()),(this.anchorOrigin_==ye.TOP_RIGHT||this.anchorOrigin_==ye.BOTTOM_RIGHT)&&(n[0]=-n[0]+a[0]),(this.anchorOrigin_==ye.BOTTOM_LEFT||this.anchorOrigin_==ye.BOTTOM_RIGHT)&&(n[1]=-n[1]+a[1])}this.normalizedAnchor_=n}var l=this.getDisplacement();return[n[0]-l[0],n[1]+l[1]]},o.prototype.setAnchor=function(n){this.anchor_=n,this.normalizedAnchor_=null},o.prototype.getColor=function(){return this.color_},o.prototype.getImage=function(n){return this.iconImage_.getImage(n)},o.prototype.getPixelRatio=function(n){return this.iconImage_.getPixelRatio(n)},o.prototype.getImageSize=function(){return this.iconImage_.getSize()},o.prototype.getImageState=function(){return this.iconImage_.getImageState()},o.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},o.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var n=this.offset_;if(this.offsetOrigin_!=ye.TOP_LEFT){var a=this.getSize(),l=this.iconImage_.getSize();if(!a||!l)return null;n=n.slice(),(this.offsetOrigin_==ye.TOP_RIGHT||this.offsetOrigin_==ye.BOTTOM_RIGHT)&&(n[0]=l[0]-a[0]-n[0]),(this.offsetOrigin_==ye.BOTTOM_LEFT||this.offsetOrigin_==ye.BOTTOM_RIGHT)&&(n[1]=l[1]-a[1]-n[1])}return this.origin_=n,this.origin_},o.prototype.getSrc=function(){return this.iconImage_.getSrc()},o.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},o.prototype.listenImageChange=function(n){this.iconImage_.addEventListener(F.CHANGE,n)},o.prototype.load=function(){this.iconImage_.load()},o.prototype.unlistenImageChange=function(n){this.iconImage_.removeEventListener(F.CHANGE,n)},o}(ka),jd=Wd,De=.5;function Vd(u,o,n,a,l,f,g){var p=u[0]*De,v=u[1]*De,E=ke(p,v);E.imageSmoothingEnabled=!1;for(var R=E.canvas,I=new Fd(E,De,l,null,g),S=n.length,L=Math.floor((256*256*256-1)/S),P={},G=1;G<=S;++G){var X=n[G-1],j=X.getStyleFunction()||a;if(a){var U=j(X,f);if(U){Array.isArray(U)||(U=[U]);for(var H=G*L,at="#"+("000000"+H.toString(16)).slice(-6),it=0,q=U.length;it<q;++it){var lt=U[it],tt=lt.getGeometryFunction()(X);if(!(!tt||!Pe(l,tt.getExtent()))){var ft=lt.clone(),At=ft.getFill();At&&At.setColor(at);var Dt=ft.getStroke();Dt&&(Dt.setColor(at),Dt.setLineDash(null)),ft.setText(void 0);var mt=lt.getImage();if(mt&&mt.getOpacity()!==0){var xt=mt.getImageSize();if(!xt)continue;var bt=ke(xt[0],xt[1],void 0,{alpha:!1}),Zt=bt.canvas;bt.fillStyle=at,bt.fillRect(0,0,Zt.width,Zt.height),ft.setImage(new jd({img:Zt,imgSize:xt,anchor:mt.getAnchor(),anchorXUnits:an.PIXELS,anchorYUnits:an.PIXELS,offset:mt.getOrigin(),opacity:1,size:mt.getSize(),scale:mt.getScale(),rotation:mt.getRotation(),rotateWithView:mt.getRotateWithView()}))}var Bt=ft.getZIndex()||0,It=P[Bt];It||(It={},P[Bt]=It,It[pt.POLYGON]=[],It[pt.CIRCLE]=[],It[pt.LINE_STRING]=[],It[pt.POINT]=[]),It[tt.getType().replace("Multi","")].push(tt,ft)}}}}}for(var zt=Object.keys(P).map(Number).sort(d),G=0,Lt=zt.length;G<Lt;++G){var It=P[zt[G]];for(var Ft in It)for(var qt=It[Ft],it=0,q=qt.length;it<q;it+=2){I.setStyle(qt[it+1]);for(var W=0,ue=o.length;W<ue;++W)I.setTransform(o[W]),I.drawGeometry(qt[it])}}return E.getImageData(0,0,R.width,R.height)}function Zd(u,o,n){var a=[];if(n){var l=Math.floor(Math.round(u[0])*De),f=Math.floor(Math.round(u[1])*De),g=(kt(l,0,n.width-1)+kt(f,0,n.height-1)*n.width)*4,p=n.data[g],v=n.data[g+1],E=n.data[g+2],R=E+256*(v+256*p),I=Math.floor((256*256*256-1)/o.length);R&&R%I===0&&a.push(o[R/I-1])}return a}var Kd=.5,xl={Point:ig,LineString:tg,Polygon:sg,MultiPoint:rg,MultiLineString:eg,MultiPolygon:ng,GeometryCollection:Qd,Circle:qd};function Hd(u,o){return parseInt(Q(u),10)-parseInt(Q(o),10)}function $d(u,o){var n=oo(u,o);return n*n}function oo(u,o){return Kd*u/o}function qd(u,o,n,a,l){var f=n.getFill(),g=n.getStroke();if(f||g){var p=u.getBuilder(n.getZIndex(),Xt.CIRCLE);p.setFillStrokeStyle(f,g),p.drawCircle(o,a)}var v=n.getText();if(v&&v.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(v),E.drawText(o,a)}}function wl(u,o,n,a,l,f,g){var p=!1,v=n.getImage();if(v){var E=v.getImageState();E==Pt.LOADED||E==Pt.ERROR?v.unlistenImageChange(l):(E==Pt.IDLE&&v.load(),E=v.getImageState(),v.listenImageChange(l),p=!0)}return Jd(u,o,n,a,f,g),p}function Jd(u,o,n,a,l,f){var g=n.getGeometryFunction()(o);if(g){var p=g.simplifyTransformed(a,l),v=n.getRenderer();if(v)Rl(u,p,n,o);else{var E=xl[p.getType()];E(u,p,n,o,f)}}}function Rl(u,o,n,a){if(o.getType()==pt.GEOMETRY_COLLECTION){for(var l=o.getGeometries(),f=0,g=l.length;f<g;++f)Rl(u,l[f],n,a);return}var p=u.getBuilder(n.getZIndex(),Xt.DEFAULT);p.drawCustom(o,a,n.getRenderer(),n.getHitDetectionRenderer())}function Qd(u,o,n,a,l){var f=o.getGeometriesArray(),g,p;for(g=0,p=f.length;g<p;++g){var v=xl[f[g].getType()];v(u,f[g],n,a,l)}}function tg(u,o,n,a,l){var f=n.getStroke();if(f){var g=u.getBuilder(n.getZIndex(),Xt.LINE_STRING);g.setFillStrokeStyle(null,f),g.drawLineString(o,a)}var p=n.getText();if(p&&p.getText()){var v=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);v.setTextStyle(p),v.drawText(o,a)}}function eg(u,o,n,a,l){var f=n.getStroke();if(f){var g=u.getBuilder(n.getZIndex(),Xt.LINE_STRING);g.setFillStrokeStyle(null,f),g.drawMultiLineString(o,a)}var p=n.getText();if(p&&p.getText()){var v=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);v.setTextStyle(p),v.drawText(o,a)}}function ng(u,o,n,a,l){var f=n.getFill(),g=n.getStroke();if(g||f){var p=u.getBuilder(n.getZIndex(),Xt.POLYGON);p.setFillStrokeStyle(f,g),p.drawMultiPolygon(o,a)}var v=n.getText();if(v&&v.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(v),E.drawText(o,a)}}function ig(u,o,n,a,l){var f=n.getImage(),g=n.getText(),p;if(l&&(u=l,p=f&&g&&g.getText()?{}:void 0),f){if(f.getImageState()!=Pt.LOADED)return;var v=u.getBuilder(n.getZIndex(),Xt.IMAGE);v.setImageStyle(f,p),v.drawPoint(o,a)}if(g&&g.getText()){var E=u.getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(g,p),E.drawText(o,a)}}function rg(u,o,n,a,l){var f=n.getImage(),g=n.getText(),p;if(l&&(u=l,p=f&&g&&g.getText()?{}:void 0),f){if(f.getImageState()!=Pt.LOADED)return;var v=u.getBuilder(n.getZIndex(),Xt.IMAGE);v.setImageStyle(f,p),v.drawMultiPoint(o,a)}if(g&&g.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(g,p),E.drawText(o,a)}}function sg(u,o,n,a,l){var f=n.getFill(),g=n.getStroke();if(f||g){var p=u.getBuilder(n.getZIndex(),Xt.POLYGON);p.setFillStrokeStyle(f,g),p.drawPolygon(o,a)}var v=n.getText();if(v&&v.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(v),E.drawText(o,a)}}var og=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ag=function(u){og(o,u);function o(n){var a=u.call(this,n)||this;return a.boundHandleStyleImageChange_=a.handleStyleImageChange_.bind(a),a.animatingOrInteracting_,a.dirty_=!1,a.hitDetectionImageData_=null,a.renderedFeatures_=null,a.renderedRevision_=-1,a.renderedResolution_=NaN,a.renderedExtent_=Fi(),a.wrappedRenderedExtent_=Fi(),a.renderedRotation_,a.renderedCenter_=null,a.renderedProjection_=null,a.renderedRenderOrder_=null,a.replayGroup_=null,a.replayGroupChanged=!0,a.declutterExecutorGroup=null,a.clipping=!0,a}return o.prototype.renderWorlds=function(n,a,l){var f=a.extent,g=a.viewState,p=g.center,v=g.resolution,E=g.projection,R=g.rotation,I=E.getExtent(),S=this.getLayer().getSource(),L=a.pixelRatio,P=a.viewHints,G=!(P[Nr.ANIMATING]||P[Nr.INTERACTING]),X=this.context,j=Math.round(a.size[0]*L),U=Math.round(a.size[1]*L),H=S.getWrapX()&&E.canWrapX(),at=H?In(I):null,it=H?Math.ceil((f[2]-I[2])/at)+1:1,q=H?Math.floor((f[0]-I[0])/at):0;do{var lt=this.getRenderTransform(p,v,R,L,j,U,q*at);n.execute(X,1,lt,R,G,void 0,l)}while(++q<it)},o.prototype.renderDeclutter=function(n){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,n,n.declutterTree)},o.prototype.renderFrame=function(n,a){var l=n.pixelRatio,f=n.layerStatesArray[n.layerIndex];kf(this.pixelTransform,1/l,1/l),Xf(this.inversePixelTransform,this.pixelTransform);var g=Yf(this.pixelTransform);this.useContainer(a,g,f.opacity,this.getBackground(n));var p=this.context,v=p.canvas,E=this.replayGroup_,R=this.declutterExecutorGroup;if((!E||E.isEmpty())&&(!R||R.isEmpty()))return null;var I=Math.round(n.size[0]*l),S=Math.round(n.size[1]*l);v.width!=I||v.height!=S?(v.width=I,v.height=S,v.style.transform!==g&&(v.style.transform=g)):this.containerReused||p.clearRect(0,0,I,S),this.preRender(p,n);var L=n.viewState;L.projection;var P=!1,G=!0;if(f.extent&&this.clipping){var X=Rd(f.extent);G=Pe(X,n.extent),P=G&&!Di(X,n.extent),P&&this.clipUnrotated(p,n,X)}G&&this.renderWorlds(E,n),P&&p.restore(),this.postRender(p,n);var j=Sc(f.opacity),U=this.container;return j!==U.style.opacity&&(U.style.opacity=j),this.renderedRotation_!==L.rotation&&(this.renderedRotation_=L.rotation,this.hitDetectionImageData_=null),this.container},o.prototype.getFeatures=function(n){return new Promise((function(a){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var l=[this.context.canvas.width,this.context.canvas.height];re(this.pixelTransform,l);var f=this.renderedCenter_,g=this.renderedResolution_,p=this.renderedRotation_,v=this.renderedProjection_,E=this.wrappedRenderedExtent_,R=this.getLayer(),I=[],S=l[0]*De,L=l[1]*De;I.push(this.getRenderTransform(f,g,p,De,S,L,0).slice());var P=R.getSource(),G=v.getExtent();if(P.getWrapX()&&v.canWrapX()&&!Di(G,E)){for(var X=E[0],j=In(G),U=0,H=void 0;X<G[0];)--U,H=j*U,I.push(this.getRenderTransform(f,g,p,De,S,L,H).slice()),X+=j;for(U=0,X=E[2];X>G[2];)++U,H=j*U,I.push(this.getRenderTransform(f,g,p,De,S,L,H).slice()),X-=j}this.hitDetectionImageData_=Vd(l,I,this.renderedFeatures_,R.getStyleFunction(),E,g,p)}a(Zd(n,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))},o.prototype.forEachFeatureAtCoordinate=function(n,a,l,f,g){var p=this;if(this.replayGroup_){var v=a.viewState.resolution,E=a.viewState.rotation,R=this.getLayer(),I={},S=function(G,X,j){var U=Q(G),H=I[U];if(H){if(H!==!0&&j<H.distanceSq){if(j===0)return I[U]=!0,g.splice(g.lastIndexOf(H),1),f(G,R,X);H.geometry=X,H.distanceSq=j}}else{if(j===0)return I[U]=!0,f(G,R,X);g.push(I[U]={feature:G,layer:R,geometry:X,distanceSq:j,callback:f})}},L,P=[this.replayGroup_];return this.declutterExecutorGroup&&P.push(this.declutterExecutorGroup),P.some(function(G){return L=G.forEachFeatureAtCoordinate(n,v,E,l,S,G===p.declutterExecutorGroup&&a.declutterTree?a.declutterTree.all().map(function(X){return X.value}):null)}),L}},o.prototype.handleFontsChanged=function(){var n=this.getLayer();n.getVisible()&&this.replayGroup_&&n.changed()},o.prototype.handleStyleImageChange_=function(n){this.renderIfReadyAndVisible()},o.prototype.prepareFrame=function(n){var a=this.getLayer(),l=a.getSource();if(!l)return!1;var f=n.viewHints[Nr.ANIMATING],g=n.viewHints[Nr.INTERACTING],p=a.getUpdateWhileAnimating(),v=a.getUpdateWhileInteracting();if(!this.dirty_&&!p&&f||!v&&g)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var E=n.extent,R=n.viewState,I=R.projection,S=R.resolution,L=n.pixelRatio,P=a.getRevision(),G=a.getRenderBuffer(),X=a.getRenderOrder();X===void 0&&(X=Hd);var j=R.center.slice(),U=qs(E,G*S),H=U.slice(),at=[U.slice()],it=I.getExtent();if(l.getWrapX()&&I.canWrapX()&&!Di(it,n.extent)){var q=In(it),lt=Math.max(In(U)/2,q);U[0]=it[0]-lt,U[2]=it[2]+lt,gd(j,I);var tt=cf(at[0],I);tt[0]<it[0]&&tt[2]<it[2]?at.push([tt[0]+q,tt[1],tt[2]+q,tt[3]]):tt[0]>it[0]&&tt[2]>it[2]&&at.push([tt[0]-q,tt[1],tt[2]-q,tt[3]])}if(!this.dirty_&&this.renderedResolution_==S&&this.renderedRevision_==P&&this.renderedRenderOrder_==X&&Di(this.wrappedRenderedExtent_,U))return y(this.renderedExtent_,H)||(this.hitDetectionImageData_=null,this.renderedExtent_=H),this.renderedCenter_=j,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var ft=new nl(oo(S,L),U,S,L),At;this.getLayer().getDeclutter()&&(At=new nl(oo(S,L),U,S,L));for(var Dt,mt,xt,mt=0,xt=at.length;mt<xt;++mt)l.loadFeatures(at[mt],S,I);var bt=$d(S,L),Zt=(function(Ft){var qt,W=Ft.getStyleFunction()||a.getStyleFunction();if(W&&(qt=W(Ft,S)),qt){var ue=this.renderFeature(Ft,bt,qt,ft,Dt,At);this.dirty_=this.dirty_||ue}}).bind(this),Bt=wd(U),It=l.getFeaturesInExtent(Bt);X&&It.sort(X);for(var mt=0,xt=It.length;mt<xt;++mt)Zt(It[mt]);this.renderedFeatures_=It;var zt=ft.finish(),Lt=new al(U,S,L,l.getOverlaps(),zt,a.getRenderBuffer());return At&&(this.declutterExecutorGroup=new al(U,S,L,l.getOverlaps(),At.finish(),a.getRenderBuffer())),this.renderedResolution_=S,this.renderedRevision_=P,this.renderedRenderOrder_=X,this.renderedExtent_=H,this.wrappedRenderedExtent_=U,this.renderedCenter_=j,this.renderedProjection_=I,this.replayGroup_=Lt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},o.prototype.renderFeature=function(n,a,l,f,g,p){if(!l)return!1;var v=!1;if(Array.isArray(l))for(var E=0,R=l.length;E<R;++E)v=wl(f,n,l[E],a,this.boundHandleStyleImageChange_,g,p)||v;else v=wl(f,n,l,a,this.boundHandleStyleImageChange_,g,p);return v},o}(jf),lg=ag,hg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ug=function(u){hg(o,u);function o(n){return u.call(this,n)||this}return o.prototype.createRenderer=function(){return new lg(this)},o}(Hc),cg=ug,Hn={ADD:"add",REMOVE:"remove"},Tl=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Il={LENGTH:"length"},zr=function(u){Tl(o,u);function o(n,a,l){var f=u.call(this,n)||this;return f.element=a,f.index=l,f}return o}(r),fg=function(u){Tl(o,u);function o(n,a){var l=u.call(this)||this;l.on,l.once,l.un;var f=a||{};if(l.unique_=!!f.unique,l.array_=n||[],l.unique_)for(var g=0,p=l.array_.length;g<p;++g)l.assertUnique_(l.array_[g],g);return l.updateLength_(),l}return o.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},o.prototype.extend=function(n){for(var a=0,l=n.length;a<l;++a)this.push(n[a]);return this},o.prototype.forEach=function(n){for(var a=this.array_,l=0,f=a.length;l<f;++l)n(a[l],l,a)},o.prototype.getArray=function(){return this.array_},o.prototype.item=function(n){return this.array_[n]},o.prototype.getLength=function(){return this.get(Il.LENGTH)},o.prototype.insertAt=function(n,a){this.unique_&&this.assertUnique_(a),this.array_.splice(n,0,a),this.updateLength_(),this.dispatchEvent(new zr(Hn.ADD,a,n))},o.prototype.pop=function(){return this.removeAt(this.getLength()-1)},o.prototype.push=function(n){this.unique_&&this.assertUnique_(n);var a=this.getLength();return this.insertAt(a,n),this.getLength()},o.prototype.remove=function(n){for(var a=this.array_,l=0,f=a.length;l<f;++l)if(a[l]===n)return this.removeAt(l)},o.prototype.removeAt=function(n){var a=this.array_[n];return this.array_.splice(n,1),this.updateLength_(),this.dispatchEvent(new zr(Hn.REMOVE,a,n)),a},o.prototype.setAt=function(n,a){var l=this.getLength();if(n<l){this.unique_&&this.assertUnique_(a,n);var f=this.array_[n];this.array_[n]=a,this.dispatchEvent(new zr(Hn.REMOVE,f,n)),this.dispatchEvent(new zr(Hn.ADD,a,n))}else{for(var g=l;g<n;++g)this.insertAt(g,void 0);this.insertAt(n,a)}},o.prototype.updateLength_=function(){this.set(Il.LENGTH,this.array_.length)},o.prototype.assertUnique_=function(n,a){for(var l=0,f=this.array_.length;l<f;++l)if(this.array_[l]===n&&l!==a)throw new ae(58)},o}(ut),dg=fg,gg=function(){function u(o){this.rbush_=new ba(o),this.items_={}}return u.prototype.insert=function(o,n){var a={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:n};this.rbush_.insert(a),this.items_[Q(n)]=a},u.prototype.load=function(o,n){for(var a=new Array(n.length),l=0,f=n.length;l<f;l++){var g=o[l],p=n[l],v={minX:g[0],minY:g[1],maxX:g[2],maxY:g[3],value:p};a[l]=v,this.items_[Q(p)]=v}this.rbush_.load(a)},u.prototype.remove=function(o){var n=Q(o),a=this.items_[n];return delete this.items_[n],this.rbush_.remove(a)!==null},u.prototype.update=function(o,n){var a=this.items_[Q(n)],l=[a.minX,a.minY,a.maxX,a.maxY];Qa(l,o)||(this.remove(n),this.insert(o,n))},u.prototype.getAll=function(){var o=this.rbush_.all();return o.map(function(n){return n.value})},u.prototype.getInExtent=function(o){var n={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]},a=this.rbush_.search(n);return a.map(function(l){return l.value})},u.prototype.forEach=function(o){return this.forEach_(this.getAll(),o)},u.prototype.forEachInExtent=function(o,n){return this.forEach_(this.getInExtent(o),n)},u.prototype.forEach_=function(o,n){for(var a,l=0,f=o.length;l<f;l++)if(a=n(o[l]),a)return a;return a},u.prototype.isEmpty=function(){return A(this.items_)},u.prototype.clear=function(){this.rbush_.clear(),this.items_={}},u.prototype.getExtent=function(o){var n=this.rbush_.toJSON();return bi(n.minX,n.minY,n.maxX,n.maxY,o)},u.prototype.concat=function(o){this.rbush_.load(o.rbush_.all());for(var n in o.items_)this.items_[n]=o.items_[n]},u}(),Cl=gg,_g=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),pg=function(u){_g(o,u);function o(n){var a=u.call(this)||this;a.projection=Xr(n.projection),a.attributions_=Sl(n.attributions),a.attributionsCollapsible_=n.attributionsCollapsible!==void 0?n.attributionsCollapsible:!0,a.loading=!1,a.state_=n.state!==void 0?n.state:Ge.READY,a.wrapX_=n.wrapX!==void 0?n.wrapX:!1,a.interpolate_=!!n.interpolate,a.viewResolver=null,a.viewRejector=null;var l=a;return a.viewPromise_=new Promise(function(f,g){l.viewResolver=f,l.viewRejector=g}),a}return o.prototype.getAttributions=function(){return this.attributions_},o.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},o.prototype.getProjection=function(){return this.projection},o.prototype.getResolutions=function(){return Z()},o.prototype.getView=function(){return this.viewPromise_},o.prototype.getState=function(){return this.state_},o.prototype.getWrapX=function(){return this.wrapX_},o.prototype.getInterpolate=function(){return this.interpolate_},o.prototype.refresh=function(){this.changed()},o.prototype.setAttributions=function(n){this.attributions_=Sl(n),this.changed()},o.prototype.setState=function(n){this.state_=n,this.changed()},o}(ut);function Sl(u){return u?Array.isArray(u)?function(o){return u}:typeof u=="function"?u:function(o){return[u]}:null}var mg=pg,Ce={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function vg(u,o){return[[-1/0,-1/0,1/0,1/0]]}var Yi={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},yg=!1;function Eg(u,o,n,a,l,f,g){var p=new XMLHttpRequest;p.open("GET",typeof u=="function"?u(n,a,l):u,!0),o.getType()==Yi.ARRAY_BUFFER&&(p.responseType="arraybuffer"),p.withCredentials=yg,p.onload=function(v){if(!p.status||p.status>=200&&p.status<300){var E=o.getType(),R=void 0;E==Yi.JSON||E==Yi.TEXT?R=p.responseText:E==Yi.XML?(R=p.responseXML,R||(R=new DOMParser().parseFromString(p.responseText,"application/xml"))):E==Yi.ARRAY_BUFFER&&(R=p.response),R?f(o.readFeatures(R,{extent:n,featureProjection:l}),o.readProjection(R)):g()}else g()},p.onerror=g,p.send()}function Al(u,o){return function(n,a,l,f,g){var p=this;Eg(u,o,n,a,l,function(v,E){p.addFeatures(v),f!==void 0&&f(v)},g||w)}}var Ol=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ln=function(u){Ol(o,u);function o(n,a,l){var f=u.call(this,n)||this;return f.feature=a,f.features=l,f}return o}(r),xg=function(u){Ol(o,u);function o(n){var a=this,l=n||{};a=u.call(this,{attributions:l.attributions,interpolate:!0,projection:void 0,state:Ge.READY,wrapX:l.wrapX!==void 0?l.wrapX:!0})||this,a.on,a.once,a.un,a.loader_=w,a.format_=l.format,a.overlaps_=l.overlaps===void 0?!0:l.overlaps,a.url_=l.url,l.loader!==void 0?a.loader_=l.loader:a.url_!==void 0&&(Vt(a.format_,7),a.loader_=Al(a.url_,a.format_)),a.strategy_=l.strategy!==void 0?l.strategy:vg;var f=l.useSpatialIndex!==void 0?l.useSpatialIndex:!0;a.featuresRtree_=f?new Cl:null,a.loadedExtentsRtree_=new Cl,a.loadingExtentsCount_=0,a.nullGeometryFeatures_={},a.idIndex_={},a.uidIndex_={},a.featureChangeKeys_={},a.featuresCollection_=null;var g,p;return Array.isArray(l.features)?p=l.features:l.features&&(g=l.features,p=g.getArray()),!f&&g===void 0&&(g=new dg(p)),p!==void 0&&a.addFeaturesInternal(p),g!==void 0&&a.bindFeaturesCollection_(g),a}return o.prototype.addFeature=function(n){this.addFeatureInternal(n),this.changed()},o.prototype.addFeatureInternal=function(n){var a=Q(n);if(!this.addToIndex_(a,n)){this.featuresCollection_&&this.featuresCollection_.remove(n);return}this.setupChangeEvents_(a,n);var l=n.getGeometry();if(l){var f=l.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(f,n)}else this.nullGeometryFeatures_[a]=n;this.dispatchEvent(new ln(Ce.ADDFEATURE,n))},o.prototype.setupChangeEvents_=function(n,a){this.featureChangeKeys_[n]=[B(a,F.CHANGE,this.handleFeatureChange_,this),B(a,s.PROPERTYCHANGE,this.handleFeatureChange_,this)]},o.prototype.addToIndex_=function(n,a){var l=!0,f=a.getId();return f!==void 0&&(f.toString()in this.idIndex_?l=!1:this.idIndex_[f.toString()]=a),l&&(Vt(!(n in this.uidIndex_),30),this.uidIndex_[n]=a),l},o.prototype.addFeatures=function(n){this.addFeaturesInternal(n),this.changed()},o.prototype.addFeaturesInternal=function(n){for(var a=[],l=[],f=[],g=0,p=n.length;g<p;g++){var v=n[g],E=Q(v);this.addToIndex_(E,v)&&l.push(v)}for(var g=0,R=l.length;g<R;g++){var v=l[g],E=Q(v);this.setupChangeEvents_(E,v);var I=v.getGeometry();if(I){var S=I.getExtent();a.push(S),f.push(v)}else this.nullGeometryFeatures_[E]=v}if(this.featuresRtree_&&this.featuresRtree_.load(a,f),this.hasListener(Ce.ADDFEATURE))for(var g=0,L=l.length;g<L;g++)this.dispatchEvent(new ln(Ce.ADDFEATURE,l[g]))},o.prototype.bindFeaturesCollection_=function(n){var a=!1;this.addEventListener(Ce.ADDFEATURE,function(l){a||(a=!0,n.push(l.feature),a=!1)}),this.addEventListener(Ce.REMOVEFEATURE,function(l){a||(a=!0,n.remove(l.feature),a=!1)}),n.addEventListener(Hn.ADD,(function(l){a||(a=!0,this.addFeature(l.element),a=!1)}).bind(this)),n.addEventListener(Hn.REMOVE,(function(l){a||(a=!0,this.removeFeature(l.element),a=!1)}).bind(this)),this.featuresCollection_=n},o.prototype.clear=function(n){if(n){for(var a in this.featureChangeKeys_){var l=this.featureChangeKeys_[a];l.forEach(k)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var f=(function(v){this.removeFeatureInternal(v)}).bind(this);this.featuresRtree_.forEach(f);for(var g in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[g])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var p=new ln(Ce.CLEAR);this.dispatchEvent(p),this.changed()},o.prototype.forEachFeature=function(n){if(this.featuresRtree_)return this.featuresRtree_.forEach(n);this.featuresCollection_&&this.featuresCollection_.forEach(n)},o.prototype.forEachFeatureAtCoordinateDirect=function(n,a){var l=[n[0],n[1],n[0],n[1]];return this.forEachFeatureInExtent(l,function(f){var g=f.getGeometry();if(g.intersectsCoordinate(n))return a(f)})},o.prototype.forEachFeatureInExtent=function(n,a){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(n,a);this.featuresCollection_&&this.featuresCollection_.forEach(a)},o.prototype.forEachFeatureIntersectingExtent=function(n,a){return this.forEachFeatureInExtent(n,function(l){var f=l.getGeometry();if(f.intersectsExtent(n)){var g=a(l);if(g)return g}})},o.prototype.getFeaturesCollection=function(){return this.featuresCollection_},o.prototype.getFeatures=function(){var n;return this.featuresCollection_?n=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(n=this.featuresRtree_.getAll(),A(this.nullGeometryFeatures_)||m(n,M(this.nullGeometryFeatures_))),n},o.prototype.getFeaturesAtCoordinate=function(n){var a=[];return this.forEachFeatureAtCoordinateDirect(n,function(l){a.push(l)}),a},o.prototype.getFeaturesInExtent=function(n){return this.featuresRtree_?this.featuresRtree_.getInExtent(n):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},o.prototype.getClosestFeatureToCoordinate=function(n,a){var l=n[0],f=n[1],g=null,p=[NaN,NaN],v=1/0,E=[-1/0,-1/0,1/0,1/0],R=a||x;return this.featuresRtree_.forEachInExtent(E,function(I){if(R(I)){var S=I.getGeometry(),L=v;if(v=S.closestPointXY(l,f,p,v),v<L){g=I;var P=Math.sqrt(v);E[0]=l-P,E[1]=f-P,E[2]=l+P,E[3]=f+P}}}),g},o.prototype.getExtent=function(n){return this.featuresRtree_.getExtent(n)},o.prototype.getFeatureById=function(n){var a=this.idIndex_[n.toString()];return a!==void 0?a:null},o.prototype.getFeatureByUid=function(n){var a=this.uidIndex_[n];return a!==void 0?a:null},o.prototype.getFormat=function(){return this.format_},o.prototype.getOverlaps=function(){return this.overlaps_},o.prototype.getUrl=function(){return this.url_},o.prototype.handleFeatureChange_=function(n){var a=n.target,l=Q(a),f=a.getGeometry();if(!f)l in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(a),this.nullGeometryFeatures_[l]=a);else{var g=f.getExtent();l in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[l],this.featuresRtree_&&this.featuresRtree_.insert(g,a)):this.featuresRtree_&&this.featuresRtree_.update(g,a)}var p=a.getId();if(p!==void 0){var v=p.toString();this.idIndex_[v]!==a&&(this.removeFromIdIndex_(a),this.idIndex_[v]=a)}else this.removeFromIdIndex_(a),this.uidIndex_[l]=a;this.changed(),this.dispatchEvent(new ln(Ce.CHANGEFEATURE,a))},o.prototype.hasFeature=function(n){var a=n.getId();return a!==void 0?a in this.idIndex_:Q(n)in this.uidIndex_},o.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&A(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0},o.prototype.loadFeatures=function(n,a,l){for(var f=this.loadedExtentsRtree_,g=this.strategy_(n,a,l),p=function(I,S){var L=g[I],P=f.forEachInExtent(L,function(G){return Di(G.extent,L)});P||(++v.loadingExtentsCount_,v.dispatchEvent(new ln(Ce.FEATURESLOADSTART)),v.loader_.call(v,L,a,l,(function(G){--this.loadingExtentsCount_,this.dispatchEvent(new ln(Ce.FEATURESLOADEND,void 0,G))}).bind(v),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new ln(Ce.FEATURESLOADERROR))}).bind(v)),f.insert(L,{extent:L.slice()}))},v=this,E=0,R=g.length;E<R;++E)p(E);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},o.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),u.prototype.refresh.call(this)},o.prototype.removeLoadedExtent=function(n){var a=this.loadedExtentsRtree_,l;a.forEachInExtent(n,function(f){if(Qa(f.extent,n))return l=f,!0}),l&&a.remove(l)},o.prototype.removeFeature=function(n){if(n){var a=Q(n);a in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[a]:this.featuresRtree_&&this.featuresRtree_.remove(n);var l=this.removeFeatureInternal(n);l&&this.changed()}},o.prototype.removeFeatureInternal=function(n){var a=Q(n),l=this.featureChangeKeys_[a];if(l){l.forEach(k),delete this.featureChangeKeys_[a];var f=n.getId();return f!==void 0&&delete this.idIndex_[f.toString()],delete this.uidIndex_[a],this.dispatchEvent(new ln(Ce.REMOVEFEATURE,n)),n}},o.prototype.removeFromIdIndex_=function(n){var a=!1;for(var l in this.idIndex_)if(this.idIndex_[l]===n){delete this.idIndex_[l],a=!0;break}return a},o.prototype.setLoader=function(n){this.loader_=n},o.prototype.setUrl=function(n){Vt(this.format_,7),this.url_=n,this.setLoader(Al(n,this.format_))},o}(mg),wg=xg,Rg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Tg=function(u){Rg(o,u);function o(n){var a=u.call(this)||this;if(a.on,a.once,a.un,a.id_=void 0,a.geometryName_="geometry",a.style_=null,a.styleFunction_=void 0,a.geometryChangeKey_=null,a.addChangeListener(a.geometryName_,a.handleGeometryChanged_),n)if(typeof n.getSimplifiedGeometry=="function"){var l=n;a.setGeometry(l)}else{var f=n;a.setProperties(f)}return a}return o.prototype.clone=function(){var n=new o(this.hasProperties()?this.getProperties():null);n.setGeometryName(this.getGeometryName());var a=this.getGeometry();a&&n.setGeometry(a.clone());var l=this.getStyle();return l&&n.setStyle(l),n},o.prototype.getGeometry=function(){return this.get(this.geometryName_)},o.prototype.getId=function(){return this.id_},o.prototype.getGeometryName=function(){return this.geometryName_},o.prototype.getStyle=function(){return this.style_},o.prototype.getStyleFunction=function(){return this.styleFunction_},o.prototype.handleGeometryChange_=function(){this.changed()},o.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(k(this.geometryChangeKey_),this.geometryChangeKey_=null);var n=this.getGeometry();n&&(this.geometryChangeKey_=B(n,F.CHANGE,this.handleGeometryChange_,this)),this.changed()},o.prototype.setGeometry=function(n){this.set(this.geometryName_,n)},o.prototype.setStyle=function(n){this.style_=n,this.styleFunction_=n?Ig(n):void 0,this.changed()},o.prototype.setId=function(n){this.id_=n,this.changed()},o.prototype.setGeometryName=function(n){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=n,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},o}(ut);function Ig(u){if(typeof u=="function")return u;var o;if(Array.isArray(u))o=u;else{Vt(typeof u.getZIndex=="function",41);var n=u;o=[n]}return function(){return o}}var Cg=Tg;function Sg(u,o,n,a){for(var l=0,f=n.length;l<f;++l)u[o++]=n[l];return o}function Ag(u,o,n,a){for(var l=0,f=n.length;l<f;++l)for(var g=n[l],p=0;p<a;++p)u[o++]=g[p];return o}var Og=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Lg=function(u){Og(o,u);function o(n,a){var l=u.call(this)||this;return l.setCoordinates(n,a),l}return o.prototype.clone=function(){var n=new o(this.flatCoordinates.slice(),this.layout);return n.applyProperties(this),n},o.prototype.closestPointXY=function(n,a,l,f){var g=this.flatCoordinates,p=xn(n,a,g[0],g[1]);if(p<f){for(var v=this.stride,E=0;E<v;++E)l[E]=g[E];return l.length=v,p}else return f},o.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},o.prototype.computeExtent=function(n){return tf(this.flatCoordinates,n)},o.prototype.getType=function(){return pt.POINT},o.prototype.intersectsExtent=function(n){return Js(n,this.flatCoordinates[0],this.flatCoordinates[1])},o.prototype.setCoordinates=function(n,a){this.setLayout(a,n,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Sg(this.flatCoordinates,0,n,this.stride),this.changed()},o}(ml),Yr=Lg,Mg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Pg=function(u){Mg(o,u);function o(n,a){var l=u.call(this)||this;return a&&!Array.isArray(n[0])?l.setFlatCoordinates(a,n):l.setCoordinates(n,a),l}return o.prototype.appendPoint=function(n){this.flatCoordinates?m(this.flatCoordinates,n.getFlatCoordinates()):this.flatCoordinates=n.getFlatCoordinates().slice(),this.changed()},o.prototype.clone=function(){var n=new o(this.flatCoordinates.slice(),this.layout);return n.applyProperties(this),n},o.prototype.closestPointXY=function(n,a,l,f){if(f<Jc(this.getExtent(),n,a))return f;for(var g=this.flatCoordinates,p=this.stride,v=0,E=g.length;v<E;v+=p){var R=xn(n,a,g[v],g[v+1]);if(R<f){f=R;for(var I=0;I<p;++I)l[I]=g[v+I];l.length=p}}return f},o.prototype.getCoordinates=function(){return Yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},o.prototype.getPoint=function(n){var a=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return n<0||a<=n?null:new Yr(this.flatCoordinates.slice(n*this.stride,(n+1)*this.stride),this.layout)},o.prototype.getPoints=function(){for(var n=this.flatCoordinates,a=this.layout,l=this.stride,f=[],g=0,p=n.length;g<p;g+=l){var v=new Yr(n.slice(g,g+l),a);f.push(v)}return f},o.prototype.getType=function(){return pt.MULTI_POINT},o.prototype.intersectsExtent=function(n){for(var a=this.flatCoordinates,l=this.stride,f=0,g=a.length;f<g;f+=l){var p=a[f],v=a[f+1];if(Js(n,p,v))return!0}return!1},o.prototype.setCoordinates=function(n,a){this.setLayout(a,n,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ag(this.flatCoordinates,0,n,this.stride),this.changed()},o}(ml),Dg=Pg;const Fg=[0,0],Ll=10,bg=64;class Ng extends Yt{constructor(o){const n=o||{};super(n),this.originCoordinate=n.originCoordinate||Fg,this.rotationAnchorCoordinate=n.rotationAnchorCoordinate||null,this.xGridSize=n.xGridSize||Ll,this.yGridSize=n.yGridSize||Ll,this.maxPointsPerSide=n.maxPointsPerSide||bg,this.overlay_=new cg({source:Wg(),style:n.style,updateWhileInteracting:!0}),this.gridFeature_=new Cg({geometry:new Dg([])}),this.updateGridDescription_(),this.overlay_.getSource().addFeature(this.gridFeature_),this.overlay_.on("postrender",this.handleGridLayerPostRender_.bind(this)),this.addEventListener("change:active",this.updateState_)}getGridFeature(){return this.gridFeature_}setOriginPoint(o){this.originCoordinate=o,this.updateGridDescription_()}setRotationControlPoint(o){this.rotationAnchorCoordinate=o,this.updateGridDescription_()}setXGridSize(o){this.xGridSize=o,this.updateGridDescription_()}setYGridSize(o){this.yGridSize=o,this.updateGridDescription_()}setMaxPointsPerSide(o){this.maxPointsPerSide=o,this.changed()}setStyle(o){this.overlay_.setStyle(o)}setMap(o){super.setMap(o),this.updateState_()}updateState_(){const o=this.getMap(),n=this.getActive();this.overlay_.setMap(n?o:null),this.updateGridDescription_()}updateGridDescription_(){const o=this.getMap();if(!o||!this.originCoordinate||!this.xGridSize||!this.yGridSize||!this.getActive()){this.gridDescription_=null,this.lastGridDescription_=null,this.gridFeature_.getGeometry().setCoordinates([]),this.changed();return}const n=o.getView().getProjection(),a=gl(this.originCoordinate,n,"EPSG:4326"),l=this.rotationAnchorCoordinate||ao(this.originCoordinate,[1,0]),f=gl(l,n,"EPSG:4326"),g=[a[0],f[1]],p=[f[0],a[1]],v=Xi(a,f);let E=Xi(a,g),R=Xi(a,p);a[0]>f[0]&&(R*=-1),a[1]>f[1]&&(E*=-1);const I=E/v,S=R/v;this.gridDescription_,this.gridDescription_={originCoordinate:this.originCoordinate,riseFactor:I,runFactor:S,xDim:this.xGridSize,yDim:this.yGridSize},this.changed()}changed(){super.changed(),this.overlay_.changed()}handleGridLayerPostRender_(o){const n=this.getMap(),a=this.gridDescription_;if(!a)return;const l=n.getView().calculateExtent(n.getSize()),f=a===this.lastGridDescription_||JSON.stringify(a)===JSON.stringify(this.lastGridDescription_),g=l===this.lastViewExtent_||JSON.stringify(l)===JSON.stringify(this.lastViewExtent_);if(f&&g)return;const p=a.originCoordinate;let v=[a.xDim*a.runFactor,a.xDim*a.riseFactor],E=[a.yDim*-1*a.riseFactor,a.yDim*a.runFactor];const R=this.calculateLocalSphereNormalizationCoefficients(new Yr(a.originCoordinate));v=Dl(v,R),E=Dl(E,R);const I=Qs(l),S=Bi(p,v,E,I),L=ao(p,Ml([v,E],S)),P=new Yr(L),G=Bg(L,v,E,l),X=Ug(l,P,G,v,E,this.maxPointsPerSide);this.lastGridDescription_=a,this.lastViewExtent_=l,this.gridFeature_.getGeometry().setCoordinates(X)}calculateLocalSphereNormalizationCoefficients(o){const n=this.getMap().getView().getProjection().getCode();function a(v){return v.transform(n,"EPSG:4326").getCoordinates()}function l(v,E,R){const I=v.clone();return I.translate(E,R),I}const f=a(o.clone()),g=a(l(o,1,0)),p=a(l(o,0,1));return[1/Xi(f,g),1/Xi(f,p)]}}function Gg(u,o,n,a,l){const f=Pl(a,o),g=Pl(l,n),p=u.clone();return p.setCoordinates(ao(u.getCoordinates(),f,g)),p}function kg(u){const o=u[0][0],n=u[0][1],a=u[1][0],l=u[1][1],f=o*l-n*a;return[[l/f,-n/f],[-a/f,o/f]]}function Ml(u,o){const n=u[0][0],a=u[0][1],l=u[1][0],f=u[1][1],g=o[0],p=o[1];return[n*g+l*p,a*g+f*p]}function Xg(u,o,n){const a=kg([u,o]);return Ml(a,n)}function zg(u,o,n,a){const l=a||Math.round,f=Xg(u,o,n);return[l(f[0]),l(f[1])]}function Yg(u,o){return[u[0]-o[0],u[1]-o[1]]}function ao(u,o,n){return n?[u[0]+o[0]+n[0],u[1]+o[1]+n[1]]:[u[0]+o[0],u[1]+o[1]]}function Pl(u,o){return[u[0]*o,u[1]*o]}function Dl(u,o){return[u[0]*o[0],u[1]*o[1]]}function Bi(u,o,n,a,l){const f=Yg(a,u);return zg(o,n,f,l)}function Bg(u,o,n,a){return[Bi(u,o,n,[a[0],a[1]],Math.ceil),Bi(u,o,n,[a[2],a[3]],Math.ceil),Bi(u,o,n,[a[0],a[3]],Math.ceil),Bi(u,o,n,[a[2],a[1]],Math.ceil)]}function Ug(u,o,n,a,l,f){const g=n[0][0],p=n[0][1],v=n[1][0],E=n[1][1],R=n[2][0],I=n[2][1],S=n[3][0],L=n[3][1],P=Math.min(g,v,R,S),G=Math.min(p,E,I,L),X=Math.max(g,v,R,S),j=Math.max(p,E,I,L),U=X-P,H=j-G,at=Math.max(1,Math.floor(U/f)),it=Math.max(1,Math.floor(H/f)),q=[];for(let lt=P;lt<=X;lt+=at)for(let tt=G;tt<=j;tt+=it){const ft=Gg(o,lt,tt,a,l);ft.intersectsExtent(u)&&q.push(ft.getCoordinates())}return q}function Wg(){const u=new wg({useSpatialIndex:!1,features:[],wrapX:!1});return u.getFeaturesInExtent=u.getFeatures,u}return Ng})}(as)),as.exports}var Ky=Zy();const Hy=jy(Ky),$y="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5%201H6V5H10V6H6V10H5V6H1L1%205H5V1Z'%20fill='white'/%3e%3c/svg%3e",qy=new py({sources:[new Wy({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})],operation:function(i){const s=.13793103448275862,h=6/29,c=3*h*h,d=h*h*h,_=2*Math.PI;function m(A){const D=255-A[0],z=255-A[1],b=255-A[2];return A[0]=D,A[1]=z,A[2]=b,A}function y(A){const D=T(A[0]),z=T(A[1]),b=T(A[2]),F=w((.4124564*D+.3575761*z+.1804375*b)/.95047),B=w((.2126729*D+.7151522*z+.072175*b)/1),V=w((.0193339*D+.119192*z+.9503041*b)/1.08883),k=116*B-16,K=500*(F-B),Y=200*(B-V),st=Math.sqrt(K*K+Y*Y);let et=Math.atan2(Y,K);return et<0&&(et+=_),A[0]=et,A[1]=st,A[2]=k,A}function x(A){const D=A[0],z=A[1],b=A[2],F=Math.cos(D)*z,B=Math.sin(D)*z;let V=(b+16)/116,k=isNaN(F)?V:V+F/500,K=isNaN(B)?V:V-B/200;return V=1*C(V),k=.95047*C(k),K=1.08883*C(K),A[0]=O(3.2404542*k-1.5371385*V-.4985314*K),A[1]=O(-.969266*k+1.8760108*V+.041556*K),A[2]=O(.0556434*k-.2040259*V+1.0572252*K),A}function w(A){return A>d?Math.pow(A,1/3):A/c+s}function C(A){return A>h?A*A*A:c*(A-s)}function T(A){return(A/=255)<=.04045?A/12.92:Math.pow((A+.055)/1.055,2.4)}function O(A){return 255*(A<=.0031308?12.92*A:1.055*Math.pow(A,1/2.4)-.055)}const M=y(i[0]);return M[0]=0,M[1]*=0,M[2]*=1,m(x(M))}}),Jy=new Dv({layers:[new nc({source:qy})],target:"map",view:new Fe({center:[11834170421e-3,1879590664e-3],zoom:6,maxZoom:18})});let Qy=new vn({image:new Xs({color:"white",scale:1,crossOrigin:"anonymous",src:$y})});Jy.addInteraction(new Hy({originCoordinate:[0,0],rotationAnchorCoordinate:[0,1],xGridSize:25e4,yGridSize:25e4,style:Qy}));
