var Mm=Object.defineProperty;var Pm=(n,t,e)=>t in n?Mm(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var ru=(n,t,e)=>Pm(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const Oe={ADD:"add",REMOVE:"remove"},Fr={PROPERTYCHANGE:"propertychange"},mt={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class zs{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Dm(n,t,e){let i,r;e=e||Xi;let a=0,f=n.length,g=!1;for(;a<f;)i=a+(f-a>>1),r=+e(n[i],t),r<0?a=i+1:(f=i,g=!r);return g?a:~a}function Xi(n,t){return n>t?1:n<t?-1:0}function Fm(n,t){return n<t?1:n>t?-1:0}function ca(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if(typeof e=="function"){for(let r=1;r<i;++r){const a=n[r];if(a===t)return r;if(a<t)return e(t,n[r-1],a)>0?r-1:r}return i-1}if(e>0){for(let r=1;r<i;++r)if(n[r]<t)return r-1;return i-1}if(e<0){for(let r=1;r<i;++r)if(n[r]<=t)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==t)return r;if(n[r]<t)return n[r-1]-t<t-n[r]?r-1:r}return i-1}function bm(n,t,e){for(;t<e;){const i=n[t];n[t]=n[e],n[e]=i,++t,--e}}function si(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let r=0;r<i;r++)n[n.length]=e[r]}function In(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function Gm(n,t,e){const i=t||Xi;return n.every(function(r,a){if(a===0)return!0;const f=i(n[a-1],r);return!(f>0||f===0)})}function Os(){return!0}function ua(){return!1}function br(){}function yf(n){let t,e,i;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==i||!In(r,e))&&(i=this,e=r,t=n.apply(this,arguments)),t}}function Jl(n){function t(){let e;try{e=n()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Us(n){for(const t in n)delete n[t]}function Un(n){let t;for(t in n)return!1;return!t}class Qe{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class js extends zs{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),r=i[t]||(i[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const a=e?new Qe(t):t;a.target||(a.target=this.eventTarget_||this);const f=this.dispatching_||(this.dispatching_={}),g=this.pendingRemovals_||(this.pendingRemovals_={});i in f||(f[i]=0,g[i]=0),++f[i];let p;for(let y=0,v=r.length;y<v;++y)if("handleEvent"in r[y]?p=r[y].handleEvent(a):p=r[y].call(this,a),p===!1||a.propagationStopped){p=!1;break}if(--f[i]===0){let y=g[i];for(delete g[i];y--;)this.removeEventListener(i,br);delete f[i]}return p}disposeInternal(){this.listeners_&&Us(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const r=i.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[r]=br,++this.pendingRemovals_[t]):(i.splice(r,1),i.length===0&&delete this.listeners_[t]))}}function Ot(n,t,e,i,r){if(r){const f=e;e=function(g){return n.removeEventListener(t,e),f.call(i??this,g)}}else i&&i!==n&&(e=e.bind(i));const a={target:n,type:t,listener:e};return n.addEventListener(t,e),a}function Wo(n,t,e,i){return Ot(n,t,e,i,!0)}function Wt(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),Us(n))}class Vs extends js{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(mt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,r=new Array(i);for(let a=0;a<i;++a)r[a]=Ot(this,t[a],e);return r}return Ot(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const r=t.length;i=new Array(r);for(let a=0;a<r;++a)i[a]=Wo(this,t[a],e)}else i=Wo(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)km(i);else if(Array.isArray(t))for(let r=0,a=t.length;r<a;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}Vs.prototype.on;Vs.prototype.once;Vs.prototype.un;function km(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)Wt(n[t]);else Wt(n)}function Ct(){throw new Error("Unimplemented abstract method.")}let Nm=0;function Mt(n){return n.ol_uid||(n.ol_uid=String(++Nm))}class su extends Qe{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class li extends Vs{constructor(t){super(),this.on,this.once,this.un,Mt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new su(i,t,e)),i=Fr.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new su(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const r=this.values_||(this.values_={});if(i)r[t]=e;else{const a=r[t];r[t]=e,a!==e&&this.notify(t,a)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Un(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const ou={LENGTH:"length"};class Ao extends Qe{constructor(t,e,i){super(t),this.element=e,this.index=i}}class _i extends li{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(ou.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ao(Oe.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ao(Oe.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ao(Oe.REMOVE,r,t)),this.dispatchEvent(new Ao(Oe.ADD,e,t))}updateLength_(){this.set(ou.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}}class Er extends Qe{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class fn extends Er{constructor(t,e,i,r,a,f){super(t,e,a),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=f}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ne={SINGLECLICK:"singleclick",CLICK:mt.CLICK,DBLCLICK:mt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Cn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Xm=Cn.includes("firefox"),Ym=Cn.includes("safari")&&!Cn.includes("chrom");Ym&&(Cn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Cn));const Wm=Cn.includes("webkit")&&!Cn.includes("edge"),vf=Cn.includes("macintosh"),Ef=typeof devicePixelRatio<"u"?devicePixelRatio:1,Ql=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,xf=typeof Image<"u"&&Image.prototype.decode,Bm=typeof createImageBitmap=="function",Cf=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}(),Ll={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class zm extends js{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=Ot(i,Ll.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Ot(i,Ll.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(mt.TOUCHMOVE,this.boundHandleTouchMove_,Cf?{passive:!1}:!1)}emulateClick_(t){let e=new fn(ne.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new fn(ne.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new fn(ne.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==ne.POINTERUP||e.type==ne.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==ne.POINTERDOWN||e.type==ne.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new fn(ne.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Wt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new fn(ne.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Ot(i,ne.POINTERMOVE,this.handlePointerMove_,this),Ot(i,ne.POINTERUP,this.handlePointerUp_,this),Ot(this.element_,ne.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(Ot(this.element_.getRootNode(),ne.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new fn(ne.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new fn(ne.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Wt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(mt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Wt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Wt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const dn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ve={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},at={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Dt(n,t){if(!n)throw new Error(t)}const Bo=1/0;class Um{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Us(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(t){Dt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Bo?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,r=e.length,a=e[t],f=i[t],g=t;for(;t<r>>1;){const p=this.getLeftChildIndex_(t),y=this.getRightChildIndex_(t),v=y<r&&i[y]<i[p]?y:p;e[t]=e[v],i[t]=i[v],t=v}e[t]=a,i[t]=f,this.siftDown_(g,t)}siftDown_(t,e){const i=this.elements_,r=this.priorities_,a=i[e],f=r[e];for(;e>t;){const g=this.getParentIndex_(e);if(r[g]>f)i[e]=i[g],r[e]=r[g],e=g;else break}i[e]=a,r[e]=f}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let r=0;const a=e.length;let f,g,p;for(g=0;g<a;++g)f=e[g],p=t(f),p==Bo?delete this.queuedElements_[this.keyFunction_(f)]:(i[r]=p,e[r++]=f);e.length=r,i.length=r,this.heapify_()}}class Rf extends Um{constructor(t,e){super(i=>t.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(mt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===at.LOADED||i===at.ERROR||i===at.EMPTY){i!==at.ERROR&&e.removeEventListener(mt.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;){const r=this.dequeue()[0],a=r.getKey();r.getState()===at.IDLE&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++i,r.load())}}}function jm(n,t,e,i,r){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return Bo;const a=n.viewState.center,f=i[0]-a[0],g=i[1]-a[1];return 65536*Math.log(r)+Math.sqrt(f*f+g*g)/r}const ge={ANIMATING:0,INTERACTING:1},ni={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function re(n,t,e){return Math.min(Math.max(n,t),e)}function Vm(n,t,e,i,r,a){const f=r-e,g=a-i;if(f!==0||g!==0){const p=((n-e)*f+(t-i)*g)/(f*f+g*g);p>1?(e=r,i=a):p>0&&(e+=f*p,i+=g*p)}return zn(n,t,e,i)}function zn(n,t,e,i){const r=e-n,a=i-t;return r*r+a*a}function Km(n){const t=n.length;for(let i=0;i<t;i++){let r=i,a=Math.abs(n[i][i]);for(let g=i+1;g<t;g++){const p=Math.abs(n[g][i]);p>a&&(a=p,r=g)}if(a===0)return null;const f=n[r];n[r]=n[i],n[i]=f;for(let g=i+1;g<t;g++){const p=-n[g][i]/n[i][i];for(let y=i;y<t+1;y++)i==y?n[g][y]=0:n[g][y]+=p*n[i][y]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let r=i-1;r>=0;r--)n[r][t]-=n[r][i]*e[i]}return e}function zo(n){return n*180/Math.PI}function oi(n){return n*Math.PI/180}function Ar(n,t){const e=n%t;return e*t<0?e+t:e}function Ge(n,t,e){return n+e*(t-n)}function th(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function Lo(n,t){return Math.floor(th(n,t))}function mn(n,t){return Math.ceil(th(n,t))}function Ol(n,t,e){if(n>=t&&n<e)return n;const i=e-t;return((n-t)%i+i)%i+t}function au(n,t,e){return function(i,r,a,f,g){if(!i)return;if(!r&&!t)return i;const p=t?0:a[0]*r,y=t?0:a[1]*r,v=g?g[0]:0,x=g?g[1]:0;let R=n[0]+p/2+v,S=n[2]-p/2+v,I=n[1]+y/2+x,L=n[3]-y/2+x;R>S&&(R=(S+R)/2,S=R),I>L&&(I=(L+I)/2,L=I);let O=re(i[0],R,S),M=re(i[1],I,L);if(f&&e&&r){const P=30*r;O+=-P*Math.log(1+Math.max(0,R-i[0])/P)+P*Math.log(1+Math.max(0,i[0]-S)/P),M+=-P*Math.log(1+Math.max(0,I-i[1])/P)+P*Math.log(1+Math.max(0,i[1]-L)/P)}return[O,M]}}function Zm(n){return n}const de={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function lu(n){const t=Fe();for(let e=0,i=n.length;e<i;++e)Ls(t,n[e]);return t}function fa(n,t,e){return e?(e[0]=n[0]-t,e[1]=n[1]-t,e[2]=n[2]+t,e[3]=n[3]+t,e):[n[0]-t,n[1]-t,n[2]+t,n[3]+t]}function wf(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n.slice()}function Hn(n,t,e){let i,r;return t<n[0]?i=n[0]-t:n[2]<t?i=t-n[2]:i=0,e<n[1]?r=n[1]-e:n[3]<e?r=e-n[3]:r=0,i*i+r*r}function jn(n,t){return eh(n,t[0],t[1])}function yn(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function eh(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function Ml(n,t){const e=n[0],i=n[1],r=n[2],a=n[3],f=t[0],g=t[1];let p=de.UNKNOWN;return f<e?p=p|de.LEFT:f>r&&(p=p|de.RIGHT),g<i?p=p|de.BELOW:g>a&&(p=p|de.ABOVE),p===de.UNKNOWN&&(p=de.INTERSECTING),p}function Fe(){return[1/0,1/0,-1/0,-1/0]}function Rn(n,t,e,i,r){return r?(r[0]=n,r[1]=t,r[2]=e,r[3]=i,r):[n,t,e,i]}function Ks(n){return Rn(1/0,1/0,-1/0,-1/0,n)}function ih(n,t){const e=n[0],i=n[1];return Rn(e,i,e,i,t)}function nh(n,t,e,i,r){const a=Ks(r);return If(a,n,t,e,i)}function wn(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function rh(n,t){return t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3]),n}function Ls(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function If(n,t,e,i,r){for(;e<i;e+=r)Hm(n,t[e],t[e+1]);return n}function Hm(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function Tf(n,t){let e;return e=t(da(n)),e||(e=t(ga(n)),e)||(e=t(_a(n)),e)||(e=t(Bi(n)),e)?e:!1}function Ms(n){let t=0;return Wr(n)||(t=It(n)*Ht(n)),t}function da(n){return[n[0],n[1]]}function ga(n){return[n[2],n[1]]}function Je(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function $m(n,t){let e;if(t==="bottom-left")e=da(n);else if(t==="bottom-right")e=ga(n);else if(t==="top-left")e=Bi(n);else if(t==="top-right")e=_a(n);else throw new Error("Invalid corner");return e}function Uo(n,t,e,i,r){const[a,f,g,p,y,v,x,R]=Sf(n,t,e,i);return Rn(Math.min(a,g,y,x),Math.min(f,p,v,R),Math.max(a,g,y,x),Math.max(f,p,v,R),r)}function Sf(n,t,e,i){const r=t*i[0]/2,a=t*i[1]/2,f=Math.cos(e),g=Math.sin(e),p=r*f,y=r*g,v=a*f,x=a*g,R=n[0],S=n[1];return[R-p+x,S-y-v,R-p-x,S-y+v,R+p-x,S+y+v,R+p+x,S+y-v,R-p+x,S-y-v]}function Ht(n){return n[3]-n[1]}function Ne(n,t,e){const i=e||Fe();return Re(n,t)?(n[0]>t[0]?i[0]=n[0]:i[0]=t[0],n[1]>t[1]?i[1]=n[1]:i[1]=t[1],n[2]<t[2]?i[2]=n[2]:i[2]=t[2],n[3]<t[3]?i[3]=n[3]:i[3]=t[3]):Ks(i),i}function Bi(n){return[n[0],n[3]]}function _a(n){return[n[2],n[3]]}function It(n){return n[2]-n[0]}function Re(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function Wr(n){return n[2]<n[0]||n[3]<n[1]}function qm(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}function Jm(n,t,e){let i=!1;const r=Ml(n,t),a=Ml(n,e);if(r===de.INTERSECTING||a===de.INTERSECTING)i=!0;else{const f=n[0],g=n[1],p=n[2],y=n[3],v=t[0],x=t[1],R=e[0],S=e[1],I=(S-x)/(R-v);let L,O;a&de.ABOVE&&!(r&de.ABOVE)&&(L=R-(S-y)/I,i=L>=f&&L<=p),!i&&a&de.RIGHT&&!(r&de.RIGHT)&&(O=S-(R-p)*I,i=O>=g&&O<=y),!i&&a&de.BELOW&&!(r&de.BELOW)&&(L=R-(S-g)/I,i=L>=f&&L<=p),!i&&a&de.LEFT&&!(r&de.LEFT)&&(O=S-(R-f)*I,i=O>=g&&O<=y)}return i}function Af(n,t){const e=t.getExtent(),i=Je(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const r=It(e),f=Math.floor((i[0]-e[0])/r)*r;n[0]-=f,n[2]-=f}return n}function sh(n,t,e){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];Af(n,t);const r=It(i);if(It(n)>r&&!e)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+r,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-r,n[3]]]}return[n]}function Lf(n,t){return n[0]+=+t[0],n[1]+=+t[1],n}function jo(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function oh(n,t){const e=Math.cos(t),i=Math.sin(t),r=n[0]*e-n[1]*i,a=n[1]*e+n[0]*i;return n[0]=r,n[1]=a,n}function Of(n,t){return n[0]*=t,n[1]*=t,n}function Mf(n,t){if(t.canWrapX()){const e=It(t.getExtent()),i=Qm(n,t,e);i&&(n[0]-=i*e)}return n}function Qm(n,t,e){const i=t.getExtent();let r=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||It(i),r=Math.floor((n[0]-i[0])/e)),r}function Pf(n){return Math.pow(n,3)}function Br(n){return 1-Pf(1-n)}function ty(n){return 3*n*n-2*n*n*n}function ey(n){return n}const Df=63710088e-1;function hu(n,t,e){e=e||Df;const i=oi(n[1]),r=oi(t[1]),a=(r-i)/2,f=oi(t[0]-n[0])/2,g=Math.sin(a)*Math.sin(a)+Math.sin(f)*Math.sin(f)*Math.cos(i)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))}function iy(n,t,e,i){i=i||Df;const r=oi(n[1]),a=oi(n[0]),f=t/i,g=Math.asin(Math.sin(r)*Math.cos(f)+Math.cos(r)*Math.sin(f)*Math.cos(e)),p=a+Math.atan2(Math.sin(e)*Math.sin(f)*Math.cos(r),Math.cos(f)-Math.sin(r)*Math.sin(g));return[zo(p),zo(g)]}function Ff(...n){console.warn(...n)}const ah={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class lh{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ah[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Zs=6378137,Tr=Math.PI*Zs,ny=[-Tr,-Tr,Tr,Tr],ry=[-180,-85,180,85],Oo=Zs*Math.log(Math.tan(Math.PI/2));class fr extends lh{constructor(t){super({code:t,units:"m",extent:ny,global:!0,worldExtent:ry,getPointResolution:function(e,i){return e/Math.cosh(i[1]/Zs)}})}}const cu=[new fr("EPSG:3857"),new fr("EPSG:102100"),new fr("EPSG:102113"),new fr("EPSG:900913"),new fr("http://www.opengis.net/def/crs/EPSG/0/3857"),new fr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function sy(n,t,e,i){const r=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let a=0;a<r;a+=i){t[a]=Tr*n[a]/180;let f=Zs*Math.log(Math.tan(Math.PI*(+n[a+1]+90)/360));f>Oo?f=Oo:f<-Oo&&(f=-Oo),t[a+1]=f}return t}function oy(n,t,e,i){const r=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let a=0;a<r;a+=i)t[a]=180*n[a]/Tr,t[a+1]=360*Math.atan(Math.exp(n[a+1]/Zs))/Math.PI-90;return t}const ay=6378137,uu=[-180,-90,180,90],ly=Math.PI*ay/180;class Fn extends lh{constructor(t,e){super({code:t,units:"degrees",extent:uu,axisOrientation:e,global:!0,metersPerUnit:ly,worldExtent:uu})}}const fu=[new Fn("CRS:84"),new Fn("EPSG:4326","neu"),new Fn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Fn("urn:ogc:def:crs:OGC:2:84"),new Fn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Fn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Fn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Pl={};function hy(n){return Pl[n]||Pl[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function cy(n,t){Pl[n]=t}let Lr={};function Ps(n,t,e){const i=n.getCode(),r=t.getCode();i in Lr||(Lr[i]={}),Lr[i][r]=e}function ol(n,t){return n in Lr&&t in Lr[n]?Lr[n][t]:null}const Vo=.9996,qe=.00669438,pa=qe*qe,ma=pa*qe,Xn=qe/(1-qe),du=Math.sqrt(1-qe),Gr=(1-du)/(1+du),bf=Gr*Gr,hh=bf*Gr,ch=hh*Gr,Gf=ch*Gr,kf=1-qe/4-3*pa/64-5*ma/256,uy=3*qe/8+3*pa/32+45*ma/1024,fy=15*pa/256+45*ma/1024,dy=35*ma/3072,gy=3/2*Gr-27/32*hh+269/512*Gf,_y=21/16*bf-55/32*ch,py=151/96*hh-417/128*Gf,my=1097/512*ch,Ko=6378137;function yy(n,t,e){const i=n-5e5,f=(e.north?t:t-1e7)/Vo/(Ko*kf),g=f+gy*Math.sin(2*f)+_y*Math.sin(4*f)+py*Math.sin(6*f)+my*Math.sin(8*f),p=Math.sin(g),y=p*p,v=Math.cos(g),x=p/v,R=x*x,S=R*R,I=1-qe*y,L=Math.sqrt(1-qe*y),O=Ko/L,M=(1-qe)/I,P=Xn*v**2,X=P*P,b=i/(O*Vo),G=b*b,W=G*b,j=W*b,Y=j*b,V=Y*b,U=g-x/M*(G/2-j/24*(5+3*R+10*P-4*X-9*Xn))+V/720*(61+90*R+298*P+45*S-252*Xn-3*X);let it=(b-W/6*(1+2*R+P)+Y/120*(5-2*P+28*R-3*X+8*Xn+24*S))/v;return it=Ol(it+oi(Nf(e.number)),-Math.PI,Math.PI),[zo(it),zo(U)]}const gu=-80,_u=84,vy=-180,Ey=180;function xy(n,t,e){n=Ol(n,vy,Ey),t<gu?t=gu:t>_u&&(t=_u);const i=oi(t),r=Math.sin(i),a=Math.cos(i),f=r/a,g=f*f,p=g*g,y=oi(n),v=Nf(e.number),x=oi(v),R=Ko/Math.sqrt(1-qe*r**2),S=Xn*a**2,I=a*Ol(y-x,-Math.PI,Math.PI),L=I*I,O=L*I,M=O*I,P=M*I,X=P*I,b=Ko*(kf*i-uy*Math.sin(2*i)+fy*Math.sin(4*i)-dy*Math.sin(6*i)),G=Vo*R*(I+O/6*(1-g+S)+P/120*(5-18*g+p+72*S-58*Xn))+5e5;let W=Vo*(b+R*f*(L/2+M/24*(5-g+9*S+4*S**2)+X/720*(61-58*g+p+600*S-330*Xn)));return e.north||(W+=1e7),[G,W]}function Nf(n){return(n-1)*6-180+3}const Cy=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Xf(n){let t=0;for(const r of Cy){const a=n.match(r);if(a){t=parseInt(a[1]);break}}if(!t)return null;let e=0,i=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(i=!0,e=t-32600),e?{number:e,north:i}:null}function pu(n,t){return function(e,i,r,a){const f=e.length;r=r>1?r:2,a=a??r,i||(r>2?i=e.slice():i=new Array(f));for(let g=0;g<f;g+=a){const p=e[g],y=e[g+1],v=n(p,y,t);i[g]=v[0],i[g+1]=v[1]}return i}}function Ry(n){return Xf(n)?new lh({code:n,units:"m"}):null}function wy(n){const t=Xf(n.getCode());return t?{forward:pu(xy,t),inverse:pu(yy,t)}:null}const Iy=[wy],Ty=[Ry];let Dl=!0;function Sy(n){Dl=!1}function uh(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function Ay(n,t){if(t!==void 0&&n!==t){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];n=t}return n}function Fl(n){cy(n.getCode(),n),Ps(n,n,uh)}function Ly(n){n.forEach(Fl)}function $t(n){if(typeof n!="string")return n;const t=hy(n);if(t)return t;for(const e of Ty){const i=e(n);if(i)return i}return null}function mu(n,t,e,i){n=$t(n);let r;const a=n.getPointResolutionFunc();if(a)r=a(t,e);else{const f=n.getUnits();if(f=="degrees"||i=="degrees")r=t;else{const g=ya(n,$t("EPSG:4326"));if(!g&&f!=="degrees")r=t*n.getMetersPerUnit();else{let y=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];y=g(y,y,2);const v=hu(y.slice(0,2),y.slice(2,4)),x=hu(y.slice(4,6),y.slice(6,8));r=(v+x)/2}const p=n.getMetersPerUnit();p!==void 0&&(r/=p)}}return r}function yu(n){Ly(n),n.forEach(function(t){n.forEach(function(e){t!==e&&Ps(t,e,uh)})})}function Oy(n,t,e,i){n.forEach(function(r){t.forEach(function(a){Ps(r,a,e),Ps(a,r,i)})})}function fh(n,t){return n?typeof n=="string"?$t(n):n:$t(t)}function My(n){return function(t,e,i,r){const a=t.length;i=i!==void 0?i:2,r=r??i,e=e!==void 0?e:new Array(a);for(let f=0;f<a;f+=r){const g=n(t.slice(f,f+i)),p=g.length;for(let y=0,v=r;y<v;++y)e[f+y]=y>=p?t[f+y]:g[y]}return e}}function Or(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||ya(n,t)===uh)&&e}function ya(n,t){const e=n.getCode(),i=t.getCode();let r=ol(e,i);if(r)return r;let a=null,f=null;for(const p of Iy)a||(a=p(n)),f||(f=p(t));if(!a&&!f)return null;const g="EPSG:4326";if(f)if(a)r=al(a.inverse,f.forward);else{const p=ol(e,g);p&&(r=al(p,f.forward))}else{const p=ol(g,i);p&&(r=al(a.inverse,p))}return r&&(Fl(n),Fl(t),Ps(n,t,r)),r}function al(n,t){return function(e,i,r,a){return i=n(e,i,r,a),t(i,i,r,a)}}function Ds(n,t){const e=$t(n),i=$t(t);return ya(e,i)}function Yf(n,t,e){const i=Ds(t,e);if(!i){const r=$t(t).getCode(),a=$t(e).getCode();throw new Error(`No transform available between ${r} and ${a}`)}return i(n,void 0,n.length)}function bl(n,t){return n}function bi(n,t){return Dl&&!jo(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Dl=!1,Ff("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function Wf(n,t){return n}function pi(n,t){return n}function Py(){yu(cu),yu(fu),Oy(fu,cu,sy,oy)}Py();new Array(6);function Xe(){return[1,0,0,1,0,0]}function Dy(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function ce(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function vi(n,t,e,i,r,a,f,g){const p=Math.sin(a),y=Math.cos(a);return n[0]=i*y,n[1]=r*p,n[2]=-i*p,n[3]=r*y,n[4]=f*i*y-g*i*p+t,n[5]=f*r*p+g*r*y+e,n}function Bf(n,t){const e=Fy(t);Dt(e!==0,"Transformation matrix cannot be inverted");const i=t[0],r=t[1],a=t[2],f=t[3],g=t[4],p=t[5];return n[0]=f/e,n[1]=-r/e,n[2]=-a/e,n[3]=i/e,n[4]=(a*p-f*g)/e,n[5]=-(i*p-r*g)/e,n}function Fy(n){return n[0]*n[3]-n[1]*n[2]}const vu=[1e6,1e6,1e6,1e6,2,2];function by(n){return"matrix("+n.map((e,i)=>Math.round(e*vu[i])/vu[i]).join(", ")+")"}function xn(n,t,e,i,r,a,f){a=a||[],f=f||2;let g=0;for(let p=t;p<e;p+=i){const y=n[p],v=n[p+1];a[g++]=r[0]*y+r[2]*v+r[4],a[g++]=r[1]*y+r[3]*v+r[5];for(let x=2;x<f;x++)a[g++]=n[p+x]}return a&&a.length!=g&&(a.length=g),a}function zf(n,t,e,i,r,a,f){f=f||[];const g=Math.cos(r),p=Math.sin(r),y=a[0],v=a[1];let x=0;for(let R=t;R<e;R+=i){const S=n[R]-y,I=n[R+1]-v;f[x++]=y+S*g-I*p,f[x++]=v+S*p+I*g;for(let L=R+2;L<R+i;++L)f[x++]=n[L]}return f&&f.length!=x&&(f.length=x),f}function Gy(n,t,e,i,r,a,f,g){g=g||[];const p=f[0],y=f[1];let v=0;for(let x=t;x<e;x+=i){const R=n[x]-p,S=n[x+1]-y;g[v++]=p+r*R,g[v++]=y+a*S;for(let I=x+2;I<x+i;++I)g[v++]=n[I]}return g&&g.length!=v&&(g.length=v),g}function ky(n,t,e,i,r,a,f){f=f||[];let g=0;for(let p=t;p<e;p+=i){f[g++]=n[p]+r,f[g++]=n[p+1]+a;for(let y=p+2;y<p+i;++y)f[g++]=n[y]}return f&&f.length!=g&&(f.length=g),f}const Eu=Xe(),Ny=[NaN,NaN];class Uf extends li{constructor(){super(),this.extent_=Fe(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=yf((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Ct()}closestPointXY(t,e,i,r){return Ct()}containsXY(t,e){return this.closestPointXY(t,e,Ny,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Ct()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ks(e),this.extentRevision_=this.getRevision()}return qm(this.extent_,t)}rotate(t,e){Ct()}scale(t,e,i){Ct()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Ct()}getType(){return Ct()}applyTransform(t){Ct()}intersectsExtent(t){return Ct()}translate(t,e){Ct()}transform(t,e){const i=$t(t),r=i.getUnits()=="tile-pixels"?function(a,f,g){const p=i.getExtent(),y=i.getWorldExtent(),v=Ht(y)/Ht(p);vi(Eu,y[0],y[3],v,-v,0,0,0);const x=xn(a,0,a.length,g,Eu,f),R=Ds(i,e);return R?R(x,x,g):x}:Ds(i,e);return this.applyTransform(r),this}}class $n extends Uf{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return nh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Ct()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=xu(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Ct()}setLayout(t,e,i){let r;if(t)r=xu(t);else{for(let a=0;a<i;++a){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=qn(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();zf(i,0,i.length,r,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=Je(this.getExtent()));const r=this.getFlatCoordinates();if(r){const a=this.getStride();Gy(r,0,r.length,a,t,e,i,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();ky(i,0,i.length,r,t,e,i),this.changed()}}}function qn(n){let t;return n==2?t="XY":n==3?t="XYZ":n==4&&(t="XYZM"),t}function xu(n){let t;return n=="XY"?t=2:n=="XYZ"||n=="XYM"?t=3:n=="XYZM"&&(t=4),t}function Xy(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return xn(i,0,i.length,r,t,e)}function jf(n,t,e,i){let r=0;const a=n[e-i],f=n[e-i+1];let g=0,p=0;for(;t<e;t+=i){const y=n[t]-a,v=n[t+1]-f;r+=p*y-g*v,g=y,p=v}return r/2}function Vf(n,t,e,i){let r=0;for(let a=0,f=e.length;a<f;++a){const g=e[a];r+=jf(n,t,g,i),t=g}return r}function Yy(n,t,e,i){let r=0;for(let a=0,f=e.length;a<f;++a){const g=e[a];r+=Vf(n,t,g,i),t=g[g.length-1]}return r}function Cu(n,t,e,i,r,a,f){const g=n[t],p=n[t+1],y=n[e]-g,v=n[e+1]-p;let x;if(y===0&&v===0)x=t;else{const R=((r-g)*y+(a-p)*v)/(y*y+v*v);if(R>1)x=e;else if(R>0){for(let S=0;S<i;++S)f[S]=Ge(n[t+S],n[e+S],R);f.length=i;return}else x=t}for(let R=0;R<i;++R)f[R]=n[x+R];f.length=i}function dh(n,t,e,i,r){let a=n[t],f=n[t+1];for(t+=i;t<e;t+=i){const g=n[t],p=n[t+1],y=zn(a,f,g,p);y>r&&(r=y),a=g,f=p}return r}function gh(n,t,e,i,r){for(let a=0,f=e.length;a<f;++a){const g=e[a];r=dh(n,t,g,i,r),t=g}return r}function Wy(n,t,e,i,r){for(let a=0,f=e.length;a<f;++a){const g=e[a];r=gh(n,t,g,i,r),t=g[g.length-1]}return r}function _h(n,t,e,i,r,a,f,g,p,y,v){if(t==e)return y;let x,R;if(r===0){if(R=zn(f,g,n[t],n[t+1]),R<y){for(x=0;x<i;++x)p[x]=n[t+x];return p.length=i,R}return y}v=v||[NaN,NaN];let S=t+i;for(;S<e;)if(Cu(n,S-i,S,i,f,g,v),R=zn(f,g,v[0],v[1]),R<y){for(y=R,x=0;x<i;++x)p[x]=v[x];p.length=i,S+=i}else S+=i*Math.max((Math.sqrt(R)-Math.sqrt(y))/r|0,1);if(a&&(Cu(n,e-i,t,i,f,g,v),R=zn(f,g,v[0],v[1]),R<y)){for(y=R,x=0;x<i;++x)p[x]=v[x];p.length=i}return y}function ph(n,t,e,i,r,a,f,g,p,y,v){v=v||[NaN,NaN];for(let x=0,R=e.length;x<R;++x){const S=e[x];y=_h(n,t,S,i,r,a,f,g,p,y,v),t=S}return y}function By(n,t,e,i,r,a,f,g,p,y,v){v=v||[NaN,NaN];for(let x=0,R=e.length;x<R;++x){const S=e[x];y=ph(n,t,S,i,r,a,f,g,p,y,v),t=S[S.length-1]}return y}function zy(n,t,e,i){for(let r=0,a=e.length;r<a;++r)n[t++]=e[r];return t}function va(n,t,e,i){for(let r=0,a=e.length;r<a;++r){const f=e[r];for(let g=0;g<i;++g)n[t++]=f[g]}return t}function Hs(n,t,e,i,r){r=r||[];let a=0;for(let f=0,g=e.length;f<g;++f){const p=va(n,t,e[f],i);r[a++]=p,t=p}return r.length=a,r}function Kf(n,t,e,i,r){r=r||[];let a=0;for(let f=0,g=e.length;f<g;++f){const p=Hs(n,t,e[f],i,r[a]);p.length===0&&(p[0]=t),r[a++]=p,t=p[p.length-1]}return r.length=a,r}function vn(n,t,e,i,r){r=r!==void 0?r:[];let a=0;for(let f=t;f<e;f+=i)r[a++]=n.slice(f,f+i);return r.length=a,r}function Fs(n,t,e,i,r){r=r!==void 0?r:[];let a=0;for(let f=0,g=e.length;f<g;++f){const p=e[f];r[a++]=vn(n,t,p,i,r[a]),t=p}return r.length=a,r}function Gl(n,t,e,i,r){r=r!==void 0?r:[];let a=0;for(let f=0,g=e.length;f<g;++f){const p=e[f];r[a++]=p.length===1&&p[0]===t?[]:Fs(n,t,p,i,r[a]),t=p[p.length-1]}return r.length=a,r}function Ea(n,t,e,i,r,a,f){const g=(e-t)/i;if(g<3){for(;t<e;t+=i)a[f++]=n[t],a[f++]=n[t+1];return f}const p=new Array(g);p[0]=1,p[g-1]=1;const y=[t,e-i];let v=0;for(;y.length>0;){const x=y.pop(),R=y.pop();let S=0;const I=n[R],L=n[R+1],O=n[x],M=n[x+1];for(let P=R+i;P<x;P+=i){const X=n[P],b=n[P+1],G=Vm(X,b,I,L,O,M);G>S&&(v=P,S=G)}S>r&&(p[(v-t)/i]=1,R+i<v&&y.push(R,v),v+i<x&&y.push(v,x))}for(let x=0;x<g;++x)p[x]&&(a[f++]=n[t+x*i],a[f++]=n[t+x*i+1]);return f}function Zf(n,t,e,i,r,a,f,g){for(let p=0,y=e.length;p<y;++p){const v=e[p];f=Ea(n,t,v,i,r,a,f),g.push(f),t=v}return f}function kn(n,t){return t*Math.round(n/t)}function Uy(n,t,e,i,r,a,f){if(t==e)return f;let g=kn(n[t],r),p=kn(n[t+1],r);t+=i,a[f++]=g,a[f++]=p;let y,v;do if(y=kn(n[t],r),v=kn(n[t+1],r),t+=i,t==e)return a[f++]=y,a[f++]=v,f;while(y==g&&v==p);for(;t<e;){const x=kn(n[t],r),R=kn(n[t+1],r);if(t+=i,x==y&&R==v)continue;const S=y-g,I=v-p,L=x-g,O=R-p;if(S*O==I*L&&(S<0&&L<S||S==L||S>0&&L>S)&&(I<0&&O<I||I==O||I>0&&O>I)){y=x,v=R;continue}a[f++]=y,a[f++]=v,g=y,p=v,y=x,v=R}return a[f++]=y,a[f++]=v,f}function mh(n,t,e,i,r,a,f,g){for(let p=0,y=e.length;p<y;++p){const v=e[p];f=Uy(n,t,v,i,r,a,f),g.push(f),t=v}return f}function jy(n,t,e,i,r,a,f,g){for(let p=0,y=e.length;p<y;++p){const v=e[p],x=[];f=mh(n,t,v,i,r,a,f,x),g.push(x),t=v[v.length-1]}return f}class bs extends $n{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new bs(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,r){return r<Hn(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(dh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_h(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))}getArea(){return jf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return vn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ea(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new bs(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=va(this.flatCoordinates,0,t,this.stride),this.changed()}}class Vn extends $n{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Vn(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const a=this.flatCoordinates,f=zn(t,e,a[0],a[1]);if(f<r){const g=this.stride;for(let p=0;p<g;++p)i[p]=a[p];return i.length=g,f}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return ih(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return eh(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zy(this.flatCoordinates,0,t,this.stride),this.changed()}}function Vy(n,t,e,i,r){return!Tf(r,function(f){return!Yn(n,t,e,i,f[0],f[1])})}function Yn(n,t,e,i,r,a){let f=0,g=n[e-i],p=n[e-i+1];for(;t<e;t+=i){const y=n[t],v=n[t+1];p<=a?v>a&&(y-g)*(a-p)-(r-g)*(v-p)>0&&f++:v<=a&&(y-g)*(a-p)-(r-g)*(v-p)<0&&f--,g=y,p=v}return f!==0}function yh(n,t,e,i,r,a){if(e.length===0||!Yn(n,t,e[0],i,r,a))return!1;for(let f=1,g=e.length;f<g;++f)if(Yn(n,e[f-1],e[f],i,r,a))return!1;return!0}function Ky(n,t,e,i,r,a){if(e.length===0)return!1;for(let f=0,g=e.length;f<g;++f){const p=e[f];if(yh(n,t,p,i,r,a))return!0;t=p[p.length-1]}return!1}function vh(n,t,e,i,r,a,f){let g,p,y,v,x,R,S;const I=r[a+1],L=[];for(let P=0,X=e.length;P<X;++P){const b=e[P];for(v=n[b-i],R=n[b-i+1],g=t;g<b;g+=i)x=n[g],S=n[g+1],(I<=R&&S<=I||R<=I&&I<=S)&&(y=(I-R)/(S-R)*(x-v)+v,L.push(y)),v=x,R=S}let O=NaN,M=-1/0;for(L.sort(Xi),v=L[0],g=1,p=L.length;g<p;++g){x=L[g];const P=Math.abs(x-v);P>M&&(y=(v+x)/2,yh(n,t,e,i,y,I)&&(O=y,M=P)),v=x}return isNaN(O)&&(O=r[a]),f?(f.push(O,I,M),f):[O,I,M]}function Hf(n,t,e,i,r){let a=[];for(let f=0,g=e.length;f<g;++f){const p=e[f];a=vh(n,t,p,i,r,2*f,a),t=p[p.length-1]}return a}function $f(n,t,e,i,r){let a;for(t+=i;t<e;t+=i)if(a=r(n.slice(t-i,t),n.slice(t,t+i)),a)return a;return!1}function xa(n,t,e,i,r,a){return a=a??If(Fe(),n,t,e,i),Re(r,a)?a[0]>=r[0]&&a[2]<=r[2]||a[1]>=r[1]&&a[3]<=r[3]?!0:$f(n,t,e,i,function(f,g){return Jm(r,f,g)}):!1}function Zy(n,t,e,i,r){for(let a=0,f=e.length;a<f;++a){if(xa(n,t,e[a],i,r))return!0;t=e[a]}return!1}function qf(n,t,e,i,r){return!!(xa(n,t,e,i,r)||Yn(n,t,e,i,r[0],r[1])||Yn(n,t,e,i,r[0],r[3])||Yn(n,t,e,i,r[2],r[1])||Yn(n,t,e,i,r[2],r[3]))}function Jf(n,t,e,i,r){if(!qf(n,t,e[0],i,r))return!1;if(e.length===1)return!0;for(let a=1,f=e.length;a<f;++a)if(Vy(n,e[a-1],e[a],i,r)&&!xa(n,e[a-1],e[a],i,r))return!1;return!0}function Hy(n,t,e,i,r){for(let a=0,f=e.length;a<f;++a){const g=e[a];if(Jf(n,t,g,i,r))return!0;t=g[g.length-1]}return!1}function $y(n,t,e,i){for(;t<e-i;){for(let r=0;r<i;++r){const a=n[t+r];n[t+r]=n[e-i+r],n[e-i+r]=a}t+=i,e-=i}}function Eh(n,t,e,i){let r=0,a=n[e-i],f=n[e-i+1];for(;t<e;t+=i){const g=n[t],p=n[t+1];r+=(g-a)*(p+f),a=g,f=p}return r===0?void 0:r>0}function xh(n,t,e,i,r){r=r!==void 0?r:!1;for(let a=0,f=e.length;a<f;++a){const g=e[a],p=Eh(n,t,g,i);if(a===0){if(r&&p||!r&&!p)return!1}else if(r&&!p||!r&&p)return!1;t=g}return!0}function Qf(n,t,e,i,r){for(let a=0,f=e.length;a<f;++a){const g=e[a];if(!xh(n,t,g,i,r))return!1;g.length&&(t=g[g.length-1])}return!0}function Zo(n,t,e,i,r){r=r!==void 0?r:!1;for(let a=0,f=e.length;a<f;++a){const g=e[a],p=Eh(n,t,g,i);(a===0?r&&p||!r&&!p:r&&!p||!r&&p)&&$y(n,t,g,i),t=g}return t}function kl(n,t,e,i,r){for(let a=0,f=e.length;a<f;++a)t=Zo(n,t,e[a],i,r);return t}function qy(n,t){const e=[];let i=0,r=0,a;for(let f=0,g=t.length;f<g;++f){const p=t[f],y=Eh(n,i,p,2);if(a===void 0&&(a=y),y===a)e.push(t.slice(r,f+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=f+1,i=p}return e}class zi extends $n{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?si(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new zi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Hn(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ph(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return yh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Vf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Zo(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Fs(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Je(this.getExtent());this.flatInteriorPoint_=vh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Vn(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new bs(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[];let a=0;for(let f=0,g=i.length;f<g;++f){const p=i[f],y=new bs(e.slice(a,p),t);r.push(y),a=p}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;xh(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Zo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=mh(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new zi(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return Jf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Hs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function Jy(n,t,e,i){e=e||32;const r=[];for(let a=0;a<e;++a)si(r,iy(n,t,2*Math.PI*a/e,i));return r.push(r[0],r[1]),new zi(r,"XY",[r.length])}function Ru(n){if(Wr(n))throw new Error("Cannot create polygon from empty extent");const t=n[0],e=n[1],i=n[2],r=n[3],a=[t,e,t,r,i,r,i,e,t,e];return new zi(a,"XY",[a.length])}function Ch(n,t,e,i){const r=It(t)/e[0],a=Ht(t)/e[1];return i?Math.min(n,Math.max(r,a)):Math.min(n,Math.min(r,a))}function Rh(n,t,e){let i=Math.min(n,t);const r=50;return i*=Math.log(1+r*Math.max(0,n/t-1))/r+1,e&&(i=Math.max(i,e),i/=Math.log(1+r*Math.max(0,e/n-1))/r+1),re(i,e/2,t*2)}function Qy(n,t,e,i){return t=t!==void 0?t:!0,function(r,a,f,g){if(r!==void 0){const p=n[0],y=n[n.length-1],v=e?Ch(p,e,f,i):p;if(g)return t?Rh(r,v,y):re(r,y,v);const x=Math.min(v,r),R=Math.floor(ca(n,x,a));return n[R]>v&&R<n.length-1?n[R+1]:n[R]}}}function t0(n,t,e,i,r,a){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(f,g,p,y){if(f!==void 0){const v=r?Ch(t,r,p,a):t;if(y)return i?Rh(f,v,e):re(f,e,v);const x=1e-9,R=Math.ceil(Math.log(t/v)/Math.log(n)-x),S=-g*(.5-x)+.5,I=Math.min(v,f),L=Math.floor(Math.log(t/I)/Math.log(n)+S),O=Math.max(R,L),M=t/Math.pow(n,O);return re(M,e,v)}}}function wu(n,t,e,i,r){return e=e!==void 0?e:!0,function(a,f,g,p){if(a!==void 0){const y=i?Ch(n,i,g,r):n;return!e||!p?re(a,t,y):Rh(a,y,t)}}}function wh(n){if(n!==void 0)return 0}function Iu(n){if(n!==void 0)return n}function e0(n){const t=2*Math.PI/n;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function i0(n){const t=oi(5);return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}const n0=42,Ih=256,ll=0;class di extends li{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=fh(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Sy(),t.center&&(t.center=bi(t.center,this.projection_)),t.extent&&(t.extent=pi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const g in ni)delete e[g];this.setProperties(e,!0);const i=s0(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const r=r0(t),a=i.constraint,f=o0(t);this.constraints_={center:r,resolution:a,rotation:f},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const r=t||[0,0,0,0];e=e||[0,0,0,0];const a=this.getResolution(),f=a/2*(r[3]-e[3]+e[1]-r[1]),g=a/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([i[0]+f,i[1]-g])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=bi(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=bi(r.anchor,this.getProjection())),e[i]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const v=arguments[r];v.center&&this.setCenterInternal(v.center),v.zoom!==void 0?this.setZoom(v.zoom):v.resolution&&this.setResolution(v.resolution),v.rotation!==void 0&&this.setRotation(v.rotation)}if(r===e){i&&Mo(i,!0);return}let a=Date.now(),f=this.targetCenter_.slice(),g=this.targetResolution_,p=this.targetRotation_;const y=[];for(;r<e;++r){const v=arguments[r],x={start:a,complete:!1,anchor:v.anchor,duration:v.duration!==void 0?v.duration:1e3,easing:v.easing||ty,callback:i};if(v.center&&(x.sourceCenter=f,x.targetCenter=v.center.slice(),f=x.targetCenter),v.zoom!==void 0?(x.sourceResolution=g,x.targetResolution=this.getResolutionForZoom(v.zoom),g=x.targetResolution):v.resolution&&(x.sourceResolution=g,x.targetResolution=v.resolution,g=x.targetResolution),v.rotation!==void 0){x.sourceRotation=p;const R=Ar(v.rotation-p+Math.PI,2*Math.PI)-Math.PI;x.targetRotation=p+R,p=x.targetRotation}a0(x)?x.complete=!0:a+=x.duration,y.push(x)}this.animations_.push(y),this.setHint(ge.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ge.ANIMATING]>0}getInteracting(){return this.hints_[ge.INTERACTING]>0}cancelAnimations(){this.setHint(ge.ANIMATING,-this.hints_[ge.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const r=this.animations_[e];if(r[0].callback&&Mo(r[0].callback,!1),!t)for(let a=0,f=r.length;a<f;++a){const g=r[a];if(!g.complete){t=g.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let a=!0;for(let f=0,g=r.length;f<g;++f){const p=r[f];if(p.complete)continue;const y=t-p.start;let v=p.duration>0?y/p.duration:1;v>=1?(p.complete=!0,v=1):a=!1;const x=p.easing(v);if(p.sourceCenter){const R=p.sourceCenter[0],S=p.sourceCenter[1],I=p.targetCenter[0],L=p.targetCenter[1];this.nextCenter_=p.targetCenter;const O=R+x*(I-R),M=S+x*(L-S);this.targetCenter_=[O,M]}if(p.sourceResolution&&p.targetResolution){const R=x===1?p.targetResolution:p.sourceResolution+x*(p.targetResolution-p.sourceResolution);if(p.anchor){const S=this.getViewportSize_(this.getRotation()),I=this.constraints_.resolution(R,0,S,!0);this.targetCenter_=this.calculateCenterZoom(I,p.anchor)}this.nextResolution_=p.targetResolution,this.targetResolution_=R,this.applyTargetState_(!0)}if(p.sourceRotation!==void 0&&p.targetRotation!==void 0){const R=x===1?Ar(p.targetRotation+Math.PI,2*Math.PI)-Math.PI:p.sourceRotation+x*(p.targetRotation-p.sourceRotation);if(p.anchor){const S=this.constraints_.rotation(R,!0);this.targetCenter_=this.calculateCenterRotate(S,p.anchor)}this.nextRotation_=p.targetRotation,this.targetRotation_=R}if(this.applyTargetState_(!0),e=!0,!p.complete)break}if(a){this.animations_[i]=null,this.setHint(ge.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const f=r[0].callback;f&&Mo(f,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-e[0],r[1]-e[1]],oh(i,t-this.getRotation()),Lf(i,e)),i}calculateCenterZoom(t,e){let i;const r=this.getCenterInternal(),a=this.getResolution();if(r!==void 0&&a!==void 0){const f=e[0]-t*(e[0]-r[0])/a,g=e[1]-t*(e[1]-r[1])/a;i=[f,g]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],r=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&bl(t,this.getProjection())}getCenterInternal(){return this.get(ni.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Wf(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Dt(e,"The view center is not defined");const i=this.getResolution();Dt(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return Dt(r!==void 0,"The view rotation is not defined"),Uo(e,i,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(ni.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(pi(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=It(t)/e[0],r=Ht(t)/e[1];return Math.max(i,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(e/i)/Math.log(t);return function(a){return e/Math.pow(t,a*r)}}getRotation(){return this.get(ni.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,a=Math.log(i/r)/e;return function(f){return Math.log(i/f)/e/a}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const a=this.padding_;if(a){const f=this.getViewportSizeMinusPadding_();r=hl(r,this.getViewportSize_(),[f[0]/2+a[3],f[1]/2+a[0]],e,i)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,r;if(this.resolutions_){const a=ca(this.resolutions_,t,1);e=a,i=this.resolutions_[a],a==this.resolutions_.length-1?r=2:r=i/this.resolutions_[a+1]}else i=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(i/t)/Math.log(r)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=re(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(r,re(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(Dt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Dt(!Wr(t),"Cannot fit empty extent provided as `geometry`");const r=pi(t,this.getProjection());i=Ru(r)}else if(t.getType()==="Circle"){const r=pi(t.getExtent(),this.getProjection());i=Ru(r),i.rotate(this.getRotation(),Je(r))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),r=Math.sin(-e),a=t.getFlatCoordinates(),f=t.getStride();let g=1/0,p=1/0,y=-1/0,v=-1/0;for(let x=0,R=a.length;x<R;x+=f){const S=a[x]*i-a[x+1]*r,I=a[x]*r+a[x+1]*i;g=Math.min(g,S),p=Math.min(p,I),y=Math.max(y,S),v=Math.max(v,I)}return[g,p,y,v]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],a=e.nearest!==void 0?e.nearest:!1;let f;e.minResolution!==void 0?f=e.minResolution:e.maxZoom!==void 0?f=this.getResolutionForZoom(e.maxZoom):f=0;const g=this.rotatedExtentForGeometry(t);let p=this.getResolutionForExtentInternal(g,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);p=isNaN(p)?f:Math.max(p,f),p=this.getConstrainedResolution(p,a?0:1);const y=this.getRotation(),v=Math.sin(y),x=Math.cos(y),R=Je(g);R[0]+=(r[1]-r[3])/2*p,R[1]+=(r[0]-r[2])/2*p;const S=R[0]*x-R[1]*v,I=R[1]*x+R[0]*v,L=this.getConstrainedCenter([S,I],p),O=e.callback?e.callback:br;e.duration!==void 0?this.animateInternal({resolution:p,center:L,duration:e.duration,easing:e.easing},O):(this.targetResolution_=p,this.targetCenter_=L,this.applyTargetState_(!1,!0),Mo(O,!0))}centerOn(t,e,i){this.centerOnInternal(bi(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(hl(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,r){let a;const f=this.padding_;if(f&&t){const g=this.getViewportSizeMinusPadding_(-i),p=hl(t,r,[g[0]/2+f[3],g[1]/2+f[0]],e,i);a=[t[0]-p[0],t[1]-p[1]]}return a}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=bl(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&bi(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),a=this.constraints_.resolution(this.targetResolution_*t,0,r,i);e&&(this.targetCenter_=this.calculateCenterZoom(a,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=bi(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&bi(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,i),a=this.getViewportSize_(r),f=this.constraints_.resolution(this.targetResolution_,0,a,i),g=this.constraints_.center(this.targetCenter_,f,a,i,this.calculateCenterShift(this.targetCenter_,f,r,a));this.get(ni.ROTATION)!==r&&this.set(ni.ROTATION,r),this.get(ni.RESOLUTION)!==f&&(this.set(ni.RESOLUTION,f),this.set("zoom",this.getZoom(),!0)),(!g||!this.get(ni.CENTER)||!jo(this.get(ni.CENTER),g))&&this.set(ni.CENTER,g),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const r=e||0,a=this.constraints_.rotation(this.targetRotation_),f=this.getViewportSize_(a),g=this.constraints_.resolution(this.targetResolution_,r,f),p=this.constraints_.center(this.targetCenter_,g,f,!1,this.calculateCenterShift(this.targetCenter_,g,a,f));if(t===0&&!this.cancelAnchor_){this.targetResolution_=g,this.targetRotation_=a,this.targetCenter_=p,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==g||this.getRotation()!==a||!this.getCenterInternal()||!jo(this.getCenterInternal(),p))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:a,center:p,resolution:g,duration:t,easing:Br,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ge.INTERACTING,1)}endInteraction(t,e,i){i=i&&bi(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(ge.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Mo(n,t){setTimeout(function(){n(t)},0)}function r0(n){if(n.extent!==void 0){const e=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return au(n.extent,n.constrainOnlyCenter,e)}const t=fh(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,au(e,!1,!1)}return Zm}function s0(n){let t,e,i,f=n.minZoom!==void 0?n.minZoom:ll,g=n.maxZoom!==void 0?n.maxZoom:28;const p=n.zoomFactor!==void 0?n.zoomFactor:2,y=n.multiWorld!==void 0?n.multiWorld:!1,v=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,x=n.showFullExtent!==void 0?n.showFullExtent:!1,R=fh(n.projection,"EPSG:3857"),S=R.getExtent();let I=n.constrainOnlyCenter,L=n.extent;if(!y&&!L&&R.isGlobal()&&(I=!1,L=S),n.resolutions!==void 0){const O=n.resolutions;e=O[f],i=O[g]!==void 0?O[g]:O[O.length-1],n.constrainResolution?t=Qy(O,v,!I&&L,x):t=wu(e,i,v,!I&&L,x)}else{const M=(S?Math.max(It(S),Ht(S)):360*ah.degrees/R.getMetersPerUnit())/Ih/Math.pow(2,ll),P=M/Math.pow(2,28-ll);e=n.maxResolution,e!==void 0?f=0:e=M/Math.pow(p,f),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=e/Math.pow(p,g):i=M/Math.pow(p,g):i=P),g=f+Math.floor(Math.log(e/i)/Math.log(p)),i=e/Math.pow(p,g-f),n.constrainResolution?t=t0(p,e,i,v,!I&&L,x):t=wu(e,i,v,!I&&L,x)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:f,zoomFactor:p}}function o0(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const e=n.constrainRotation;return e===void 0||e===!0?i0():e===!1?Iu:typeof e=="number"?e0(e):Iu}return wh}function a0(n){return!(n.sourceCenter&&n.targetCenter&&!jo(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function hl(n,t,e,i,r){const a=Math.cos(-r);let f=Math.sin(-r),g=n[0]*a-n[1]*f,p=n[1]*a+n[0]*f;g+=(t[0]/2-e[0])*i,p+=(e[1]-t[1]/2)*i,f=-f;const y=g*a-p*f,v=p*a+g*f;return[y,v]}const Po="ol-hidden",Ca="ol-unselectable",Th="ol-control",Tu="ol-collapsed",l0=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Su=["style","variant","weight","size","lineHeight","family"],td=function(n){const t=n.match(l0);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,r=Su.length;i<r;++i){const a=t[i+1];a!==void 0&&(e[Su[i]]=a)}return e.families=e.family.split(/,\s?/),e};function ee(n,t,e,i){let r;return e&&e.length?r=e.shift():Ql?r=new OffscreenCanvas(n||300,t||300):r=document.createElement("canvas"),n&&(r.width=n),t&&(r.height=t),r.getContext("2d",i)}let cl;function Ho(){return cl||(cl=ee(1,1)),cl}function Ra(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function Au(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function h0(n){for(;n.lastChild;)n.lastChild.remove()}function c0(n,t){const e=n.childNodes;for(let i=0;;++i){const r=e[i],a=t[i];if(!r&&!a)break;if(r!==a){if(!r){n.appendChild(a);continue}if(!a){n.removeChild(r),--i;continue}n.insertBefore(a,r)}}}class Sh extends li{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let i=0,r=this.listenerKeys.length;i<r;++i)Wt(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,t){const i=this.target_??t.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==br&&this.listenerKeys.push(Ot(t,dn.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class u0 extends Sh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",a=t.collapseLabel!==void 0?t.collapseLabel:"",f=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof a=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=a,this.collapseLabel_.className=f):this.collapseLabel_=a;const g=t.label!==void 0?t.label:"i";typeof g=="string"?(this.label_=document.createElement("span"),this.label_.textContent=g,this.label_.className=r):this.label_=g;const p=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(p),this.toggleButton_.addEventListener(mt.CLICK,this.handleClick_.bind(this),!1);const y=e+" "+Ca+" "+Th+(this.collapsed_&&this.collapsible_?" "+Tu:"")+(this.collapsible_?"":" ol-uncollapsible"),v=this.element;v.className=y,v.appendChild(this.toggleButton_),v.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),i=new Set(e.flatMap(r=>r.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(r=>i.add(r)):i.add(this.attributions_)),!this.overrideCollapsible_){const r=!e.some(a=>{var f;return((f=a.getSource())==null?void 0:f.getAttributionsCollapsible())===!1});this.setCollapsible(r)}return Array.from(i)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(r=>Jl(()=>r))),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!In(e,this.renderedAttributions_)){h0(this.ulElement_);for(let r=0,a=e.length;r<a;++r){const f=document.createElement("li");f.innerHTML=e[r],this.ulElement_.appendChild(f)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Tu),this.collapsed_?Au(this.collapseLabel_,this.label_):Au(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class f0 extends Sh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const a=t.tipLabel?t.tipLabel:"Reset rotation",f=document.createElement("button");f.className=e+"-reset",f.setAttribute("type","button"),f.title=a,f.appendChild(this.label_),f.addEventListener(mt.CLICK,this.handleClick_.bind(this),!1);const g=e+" "+Ca+" "+Th,p=this.element;p.className=g,p.appendChild(f),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Po)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Br}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const a=this.element.classList.contains(Po);!a&&i===0?this.element.classList.add(Po):a&&i!==0&&this.element.classList.remove(Po)}this.label_.style.transform=r}this.rotation_=i}}class d0 extends Sh{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",a=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",f=t.zoomInLabel!==void 0?t.zoomInLabel:"+",g=t.zoomOutLabel!==void 0?t.zoomOutLabel:"",p=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",y=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",v=document.createElement("button");v.className=r,v.setAttribute("type","button"),v.title=p,v.appendChild(typeof f=="string"?document.createTextNode(f):f),v.addEventListener(mt.CLICK,this.handleClick_.bind(this,i),!1);const x=document.createElement("button");x.className=a,x.setAttribute("type","button"),x.title=y,x.appendChild(typeof g=="string"?document.createTextNode(g):g),x.addEventListener(mt.CLICK,this.handleClick_.bind(this,-i),!1);const R=e+" "+Ca+" "+Th,S=this.element;S.className=R,S.appendChild(v),S.appendChild(x),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(r!==void 0){const a=i.getConstrainedZoom(r+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:a,duration:this.duration_,easing:Br})):i.setZoom(a)}}}function g0(n){n=n||{};const t=new _i;return(n.zoom!==void 0?n.zoom:!0)&&t.push(new d0(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&t.push(new f0(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&t.push(new u0(n.attributionOptions)),t}class _0{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;const a=this.points_[e]-this.points_[i],f=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(f,a),this.initialVelocity_=Math.sqrt(a*a+f*f)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Lu={ACTIVE:"active"};class $s extends li{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Lu.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Lu.ACTIVE,t)}setMap(t){this.map_=t}}function p0(n,t,e){const i=n.getCenterInternal();if(i){const r=[i[0]+t[0],i[1]+t[1]];n.animateInternal({duration:e!==void 0?e:250,easing:ey,center:n.getConstrainedCenter(r)})}}function Ah(n,t,e,i){const r=n.getZoom();if(r===void 0)return;const a=n.getConstrainedZoom(r+t),f=n.getResolutionForZoom(a);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:f,anchor:e,duration:i!==void 0?i:250,easing:Br})}class m0 extends $s{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==ne.DBLCLICK){const i=t.originalEvent,r=t.map,a=t.coordinate,f=i.shiftKey?-this.delta_:this.delta_,g=r.getView();Ah(g,f,a,this.duration_),i.preventDefault(),e=!0}return!e}}function Nl(n){const t=arguments;return function(e){let i=!0;for(let r=0,a=t.length;r<a&&(i=i&&t[r](e),!!i);++r);return i}}const y0=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},v0=function(n){const t=n.map.getTargetElement(),e=t.getRootNode(),i=n.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(i):t.contains(i)},ed=function(n){const t=n.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?v0(n):!0},E0=Os,id=function(n){const t=n.originalEvent;return t.button==0&&!(Wm&&vf&&t.ctrlKey)},nd=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},x0=function(n){const t=n.originalEvent;return vf?t.metaKey:t.ctrlKey},C0=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},rd=function(n){const t=n.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},ul=function(n){const t=n.originalEvent;return Dt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},R0=function(n){const t=n.originalEvent;return Dt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class qs extends $s{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==ne.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==ne.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==ne.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==ne.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Lh(n){const t=n.length;let e=0,i=0;for(let r=0;r<t;r++)e+=n[r].clientX,i+=n[r].clientY;return{clientX:e/t,clientY:i/t}}class w0 extends qs{constructor(t){super({stopDown:ua}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Nl(nd,R0);this.condition_=t.onFocusOnly?Nl(ed,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,r=e.getEventPixel(Lh(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const a=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],g=t.map.getView();Of(a,g.getResolution()),oh(a,g.getRotation()),g.adjustCenterInternal(a)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),a=this.kinetic_.getAngle(),f=i.getCenterInternal(),g=e.getPixelFromCoordinateInternal(f),p=e.getCoordinateFromPixelInternal([g[0]-r*Math.cos(a),g[1]-r*Math.sin(a)]);i.animateInternal({center:i.getConstrainedCenter(p),duration:500,easing:Br})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class I0 extends qs{constructor(t){t=t||{},super({stopDown:ua}),this.condition_=t.condition?t.condition:y0,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!ul(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===wh)return;const r=e.getSize(),a=t.pixel,f=Math.atan2(r[1]/2-a[1],a[0]-r[0]/2);if(this.lastAngle_!==void 0){const g=f-this.lastAngle_;i.adjustRotationInternal(-g)}this.lastAngle_=f}handleUpEvent(t){return ul(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return ul(t)&&id(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class T0 extends zs{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+i,r.top=Math.min(t[1],e[1])+i,r.width=Math.abs(e[0]-t[0])+i,r.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new zi([r])}getGeometry(){return this.geometry_}}const dr={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class vs extends Qe{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class S0 extends qs{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new T0(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??id,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const r=i[0]-e[0],a=i[1]-e[1];return r*r+a*a>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new vs(dr.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new vs(e?dr.BOXEND:dr.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new vs(dr.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new vs(dr.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new vs(dr.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class A0 extends S0{constructor(t){t=t||{};const e=t.condition?t.condition:C0;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const a=i.rotatedExtentForGeometry(r),f=i.getResolutionForExtentInternal(a),g=i.getResolution()/f;r=r.clone(),r.scale(g*g)}i.fitInternal(r,{duration:this.duration_,easing:Br})}}const bn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class L0 extends $s{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return nd(e)&&rd(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==mt.KEYDOWN){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&(r==bn.DOWN||r==bn.LEFT||r==bn.RIGHT||r==bn.UP)){const f=t.map.getView(),g=f.getResolution()*this.pixelDelta_;let p=0,y=0;r==bn.DOWN?y=-g:r==bn.LEFT?p=-g:r==bn.RIGHT?p=g:y=g;const v=[p,y];oh(v,f.getRotation()),p0(f,v,this.duration_),i.preventDefault(),e=!0}}return!e}}class O0 extends $s{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!x0(e)&&rd(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==mt.KEYDOWN||t.type==mt.KEYPRESS){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&(r==="+"||r==="-")){const a=t.map,f=r==="+"?this.delta_:-this.delta_,g=a.getView();Ah(g,f,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}class M0 extends $s{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:E0;this.condition_=t.onFocusOnly?Nl(ed,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==mt.WHEEL)return!0;const i=t.map,r=t.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let a;if(t.type==mt.WHEEL&&(a=r.deltaY,Xm&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(a/=Ef),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(a*=40)),a===0)return!1;this.lastDelta_=a;const f=Date.now();this.startTime_===void 0&&(this.startTime_=f),(!this.mode_||f-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(a)<4?"trackpad":"wheel");const g=i.getView();if(this.mode_==="trackpad"&&!(g.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(g.getAnimating()&&g.cancelAnimations(),g.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),g.adjustZoom(-a/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=f,!1;this.totalDelta_+=a;const p=Math.max(this.timeout_-(f-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),p),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-re(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Ah(e,i,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class P0 extends qs{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ua),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],r=this.targetPointers[1],a=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const p=a-this.lastAngle_;this.rotationDelta_+=p,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=p}this.lastAngle_=a;const f=t.map,g=f.getView();g.getConstraints().rotation!==wh&&(this.anchor_=f.getCoordinateFromPixelInternal(f.getEventPixel(Lh(this.targetPointers))),this.rotating_&&(f.render(),g.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class D0 extends qs{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ua),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],r=this.targetPointers[1],a=i.clientX-r.clientX,f=i.clientY-r.clientY,g=Math.sqrt(a*a+f*f);this.lastDistance_!==void 0&&(e=this.lastDistance_/g),this.lastDistance_=g;const p=t.map,y=p.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=p.getCoordinateFromPixelInternal(p.getEventPixel(Lh(this.targetPointers))),p.render(),y.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function F0(n){n=n||{};const t=new _i,e=new _0(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&t.push(new I0),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&t.push(new m0({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&t.push(new w0({onFocusOnly:n.onFocusOnly,kinetic:e})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&t.push(new P0),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&t.push(new D0({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(t.push(new L0),t.push(new O0({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&t.push(new M0({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&t.push(new A0({duration:n.zoomDuration})),t}const Nt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class sd extends li{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Nt.OPACITY]=t.opacity!==void 0?t.opacity:1,Dt(typeof e[Nt.OPACITY]=="number","Layer opacity must be a number"),e[Nt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Nt.Z_INDEX]=t.zIndex,e[Nt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Nt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Nt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Nt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=re(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Ct()}getLayerStatesArray(t){return Ct()}getExtent(){return this.get(Nt.EXTENT)}getMaxResolution(){return this.get(Nt.MAX_RESOLUTION)}getMinResolution(){return this.get(Nt.MIN_RESOLUTION)}getMinZoom(){return this.get(Nt.MIN_ZOOM)}getMaxZoom(){return this.get(Nt.MAX_ZOOM)}getOpacity(){return this.get(Nt.OPACITY)}getSourceState(){return Ct()}getVisible(){return this.get(Nt.VISIBLE)}getZIndex(){return this.get(Nt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Nt.EXTENT,t)}setMaxResolution(t){this.set(Nt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Nt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Nt.MAX_ZOOM,t)}setMinZoom(t){this.set(Nt.MIN_ZOOM,t)}setOpacity(t){Dt(typeof t=="number","Layer opacity must be a number"),this.set(Nt.OPACITY,t)}setVisible(t){this.set(Nt.VISIBLE,t)}setZIndex(t){this.set(Nt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class _n extends Qe{constructor(t,e){super(t),this.layer=e}}const fl={LAYERS:"layers"};class zr extends sd{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(fl.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new _i(i.slice(),{unique:!0}):Dt(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new _i(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Wt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(Ot(t,Oe.ADD,this.handleLayersAdd_,this),Ot(t,Oe.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(Wt);Us(this.listenerKeys_);const e=t.getArray();for(let i=0,r=e.length;i<r;i++){const a=e[i];this.registerLayerListeners_(a),this.dispatchEvent(new _n("addlayer",a))}this.changed()}registerLayerListeners_(t){const e=[Ot(t,Fr.PROPERTYCHANGE,this.handleLayerChange_,this),Ot(t,mt.CHANGE,this.handleLayerChange_,this)];t instanceof zr&&e.push(Ot(t,"addlayer",this.handleLayerGroupAdd_,this),Ot(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Mt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new _n("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new _n("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new _n("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=Mt(e);this.listenerKeys_[i].forEach(Wt),delete this.listenerKeys_[i],this.dispatchEvent(new _n("removelayer",e)),this.changed()}getLayers(){return this.get(fl.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let r=0,a=i.length;r<a;++r)this.dispatchEvent(new _n("removelayer",i[r]))}this.set(fl.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(f){f.getLayerStatesArray(e)});const r=this.getLayerState();let a=r.zIndex;!t&&r.zIndex===void 0&&(a=0);for(let f=i,g=e.length;f<g;f++){const p=e[f];p.opacity*=r.opacity,p.visible=p.visible&&r.visible,p.maxResolution=Math.min(p.maxResolution,r.maxResolution),p.minResolution=Math.max(p.minResolution,r.minResolution),p.minZoom=Math.max(p.minZoom,r.minZoom),p.maxZoom=Math.min(p.maxZoom,r.maxZoom),r.extent!==void 0&&(p.extent!==void 0?p.extent=Ne(p.extent,r.extent):p.extent=r.extent),p.zIndex===void 0&&(p.zIndex=a)}return e}getSourceState(){return"ready"}}const He={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Js extends sd{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Nt.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Nt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Wt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=Ot(t,mt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof di?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;if(e.layerStatesArray){if(r=e.layerStatesArray.find(f=>f.layer===this),!r)return!1}else r=this.getLayerState();const a=this.getExtent();return Oh(r,e.viewState)&&(!a||Re(a,e.extent))}getAttributions(t){var a;if(!this.isVisible(t))return[];const e=(a=this.getSource())==null?void 0:a.getAttributions();if(!e)return[];const i=t instanceof di?t.getViewStateAndExtent():t;let r=e(i);return Array.isArray(r)||(r=[r]),r}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Nt.MAP,t)}getMapInternal(){return this.get(Nt.MAP)}setMap(t){this.mapPrecomposeKey_&&(Wt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Wt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Ot(t,He.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=Ot(this,mt.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);Dt(!e.some(r=>r.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(i)}setSource(t){this.set(Nt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Oh(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}function od(n,t,e=0,i=n.length-1,r=b0){for(;i>e;){if(i-e>600){const p=i-e+1,y=t-e+1,v=Math.log(p),x=.5*Math.exp(2*v/3),R=.5*Math.sqrt(v*x*(p-x)/p)*(y-p/2<0?-1:1),S=Math.max(e,Math.floor(t-y*x/p+R)),I=Math.min(i,Math.floor(t+(p-y)*x/p+R));od(n,t,S,I,r)}const a=n[t];let f=e,g=i;for(Es(n,e,t),r(n[i],a)>0&&Es(n,e,i);f<g;){for(Es(n,f,g),f++,g--;r(n[f],a)<0;)f++;for(;r(n[g],a)>0;)g--}r(n[e],a)===0?Es(n,e,g):(g++,Es(n,g,i)),g<=t&&(e=g+1),t<=g&&(i=g-1)}}function Es(n,t,e){const i=n[t];n[t]=n[e],n[e]=i}function b0(n,t){return n<t?-1:n>t?1:0}let ad=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Fo(t,e))return i;const r=this.toBBox,a=[];for(;e;){for(let f=0;f<e.children.length;f++){const g=e.children[f],p=e.leaf?r(g):g;Fo(t,p)&&(e.leaf?i.push(g):gl(t,p)?this._all(g,i):a.push(g))}e=a.pop()}return i}collides(t){let e=this.data;if(!Fo(t,e))return!1;const i=[];for(;e;){for(let r=0;r<e.children.length;r++){const a=e.children[r],f=e.leaf?this.toBBox(a):a;if(Fo(t,f)){if(e.leaf||gl(t,f))return!0;i.push(a)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=xr([]),this}remove(t,e){if(!t)return this;let i=this.data;const r=this.toBBox(t),a=[],f=[];let g,p,y;for(;i||a.length;){if(i||(i=a.pop(),p=a[a.length-1],g=f.pop(),y=!0),i.leaf){const v=G0(t,i.children,e);if(v!==-1)return i.children.splice(v,1),a.push(i),this._condense(a),this}!y&&!i.leaf&&gl(i,r)?(a.push(i),f.push(g),g=0,p=i,i=i.children[0]):p?(g++,i=p.children[g],y=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,r){const a=i-e+1;let f=this._maxEntries,g;if(a<=f)return g=xr(t.slice(e,i+1)),gr(g,this.toBBox),g;r||(r=Math.ceil(Math.log(a)/Math.log(f)),f=Math.ceil(a/Math.pow(f,r-1))),g=xr([]),g.leaf=!1,g.height=r;const p=Math.ceil(a/f),y=p*Math.ceil(Math.sqrt(f));Ou(t,e,i,y,this.compareMinX);for(let v=e;v<=i;v+=y){const x=Math.min(v+y-1,i);Ou(t,v,x,p,this.compareMinY);for(let R=v;R<=x;R+=p){const S=Math.min(R+p-1,x);g.children.push(this._build(t,R,S,r-1))}}return gr(g,this.toBBox),g}_chooseSubtree(t,e,i,r){for(;r.push(e),!(e.leaf||r.length-1===i);){let a=1/0,f=1/0,g;for(let p=0;p<e.children.length;p++){const y=e.children[p],v=dl(y),x=X0(t,y)-v;x<f?(f=x,a=v<a?v:a,g=y):x===f&&v<a&&(a=v,g=y)}e=g||e.children[0]}return e}_insert(t,e,i){const r=i?t:this.toBBox(t),a=[],f=this._chooseSubtree(r,this.data,e,a);for(f.children.push(t),ws(f,r);e>=0&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(r,a,e)}_split(t,e){const i=t[e],r=i.children.length,a=this._minEntries;this._chooseSplitAxis(i,a,r);const f=this._chooseSplitIndex(i,a,r),g=xr(i.children.splice(f,i.children.length-f));g.height=i.height,g.leaf=i.leaf,gr(i,this.toBBox),gr(g,this.toBBox),e?t[e-1].children.push(g):this._splitRoot(i,g)}_splitRoot(t,e){this.data=xr([t,e]),this.data.height=t.height+1,this.data.leaf=!1,gr(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let r,a=1/0,f=1/0;for(let g=e;g<=i-e;g++){const p=Rs(t,0,g,this.toBBox),y=Rs(t,g,i,this.toBBox),v=Y0(p,y),x=dl(p)+dl(y);v<a?(a=v,r=g,f=x<f?x:f):v===a&&x<f&&(f=x,r=g)}return r||i-e}_chooseSplitAxis(t,e,i){const r=t.leaf?this.compareMinX:k0,a=t.leaf?this.compareMinY:N0,f=this._allDistMargin(t,e,i,r),g=this._allDistMargin(t,e,i,a);f<g&&t.children.sort(r)}_allDistMargin(t,e,i,r){t.children.sort(r);const a=this.toBBox,f=Rs(t,0,e,a),g=Rs(t,i-e,i,a);let p=Do(f)+Do(g);for(let y=e;y<i-e;y++){const v=t.children[y];ws(f,t.leaf?a(v):v),p+=Do(f)}for(let y=i-e-1;y>=e;y--){const v=t.children[y];ws(g,t.leaf?a(v):v),p+=Do(g)}return p}_adjustParentBBoxes(t,e,i){for(let r=i;r>=0;r--)ws(e[r],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():gr(t[e],this.toBBox)}};function G0(n,t,e){if(!e)return t.indexOf(n);for(let i=0;i<t.length;i++)if(e(n,t[i]))return i;return-1}function gr(n,t){Rs(n,0,n.children.length,t,n)}function Rs(n,t,e,i,r){r||(r=xr(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let a=t;a<e;a++){const f=n.children[a];ws(r,n.leaf?i(f):f)}return r}function ws(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function k0(n,t){return n.minX-t.minX}function N0(n,t){return n.minY-t.minY}function dl(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Do(n){return n.maxX-n.minX+(n.maxY-n.minY)}function X0(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function Y0(n,t){const e=Math.max(n.minX,t.minX),i=Math.max(n.minY,t.minY),r=Math.min(n.maxX,t.maxX),a=Math.min(n.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,a-i)}function gl(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function Fo(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function xr(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ou(n,t,e,i,r){const a=[t,e];for(;a.length;){if(e=a.pop(),t=a.pop(),e-t<=i)continue;const f=t+Math.ceil((e-t)/i/2)*i;od(n,f,t,e,r),a.push(t,f,f,e)}}const Mu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Pu={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function W0(n){var v,x;var t,e=[],i=1,r;if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(n=String(n).toLowerCase(),Mu[n])e=Mu[n].slice(),r="rgb";else if(n==="transparent")i=0,r="rgb",e=[0,0,0];else if(n[0]==="#"){var a=n.slice(1),f=a.length,g=f<=4;i=1,g?(e=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],f===4&&(i=parseInt(a[3]+a[3],16)/255)):(e=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],f===8&&(i=parseInt(a[6]+a[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(n)){var p=t[1];r=p.replace(/a$/,"");var y=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(R,S){if(R[R.length-1]==="%")return R=parseFloat(R)/100,S===3?R:r==="rgb"?R*255:r[0]==="h"||r[0]==="l"&&!S?R*100:r==="lab"?R*125:r==="lch"?S<2?R*150:R*360:r[0]==="o"&&!S?R:r==="oklab"?R*.4:r==="oklch"?S<2?R*.4:R*360:R;if(r[S]==="h"||S===2&&r[r.length-1]==="h"){if(Pu[R]!==void 0)return Pu[R];if(R.endsWith("deg"))return parseFloat(R);if(R.endsWith("turn"))return parseFloat(R)*360;if(R.endsWith("grad"))return parseFloat(R)*360/400;if(R.endsWith("rad"))return parseFloat(R)*180/Math.PI}return R==="none"?0:parseFloat(R)}),i=e.length>y?e.pop():1}else/[0-9](?:\s|\/|,)/.test(n)&&(e=n.match(/([0-9]+)/g).map(function(R){return parseFloat(R)}),r=((x=(v=n.match(/([a-z])/ig))==null?void 0:v.join(""))==null?void 0:x.toLowerCase())||"rgb");return{space:r,values:e,alpha:i}}const Gs={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var _l={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(n){var t=n[0]/360,e=n[1]/100,i=n[2]/100,r,a,f,g,p,y=0;if(e===0)return p=i*255,[p,p,p];for(a=i<.5?i*(1+e):i+e-i*e,r=2*i-a,g=[0,0,0];y<3;)f=t+1/3*-(y-1),f<0?f++:f>1&&f--,p=6*f<1?r+(a-r)*6*f:2*f<1?a:3*f<2?r+(a-r)*(2/3-f)*6:r,g[y++]=p*255;return g}};Gs.hsl=function(n){var t=n[0]/255,e=n[1]/255,i=n[2]/255,r=Math.min(t,e,i),a=Math.max(t,e,i),f=a-r,g,p,y;return a===r?g=0:t===a?g=(e-i)/f:e===a?g=2+(i-t)/f:i===a&&(g=4+(t-e)/f),g=Math.min(g*60,360),g<0&&(g+=360),y=(r+a)/2,a===r?p=0:y<=.5?p=f/(a+r):p=f/(2-a-r),[g,p*100,y*100]};function B0(n){Array.isArray(n)&&n.raw&&(n=String.raw(...arguments)),n instanceof Number&&(n=+n);var t,e=W0(n);if(!e.space)return[];const i=e.space[0]==="h"?_l.min:Gs.min,r=e.space[0]==="h"?_l.max:Gs.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),r[2]),e.space[0]==="h"&&(t=_l.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const Ee={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};Ee.max=Ee.whitepoint[2].D65;Ee.rgb=function(n,t){t=t||Ee.whitepoint[2].E;var e=n[0]/t[0],i=n[1]/t[1],r=n[2]/t[2],a,f,g;return a=e*3.240969941904521+i*-1.537383177570093+r*-.498610760293,f=e*-.96924363628087+i*1.87596750150772+r*.041555057407175,g=e*.055630079696993+i*-.20397695888897+r*1.056971514242878,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,f=f>.0031308?1.055*Math.pow(f,1/2.4)-.055:f=f*12.92,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:g=g*12.92,a=Math.min(Math.max(0,a),1),f=Math.min(Math.max(0,f),1),g=Math.min(Math.max(0,g),1),[a*255,f*255,g*255]};Gs.xyz=function(n,t){var e=n[0]/255,i=n[1]/255,r=n[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var a=e*.41239079926595+i*.35758433938387+r*.18048078840183,f=e*.21263900587151+i*.71516867876775+r*.072192315360733,g=e*.019330818715591+i*.11919477979462+r*.95053215224966;return t=t||Ee.whitepoint[2].E,[a*t[0],f*t[1],g*t[2]]};var Mh={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(n,t,e){var i,r,a,f,g,p,y,v,x,R,S,I,L;if(a=n[0],f=n[1],g=n[2],a===0)return[0,0,0];var O=.0011070564598794539;return t=t||"D65",e=e||2,x=Ee.whitepoint[e][t][0],R=Ee.whitepoint[e][t][1],S=Ee.whitepoint[e][t][2],I=4*x/(x+15*R+3*S),L=9*R/(x+15*R+3*S),i=f/(13*a)+I||0,r=g/(13*a)+L||0,y=a>8?R*Math.pow((a+16)/116,3):R*a*O,p=y*9*i/(4*r)||0,v=y*(12-3*i-20*r)/(4*r)||0,[p,y,v]}};Ee.luv=function(n,t,e){var i,r,a,f,g,p,y,v,x,R,S,I,L,O=.008856451679035631,M=903.2962962962961;t=t||"D65",e=e||2,x=Ee.whitepoint[e][t][0],R=Ee.whitepoint[e][t][1],S=Ee.whitepoint[e][t][2],I=4*x/(x+15*R+3*S),L=9*R/(x+15*R+3*S),p=n[0],y=n[1],v=n[2],i=4*p/(p+15*y+3*v)||0,r=9*y/(p+15*y+3*v)||0;var P=y/R;return a=P<=O?M*P:116*Math.pow(P,1/3)-16,f=13*a*(i-I),g=13*a*(r-L),[a,f,g]};var ld={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(n){var t=n[0],e=n[1],i=n[2],r,a,f;return f=i/360*2*Math.PI,r=e*Math.cos(f),a=e*Math.sin(f),[t,r,a]},xyz:function(n){return Mh.xyz(ld.luv(n))}};Mh.lchuv=function(n){var t=n[0],e=n[1],i=n[2],r=Math.sqrt(e*e+i*i),a=Math.atan2(i,e),f=a*360/2/Math.PI;return f<0&&(f+=360),[t,r,f]};Ee.lchuv=function(n){return Mh.lchuv(Ee.luv(n))};const Ph=[NaN,NaN,NaN,0];function z0(n){return typeof n=="string"?n:Fh(n)}const U0=1024,xs={};let pl=0;function j0(n){if(n.length===4)return n;const t=n.slice();return t[3]=1,t}function Du(n){const t=Ee.lchuv(Gs.xyz(n));return t[3]=n[3],t}function V0(n){const t=Ee.rgb(ld.xyz(n));return t[3]=n[3],t}function Dh(n){if(n==="none")return Ph;if(xs.hasOwnProperty(n))return xs[n];if(pl>=U0){let e=0;for(const i in xs)(e++&3)===0&&(delete xs[i],--pl)}const t=B0(n);if(t.length!==4)throw new Error('failed to parse "'+n+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+n+'" as color');return hd(t),xs[n]=t,++pl,t}function kr(n){return Array.isArray(n)?n:Dh(n)}function hd(n){return n[0]=re(n[0]+.5|0,0,255),n[1]=re(n[1]+.5|0,0,255),n[2]=re(n[2]+.5|0,0,255),n[3]=re(n[3],0,1),n}function Fh(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+r+")"}function Fu(n){return n[0]>0&&n[1]>0}function K0(n,t,e){return e===void 0&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}function pe(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}let Jn=0;const Ce=1<<Jn++,Lt=1<<Jn++,Me=1<<Jn++,ri=1<<Jn++,Kn=1<<Jn++,Is=1<<Jn++,bo=Math.pow(2,Jn)-1,bh={[Ce]:"boolean",[Lt]:"number",[Me]:"string",[ri]:"color",[Kn]:"number[]",[Is]:"size"},Z0=Object.keys(bh).map(Number).sort(Xi);function H0(n){return n in bh}function Ts(n){const t=[];for(const e of Z0)Ss(n,e)&&t.push(bh[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Ss(n,t){return(n&t)===t}function an(n,t){return n===t}class he{constructor(t,e){if(!H0(t))throw new Error(`literal expressions must have a specific type, got ${Ts(t)}`);this.type=t,this.value=e}}class $0{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function cd(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function me(n,t,e){switch(typeof n){case"boolean":{if(an(t,Me))return new he(Me,n?"true":"false");if(!Ss(t,Ce))throw new Error(`got a boolean, but expected ${Ts(t)}`);return new he(Ce,n)}case"number":{if(an(t,Is))return new he(Is,pe(n));if(an(t,Ce))return new he(Ce,!!n);if(an(t,Me))return new he(Me,n.toString());if(!Ss(t,Lt))throw new Error(`got a number, but expected ${Ts(t)}`);return new he(Lt,n)}case"string":{if(an(t,ri))return new he(ri,Dh(n));if(an(t,Ce))return new he(Ce,!!n);if(!Ss(t,Me))throw new Error(`got a string, but expected ${Ts(t)}`);return new he(Me,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return av(n,t,e);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(an(t,Is)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new he(Is,n)}if(an(t,ri)){if(n.length===3)return new he(ri,[...n,1]);if(n.length===4)return new he(ri,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!Ss(t,Kn))throw new Error(`got an array of numbers, but expected ${Ts(t)}`);return new he(Kn,n)}const B={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},q0={[B.Get]:xt(wt(1,1/0),bu),[B.Var]:xt(wt(1,1),J0),[B.Has]:xt(wt(1,1/0),bu),[B.Id]:xt(Q0,_r),[B.Concat]:xt(wt(2,1/0),Gt(Me)),[B.GeometryType]:xt(tv,_r),[B.LineMetric]:xt(_r),[B.Resolution]:xt(ml,_r),[B.Zoom]:xt(ml,_r),[B.Time]:xt(ml,_r),[B.Any]:xt(wt(2,1/0),Gt(Ce)),[B.All]:xt(wt(2,1/0),Gt(Ce)),[B.Not]:xt(wt(1,1),Gt(Ce)),[B.Equal]:xt(wt(2,2),Gt(bo)),[B.NotEqual]:xt(wt(2,2),Gt(bo)),[B.GreaterThan]:xt(wt(2,2),Gt(Lt)),[B.GreaterThanOrEqualTo]:xt(wt(2,2),Gt(Lt)),[B.LessThan]:xt(wt(2,2),Gt(Lt)),[B.LessThanOrEqualTo]:xt(wt(2,2),Gt(Lt)),[B.Multiply]:xt(wt(2,1/0),Gu),[B.Coalesce]:xt(wt(2,1/0),Gu),[B.Divide]:xt(wt(2,2),Gt(Lt)),[B.Add]:xt(wt(2,1/0),Gt(Lt)),[B.Subtract]:xt(wt(2,2),Gt(Lt)),[B.Clamp]:xt(wt(3,3),Gt(Lt)),[B.Mod]:xt(wt(2,2),Gt(Lt)),[B.Pow]:xt(wt(2,2),Gt(Lt)),[B.Abs]:xt(wt(1,1),Gt(Lt)),[B.Floor]:xt(wt(1,1),Gt(Lt)),[B.Ceil]:xt(wt(1,1),Gt(Lt)),[B.Round]:xt(wt(1,1),Gt(Lt)),[B.Sin]:xt(wt(1,1),Gt(Lt)),[B.Cos]:xt(wt(1,1),Gt(Lt)),[B.Atan]:xt(wt(1,2),Gt(Lt)),[B.Sqrt]:xt(wt(1,1),Gt(Lt)),[B.Match]:xt(wt(4,1/0),ku,iv),[B.Between]:xt(wt(3,3),Gt(Lt)),[B.Interpolate]:xt(wt(6,1/0),ku,nv),[B.Case]:xt(wt(3,1/0),ev,rv),[B.In]:xt(wt(2,2),sv),[B.Number]:xt(wt(1,1/0),Gt(bo)),[B.String]:xt(wt(1,1/0),Gt(bo)),[B.Array]:xt(wt(1,1/0),Gt(Lt)),[B.Color]:xt(wt(1,4),Gt(Lt)),[B.Band]:xt(wt(1,3),Gt(Lt)),[B.Palette]:xt(wt(2,2),ov),[B.ToString]:xt(wt(1,1),Gt(Ce|Lt|Me|ri))};function bu(n,t,e){const i=n.length-1,r=new Array(i);for(let a=0;a<i;++a){const f=n[a+1];switch(typeof f){case"number":{r[a]=new he(Lt,f);break}case"string":{r[a]=new he(Me,f);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${f}`)}a===0&&e.properties.add(String(f))}return r}function J0(n,t,e){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return e.variables.add(i),[new he(Me,i)]}function Q0(n,t,e){e.featureId=!0}function tv(n,t,e){e.geometryType=!0}function ml(n,t,e){e.mapState=!0}function _r(n,t,e){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function wt(n,t){return function(e,i,r){const a=e[0],f=e.length-1;if(n===t){if(f!==n){const g=n===1?"":"s";throw new Error(`expected ${n} argument${g} for ${a}, got ${f}`)}}else if(f<n||f>t){const g=t===1/0?`${n} or more`:`${n} to ${t}`;throw new Error(`expected ${g} arguments for ${a}, got ${f}`)}}}function Gu(n,t,e){const i=n.length-1,r=new Array(i);for(let a=0;a<i;++a){const f=me(n[a+1],t,e);r[a]=f}return r}function Gt(n){return function(t,e,i){const r=t.length-1,a=new Array(r);for(let f=0;f<r;++f){const g=me(t[f+1],n,i);a[f]=g}return a}}function ev(n,t,e){const i=n[0],r=n.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${r} instead`)}function ku(n,t,e){const i=n[0],r=n.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${r} instead`)}function iv(n,t,e){const i=n.length-1,r=Me|Lt|Ce,a=me(n[1],r,e),f=me(n[n.length-1],t,e),g=new Array(i-2);for(let p=0;p<i-2;p+=2){try{const y=me(n[p+2],a.type,e);g[p]=y}catch(y){throw new Error(`failed to parse argument ${p+1} of match expression: ${y.message}`)}try{const y=me(n[p+3],f.type,e);g[p+1]=y}catch(y){throw new Error(`failed to parse argument ${p+2} of match expression: ${y.message}`)}}return[a,...g,f]}function nv(n,t,e){const i=n[1];let r;switch(i[0]){case"linear":r=1;break;case"exponential":const p=i[1];if(typeof p!="number"||p<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(p)} instead`);r=p;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const a=new he(Lt,r);let f;try{f=me(n[2],Lt,e)}catch(p){throw new Error(`failed to parse argument 1 in interpolate expression: ${p.message}`)}const g=new Array(n.length-3);for(let p=0;p<g.length;p+=2){try{const y=me(n[p+3],Lt,e);g[p]=y}catch(y){throw new Error(`failed to parse argument ${p+2} for interpolate expression: ${y.message}`)}try{const y=me(n[p+4],t,e);g[p+1]=y}catch(y){throw new Error(`failed to parse argument ${p+3} for interpolate expression: ${y.message}`)}}return[a,f,...g]}function rv(n,t,e){const i=me(n[n.length-1],t,e),r=new Array(n.length-1);for(let a=0;a<r.length-1;a+=2){try{const f=me(n[a+1],Ce,e);r[a]=f}catch(f){throw new Error(`failed to parse argument ${a} of case expression: ${f.message}`)}try{const f=me(n[a+2],i.type,e);r[a+1]=f}catch(f){throw new Error(`failed to parse argument ${a+1} of case expression: ${f.message}`)}}return r[r.length-1]=i,r}function sv(n,t,e){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],r=Me}else r=Lt;const a=new Array(i.length);for(let g=0;g<a.length;g++)try{const p=me(i[g],r,e);a[g]=p}catch(p){throw new Error(`failed to parse haystack item ${g} for "in" expression: ${p.message}`)}return[me(n[1],r,e),...a]}function ov(n,t,e){let i;try{i=me(n[1],Lt,e)}catch(f){throw new Error(`failed to parse first argument in palette expression: ${f.message}`)}const r=n[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const a=new Array(r.length);for(let f=0;f<a.length;f++){let g;try{g=me(r[f],ri,e)}catch(p){throw new Error(`failed to parse color at index ${f} in palette expression: ${p.message}`)}if(!(g instanceof he))throw new Error(`the palette color at index ${f} must be a literal value`);a[f]=g}return[i,...a]}function xt(...n){return function(t,e,i){const r=t[0];let a;for(let f=0;f<n.length;f++){const g=n[f](t,e,i);if(f==n.length-1){if(!g)throw new Error("expected last argument validator to return the parsed args");a=g}}return new $0(e,r,...a)}}function av(n,t,e){const i=n[0],r=q0[i];if(!r)throw new Error(`unknown operator: ${i}`);return r(n,t,e)}function ud(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return ud(n.getGeometries()[0]);default:return""}}function fd(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Ui(n,t,e){const i=me(n,t,e);return ai(i)}function ai(n,t){if(n instanceof he){if(n.type===ri&&typeof n.value=="string"){const i=Dh(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case B.Number:case B.String:case B.Coalesce:return lv(n);case B.Get:case B.Var:case B.Has:return hv(n);case B.Id:return i=>i.featureId;case B.GeometryType:return i=>i.geometryType;case B.Concat:{const i=n.args.map(r=>ai(r));return r=>"".concat(...i.map(a=>a(r).toString()))}case B.Resolution:return i=>i.resolution;case B.Any:case B.All:case B.Between:case B.In:case B.Not:return uv(n);case B.Equal:case B.NotEqual:case B.LessThan:case B.LessThanOrEqualTo:case B.GreaterThan:case B.GreaterThanOrEqualTo:return cv(n);case B.Multiply:case B.Divide:case B.Add:case B.Subtract:case B.Clamp:case B.Mod:case B.Pow:case B.Abs:case B.Floor:case B.Ceil:case B.Round:case B.Sin:case B.Cos:case B.Atan:case B.Sqrt:return fv(n);case B.Case:return dv(n);case B.Match:return gv(n);case B.Interpolate:return _v(n);case B.ToString:return pv(n);default:throw new Error(`Unsupported operator ${e}`)}}function lv(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let a=0;a<i;++a)r[a]=ai(n.args[a]);switch(e){case B.Coalesce:return a=>{for(let f=0;f<i;++f){const g=r[f](a);if(typeof g<"u"&&g!==null)return g}throw new Error("Expected one of the values to be non-null")};case B.Number:case B.String:return a=>{for(let f=0;f<i;++f){const g=r[f](a);if(typeof g===e)return g}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function hv(n,t){const i=n.args[0].value;switch(n.operator){case B.Get:return r=>{const a=n.args;let f=r.properties[i];for(let g=1,p=a.length;g<p;++g){const v=a[g].value;f=f[v]}return f};case B.Var:return r=>r.variables[i];case B.Has:return r=>{const a=n.args;if(!(i in r.properties))return!1;let f=r.properties[i];for(let g=1,p=a.length;g<p;++g){const v=a[g].value;if(!f||!Object.hasOwn(f,v))return!1;f=f[v]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function cv(n,t){const e=n.operator,i=ai(n.args[0]),r=ai(n.args[1]);switch(e){case B.Equal:return a=>i(a)===r(a);case B.NotEqual:return a=>i(a)!==r(a);case B.LessThan:return a=>i(a)<r(a);case B.LessThanOrEqualTo:return a=>i(a)<=r(a);case B.GreaterThan:return a=>i(a)>r(a);case B.GreaterThanOrEqualTo:return a=>i(a)>=r(a);default:throw new Error(`Unsupported comparison operator ${e}`)}}function uv(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let a=0;a<i;++a)r[a]=ai(n.args[a]);switch(e){case B.Any:return a=>{for(let f=0;f<i;++f)if(r[f](a))return!0;return!1};case B.All:return a=>{for(let f=0;f<i;++f)if(!r[f](a))return!1;return!0};case B.Between:return a=>{const f=r[0](a),g=r[1](a),p=r[2](a);return f>=g&&f<=p};case B.In:return a=>{const f=r[0](a);for(let g=1;g<i;++g)if(f===r[g](a))return!0;return!1};case B.Not:return a=>!r[0](a);default:throw new Error(`Unsupported logical operator ${e}`)}}function fv(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let a=0;a<i;++a)r[a]=ai(n.args[a]);switch(e){case B.Multiply:return a=>{let f=1;for(let g=0;g<i;++g)f*=r[g](a);return f};case B.Divide:return a=>r[0](a)/r[1](a);case B.Add:return a=>{let f=0;for(let g=0;g<i;++g)f+=r[g](a);return f};case B.Subtract:return a=>r[0](a)-r[1](a);case B.Clamp:return a=>{const f=r[0](a),g=r[1](a);if(f<g)return g;const p=r[2](a);return f>p?p:f};case B.Mod:return a=>r[0](a)%r[1](a);case B.Pow:return a=>Math.pow(r[0](a),r[1](a));case B.Abs:return a=>Math.abs(r[0](a));case B.Floor:return a=>Math.floor(r[0](a));case B.Ceil:return a=>Math.ceil(r[0](a));case B.Round:return a=>Math.round(r[0](a));case B.Sin:return a=>Math.sin(r[0](a));case B.Cos:return a=>Math.cos(r[0](a));case B.Atan:return i===2?a=>Math.atan2(r[0](a),r[1](a)):a=>Math.atan(r[0](a));case B.Sqrt:return a=>Math.sqrt(r[0](a));default:throw new Error(`Unsupported numeric operator ${e}`)}}function dv(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=ai(n.args[r]);return r=>{for(let a=0;a<e-1;a+=2)if(i[a](r))return i[a+1](r);return i[e-1](r)}}function gv(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=ai(n.args[r]);return r=>{const a=i[0](r);for(let f=1;f<e;f+=2)if(a===i[f](r))return i[f+1](r);return i[e-1](r)}}function _v(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=ai(n.args[r]);return r=>{const a=i[0](r),f=i[1](r);let g,p;for(let y=2;y<e;y+=2){const v=i[y](r);let x=i[y+1](r);const R=Array.isArray(x);if(R&&(x=j0(x)),v>=f)return y===2?x:R?mv(a,f,g,p,v,x):As(a,f,g,p,v,x);g=v,p=x}return p}}function pv(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let a=0;a<i;++a)r[a]=ai(n.args[a]);switch(e){case B.ToString:return a=>{const f=r[0](a);return n.args[0].type===ri?Fh(f):f.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function As(n,t,e,i,r,a){const f=r-e;if(f===0)return i;const g=t-e,p=n===1?g/f:(Math.pow(n,g)-1)/(Math.pow(n,f)-1);return i+p*(a-i)}function mv(n,t,e,i,r,a){if(r-e===0)return i;const g=Du(i),p=Du(a);let y=p[2]-g[2];y>180?y-=360:y<-180&&(y+=360);const v=[As(n,t,e,g[0],r,p[0]),As(n,t,e,g[1],r,p[1]),g[2]+As(n,t,e,0,r,y),As(n,t,e,i[3],r,a[3])];return hd(V0(v))}const lt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Gh extends js{constructor(t,e,i,r){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=typeof r=="function"?lt.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(mt.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==lt.IDLE&&this.loader){this.state=lt.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;Jl(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||Bm&&i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=lt.LOADED}).catch(i=>{this.state=lt.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function yv(n,t,e){const i=n;let r=!0,a=!1,f=!1;const g=[Wo(i,mt.LOAD,function(){f=!0,a||t()})];return i.src&&xf?(a=!0,i.decode().then(function(){r&&t()}).catch(function(p){r&&(f?t():e())})):g.push(Wo(i,mt.ERROR,e)),function(){r=!1,g.forEach(Wt)}}function vv(n,t){return new Promise((e,i)=>{function r(){f(),e(n)}function a(){f(),i(new Error("Image load error"))}function f(){n.removeEventListener("load",r),n.removeEventListener("error",a)}n.addEventListener("load",r),n.addEventListener("error",a)})}function Ev(n,t){return t&&(n.src=t),n.src&&xf?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(r=>n.complete&&n.width?e(n):i(r))):vv(n)}class xv{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];(t++&3)===0&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const r=yl(t,e,i);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,i){const r=yl(t,e,i);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,i,r,a){const f=yl(t,e,i),g=f in this.cache_;this.cache_[f]=r,a&&(r.getImageState()===lt.IDLE&&r.load(),r.getImageState()===lt.LOADING?r.ready().then(()=>{this.patternCache_[f]=Ho().createPattern(r.getImage(1),"repeat")}):this.patternCache_[f]=Ho().createPattern(r.getImage(1),"repeat")),g||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function yl(n,t,e){const i=e?kr(e):"null";return t+":"+n+":"+i}const $e=new xv;let Cs=null;class dd extends js{constructor(t,e,i,r,a){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=a,this.imageState_=r===void 0?lt.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===lt.LOADED){Cs||(Cs=ee(1,1,void 0,{willReadFrequently:!0})),Cs.drawImage(this.image_,0,0);try{Cs.getImageData(0,0,1,1),this.tainted_=!1}catch{Cs=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(mt.CHANGE)}handleImageError_(){this.imageState_=lt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=lt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=ee(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===lt.IDLE){this.image_||this.initializeImage_(),this.imageState_=lt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ev(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==lt.LOADED)return;const e=this.image_,i=ee(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=z0(this.color_),i.fillRect(0,0,r.width/t,r.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===lt.LOADED||this.imageState_===lt.ERROR)t();else{const e=()=>{(this.imageState_===lt.LOADED||this.imageState_===lt.ERROR)&&(this.removeEventListener(mt.CHANGE,e),t())};this.addEventListener(mt.CHANGE,e)}})),this.ready_}}function kh(n,t,e,i,r,a){let f=t===void 0?void 0:$e.get(t,e,r);return f||(f=new dd(n,n&&"src"in n?n.src||void 0:t,e,i,r),$e.set(t,e,r,f,a)),a&&f&&!$e.getPattern(t,e,r)&&$e.set(t,e,r,f,a),f}function mi(n){return n?Array.isArray(n)?Fh(n):typeof n=="object"&&"src"in n?Cv(n):n:null}function Cv(n){if(!n.offset||!n.size)return $e.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=$e.getPattern(t,void 0,n.color);if(e)return e;const i=$e.get(n.src,"anonymous",null);if(i.getImageState()!==lt.LOADED)return null;const r=ee(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),kh(r.canvas,t,void 0,lt.LOADED,n.color,!0),$e.getPattern(t,void 0,n.color)}const gd="10px sans-serif",Pe="#000",Nr="round",Yi=[],Wi=0,Xr="round",ks=10,Ns="#000",Xs="center",$o="middle",Wn=[0,0,0,0],Ys=1,Gi=new li;let Cr=null,Xl;const Yl={},Rv=function(){const t="32px ",e=["monospace","serif"],i=e.length,r="wmytzilWMYTZIL@#/&?$%10";let a,f;function g(y,v,x){let R=!0;for(let S=0;S<i;++S){const I=e[S];if(f=qo(y+" "+v+" "+t+I,r),x!=I){const L=qo(y+" "+v+" "+t+x+","+I,r);R=R&&L!=f}}return!!R}function p(){let y=!0;const v=Gi.getKeys();for(let x=0,R=v.length;x<R;++x){const S=v[x];if(Gi.get(S)<100){const[I,L,O]=S.split(`
`);g(I,L,O)?(Us(Yl),Cr=null,Xl=void 0,Gi.set(S,100)):(Gi.set(S,Gi.get(S)+1,!0),y=!1)}}y&&(clearInterval(a),a=void 0)}return function(y){const v=td(y);if(!v)return;const x=v.families;for(let R=0,S=x.length;R<S;++R){const I=x[R],L=v.style+`
`+v.weight+`
`+I;Gi.get(L)===void 0&&(Gi.set(L,100,!0),g(v.style,v.weight,I)||(Gi.set(L,0,!0),a===void 0&&(a=setInterval(p,32))))}}}(),wv=function(){let n;return function(t){let e=Yl[t];if(e==null){if(Ql){const i=td(t),r=_d(t,"g");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);Yl[t]=e}return e}}();function _d(n,t){return Cr||(Cr=ee(1,1)),n!=Xl&&(Cr.font=n,Xl=Cr.font),Cr.measureText(t)}function qo(n,t){return _d(n,t).width}function Nu(n,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((r,a)=>Math.max(r,qo(n,a)),0);return e[t]=i,i}function Iv(n,t){const e=[],i=[],r=[];let a=0,f=0,g=0,p=0;for(let y=0,v=t.length;y<=v;y+=2){const x=t[y];if(x===`
`||y===v){a=Math.max(a,f),r.push(f),f=0,g+=p,p=0;continue}const R=t[y+1]||n.font,S=qo(R,x);e.push(S),f+=S;const I=wv(R);i.push(I),p=Math.max(p,I)}return{width:a,height:g,widths:e,heights:i,lineWidths:r}}function Tv(n,t,e,i,r,a,f,g,p,y,v){n.save(),e!==1&&(n.globalAlpha===void 0?n.globalAlpha=x=>x.globalAlpha*=e:n.globalAlpha*=e),t&&n.transform.apply(n,t),i.contextInstructions?(n.translate(p,y),n.scale(v[0],v[1]),Sv(i,n)):v[0]<0||v[1]<0?(n.translate(p,y),n.scale(v[0],v[1]),n.drawImage(i,r,a,f,g,0,0,f,g)):n.drawImage(i,r,a,f,g,p,y,f*v[0],g*v[1]),n.restore()}function Sv(n,t){const e=n.contextInstructions;for(let i=0,r=e.length;i<r;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class wa{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=pe(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new wa({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Ct()}getImage(t){return Ct()}getHitDetectionImage(){return Ct()}getPixelRatio(t){return 1}getImageState(){return Ct()}getImageSize(){return Ct()}getOrigin(){return Ct()}getSize(){return Ct()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=pe(t)}listenImageChange(t){Ct()}load(){Ct()}unlistenImageChange(t){Ct()}ready(){return Promise.resolve()}}class Ia extends wa{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?lt.LOADING:lt.LOADED,this.imageState_===lt.LOADING&&this.ready().then(()=>this.imageState_=lt.LOADED),this.render()}clone(){const t=this.getScale(),e=new Ia({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var a,f;const e=(a=this.fill_)==null?void 0:a.getKey(),i=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let r=(f=$e.get(i,null,null))==null?void 0:f.getImage(1);if(!r){const g=this.renderOptions_,p=Math.ceil(g.size*t),y=ee(p,p);this.draw_(g,y,t),r=y.canvas,$e.set(i,null,null,new dd(r,void 0,null,lt.LOADED,null))}return r}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius,a=this.radius2_===void 0?r:this.radius2_;if(r<a){const W=r;r=a,a=W}const f=this.radius2_===void 0?this.points_:this.points_*2,g=2*Math.PI/f,p=a*Math.sin(g),y=Math.sqrt(a*a-p*p),v=r-y,x=Math.sqrt(p*p+v*v),R=x/p;if(t==="miter"&&R<=i)return R*e;const S=e/2/R,I=e/2*(v/x),O=Math.sqrt((r+S)*(r+S)+I*I)-r;if(this.radius2_===void 0||t==="bevel")return O*2;const M=r*Math.sin(g),P=Math.sqrt(r*r-M*M),X=a-P,G=Math.sqrt(M*M+X*X)/M;if(G<=i){const W=G*e/2-a-r;return 2*Math.max(O,W)}return O*2}createRenderOptions(){let t=Nr,e=Xr,i=0,r=null,a=0,f,g=0;this.stroke_&&(f=mi(this.stroke_.getColor()??Ns),g=this.stroke_.getWidth()??Ys,r=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Xr,t=this.stroke_.getLineCap()??Nr,i=this.stroke_.getMiterLimit()??ks);const p=this.calculateLineJoinSize_(e,g,i),y=Math.max(this.radius,this.radius2_||0),v=Math.ceil(2*y+p);return{strokeStyle:f,strokeWidth:g,size:v,lineCap:t,lineDash:r,lineDashOffset:a,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=Pe),e.fillStyle=mi(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=kr(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(e=ee(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const a=this.angle_-Math.PI/2,f=2*Math.PI/e;for(let g=0;g<e;g++){const p=a+g*f,y=g%2===0?i:r;t.lineTo(y*Math.cos(p),y*Math.sin(p))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Pe,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Qs extends Ia{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Qs({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class Zn{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Zn({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=kh(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===lt.IDLE&&e.load(),e.getImageState()===lt.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?Mt(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:kr(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Xu(n,t,e,i){return e!==void 0&&i!==void 0?[e/n,i/t]:e!==void 0?e/n:i!==void 0?i/t:1}class Ur extends wa{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,a=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:a,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const f=t.img!==void 0?t.img:null;let g=t.src;Dt(!(g!==void 0&&f),"`image` and `src` cannot be provided at the same time"),(g===void 0||g.length===0)&&f&&(g=f.src||Mt(f)),Dt(g!==void 0&&g.length>0,"A defined and non-empty `src` or `image` must be provided"),Dt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let p;if(t.src!==void 0?p=lt.IDLE:f!==void 0&&("complete"in f?f.complete?p=f.src?lt.LOADED:lt.IDLE:p=lt.LOADING:p=lt.LOADED),this.color_=t.color!==void 0?kr(t.color):null,this.iconImage_=kh(f,g,this.crossOrigin_,p,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let y,v;if(t.size)[y,v]=t.size;else{const x=this.getImage(1);if(x.width&&x.height)y=x.width,v=x.height;else if(x instanceof HTMLImageElement){this.initialOptions_=t;const R=()=>{if(this.unlistenImageChange(R),!this.initialOptions_)return;const S=this.iconImage_.getSize();this.setScale(Xu(S[0],S[1],t.width,t.height))};this.listenImageChange(R);return}}y!==void 0&&this.setScale(Xu(y,v,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Ur({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==lt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==lt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(mt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(mt.CHANGE,t)}ready(){return this.iconImage_.ready()}}class Ta{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Ta({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class yi{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Yu,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new yi({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Yu,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Av(n){let t;if(typeof n=="function")t=n;else{let e;Array.isArray(n)?e=n:(Dt(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[n]),t=function(){return e}}return t}let vl=null;function pd(n,t){if(!vl){const e=new Zn({color:"rgba(255,255,255,0.4)"}),i=new Ta({color:"#3399CC",width:1.25});vl=[new yi({image:new Qs({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return vl}function Yu(n){return n.getGeometry()}const Lv="#333";class Sa{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=pe(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Zn({color:Lv}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Sa({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=pe(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function Ov(n){return!0}function Mv(n){const t=cd(),e=Pv(n,t),i=fd();return function(r,a){if(i.properties=r.getPropertiesInternal(),i.resolution=a,t.featureId){const f=r.getId();f!==void 0?i.featureId=f:i.featureId=null}return t.geometryType&&(i.geometryType=ud(r.getGeometry())),e(i)}}function Wu(n){const t=cd(),e=n.length,i=new Array(e);for(let f=0;f<e;++f)i[f]=Wl(n[f],t);const r=fd(),a=new Array(e);return function(f,g){if(r.properties=f.getPropertiesInternal(),r.resolution=g,t.featureId){const y=f.getId();y!==void 0?r.featureId=y:r.featureId=null}let p=0;for(let y=0;y<e;++y){const v=i[y](r);v&&(a[p]=v,p+=1)}return a.length=p,a}}function Pv(n,t){const e=n.length,i=new Array(e);for(let r=0;r<e;++r){const a=n[r],f="filter"in a?Ui(a.filter,Ce,t):Ov;let g;if(Array.isArray(a.style)){const p=a.style.length;g=new Array(p);for(let y=0;y<p;++y)g[y]=Wl(a.style[y],t)}else g=[Wl(a.style,t)];i[r]={filter:f,styles:g}}return function(r){const a=[];let f=!1;for(let g=0;g<e;++g){const p=i[g].filter;if(p(r)&&!(n[g].else&&f)){f=!0;for(const y of i[g].styles){const v=y(r);v&&a.push(v)}}}return a}}function Wl(n,t){const e=Ws(n,"",t),i=Bs(n,"",t),r=Dv(n,t),a=Fv(n,t),f=De(n,"z-index",t);if(!e&&!i&&!r&&!a&&!Un(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const g=new yi;return function(p){let y=!0;if(e){const v=e(p);v&&(y=!1),g.setFill(v)}if(i){const v=i(p);v&&(y=!1),g.setStroke(v)}if(r){const v=r(p);v&&(y=!1),g.setText(v)}if(a){const v=a(p);v&&(y=!1),g.setImage(v)}return f&&g.setZIndex(f(p)),y?null:g}}function Ws(n,t,e){let i;if(t+"fill-pattern-src"in n)i=Nv(n,t+"fill-",e);else{if(n[t+"fill-color"]==="none")return a=>null;i=Nh(n,t+"fill-color",e)}if(!i)return null;const r=new Zn;return function(a){const f=i(a);return f===Ph?null:(r.setColor(f),r)}}function Bs(n,t,e){const i=De(n,t+"stroke-width",e),r=Nh(n,t+"stroke-color",e);if(!i&&!r)return null;const a=Ni(n,t+"stroke-line-cap",e),f=Ni(n,t+"stroke-line-join",e),g=md(n,t+"stroke-line-dash",e),p=De(n,t+"stroke-line-dash-offset",e),y=De(n,t+"stroke-miter-limit",e),v=new Ta;return function(x){if(r){const R=r(x);if(R===Ph)return null;v.setColor(R)}if(i&&v.setWidth(i(x)),a){const R=a(x);if(R!=="butt"&&R!=="round"&&R!=="square")throw new Error("Expected butt, round, or square line cap");v.setLineCap(R)}if(f){const R=f(x);if(R!=="bevel"&&R!=="round"&&R!=="miter")throw new Error("Expected bevel, round, or miter line join");v.setLineJoin(R)}return g&&v.setLineDash(g(x)),p&&v.setLineDashOffset(p(x)),y&&v.setMiterLimit(y(x)),v}}function Dv(n,t){const e="text-",i=Ni(n,e+"value",t);if(!i)return null;const r=Ws(n,e,t),a=Ws(n,e+"background-",t),f=Bs(n,e,t),g=Bs(n,e+"background-",t),p=Ni(n,e+"font",t),y=De(n,e+"max-angle",t),v=De(n,e+"offset-x",t),x=De(n,e+"offset-y",t),R=Mr(n,e+"overflow",t),S=Ni(n,e+"placement",t),I=De(n,e+"repeat",t),L=Aa(n,e+"scale",t),O=Mr(n,e+"rotate-with-view",t),M=De(n,e+"rotation",t),P=Ni(n,e+"align",t),X=Ni(n,e+"justify",t),b=Ni(n,e+"baseline",t),G=Mr(n,e+"keep-upright",t),W=md(n,e+"padding",t),j=La(n,e+"declutter-mode"),Y=new Sa({declutterMode:j});return function(V){if(Y.setText(i(V)),r&&Y.setFill(r(V)),a&&Y.setBackgroundFill(a(V)),f&&Y.setStroke(f(V)),g&&Y.setBackgroundStroke(g(V)),p&&Y.setFont(p(V)),y&&Y.setMaxAngle(y(V)),v&&Y.setOffsetX(v(V)),x&&Y.setOffsetY(x(V)),R&&Y.setOverflow(R(V)),S){const U=S(V);if(U!=="point"&&U!=="line")throw new Error("Expected point or line for text-placement");Y.setPlacement(U)}if(I&&Y.setRepeat(I(V)),L&&Y.setScale(L(V)),O&&Y.setRotateWithView(O(V)),M&&Y.setRotation(M(V)),P){const U=P(V);if(U!=="left"&&U!=="center"&&U!=="right"&&U!=="end"&&U!=="start")throw new Error("Expected left, right, center, start, or end for text-align");Y.setTextAlign(U)}if(X){const U=X(V);if(U!=="left"&&U!=="right"&&U!=="center")throw new Error("Expected left, right, or center for text-justify");Y.setJustify(U)}if(b){const U=b(V);if(U!=="bottom"&&U!=="top"&&U!=="middle"&&U!=="alphabetic"&&U!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");Y.setTextBaseline(U)}return W&&Y.setPadding(W(V)),G&&Y.setKeepUpright(G(V)),Y}}function Fv(n,t){return"icon-src"in n?bv(n,t):"shape-points"in n?Gv(n,t):"circle-radius"in n?kv(n,t):null}function bv(n,t){const e="icon-",i=e+"src",r=yd(n[i],i),a=Jo(n,e+"anchor",t),f=Aa(n,e+"scale",t),g=De(n,e+"opacity",t),p=Jo(n,e+"displacement",t),y=De(n,e+"rotation",t),v=Mr(n,e+"rotate-with-view",t),x=zu(n,e+"anchor-origin"),R=Uu(n,e+"anchor-x-units"),S=Uu(n,e+"anchor-y-units"),I=Bv(n,e+"color"),L=Yv(n,e+"cross-origin"),O=Wv(n,e+"offset"),M=zu(n,e+"offset-origin"),P=Qo(n,e+"width"),X=Qo(n,e+"height"),b=Xv(n,e+"size"),G=La(n,e+"declutter-mode"),W=new Ur({src:r,anchorOrigin:x,anchorXUnits:R,anchorYUnits:S,color:I,crossOrigin:L,offset:O,offsetOrigin:M,height:X,width:P,size:b,declutterMode:G});return function(j){return g&&W.setOpacity(g(j)),p&&W.setDisplacement(p(j)),y&&W.setRotation(y(j)),v&&W.setRotateWithView(v(j)),f&&W.setScale(f(j)),a&&W.setAnchor(a(j)),W}}function Gv(n,t){const e="shape-",i=e+"points",r=e+"radius",a=Bl(n[i],i),f=Bl(n[r],r),g=Ws(n,e,t),p=Bs(n,e,t),y=Aa(n,e+"scale",t),v=Jo(n,e+"displacement",t),x=De(n,e+"rotation",t),R=Mr(n,e+"rotate-with-view",t),S=Qo(n,e+"radius2"),I=Qo(n,e+"angle"),L=La(n,e+"declutter-mode"),O=new Ia({points:a,radius:f,radius2:S,angle:I,declutterMode:L});return function(M){return g&&O.setFill(g(M)),p&&O.setStroke(p(M)),v&&O.setDisplacement(v(M)),x&&O.setRotation(x(M)),R&&O.setRotateWithView(R(M)),y&&O.setScale(y(M)),O}}function kv(n,t){const e="circle-",i=Ws(n,e,t),r=Bs(n,e,t),a=De(n,e+"radius",t),f=Aa(n,e+"scale",t),g=Jo(n,e+"displacement",t),p=De(n,e+"rotation",t),y=Mr(n,e+"rotate-with-view",t),v=La(n,e+"declutter-mode"),x=new Qs({radius:5,declutterMode:v});return function(R){return a&&x.setRadius(a(R)),i&&x.setFill(i(R)),r&&x.setStroke(r(R)),g&&x.setDisplacement(g(R)),p&&x.setRotation(p(R)),y&&x.setRotateWithView(y(R)),f&&x.setScale(f(R)),x}}function De(n,t,e){if(!(t in n))return;const i=Ui(n[t],Lt,e);return function(r){return Bl(i(r),t)}}function Ni(n,t,e){if(!(t in n))return null;const i=Ui(n[t],Me,e);return function(r){return yd(i(r),t)}}function Nv(n,t,e){const i=Ni(n,t+"pattern-src",e),r=Bu(n,t+"pattern-offset",e),a=Bu(n,t+"pattern-size",e),f=Nh(n,t+"color",e);return function(g){return{src:i(g),offset:r&&r(g),size:a&&a(g),color:f&&f(g)}}}function Mr(n,t,e){if(!(t in n))return null;const i=Ui(n[t],Ce,e);return function(r){const a=i(r);if(typeof a!="boolean")throw new Error(`Expected a boolean for ${t}`);return a}}function Nh(n,t,e){if(!(t in n))return null;const i=Ui(n[t],ri,e);return function(r){return vd(i(r),t)}}function md(n,t,e){if(!(t in n))return null;const i=Ui(n[t],Kn,e);return function(r){return to(i(r),t)}}function Jo(n,t,e){if(!(t in n))return null;const i=Ui(n[t],Kn,e);return function(r){const a=to(i(r),t);if(a.length!==2)throw new Error(`Expected two numbers for ${t}`);return a}}function Bu(n,t,e){if(!(t in n))return null;const i=Ui(n[t],Kn,e);return function(r){return Ed(i(r),t)}}function Aa(n,t,e){if(!(t in n))return null;const i=Ui(n[t],Kn|Lt,e);return function(r){return zv(i(r),t)}}function Qo(n,t){const e=n[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Xv(n,t){const e=n[t];if(e!==void 0){if(typeof e=="number")return pe(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Yv(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function zu(n,t){const e=n[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function Uu(n,t){const e=n[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Wv(n,t){const e=n[t];if(e!==void 0)return to(e,t)}function La(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Bv(n,t){const e=n[t];if(e!==void 0)return vd(e,t)}function to(n,t){if(!Array.isArray(n))throw new Error(`Expected an array for ${t}`);const e=n.length;for(let i=0;i<e;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return n}function yd(n,t){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}function Bl(n,t){if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}function vd(n,t){if(typeof n=="string")return n;const e=to(n,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function Ed(n,t){const e=to(n,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function zv(n,t){return typeof n=="number"?n:Ed(n,t)}const ju={RENDER_ORDER:"renderOrder"};class xd extends Js{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(ju.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new ad(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(ju.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?pd:t;const e=Uv(t);this.styleFunction_=t===null?void 0:Av(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function Uv(n){if(n===void 0)return pd;if(!n)return null;if(typeof n=="function"||n instanceof yi)return n;if(!Array.isArray(n))return Wu([n]);if(n.length===0)return[];const t=n.length,e=n[0];if(e instanceof yi){const r=new Array(t);for(let a=0;a<t;++a){const f=n[a];if(!(f instanceof yi))throw new Error("Expected a list of style instances");r[a]=f}return r}if("style"in e){const r=new Array(t);for(let a=0;a<t;++a){const f=n[a];if(!("style"in f))throw new Error("Expected a list of rules with a style property");r[a]=f}return Mv(r)}return Wu(n)}class Cd extends Qe{constructor(t,e,i,r){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=r}}class jv extends zs{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){Ct()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;vi(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Bf(r,i)}forEachFeatureAtCoordinate(t,e,i,r,a,f,g,p){let y;const v=e.viewState;function x(b,G,W,j){return a.call(f,G,b?W:null,j)}const R=v.projection,S=Mf(t.slice(),R),I=[[0,0]];if(R.canWrapX()&&r){const b=R.getExtent(),G=It(b);I.push([-G,0],[G,0])}const L=e.layerStatesArray,O=L.length,M=[],P=[];for(let b=0;b<I.length;b++)for(let G=O-1;G>=0;--G){const W=L[G],j=W.layer;if(j.hasRenderer()&&Oh(W,v)&&g.call(p,j)){const Y=j.getRenderer(),V=j.getSource();if(Y&&V){const U=V.getWrapX()?S:t,it=x.bind(null,W.managed);P[0]=U[0]+I[b][0],P[1]=U[1]+I[b][1],y=Y.forEachFeatureAtCoordinate(P,e,i,it,M)}if(y)return y}}if(M.length===0)return;const X=1/M.length;return M.forEach((b,G)=>b.distanceSq+=G*X),M.sort((b,G)=>b.distanceSq-G.distanceSq),M.some(b=>y=b.callback(b.feature,b.layer,b.geometry)),y}hasFeatureAtCoordinate(t,e,i,r,a,f){return this.forEachFeatureAtCoordinate(t,e,i,r,Os,this,a,f)!==void 0}getMap(){return this.map_}renderFrame(t){Ct()}scheduleExpireIconCache(t){$e.canExpireCache()&&t.postRenderFunctions.push(Vv)}}function Vv(n,t){$e.expire()}class Kv extends jv{constructor(t){super(t),this.fontChangeListenerKey_=Ot(Gi,Fr.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Ca+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const r=new Cd(t,void 0,e);i.dispatchEvent(r)}}disposeInternal(){Wt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(He.PRECOMPOSE,t);const e=t.layerStatesArray.sort((g,p)=>g.zIndex-p.zIndex);e.some(g=>g.layer instanceof xd&&g.layer.getDeclutter())&&(t.declutter={});const r=t.viewState;this.children_.length=0;const a=[];let f=null;for(let g=0,p=e.length;g<p;++g){const y=e[g];t.layerIndex=g;const v=y.layer,x=v.getSourceState();if(!Oh(y,r)||x!="ready"&&x!="undefined"){v.unrender();continue}const R=v.render(t,f);R&&(R!==f&&(this.children_.push(R),f=R),a.push(y))}this.declutter(t,a),c0(this.element_,this.children_),this.dispatchRenderEvent(He.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let i=e.length-1;i>=0;--i){const r=e[i],a=r.layer;a.getDeclutter()&&a.renderDeclutter(t,r)}e.forEach(i=>i.layer.renderDeferred(t))}}}function Rd(n){if(n instanceof Js){n.setMapInternal(null);return}n instanceof zr&&n.getLayers().forEach(Rd)}function wd(n,t){if(n instanceof Js){n.setMapInternal(t);return}if(n instanceof zr){const e=n.getLayers().getArray();for(let i=0,r=e.length;i<r;++i)wd(e[i],t)}}class Zv extends li{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Hv(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Ef,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Xe(),this.pixelToCoordinateTransform_=Xe(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||g0(),this.interactions=e.interactions||F0({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Rf(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ve.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ve.VIEW,this.handleViewChanged_),this.addChangeListener(ve.SIZE,this.handleSizeChanged_),this.addChangeListener(ve.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof di)&&t.view.then(function(r){i.setView(new di(r))}),this.controls.addEventListener(Oe.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Oe.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Oe.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Oe.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Oe.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Oe.REMOVE,r=>{const a=r.element.getId();a!==void 0&&delete this.overlayIdIndex_[a.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){wd(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const a=i.hitTolerance!==void 0?i.hitTolerance:0,f=i.layerFilter!==void 0?i.layerFilter:Os,g=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,a,g,e,null,f,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(r){i.push(r)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(r){r instanceof zr?e(r.getLayers()):t.push(r)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const r=e.layerFilter!==void 0?e.layerFilter:Os,a=e.hitTolerance!==void 0?e.hitTolerance:0,f=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,a,f,r,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),a=i.width/r[0],f=i.height/r[1],g="changedTouches"in t?t.changedTouches[0]:t;return[(g.clientX-i.left)/a,(g.clientY-i.top)/f]}getTarget(){return this.get(ve.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return bl(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?ce(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ve.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof _i){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const r=t[e];if(!r.visible)continue;const a=r.layer.getRenderer();if(a&&!a.ready)return!0;const f=r.layer.getSource();if(f&&f.loading)return!0}return!1}getPixelFromCoordinate(t){const e=bi(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?ce(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ve.SIZE)}getView(){return this.get(ve.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,r){return jm(this.frameState_,t,e,i,r)}handleBrowserEvent(t,e){e=e||t.type;const i=new fn(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===Ll.POINTERDOWN||i===mt.WHEEL||i===mt.KEYDOWN){const r=this.getOwnerDocument(),a=this.viewport_.getRootNode?this.viewport_.getRootNode():r,f=e.target,g=a instanceof ShadowRoot?a.host===f?a.host.ownerDocument:a:a===r?r.documentElement:a;if(this.overlayContainerStopEvent_.contains(f)||!g.contains(f))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const r=this.getInteractions().getArray().slice();for(let a=r.length-1;a>=0;a--){const f=r[a];if(f.getMap()!==this||!f.getActive()||!this.getTargetElement())continue;if(!f.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let r=this.maxTilesLoading_,a=r;if(t){const f=t.viewHints;if(f[ge.ANIMATING]||f[ge.INTERACTING]){const g=Date.now()-t.time>8;r=g?0:8,a=g?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,a))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(He.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(He.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Er(dn.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Er(dn.LOADSTART,this,t))));const i=this.postRenderFunctions_;if(t)for(let r=0,a=i.length;r<a;++r)i[r](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)Wt(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(mt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(mt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Kv(this)),this.mapBrowserEventHandler_=new zm(this,this.moveTolerance_);for(const a in ne)this.mapBrowserEventHandler_.addEventListener(ne[a],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(mt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(mt.WHEEL,this.boundHandleBrowserEvent_,Cf?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const a=e.getRootNode();i=a instanceof ShadowRoot?a.host:e}this.targetChangeHandlerKeys_=[Ot(i,mt.KEYDOWN,this.handleBrowserEvent,this),Ot(i,mt.KEYPRESS,this.handleBrowserEvent,this)];const r=e.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Wt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Wt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Ot(t,Fr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Ot(t,mt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Wt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new _n("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Ot(t,Fr.PROPERTYCHANGE,this.render,this),Ot(t,mt.CHANGE,this.render,this),Ot(t,"addlayer",this.handleLayerAdd_,this),Ot(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Rd(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),r=this.frameState_;let a=null;if(e!==void 0&&Fu(e)&&i&&i.isDef()){const f=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),g=i.getState();if(a={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Uo(g.center,g.resolution,g.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:g,viewHints:f,wantedTiles:{},mapId:Mt(this),renderTargets:{}},g.nextCenter&&g.nextResolution){const p=isNaN(g.nextRotation)?g.rotation:g.nextRotation;a.nextExtent=Uo(g.nextCenter,g.nextResolution,p,e)}}this.frameState_=a,this.renderer_.renderFrame(a),a&&(a.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,a.postRenderFunctions),r&&(!this.previousExtent_||!Wr(this.previousExtent_)&&!wn(a.extent,this.previousExtent_))&&(this.dispatchEvent(new Er(dn.MOVESTART,this,r)),this.previousExtent_=Ks(this.previousExtent_)),this.previousExtent_&&!a.viewHints[ge.ANIMATING]&&!a.viewHints[ge.INTERACTING]&&!wn(a.extent,this.previousExtent_)&&(this.dispatchEvent(new Er(dn.MOVEEND,this,a)),wf(a.extent,this.previousExtent_))),this.dispatchEvent(new Er(dn.POSTRENDER,this,a)),this.renderComplete_=(this.hasListener(dn.LOADSTART)||this.hasListener(dn.LOADEND)||this.hasListener(He.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new _n("removelayer",e)),this.set(ve.LAYERGROUP,t)}setSize(t){this.set(ve.SIZE,t)}setTarget(t){this.set(ve.TARGET,t)}setView(t){if(!t||t instanceof di){this.set(ve.VIEW,t);return}this.set(ve.VIEW,new di);const e=this;t.then(function(i){e.setView(new di(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const r=getComputedStyle(t),a=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),f=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(a)&&!isNaN(f)&&(e=[Math.max(0,a),Math.max(0,f)],!Fu(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Ff("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!In(e,i))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}}function Hv(n){let t=null;n.keyboardEventTarget!==void 0&&(t=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new zr({layers:n.layers});e[ve.LAYERGROUP]=i,e[ve.TARGET]=n.target,e[ve.VIEW]=n.view instanceof di?n.view:new di;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new _i(n.controls.slice()):(Dt(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls));let a;n.interactions!==void 0&&(Array.isArray(n.interactions)?a=new _i(n.interactions.slice()):(Dt(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),a=n.interactions));let f;return n.overlays!==void 0?Array.isArray(n.overlays)?f=new _i(n.overlays.slice()):(Dt(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),f=n.overlays):f=new _i,{controls:r,interactions:a,keyboardEventTarget:t,overlays:f,values:e}}class Id{constructor(){ru(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Ho(),{get:(t,e)=>{if(typeof Ho()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,r=e.length;i<r;++i){const a=e[i];if(typeof a=="function"){a(t);continue}const f=e[++i];if(typeof t[a]=="function")t[a](...f);else{if(typeof f=="function"){t[a]=f(t);continue}t[a]=f}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const $v=5;class qv extends Vs{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=$v}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Ct()}getData(t){return null}prepareFrame(t){return Ct()}renderFrame(t,e){return Ct()}forEachFeatureAtCoordinate(t,e,i,r,a){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===lt.LOADED||e.getState()===lt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=lt.LOADED&&e!=lt.ERROR&&t.addEventListener(mt.CHANGE,this.boundHandleImageChange_),e==lt.IDLE&&(t.load(),e=t.getState()),e==lt.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Vu=[];let Rr=null;function Jv(){Rr=ee(1,1,void 0,{willReadFrequently:!0})}class Xh extends qv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Xe(),this.pixelTransform=Xe(),this.inversePixelTransform=Xe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,i){Rr||Jv(),Rr.clearRect(0,0,1,1);let r;try{Rr.drawImage(t,e,i,1,1,0,0,1,1),r=Rr.getImageData(0,0,1,1).data}catch{return Rr=null,null}return r}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const r=this.getLayer().getClassName();let a,f;if(t&&t.className===r&&(!i||t&&t.style.backgroundColor&&In(kr(t.style.backgroundColor),kr(i)))){const g=t.firstElementChild;g instanceof HTMLCanvasElement&&(f=g.getContext("2d"))}if(f&&f.canvas.style.transform===e?(this.container=t,this.context=f,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){a=document.createElement("div"),a.className=r;let g=a.style;g.position="absolute",g.width="100%",g.height="100%",f=ee();const p=f.canvas;a.appendChild(p),g=p.style,g.position="absolute",g.left="0",g.transformOrigin="top left",this.container=a,this.context=f}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const r=Bi(i),a=_a(i),f=ga(i),g=da(i);ce(e.coordinateToPixelTransform,r),ce(e.coordinateToPixelTransform,a),ce(e.coordinateToPixelTransform,f),ce(e.coordinateToPixelTransform,g);const p=this.inversePixelTransform;ce(p,r),ce(p,a),ce(p,f),ce(p,g),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(f[0]),Math.round(f[1])),t.lineTo(Math.round(g[0]),Math.round(g[1])),t.clip()}prepareContainer(t,e){const i=t.extent,r=t.viewState.resolution,a=t.viewState.rotation,f=t.pixelRatio,g=Math.round(It(i)/r*f),p=Math.round(Ht(i)/r*f);vi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/f,1/f,a,-g/2,-p/2),Bf(this.inversePixelTransform,this.pixelTransform);const y=by(this.pixelTransform);if(this.useContainer(e,y,this.getBackground(t)),!this.containerReused){const v=this.context.canvas;v.width!=g||v.height!=p?(v.width=g,v.height=p):this.context.clearRect(0,0,g,p),y!==v.style.transform&&(v.style.transform=y)}}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){const a=new Cd(t,this.inversePixelTransform,i,e);r.dispatchEvent(a)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(He.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(He.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Id),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(He.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(He.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,r,a,f,g){const p=a/2,y=f/2,v=r/e,x=-v,R=-t[0]+g,S=-t[1];return vi(this.tempTransform,p,y,v,x,-i,R,S)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Qv extends Xh{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,r=t.viewState,a=r.resolution,f=this.getLayer().getSource(),g=t.viewHints;let p=t.extent;if(e.extent!==void 0&&(p=Ne(p,pi(e.extent,r.projection))),!g[ge.ANIMATING]&&!g[ge.INTERACTING]&&!Wr(p))if(f){const y=r.projection,v=f.getImage(p,a,i,y);v&&(this.loadImage(v)?this.image=v:v.getState()===lt.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=ce(e.pixelToCoordinateTransform,t.slice()),a=i.getExtent();if(a&&!jn(a,r))return null;const f=this.image.getExtent(),g=this.image.getImage(),p=It(f),y=Math.floor(g.width*((r[0]-f[0])/p));if(y<0||y>=g.width)return null;const v=Ht(f),x=Math.floor(g.height*((f[3]-r[1])/v));return x<0||x>=g.height?null:this.getImageData(g,y,x)}renderFrame(t,e){const i=this.image,r=i.getExtent(),a=i.getResolution(),[f,g]=Array.isArray(a)?a:[a,a],p=i.getPixelRatio(),y=t.layerStatesArray[t.layerIndex],v=t.pixelRatio,x=t.viewState,R=x.center,S=x.resolution,I=v*f/(S*p),L=v*g/(S*p);this.prepareContainer(t,e);const O=this.context.canvas.width,M=this.context.canvas.height,P=this.getRenderContext(t);let X=!1,b=!0;if(y.extent){const V=pi(y.extent,x.projection);b=Re(V,t.extent),X=b&&!yn(V,t.extent),X&&this.clipUnrotated(P,t,V)}const G=i.getImage(),W=vi(this.tempTransform,O/2,M/2,I,L,0,p*(r[0]-R[0])/f,p*(R[1]-r[3])/g);this.renderedResolution=g*v/p;const j=G.width*W[0],Y=G.height*W[3];if(this.getLayer().getSource().getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,t),b&&j>=.5&&Y>=.5){const V=W[4],U=W[5],it=y.opacity;it!==1&&(P.save(),P.globalAlpha=it),P.drawImage(G,0,0,+G.width,+G.height,V,U,j,Y),it!==1&&P.restore()}return this.postRender(this.context,t),X&&P.restore(),P.imageSmoothingEnabled=!0,this.container}}class tE extends Js{constructor(t){t=t||{},super(t)}}class Td extends tE{constructor(t){super(t)}createRenderer(){return new Qv(this)}getData(t){return super.getData(t)}}class eE extends Gh{constructor(t,e,i,r,a){const f=a!==void 0?lt.IDLE:lt.LOADED;super(t,e,i,f),this.loader_=a!==void 0?a:null,this.canvas_=r,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=lt.ERROR):this.state=lt.LOADED,this.changed()}load(){this.state==lt.IDLE&&(this.state=lt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class Yh extends js{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(mt.CHANGE)}release(){this.setState(at.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==at.EMPTY){if(this.state!==at.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Ct()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const r=e-i+1e3/60;return r>=this.transition_?1:Pf(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function ta(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}function iE(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Float32Array||n instanceof DataView?n:null}const nE=new Error("disposed");let pr=null;function rE(n){pr||(pr=ee(n.width,n.height,void 0,{willReadFrequently:!0}));const t=pr.canvas,e=n.width;t.width!==e&&(t.width=e);const i=n.height;return t.height!==i&&(t.height=i),pr.clearRect(0,0,e,i),pr.drawImage(n,0,0),pr.getImageData(0,0,e,i).data}const sE=[256,256];class ea extends Yh{constructor(t){const e=at.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=ta(this.data_);return t?[t.width,t.height]:sE}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==at.IDLE&&this.state!==at.ERROR)return;this.state=at.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=at.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=at.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(nE),this.controller_=null),super.disposeInternal()}}class oE extends Yh{constructor(t,e,i,r,a,f){super(t,e,f),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=a}getImage(){return this.image_}setImage(t){this.image_=t,this.state=at.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=at.ERROR,this.unlistenImage_(),this.image_=aE(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=at.LOADED:this.state=at.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==at.ERROR&&(this.state=at.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==at.IDLE&&(this.state=at.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=yv(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function aE(){const n=ee(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}class Wh{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function mr(n,t,e,i,r){return r!==void 0?(r.minX=n,r.maxX=t,r.minY=e,r.maxY=i,r):new Wh(n,t,e,i)}let El;const Pr=[];function Ku(n,t,e,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,r)),n.restore()}function xl(n,t){return Math.abs(n[t*4]-210)>2||Math.abs(n[t*4+3]-.75*255)>2}function lE(){if(El===void 0){const n=ee(6,6,Pr);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",Ku(n,4,5,4,0),Ku(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;El=xl(t,0)||xl(t,4)||xl(t,8),Ra(n),Pr.push(n.canvas)}return El}function zl(n,t,e,i){const r=Yf(e,t,n);let a=mu(t,i,e);const f=t.getMetersPerUnit();f!==void 0&&(a*=f);const g=n.getMetersPerUnit();g!==void 0&&(a/=g);const p=n.getExtent();if(!p||jn(p,r)){const y=mu(n,a,r)/a;isFinite(y)&&y>0&&(a/=y)}return a}function Sd(n,t,e,i){const r=Je(e);let a=zl(n,t,r,i);return(!isFinite(a)||a<=0)&&Tf(e,function(f){return a=zl(n,t,f,i),isFinite(a)&&a>0}),a}function Ad(n,t,e,i,r,a,f,g,p,y,v,x,R,S){const I=ee(Math.round(e*n),Math.round(e*t),Pr);if(x||(I.imageSmoothingEnabled=!1),p.length===0)return I.canvas;I.scale(e,e);function L(G){return Math.round(G*e)/e}I.globalCompositeOperation="lighter";const O=Fe();p.forEach(function(G,W,j){rh(O,G.extent)});let M;const P=e/i,X=(x?1:1+Math.pow(2,-24))/P;if(!R||p.length!==1||y!==0){if(M=ee(Math.round(It(O)*P),Math.round(Ht(O)*P),Pr),x||(M.imageSmoothingEnabled=!1),r&&S){const G=(r[0]-O[0])*P,W=-(r[3]-O[3])*P,j=It(r)*P,Y=Ht(r)*P;M.rect(G,W,j,Y),M.clip()}p.forEach(function(G,W,j){if(G.image.width>0&&G.image.height>0){if(G.clipExtent){M.save();const q=(G.clipExtent[0]-O[0])*P,K=-(G.clipExtent[3]-O[3])*P,$=It(G.clipExtent)*P,et=Ht(G.clipExtent)*P;M.rect(x?q:Math.round(q),x?K:Math.round(K),x?$:Math.round(q+$)-Math.round(q),x?et:Math.round(K+et)-Math.round(K)),M.clip()}const Y=(G.extent[0]-O[0])*P,V=-(G.extent[3]-O[3])*P,U=It(G.extent)*P,it=Ht(G.extent)*P;M.drawImage(G.image,y,y,G.image.width-2*y,G.image.height-2*y,x?Y:Math.round(Y),x?V:Math.round(V),x?U:Math.round(Y+U)-Math.round(Y),x?it:Math.round(V+it)-Math.round(V)),G.clipExtent&&M.restore()}})}const b=Bi(f);return g.getTriangles().forEach(function(G,W,j){const Y=G.source,V=G.target;let U=Y[0][0],it=Y[0][1],q=Y[1][0],K=Y[1][1],$=Y[2][0],et=Y[2][1];const nt=L((V[0][0]-b[0])/a),rt=L(-(V[0][1]-b[1])/a),ft=L((V[1][0]-b[0])/a),ut=L(-(V[1][1]-b[1])/a),ot=L((V[2][0]-b[0])/a),dt=L(-(V[2][1]-b[1])/a),Z=U,Tt=it;U=0,it=0,q-=Z,K-=Tt,$-=Z,et-=Tt;const Xt=[[q,K,0,0,ft-nt],[$,et,0,0,ot-nt],[0,0,q,K,ut-rt],[0,0,$,et,dt-rt]],ht=Km(Xt);if(!ht)return;if(I.save(),I.beginPath(),lE()||!x){I.moveTo(ft,ut);const se=4,ue=nt-ft,qt=rt-ut;for(let Bt=0;Bt<se;Bt++)I.lineTo(ft+L((Bt+1)*ue/se),ut+L(Bt*qt/(se-1))),Bt!=se-1&&I.lineTo(ft+L((Bt+1)*ue/se),ut+L((Bt+1)*qt/(se-1)));I.lineTo(ot,dt)}else I.moveTo(ft,ut),I.lineTo(nt,rt),I.lineTo(ot,dt);I.clip(),I.transform(ht[0],ht[2],ht[1],ht[3],nt,rt),I.translate(O[0]-Z,O[3]-Tt);let Vt;if(M)Vt=M.canvas,I.scale(X,-X);else{const se=p[0],ue=se.extent;Vt=se.image,I.scale(It(ue)/Vt.width,-Ht(ue)/Vt.height)}I.drawImage(Vt,0,0),I.restore()}),M&&(Ra(M),Pr.push(M.canvas)),v&&(I.save(),I.globalCompositeOperation="source-over",I.strokeStyle="black",I.lineWidth=1,g.getTriangles().forEach(function(G,W,j){const Y=G.target,V=(Y[0][0]-b[0])/a,U=-(Y[0][1]-b[1])/a,it=(Y[1][0]-b[0])/a,q=-(Y[1][1]-b[1])/a,K=(Y[2][0]-b[0])/a,$=-(Y[2][1]-b[1])/a;I.beginPath(),I.moveTo(it,q),I.lineTo(V,U),I.lineTo(K,$),I.closePath(),I.stroke()}),I.restore()),I.canvas}const hE=10,Zu=.25;class Bh{constructor(t,e,i,r,a,f,g){this.sourceProj_=t,this.targetProj_=e;let p={};const y=g?My(X=>ce(g,Yf(X,this.targetProj_,this.sourceProj_))):Ds(this.targetProj_,this.sourceProj_);this.transformInv_=function(X){const b=X[0]+"/"+X[1];return p[b]||(p[b]=y(X)),p[b]},this.maxSourceExtent_=r,this.errorThresholdSquared_=a*a,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&It(r)>=It(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?It(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?It(this.targetProj_.getExtent()):null;const v=Bi(i),x=_a(i),R=ga(i),S=da(i),I=this.transformInv_(v),L=this.transformInv_(x),O=this.transformInv_(R),M=this.transformInv_(S),P=hE+(f?Math.max(0,Math.ceil(Math.log2(Ms(i)/(f*f*256*256)))):0);if(this.addQuad_(v,x,R,S,I,L,O,M,P),this.wrapsXInSource_){let X=1/0;this.triangles_.forEach(function(b,G,W){X=Math.min(X,b.source[0][0],b.source[1][0],b.source[2][0])}),this.triangles_.forEach(b=>{if(Math.max(b.source[0][0],b.source[1][0],b.source[2][0])-X>this.sourceWorldWidth_/2){const G=[[b.source[0][0],b.source[0][1]],[b.source[1][0],b.source[1][1]],[b.source[2][0],b.source[2][1]]];G[0][0]-X>this.sourceWorldWidth_/2&&(G[0][0]-=this.sourceWorldWidth_),G[1][0]-X>this.sourceWorldWidth_/2&&(G[1][0]-=this.sourceWorldWidth_),G[2][0]-X>this.sourceWorldWidth_/2&&(G[2][0]-=this.sourceWorldWidth_);const W=Math.min(G[0][0],G[1][0],G[2][0]);Math.max(G[0][0],G[1][0],G[2][0])-W<this.sourceWorldWidth_/2&&(b.source=G)}})}p={}}addTriangle_(t,e,i,r,a,f){this.triangles_.push({source:[r,a,f],target:[t,e,i]})}addQuad_(t,e,i,r,a,f,g,p,y){const v=lu([a,f,g,p]),x=this.sourceWorldWidth_?It(v)/this.sourceWorldWidth_:null,R=this.sourceWorldWidth_,S=this.sourceProj_.canWrapX()&&x>.5&&x<1;let I=!1;if(y>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const O=lu([t,e,i,r]);I=It(O)/this.targetWorldWidth_>Zu||I}!S&&this.sourceProj_.isGlobal()&&x&&(I=x>Zu||I)}if(!I&&this.maxSourceExtent_&&isFinite(v[0])&&isFinite(v[1])&&isFinite(v[2])&&isFinite(v[3])&&!Re(v,this.maxSourceExtent_))return;let L=0;if(!I&&(!isFinite(a[0])||!isFinite(a[1])||!isFinite(f[0])||!isFinite(f[1])||!isFinite(g[0])||!isFinite(g[1])||!isFinite(p[0])||!isFinite(p[1]))){if(y>0)I=!0;else if(L=(!isFinite(a[0])||!isFinite(a[1])?8:0)+(!isFinite(f[0])||!isFinite(f[1])?4:0)+(!isFinite(g[0])||!isFinite(g[1])?2:0)+(!isFinite(p[0])||!isFinite(p[1])?1:0),L!=1&&L!=2&&L!=4&&L!=8)return}if(y>0){if(!I){const O=[(t[0]+i[0])/2,(t[1]+i[1])/2],M=this.transformInv_(O);let P;S?P=(Ar(a[0],R)+Ar(g[0],R))/2-Ar(M[0],R):P=(a[0]+g[0])/2-M[0];const X=(a[1]+g[1])/2-M[1];I=P*P+X*X>this.errorThresholdSquared_}if(I){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const O=[(e[0]+i[0])/2,(e[1]+i[1])/2],M=this.transformInv_(O),P=[(r[0]+t[0])/2,(r[1]+t[1])/2],X=this.transformInv_(P);this.addQuad_(t,e,O,P,a,f,M,X,y-1),this.addQuad_(P,O,i,r,X,M,g,p,y-1)}else{const O=[(t[0]+e[0])/2,(t[1]+e[1])/2],M=this.transformInv_(O),P=[(i[0]+r[0])/2,(i[1]+r[1])/2],X=this.transformInv_(P);this.addQuad_(t,O,P,r,a,M,X,p,y-1),this.addQuad_(O,e,i,P,M,f,g,X,y-1)}return}}if(S){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(L&11)==0&&this.addTriangle_(t,i,r,a,g,p),(L&14)==0&&this.addTriangle_(t,i,e,a,g,f),L&&((L&13)==0&&this.addTriangle_(e,r,t,f,p,a),(L&7)==0&&this.addTriangle_(e,r,i,f,p,g))}calculateSourceExtent(){const t=Fe();return this.triangles_.forEach(function(e,i,r){const a=e.source;Ls(t,a[0]),Ls(t,a[1]),Ls(t,a[2])}),t}getTriangles(){return this.triangles_}}const zh=.5;class cE extends Yh{constructor(t,e,i,r,a,f,g,p,y,v,x,R){super(a,at.IDLE,R),this.renderEdges_=x!==void 0?x:!1,this.pixelRatio_=g,this.gutter_=p,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=f||a,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const S=r.getTileCoordExtent(this.wrappedTileCoord_),I=this.targetTileGrid_.getExtent();let L=this.sourceTileGrid_.getExtent();const O=I?Ne(S,I):S;if(Ms(O)===0){this.state=at.EMPTY;return}const M=t.getExtent();M&&(L?L=Ne(L,M):L=M);const P=r.getResolution(this.wrappedTileCoord_[0]),X=Sd(t,i,O,P);if(!isFinite(X)||X<=0){this.state=at.EMPTY;return}const b=v!==void 0?v:zh;if(this.triangulation_=new Bh(t,i,O,L,X*b,P),this.triangulation_.getTriangles().length===0){this.state=at.EMPTY;return}this.sourceZ_=e.getZForResolution(X);let G=this.triangulation_.calculateSourceExtent();if(L&&(t.canWrapX()?(G[1]=re(G[1],L[1],L[3]),G[3]=re(G[3],L[1],L[3])):G=Ne(G,L)),!Ms(G))this.state=at.EMPTY;else{let W=0,j=0;t.canWrapX()&&(W=It(M),j=Math.floor((G[0]-M[0])/W)),sh(G.slice(),t,!0).forEach(V=>{const U=e.getTileRangeForExtentAndZ(V,this.sourceZ_);for(let it=U.minX;it<=U.maxX;it++)for(let q=U.minY;q<=U.maxY;q++){const K=y(this.sourceZ_,it,q,g);if(K){const $=j*W;this.sourceTiles_.push({tile:K,offset:$})}}++j}),this.sourceTiles_.length===0&&(this.state=at.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var r;const i=e.tile;if(i&&i.getState()==at.LOADED){const a=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);a[0]+=e.offset,a[2]+=e.offset;const f=(r=this.clipExtent_)==null?void 0:r.slice();f&&(f[0]+=e.offset,f[2]+=e.offset),t.push({extent:a,clipExtent:f,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=at.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],a=typeof i=="number"?i:i[1],f=this.targetTileGrid_.getResolution(e),g=this.sourceTileGrid_.getResolution(this.sourceZ_),p=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ad(r,a,this.pixelRatio_,g,this.sourceTileGrid_.getExtent(),f,p,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=at.LOADED}this.changed()}load(){if(this.state==at.IDLE){this.state=at.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==at.IDLE||i==at.LOADING){t++;const r=Ot(e,mt.CHANGE,a=>{const f=e.getState();(f==at.LOADED||f==at.ERROR||f==at.EMPTY)&&(Wt(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,r){e.getState()==at.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Wt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ra(this.canvas_.getContext("2d")),Pr.push(this.canvas_),this.canvas_=null),super.release()}}class uE{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof zs&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return Dt(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return Dt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Dt(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}function ia(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function fE(n,t,e){return n+"/"+t+"/"+e}function dE(n,t,e){return(t<<n)+e}function gE(n,t){const e=n[0],i=n[1],r=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const a=t.getFullTileRange(e);return a?a.containsXY(i,r):!0}function Cl(n,t,e,i){return`${n},${fE(t,e,i)}`}function Rl(n,t,e){if(!(e in n))return n[e]=new Set([t]),!0;const i=n[e],r=i.has(t);return r||i.add(t),!r}function _E(n,t,e){const i=n[e];return i?i.delete(t):!1}function Hu(n,t){const e=n.layerStatesArray[n.layerIndex];e.extent&&(t=Ne(t,pi(e.extent,n.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(n.viewState.projection).getExtent();r&&(t=Ne(t,r))}return t}class pE extends Xh{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Fe(),this.tempTileRange_=new Wh(0,0,0,0),this.tempTileCoord_=ia(0,0,0);const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new uE(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,i,r){const a=this.tileCache_,g=this.getLayer().getSource(),p=Cl(g.getKey(),t,e,i);let y;if(a.containsKey(p))y=a.get(p);else{if(y=g.getTile(t,e,i,r.pixelRatio,r.viewState.projection),!y)return null;a.set(p,y)}return y}getTile(t,e,i,r){const a=this.getOrCreateTile(t,e,i,r);return a||null}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=ce(e.pixelToCoordinateTransform,t.slice()),a=i.getExtent();if(a&&!jn(a,r))return null;const f=e.viewState,g=i.getRenderSource(),p=g.getTileGridForProjection(f.projection),y=g.getTilePixelRatio(e.pixelRatio);for(let v=p.getZForResolution(f.resolution);v>=p.getMinZoom();--v){const x=p.getTileCoordForCoordAndZ(r,v),R=this.getTile(v,x[1],x[2],e);if(!R||R.getState()!==at.LOADED)continue;const S=p.getOrigin(v),I=pe(p.getTileSize(v)),L=p.getResolution(v);let O;if(R instanceof oE||R instanceof cE)O=R.getImage();else if(R instanceof ea){if(O=ta(R.getData()),!O)continue}else continue;const M=Math.floor(y*((r[0]-S[0])/L-x[1]*I[0])),P=Math.floor(y*((S[1]-r[1])/L-x[2]*I[1])),X=Math.round(y*g.getGutterForProjection(f.projection));return this.getImageData(O,M+X,P+X)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const i=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(t,e,i,r,a){const f=t.viewState,g=this.getLayer(),p=g.getRenderSource(),y=p.getTileGridForProjection(f.projection),v=Mt(p);v in t.wantedTiles||(t.wantedTiles[v]={});const x=t.wantedTiles[v],R=g.getMapInternal(),S=Math.max(i-a,y.getMinZoom(),y.getZForResolution(Math.min(g.getMaxResolution(),R?R.getView().getResolutionForZoom(Math.max(g.getMinZoom(),0)):y.getResolution(0)),p.zDirection)),I=f.rotation,L=I?Sf(f.center,f.resolution,I,t.size):void 0;for(let O=i;O>=S;--O){const M=y.getTileRangeForExtentAndZ(e,O,this.tempTileRange_),P=y.getResolution(O);for(let X=M.minX;X<=M.maxX;++X)for(let b=M.minY;b<=M.maxY;++b){if(I&&!y.tileCoordIntersectsViewport([O,X,b],L))continue;const G=this.getTile(O,X,b,t);if(!G||!Rl(r,G,O))continue;const j=G.getKey();if(x[j]=!0,G.getState()===at.IDLE&&!t.tileQueue.isKeyQueued(j)){const Y=ia(O,X,b,this.tempTileCoord_);t.tileQueue.enqueue([G,v,y.getTileCoordCenter(Y),P])}}}}findStaleTile_(t,e){const i=this.tileCache_,r=t[0],a=t[1],f=t[2],g=this.getStaleKeys();for(let p=0;p<g.length;++p){const y=Cl(g[p],r,a,f);if(i.containsKey(y)){const v=i.peek(y);if(v.getState()===at.LOADED)return v.endTransition(Mt(this)),Rl(e,v,r),!0}}return!1}findAltTiles_(t,e,i,r){const a=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!a)return!1;let f=!0;const g=this.tileCache_,y=this.getLayer().getRenderSource().getKey();for(let v=a.minX;v<=a.maxX;++v)for(let x=a.minY;x<=a.maxY;++x){const R=Cl(y,i,v,x);let S=!1;if(g.containsKey(R)){const I=g.peek(R);I.getState()===at.LOADED&&(Rl(r,I,i),S=!0)}S||(f=!1)}return f}renderFrame(t,e){let i=!0;this.renderComplete=!0;const r=t.layerStatesArray[t.layerIndex],a=t.viewState,f=a.projection,g=a.resolution,p=a.center,y=t.pixelRatio,v=this.getLayer(),x=v.getSource(),R=x.getTileGridForProjection(f),S=R.getZForResolution(g,x.zDirection),I=R.getResolution(S),L=x.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==L&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=L):this.renderedSourceKey_=L;let O=t.extent;const M=x.getTilePixelRatio(y);this.prepareContainer(t,e);const P=this.context.canvas.width,X=this.context.canvas.height,b=r.extent&&pi(r.extent);b&&(O=Ne(O,pi(r.extent)));const G=I*P/2/M,W=I*X/2/M,j=[p[0]-G,p[1]-W,p[0]+G,p[1]+W],Y={};this.renderedTiles.length=0;const V=v.getPreload();if(t.nextExtent){const ut=R.getZForResolution(a.nextResolution,x.zDirection),ot=Hu(t,t.nextExtent);this.enqueueTiles(t,ot,ut,Y,V)}const U=Hu(t,O);if(this.enqueueTiles(t,U,S,Y,0),V>0&&setTimeout(()=>{this.enqueueTiles(t,U,S-1,Y,V-1)},0),!(S in Y))return this.container;const it=Mt(this),q=t.time;for(const ut of Y[S]){const ot=ut.getState();if(ot===at.EMPTY)continue;const dt=ut.tileCoord;if(ot===at.LOADED&&ut.getAlpha(it,q)===1){ut.endTransition(it);continue}if(ot!==at.IDLE&&(i=!1),ot!==at.ERROR&&(this.renderComplete=!1),this.findStaleTile_(dt,Y)){_E(Y,ut,S),t.animate=!0;continue}if(this.findAltTiles_(R,dt,S+1,Y))continue;const Xt=R.getMinZoom();for(let ht=S-1;ht>=Xt&&!this.findAltTiles_(R,dt,ht,Y);--ht);}const K=I/g*y/M,$=this.getRenderContext(t);vi(this.tempTransform,P/2,X/2,K,K,0,-P/2,-X/2),r.extent&&this.clipUnrotated($,t,b),x.getInterpolate()||($.imageSmoothingEnabled=!1),this.preRender($,t);const et=Object.keys(Y).map(Number);et.sort(Xi);let nt;const rt=[],ft=[];for(let ut=et.length-1;ut>=0;--ut){const ot=et[ut],dt=x.getTilePixelSize(ot,y,f),Tt=R.getResolution(ot)/I,Xt=dt[0]*Tt*K,ht=dt[1]*Tt*K,Vt=R.getTileCoordForCoordAndZ(Bi(j),ot),se=R.getTileCoordExtent(Vt),ue=ce(this.tempTransform,[M*(se[0]-j[0])/I,M*(j[3]-se[3])/I]),qt=M*x.getGutterForProjection(f);for(const Bt of Y[ot]){if(Bt.getState()!==at.LOADED)continue;const ji=Bt.tileCoord,Ei=Vt[1]-ji[1],hi=Math.round(ue[0]-(Ei-1)*Xt),_e=Vt[2]-ji[2],xi=Math.round(ue[1]-(_e-1)*ht),we=Math.round(ue[0]-Ei*Xt),Ye=Math.round(ue[1]-_e*ht),ci=hi-we,We=xi-Ye,Vi=et.length===1;let Tn=!1;nt=[we,Ye,we+ci,Ye,we+ci,Ye+We,we,Ye+We];for(let ti=0,Ci=rt.length;ti<Ci;++ti)if(!Vi&&ot<ft[ti]){const ae=rt[ti];Re([we,Ye,we+ci,Ye+We],[ae[0],ae[3],ae[4],ae[7]])&&(Tn||($.save(),Tn=!0),$.beginPath(),$.moveTo(nt[0],nt[1]),$.lineTo(nt[2],nt[3]),$.lineTo(nt[4],nt[5]),$.lineTo(nt[6],nt[7]),$.moveTo(ae[6],ae[7]),$.lineTo(ae[4],ae[5]),$.lineTo(ae[2],ae[3]),$.lineTo(ae[0],ae[1]),$.clip())}rt.push(nt),ft.push(ot),this.drawTile(Bt,t,we,Ye,ci,We,qt,Vi),Tn&&$.restore(),this.renderedTiles.unshift(Bt),this.updateUsedTiles(t.usedTiles,x,Bt)}}if(this.renderedResolution=I,this.extentChanged=!this.renderedExtent_||!wn(this.renderedExtent_,j),this.renderedExtent_=j,this.renderedPixelRatio=y,this.postRender(this.context,t),r.extent&&$.restore(),$.imageSmoothingEnabled=!0,this.renderComplete){const ut=(ot,dt)=>{const Z=Mt(x),Tt=dt.wantedTiles[Z],Xt=Tt?Object.keys(Tt).length:0;this.updateCacheSize(Xt),this.tileCache_.expireCache()};t.postRenderFunctions.push(ut)}return!this.renderComplete&&!i&&(t.animate=!0),this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,i,r,a,f,g,p){let y;if(t instanceof ea){if(y=ta(t.getData()),!y)throw new Error("Rendering array data is not yet supported")}else y=this.getTileImage(t);if(!y)return;const v=this.getRenderContext(e),x=Mt(this),R=e.layerStatesArray[e.layerIndex],S=R.opacity*(p?t.getAlpha(x,e.time):1),I=S!==v.globalAlpha;I&&(v.save(),v.globalAlpha=S),v.drawImage(y,g,g,y.width-2*g,y.height-2*g,i,r,a,f),I&&v.restore(),S!==R.opacity?e.animate=!0:p&&t.endTransition(x)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,i){const r=Mt(e);r in t||(t[r]={}),t[r][i.getKey()]=!0}}const Go={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class mE extends Js{constructor(t){t=t||{};const e=Object.assign({},t),i=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Go.PRELOAD)}setPreload(t){this.set(Go.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Go.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Go.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class yE extends mE{constructor(t){super(t)}createRenderer(){return new pE(this,{cacheSize:this.getCacheSize()})}}function Ul(n){return Array.isArray(n)?Math.min(...n):n}class vE extends Gh{constructor(t,e,i,r,a,f,g){let p=t.getExtent();p&&t.canWrapX()&&(p=p.slice(),p[0]=-1/0,p[2]=1/0);let y=e.getExtent();y&&e.canWrapX()&&(y=y.slice(),y[0]=-1/0,y[2]=1/0);const v=y?Ne(i,y):i,x=Je(v),R=zl(t,e,x,r),S=zh,I=new Bh(t,e,v,p,R*S,r),L=I.calculateSourceExtent(),O=Wr(L)?null:f(L,R,a),M=O?lt.IDLE:lt.EMPTY,P=O?O.getPixelRatio():1;super(i,r,P,M),this.targetProj_=e,this.maxSourceExtent_=p,this.triangulation_=I,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=O,this.sourcePixelRatio_=P,this.interpolate_=g,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==lt.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==lt.LOADED){const e=It(this.targetExtent_)/this.targetResolution_,i=Ht(this.targetExtent_)/this.targetResolution_;this.canvas_=Ad(e,i,this.sourcePixelRatio_,Ul(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==lt.IDLE){this.state=lt.LOADING,this.changed();const t=this.sourceImage_.getState();t==lt.LOADED||t==lt.ERROR?this.reproject_():(this.sourceListenerKey_=Ot(this.sourceImage_,mt.CHANGE,e=>{const i=this.sourceImage_.getState();(i==lt.LOADED||i==lt.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){Wt(this.sourceListenerKey_),this.sourceListenerKey_=null}}class eo extends li{constructor(t){super(),this.projection=$t(t.projection),this.attributions_=$u(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,r){e.viewResolver=i,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=$u(t),this.changed()}setState(t){this.state_=t,this.changed()}}function $u(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),t=>n):null}const ko=4,wl={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class EE extends Qe{constructor(t,e){super(t),this.image=e}}class Ld extends eo{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const i=ca(e,t,0);t=e[i]}return t}getImage(t,e,i,r){const a=this.getProjection();if(!a||!r||Or(a,r))return a&&(r=a),this.getImageInternal(t,e,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Or(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&wn(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new vE(a,r,t,e,i,(f,g,p)=>this.getImageInternal(f,g,p,a),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,i,r){if(this.loader){const a=xE(t,e,i,1),f=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&yn(this.wantedExtent_,a)||yn(this.image.getExtent(),a))&&(this.wantedResolution_&&Ul(this.wantedResolution_)===f||Ul(this.image.getResolution())===f)))return this.image;this.wantedProjection_=r,this.wantedExtent_=a,this.wantedResolution_=f,this.image=new Gh(a,f,i,this.loader),this.image.addEventListener(mt.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let i;switch(e.getState()){case lt.LOADING:this.loading=!0,i=wl.IMAGELOADSTART;break;case lt.LOADED:this.loading=!1,i=wl.IMAGELOADEND;break;case lt.ERROR:this.loading=!1,i=wl.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new EE(i,e))}}function xE(n,t,e,i){const r=t/e,a=Je(n),f=mn(It(n)/r,ko),g=mn(Ht(n)/r,ko),p=mn((i-1)*f/2,ko),y=f+2*p,v=mn((i-1)*g/2,ko),x=g+2*v;return Uo(a,r,0,[y,x])}const yr=[0,0,0],ln=5;class Od{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Dt(Gm(this.resolutions_,(r,a)=>a-r),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,a=this.resolutions_.length-1;r<a;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Dt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Bi(i)),Dt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Dt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Ih,Dt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,a)=>{const f=new Wh(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const g=this.getTileRangeForExtentAndZ(i,a);f.minX=Math.max(g.minX,f.minX),f.maxX=Math.min(g.maxX,f.maxX),f.minY=Math.max(g.minY,f.minY),f.maxY=Math.min(g.maxY,f.maxY)}return f}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let a=r.minX,f=r.maxX;a<=f;++a)for(let g=r.minY,p=r.maxY;g<=p;++g)i([e,a,g])}forEachTileCoordParentTileRange(t,e,i,r){let a,f,g,p=null,y=t[0]-1;for(this.zoomFactor_===2?(f=t[1],g=t[2]):p=this.getTileCoordExtent(t,r);y>=this.minZoom;){if(f!==void 0&&g!==void 0?(f=Math.floor(f/2),g=Math.floor(g/2),a=mr(f,f,g,g,i)):a=this.getTileRangeForExtentAndZ(p,y,i),e(y,a))return!0;--y}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const a=t[1]*2,f=t[2]*2;return mr(a,a+1,f,f+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],a=t[1],f=t[2];if(e===r)return mr(a,f,a,f,i);if(this.zoomFactor_){const p=Math.pow(this.zoomFactor_,e-r),y=Math.floor(a*p),v=Math.floor(f*p);if(e<r)return mr(y,y,v,v,i);const x=Math.floor(p*(a+1))-1,R=Math.floor(p*(f+1))-1;return mr(y,x,v,R,i)}const g=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(g,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,yr);const r=yr[1],a=yr[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,yr);const f=yr[1],g=yr[2];return mr(r,f,a,g,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=pe(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),a=pe(this.getTileSize(t[0]),this.tmpSize_),f=i[0]+t[1]*a[0]*r,g=i[1]-(t[2]+1)*a[1]*r,p=f+a[0]*r,y=g+a[1]*r;return Rn(f,g,p,y,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,a){const f=this.getZForResolution(i),g=i/this.getResolution(f),p=this.getOrigin(f),y=pe(this.getTileSize(f),this.tmpSize_);let v=g*(t-p[0])/i/y[0],x=g*(p[1]-e)/i/y[1];return r?(v=mn(v,ln)-1,x=mn(x,ln)-1):(v=Lo(v,ln),x=Lo(x,ln)),ia(f,v,x,a)}getTileCoordForXYAndZ_(t,e,i,r,a){const f=this.getOrigin(i),g=this.getResolution(i),p=pe(this.getTileSize(i),this.tmpSize_);let y=(t-f[0])/g/p[0],v=(f[1]-e)/g/p[1];return r?(y=mn(y,ln)-1,v=mn(v,ln)-1):(y=Lo(y,ln),v=Lo(v,ln)),ia(i,y,v,a)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=ca(this.resolutions_,t,e||0);return re(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return qf(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}}function Md(n){let t=n.getDefaultTileGrid();return t||(t=IE(n),n.setDefaultTileGrid(t)),t}function CE(n,t,e){const i=t[0],r=n.getTileCoordCenter(t),a=Uh(e);if(!jn(a,r)){const f=It(a),g=Math.ceil((a[0]-r[0])/f);return r[0]+=f*g,n.getTileCoordForCoordAndZ(r,i)}return t}function RE(n,t,e,i){i=i!==void 0?i:"top-left";const r=Pd(n,t,e);return new Od({extent:n,origin:$m(n,i),resolutions:r,tileSize:e})}function wE(n){const t=n||{},e=t.extent||$t("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Pd(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Od(i)}function Pd(n,t,e,i){t=t!==void 0?t:n0,e=pe(e!==void 0?e:Ih);const r=Ht(n),a=It(n);i=i>0?i:Math.max(a/e[0],r/e[1]);const f=t+1,g=new Array(f);for(let p=0;p<f;++p)g[p]=i/Math.pow(2,p);return g}function IE(n,t,e,i){const r=Uh(n);return RE(r,t,e,i)}function Uh(n){n=$t(n);let t=n.getExtent();if(!t){const e=180*ah.degrees/n.getMetersPerUnit();t=Rn(-e,-e,e,e)}return t}class Dd extends eo{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&pe(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||Mt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,a){return Ct()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Md(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),a=this.getTilePixelRatio(e),f=pe(r.getTileSize(t),this.tmpSize);return a==1?f:K0(f,a,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=e!==void 0?e:this.getProjection(),r=e!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=CE(r,t,i)),gE(t,r)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class TE extends Qe{constructor(t,e){super(t),this.tile=e}}function Fd(n){return function(t){const e=t.buffers,i=t.meta,r=t.imageOps,a=t.width,f=t.height,g=e.length,p=e[0].byteLength;if(r){const R=new Array(g);for(let I=0;I<g;++I)R[I]=new ImageData(new Uint8ClampedArray(e[I]),a,f);return n(R,i).data.buffer}const y=new Uint8ClampedArray(p),v=new Array(g),x=new Array(g);for(let R=0;R<g;++R)v[R]=new Uint8ClampedArray(e[R]),x[R]=[0,0,0,0];for(let R=0;R<p;R+=4){for(let I=0;I<g;++I){const L=v[I];x[I][0]=L[R],x[I][1]=L[R+1],x[I][2]=L[R+2],x[I][3]=L[R+3]}const S=n(x,i);y[R]=S[0],y[R+1]=S[1],y[R+2]=S[2],y[R+3]=S[3]}return y.buffer}}function SE(n,t){const i=Object.keys(n.lib||{}).map(function(a){return"const "+a+" = "+n.lib[a].toString()+";"}).concat(["const __minion__ = ("+Fd.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),r=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return r.addEventListener("message",t),r}function AE(n,t){const e=Fd(n.operation);let i=!1;return{postMessage:function(r){setTimeout(function(){i||t({data:{buffer:e(r),meta:r.meta}})},0)},terminate:function(){i=!0}}}class LE extends zs{constructor(t){super(),this.imageOps_=!!t.imageOps;let e;t.threads===0?e=0:this.imageOps_?e=1:e=t.threads||1;const i=new Array(e);if(e)for(let r=0;r<e;++r)i[r]=SE(t,this.onWorkerMessage_.bind(this,r));else i[0]=AE(t,this.onWorkerMessage_.bind(this,0));this.workers_=i,this.queue_=[],this.maxQueueLength_=t.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(t,e,i){this.enqueue_({inputs:t,meta:e,callback:i}),this.dispatch_()}enqueue_(t){for(this.queue_.push(t);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const t=this.queue_.shift();this.job_=t;const e=t.inputs[0].width,i=t.inputs[0].height,r=t.inputs.map(function(p){return p.data.buffer}),a=this.workers_.length;if(this.running_=a,a===1){this.workers_[0].postMessage({buffers:r,meta:t.meta,imageOps:this.imageOps_,width:e,height:i},r);return}const f=t.inputs[0].data.length,g=4*Math.ceil(f/4/a);for(let p=0;p<a;++p){const y=p*g,v=[];for(let x=0,R=r.length;x<R;++x)v.push(r[x].slice(y,y+g));this.workers_[p].postMessage({buffers:v,meta:t.meta,imageOps:this.imageOps_,width:e,height:i},v)}}onWorkerMessage_(t,e){this.disposed||(this.dataLookup_[t]=e.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const t=this.job_,e=this.workers_.length;let i,r;if(e===1)i=new Uint8ClampedArray(this.dataLookup_[0].buffer),r=this.dataLookup_[0].meta;else{const a=t.inputs[0].data.length;i=new Uint8ClampedArray(a),r=new Array(e);const f=4*Math.ceil(a/4/e);for(let g=0;g<e;++g){const p=this.dataLookup_[g].buffer,y=g*f;i.set(new Uint8ClampedArray(p),y),r[g]=this.dataLookup_[g].meta}}this.job_=null,this.dataLookup_={},t.callback(null,new ImageData(i,t.inputs[0].width,t.inputs[0].height),r),this.dispatch_()}disposeInternal(){for(let t=0;t<this.workers_.length;++t)this.workers_[t].terminate();this.workers_.length=0}}const qu={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Ju extends Qe{constructor(t,e,i){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=i}}class bd extends Ld{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=PE(t.sources);const e=this.changed.bind(this);for(let i=0,r=this.layers_.length;i<r;++i)this.layers_[i].addEventListener(mt.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new Rf(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Xe(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:ME(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Xe(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Mt(this),renderTargets:{}},this.setAttributions(function(i){var a;const r=[];for(let f=0,g=t.sources.length;f<g;++f){const p=t.sources[f],y=p instanceof eo?p:p.getSource();if(!y)continue;const v=(a=y.getAttributions())==null?void 0:a(i);typeof v=="string"?r.push(v):v!==void 0&&r.push(...v)}return r}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new LE({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,i){const r=Object.assign({},this.frameState_);r.viewState=Object.assign({},r.viewState);const a=Je(t);r.size[0]=Math.ceil(It(t)/e),r.size[1]=Math.ceil(Ht(t)/e),r.extent=[a[0]-r.size[0]*e/2,a[1]-r.size[1]*e/2,a[0]+r.size[0]*e/2,a[1]+r.size[1]*e/2],r.time=Date.now();const f=r.viewState;return f.center=a,f.projection=i,f.resolution=e,r}allSourcesReady_(){let t=!0,e;for(let i=0,r=this.layers_.length;i<r;++i)if(e=this.layers_[i].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,i,r){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const a=this.updateFrameState_(t,e,r);if(this.requestedFrameState_=a,this.renderedImageCanvas_){const f=this.renderedImageCanvas_.getResolution(),g=this.renderedImageCanvas_.getExtent();(e!==f||!wn(a.extent,g))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),a.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,i=new Array(e);for(let a=0;a<e;++a){t.layerIndex=a,t.renderTargets={};const f=OE(this.layers_[a],t);if(f)i[a]=f;else return}const r={};this.dispatchEvent(new Ju(qu.BEFOREOPERATIONS,t,r)),this.processor_.process(i,r,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,i,r){if(e||!i)return;const a=t.extent,f=t.viewState.resolution;if(f!==this.requestedFrameState_.viewState.resolution||!wn(a,this.requestedFrameState_.extent))return;let g;if(this.renderedImageCanvas_)g=this.renderedImageCanvas_.getImage().getContext("2d");else{const p=Math.round(It(a)/f),y=Math.round(Ht(a)/f);g=ee(p,y),this.renderedImageCanvas_=new eE(a,f,1,g.canvas)}g.putImageData(i,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Ju(qu.AFTEROPERATIONS,t,r))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let i=0,r=this.layers_.length;i<r&&(e=this.layers_[i].getSource().getResolutions(t),!e);++i);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}bd.prototype.dispose;let Gn=null;function OE(n,t){const e=n.getRenderer();if(!e)throw new Error("Unsupported layer type: "+n);if(!e.prepareFrame(t))return null;const i=t.size[0],r=t.size[1];if(i===0||r===0)return null;const a=e.renderFrame(t,null);let f;if(a instanceof HTMLCanvasElement)f=a;else{if(a&&(f=a.firstElementChild),!(f instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+f);if(f.width===i&&f.height===r)return f.getContext("2d").getImageData(0,0,i,r)}if(!Gn)Gn=ee(i,r,void 0,{willReadFrequently:!0});else{const g=Gn.canvas;g.width!==i||g.height!==r?Gn=ee(i,r,void 0,{willReadFrequently:!0}):Gn.clearRect(0,0,i,r)}return Gn.drawImage(f,0,0,i,r),Gn.getImageData(0,0,i,r)}function ME(n){return n.map(function(t){return t.getLayerState()})}function PE(n){const t=n.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=DE(n[i]);return e}function DE(n){let t;return n instanceof eo?n instanceof Dd?t=new yE({source:n}):n instanceof Ld&&(t=new Td({source:n})):t=n,t}let FE=!1;function bE(n,t,e,i,r,a,f){const g=new XMLHttpRequest;g.open("GET",typeof n=="function"?n(e,i,r):n,!0),t.getType()=="arraybuffer"&&(g.responseType="arraybuffer"),g.withCredentials=FE,g.onload=function(p){if(!g.status||g.status>=200&&g.status<300){const y=t.getType();try{let v;y=="text"||y=="json"?v=g.responseText:y=="xml"?v=g.responseXML||g.responseText:y=="arraybuffer"&&(v=g.response),v?a(t.readFeatures(v,{extent:e,featureProjection:r}),t.readProjection(v)):f()}catch{f()}}else f()},g.onerror=f,g.send()}function Qu(n,t){return function(e,i,r,a,f){bE(n,t,e,i,r,(g,p)=>{this.addFeatures(g),a!==void 0&&a(g)},f||br)}}function GE(n,t){return[[-1/0,-1/0,1/0,1/0]]}class io extends li{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new io(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Wt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=Ot(t,mt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?kE(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function kE(n){if(typeof n=="function")return n;let t;return Array.isArray(n)?t=n:(Dt(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[n]),function(){return t}}function Gd(n,t,e,i){const r=[];let a=Fe();for(let f=0,g=e.length;f<g;++f){const p=e[f];a=nh(n,t,p[0],i),r.push((a[0]+a[2])/2,(a[1]+a[3])/2),t=p[p.length-1]}return r}function na(n,t,e,i,r,a,f){let g,p;const y=(e-t)/i;if(y===1)g=t;else if(y===2)g=t,p=r;else if(y!==0){let v=n[t],x=n[t+1],R=0;const S=[0];for(let O=t+i;O<e;O+=i){const M=n[O],P=n[O+1];R+=Math.sqrt((M-v)*(M-v)+(P-x)*(P-x)),S.push(R),v=M,x=P}const I=r*R,L=Dm(S,I);L<0?(p=(I-S[-L-2])/(S[-L-1]-S[-L-2]),g=t+(-L-2)*i):g=t+L*i}f=f>1?f:2,a=a||new Array(f);for(let v=0;v<f;++v)a[v]=g===void 0?NaN:p===void 0?n[g+v]:Ge(n[g+v],n[g+i+v],p);return a}function jl(n,t,e,i,r,a){if(e==t)return null;let f;if(r<n[t+i-1])return a?(f=n.slice(t,t+i),f[i-1]=r,f):null;if(n[e-1]<r)return a?(f=n.slice(e-i,e),f[i-1]=r,f):null;if(r==n[t+i-1])return n.slice(t,t+i);let g=t/i,p=e/i;for(;g<p;){const R=g+p>>1;r<n[(R+1)*i-1]?p=R:g=R+1}const y=n[g*i-1];if(r==y)return n.slice((g-1)*i,(g-1)*i+i);const v=n[(g+1)*i-1],x=(r-y)/(v-y);f=[];for(let R=0;R<i-1;++R)f.push(Ge(n[(g-1)*i+R],n[g*i+R],x));return f.push(r),f}function NE(n,t,e,i,r,a,f){if(f)return jl(n,t,e[e.length-1],i,r,a);let g;if(r<n[i-1])return a?(g=n.slice(0,i),g[i-1]=r,g):null;if(n[n.length-1]<r)return a?(g=n.slice(n.length-i),g[i-1]=r,g):null;for(let p=0,y=e.length;p<y;++p){const v=e[p];if(t!=v){if(r<n[t+i-1])return null;if(r<=n[v-1])return jl(n,t,v,i,r,!1);t=v}}return null}class ra extends Uf{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Wt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(Ot(t[e],mt.CHANGE,this.changed,this))}clone(){const t=new ra(Il(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<Hn(this.getExtent(),t,e))return r;const a=this.geometries_;for(let f=0,g=a.length;f<g;++f)r=a[f].closestPointXY(t,e,i,r);return r}containsXY(t,e){const i=this.geometries_;for(let r=0,a=i.length;r<a;++r)if(i[r].containsXY(t,e))return!0;return!1}computeExtent(t){Ks(t);const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)rh(t,e[i].getExtent());return t}getGeometries(){return Il(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let r=!1;for(let a=0,f=i.length;a<f;++a){const g=i[a],p=g.getSimplifiedGeometry(t);e.push(p),p!==g&&(r=!0)}return r?new ra(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let r=0,a=i.length;r<a;++r)i[r].rotate(t,e);this.changed()}scale(t,e,i){i||(i=Je(this.getExtent()));const r=this.geometries_;for(let a=0,f=r.length;a<f;++a)r[a].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(Il(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let r=0,a=i.length;r<a;++r)i[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Il(n){return n.map(t=>t.clone())}function kd(n,t,e,i){let r=n[t],a=n[t+1],f=0;for(let g=t+i;g<e;g+=i){const p=n[g],y=n[g+1];f+=Math.sqrt((p-r)*(p-r)+(y-a)*(y-a)),r=p,a=y}return f}class Yr extends $n{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){si(this.flatCoordinates,t),this.changed()}clone(){const t=new Yr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Hn(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(dh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_h(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r))}forEachSegment(t){return $f(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,jl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return vn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return na(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return kd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ea(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Yr(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return xa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=va(this.flatCoordinates,0,t,this.stride),this.changed()}}class sa extends $n{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const r=t,a=[],f=[];for(let p=0,y=r.length;p<y;++p){const v=r[p];si(a,v.getFlatCoordinates()),f.push(a.length)}const g=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(g,a),this.ends_=f}}appendLineString(t){si(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new sa(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Hn(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ph(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,NE(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Fs(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Yr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[];let a=0;for(let f=0,g=e.length;f<g;++f){const p=e[f],y=new Yr(t.slice(a,p),i);r.push(y),a=p}return r}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const r=this.ends_,a=this.stride;for(let f=0,g=r.length;f<g;++f){const p=r[f],y=na(e,i,p,a,.5);si(t,y),i=p}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Zf(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new sa(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Zy(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Hs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Oa extends $n{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){si(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Oa(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<Hn(this.getExtent(),t,e))return r;const a=this.flatCoordinates,f=this.stride;for(let g=0,p=a.length;g<p;g+=f){const y=zn(t,e,a[g],a[g+1]);if(y<r){r=y;for(let v=0;v<f;++v)i[v]=a[g+v];i.length=f}}return r}getCoordinates(){return vn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Vn(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,r=[];for(let a=0,f=t.length;a<f;a+=i){const g=new Vn(t.slice(a,a+i),e);r.push(g)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let r=0,a=e.length;r<a;r+=i){const f=e[r],g=e[r+1];if(eh(t,f,g))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=va(this.flatCoordinates,0,t,this.stride),this.changed()}}class oa extends $n{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const r=t,a=[],f=[];for(let g=0,p=r.length;g<p;++g){const y=r[g],v=a.length,x=y.getEnds();for(let R=0,S=x.length;R<S;++R)x[R]+=v;si(a,y.getFlatCoordinates()),f.push(x)}e=r.length===0?this.getLayout():r[0].getLayout(),t=a,i=f}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;si(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,a=e.length;r<a;++r)e[r]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const i=new oa(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,r){return r<Hn(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wy(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),By(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return Ky(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Yy(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),kl(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Gl(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Gd(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Hf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Oa(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Qf(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=kl(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=jy(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new oa(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const a=this.endss_[t-1];e=a[a.length-1]}const i=this.endss_[t].slice(),r=i[i.length-1];if(e!==0)for(let a=0,f=i.length;a<f;++a)i[a]-=e;return new zi(this.flatCoordinates.slice(e,r),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[];let a=0;for(let f=0,g=i.length;f<g;++f){const p=i[f].slice(),y=p[p.length-1];if(a!==0)for(let x=0,R=p.length;x<R;++x)p[x]-=a;const v=new zi(e.slice(a,y),t,p);r.push(v),a=y}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return Hy(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Kf(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const tf=Xe();class ke{constructor(t,e,i,r,a,f){this.styleFunction,this.extent_,this.id_=f,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=a,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?ih(this.flatCoordinates_):nh(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Je(this.getExtent());this.flatInteriorPoints_=vh(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=qy(this.flatCoordinates_,this.ends_),e=Gd(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Hf(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=na(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let r=0,a=i.length;r<a;++r){const f=i[r],g=na(t,e,f,2,.5);si(this.flatMidpoints_,g),e=f}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=$t(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const r=Ht(i)/Ht(e);vi(tf,i[0],i[3],r,-r,0,0,0),xn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tf,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new ke(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=yf((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=Ea(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=Zf(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,r);break;case"Polygon":r=[],i.length=mh(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,r);break}return r&&(this.simplifiedGeometry_=new ke(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}ke.prototype.getFlatCoordinates=ke.prototype.getOrientedFlatCoordinates;class ef{constructor(t){this.rbush_=new ad(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[Mt(e)]=i}load(t,e){const i=new Array(e.length);for(let r=0,a=e.length;r<a;r++){const f=t[r],g=e[r],p={minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],value:g};i[r]=p,this.items_[Mt(g)]=p}this.rbush_.load(i)}remove(t){const e=Mt(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[Mt(e)],r=[i.minX,i.minY,i.maxX,i.maxY];wn(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(r){return r.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let r=0,a=t.length;r<a;r++)if(i=e(t[r]),i)return i;return i}isEmpty(){return Un(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Rn(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Ze={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class hn extends Qe{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Nd extends eo{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=br,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Dt(this.format_,"`format` must be set when `url` is set"),this.loader_=Qu(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:GE;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new ef:null,this.loadedExtentsRtree_=new ef,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(t.features)?r=t.features:t.features&&(i=t.features,r=i.getArray()),!e&&i===void 0&&(i=new _i(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Mt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new hn(Ze.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof ke||(this.featureChangeKeys_[t]=[Ot(e,mt.CHANGE,this.handleFeatureChange_,this),Ot(e,Fr.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof ke){const a=this.idIndex_[r];a instanceof ke?Array.isArray(a)?a.push(e):this.idIndex_[r]=[a,e]:i=!1}else i=!1}return i&&(Dt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],r=[];for(let a=0,f=t.length;a<f;a++){const g=t[a],p=Mt(g);this.addToIndex_(p,g)&&i.push(g)}for(let a=0,f=i.length;a<f;a++){const g=i[a],p=Mt(g);this.setupChangeEvents_(p,g);const y=g.getGeometry();if(y){const v=y.getExtent();e.push(v),r.push(g)}else this.nullGeometryFeatures_[p]=g}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(Ze.ADDFEATURE))for(let a=0,f=i.length;a<f;a++)this.dispatchEvent(new hn(Ze.ADDFEATURE,i[a]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Ze.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(Ze.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(Oe.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(Oe.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(Wt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new hn(Ze.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(r){const a=r.getGeometry();if(a instanceof ke||a.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const r=i.getGeometry();if(r instanceof ke||r.intersectsExtent(t)){const a=e(i);if(a)return a}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Un(this.nullGeometryFeatures_)||si(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const r=sh(t,e);return[].concat(...r.map(a=>this.featuresRtree_.getInExtent(a)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],r=t[1];let a=null;const f=[NaN,NaN];let g=1/0;const p=[-1/0,-1/0,1/0,1/0];return e=e||Os,this.featuresRtree_.forEachInExtent(p,function(y){if(e(y)){const v=y.getGeometry(),x=g;if(g=v instanceof ke?0:v.closestPointXY(i,r,f,g),g<x){a=y;const R=Math.sqrt(g);p[0]=i-R,p[1]=r-R,p[2]=i+R,p[3]=r+R}}}),a}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=Mt(e),r=e.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const f=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(f,e)):this.featuresRtree_&&this.featuresRtree_.update(f,e)}const a=e.getId();if(a!==void 0){const f=a.toString();this.idIndex_[f]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[f]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new hn(Ze.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Mt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Un(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const r=this.loadedExtentsRtree_,a=this.strategy_(t,e,i);for(let f=0,g=a.length;f<g;++f){const p=a[f];r.forEachInExtent(p,function(v){return yn(v.extent,p)})||(++this.loadingExtentsCount_,this.dispatchEvent(new hn(Ze.FEATURESLOADSTART)),this.loader_.call(this,p,e,i,v=>{--this.loadingExtentsCount_,this.dispatchEvent(new hn(Ze.FEATURESLOADEND,void 0,v))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new hn(Ze.FEATURESLOADERROR))}),r.insert(p,{extent:p.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(r){if(wn(r.extent,t))return r});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,r=t.length;i<r;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Mt(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(Wt),delete this.featureChangeKeys_[e];const r=t.getId();if(r!==void 0){const a=r.toString(),f=this.idIndex_[a];f===t?delete this.idIndex_[a]:Array.isArray(f)&&(f.splice(f.indexOf(t),1),f.length===1&&(this.idIndex_[a]=f[0]))}return delete this.uidIndex_[e],this.hasListener(Ze.REMOVEFEATURE)&&this.dispatchEvent(new hn(Ze.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Dt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Qu(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}const XE=/\{z\}/g,YE=/\{x\}/g,WE=/\{y\}/g,BE=/\{-y\}/g;function zE(n,t,e,i,r){return n.replace(XE,t.toString()).replace(YE,e.toString()).replace(WE,i.toString()).replace(BE,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-i).toString()})}function UE(n,t,e,i){const r=dE(t,e,i),a=Ar(r,n.length);return n[a]}function jE(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let a;for(a=i;a<=r;++a)t.push(n.replace(e[0],String.fromCharCode(a)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(n.replace(e[0],r.toString()));return t}return t.push(n),t}function Ma(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vl(n,t,e,i,r,a,f){f=f??Ma();const g=1/(n-t),p=1/(e-i),y=1/(r-a);return f[0]=-2*g,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*p,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*y,f[11]=0,f[12]=(n+t)*g,f[13]=(i+e)*p,f[14]=(a+r)*y,f[15]=1,f}function nf(n,t,e,i,r){return r=r??Ma(),r[0]=n[0]*t,r[1]=n[1]*t,r[2]=n[2]*t,r[3]=n[3]*t,r[4]=n[4]*e,r[5]=n[5]*e,r[6]=n[6]*e,r[7]=n[7]*e,r[8]=n[8]*i,r[9]=n[9]*i,r[10]=n[10]*i,r[11]=n[11]*i,r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}function VE(n,t,e,i,r){r=r??Ma();let a,f,g,p,y,v,x,R,S,I,L,O;return n===r?(r[12]=n[0]*t+n[4]*e+n[8]*i+n[12],r[13]=n[1]*t+n[5]*e+n[9]*i+n[13],r[14]=n[2]*t+n[6]*e+n[10]*i+n[14],r[15]=n[3]*t+n[7]*e+n[11]*i+n[15]):(a=n[0],f=n[1],g=n[2],p=n[3],y=n[4],v=n[5],x=n[6],R=n[7],S=n[8],I=n[9],L=n[10],O=n[11],r[0]=a,r[1]=f,r[2]=g,r[3]=p,r[4]=y,r[5]=v,r[6]=x,r[7]=R,r[8]=S,r[9]=I,r[10]=L,r[11]=O,r[12]=a*t+y*e+S*i+n[12],r[13]=f*t+v*e+I*i+n[13],r[14]=g*t+x*e+L*i+n[14],r[15]=p*t+R*e+O*i+n[15]),r}function KE(n,t,e,i){return i=i??Ma(),i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n,i[13]=t,i[14]=e,i[15]=1,i}const ZE=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,HE=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class $E{constructor(t){this.gl_=t,this.program_=Kl(t,HE,ZE),this.positionLocation=t.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=t.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=t.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=t.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positions),t.STATIC_DRAW),this.texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.texcoords),t.STATIC_DRAW)}drawImage(t,e,i,r,a,f,g,p,y,v,x,R,S){const I=this.gl_;p===void 0&&(p=r),y===void 0&&(y=a),f===void 0&&(f=e),g===void 0&&(g=i),v===void 0&&(v=f),x===void 0&&(x=g),R===void 0&&(R=I.canvas.width),S===void 0&&(S=I.canvas.height),I.bindTexture(I.TEXTURE_2D,t),I.useProgram(this.program_),I.bindBuffer(I.ARRAY_BUFFER,this.positionBuffer),I.enableVertexAttribArray(this.positionLocation),I.vertexAttribPointer(this.positionLocation,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,this.texcoordBuffer),I.enableVertexAttribArray(this.texcoordLocation),I.vertexAttribPointer(this.texcoordLocation,2,I.FLOAT,!1,0,0);let L=Vl(0,R,0,S,-1,1);L=VE(L,p,y,0),L=nf(L,v,x,1),I.uniformMatrix4fv(this.matrixLocation,!1,L);let O=KE(r/e,a/i,0);O=nf(O,f/e,g/i,1),I.uniformMatrix4fv(this.textureMatrixLocation,!1,O),I.uniform1i(this.textureLocation,0),I.drawArrays(I.TRIANGLES,0,this.positions.length/2)}}function rf(n,t,e){const i=n.createShader(t);if(i===null)throw new Error("Shader compilation failed");if(n.shaderSource(i,e),n.compileShader(i),!n.getShaderParameter(i,n.COMPILE_STATUS)){const r=n.getShaderInfoLog(i);throw r===null?new Error("Shader info log creation failed"):new Error(r)}return i}function Kl(n,t,e){const i=n.createProgram(),r=rf(n,n.VERTEX_SHADER,e),a=rf(n,n.FRAGMENT_SHADER,t);if(i===null)throw new Error("Program creation failed");if(n.attachShader(i,r),n.attachShader(i,a),n.linkProgram(i),!n.getProgramParameter(i,n.LINK_STATUS))throw n.getProgramInfoLog(i)===null?new Error("Program info log creation failed"):new Error;return i}const qE=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,JE=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,QE=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,tx=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function ex(n,t,e,i){let r;return e&&e.length?r=e.shift():Ql?r=new OffscreenCanvas(n||300,t||300):r=document.createElement("canvas"),n&&(r.width=n),t&&(r.height=t),r.getContext("webgl",i)}function ix(n){const t=n.canvas;t.width=1,t.height=1,n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)}const sf=[];function nx(n,t,e,i,r,a,f,g,p,y,v,x,R,S){const I=Math.round(i*t),L=Math.round(i*e);n.canvas.width=I,n.canvas.height=L;let O,M;if(M=n.createTexture(),n.bindTexture(n.TEXTURE_2D,M),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),R?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,I,L,0,n.RGBA,v,null),O=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,O),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,M,0),O===null)throw new Error("Could not create framebuffer");if(M===null)throw new Error("Could not create texture");if(p.length===0)return{width:I,height:L,framebuffer:O,texture:M};const P=Fe();p.forEach(function(U,it,q){rh(P,U.extent)});let X,b,G;const W=1/r;{if(X=n.createTexture(),M===null)throw new Error("Could not create texture");b=Math.round(It(P)*W),G=Math.round(Ht(P)*W);const U=n.getParameter(n.MAX_TEXTURE_SIZE),it=Math.max(b,G),q=it>U?U/it:1,K=Math.round(b*q),$=Math.round(G*q);n.bindTexture(n.TEXTURE_2D,X),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),R?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,K,$,0,n.RGBA,v,null);const et=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,et),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,X,0);const nt=new $E(n);p.forEach(function(rt,ft,ut){const ot=(rt.extent[0]-P[0])*W*q,dt=-(rt.extent[3]-P[3])*W*q,Z=It(rt.extent)*W*q,Tt=Ht(rt.extent)*W*q;if(n.bindFramebuffer(n.FRAMEBUFFER,et),n.viewport(0,0,K,$),rt.clipExtent){const Xt=(rt.clipExtent[0]-P[0])*W*q,ht=-(rt.clipExtent[3]-P[3])*W*q,Vt=It(rt.clipExtent)*W*q,se=Ht(rt.clipExtent)*W*q;n.enable(n.SCISSOR_TEST),n.scissor(R?Xt:Math.round(Xt),R?ht:Math.round(ht),R?Vt:Math.round(Xt+Vt)-Math.round(Xt),R?se:Math.round(ht+se)-Math.round(ht))}nt.drawImage(rt.texture,rt.width,rt.height,y,y,rt.width-2*y,rt.height-2*y,R?ot:Math.round(ot),R?dt:Math.round(dt),R?Z:Math.round(ot+Z)-Math.round(ot),R?Tt:Math.round(dt+Tt)-Math.round(dt),K,$),n.disable(n.SCISSOR_TEST)}),n.deleteFramebuffer(et)}const j=Bi(f),Y=Bi(P),V=U=>{const it=(U[0][0]-j[0])/a*i,q=-(U[0][1]-j[1])/a*i,K=(U[1][0]-j[0])/a*i,$=-(U[1][1]-j[1])/a*i,et=(U[2][0]-j[0])/a*i,nt=-(U[2][1]-j[1])/a*i;return{u1:K,v1:$,u0:it,v0:q,u2:et,v2:nt}};n.bindFramebuffer(n.FRAMEBUFFER,O),n.viewport(0,0,I,L);{const U=[],it=[],q=Kl(n,tx,QE);n.useProgram(q);const K=n.getUniformLocation(q,"u_texture");n.bindTexture(n.TEXTURE_2D,X),n.uniform1i(K,0),g.getTriangles().forEach(function(ot,dt,Z){const Tt=ot.source,Xt=ot.target,{u1:ht,v1:Vt,u0:se,v0:ue,u2:qt,v2:Bt}=V(Xt),ji=(Tt[0][0]-Y[0])/r/b,Ei=-(Tt[0][1]-Y[1])/r/G,hi=(Tt[1][0]-Y[0])/r/b,_e=-(Tt[1][1]-Y[1])/r/G,xi=(Tt[2][0]-Y[0])/r/b,we=-(Tt[2][1]-Y[1])/r/G;U.push(ht,Vt,se,ue,qt,Bt),it.push(hi,_e,ji,Ei,xi,we)});const $=Vl(0,I,L,0,-1,1),et=n.getUniformLocation(q,"u_matrix");n.uniformMatrix4fv(et,!1,$);const nt=n.getAttribLocation(q,"a_position"),rt=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,rt),n.bufferData(n.ARRAY_BUFFER,new Float32Array(U),n.STATIC_DRAW),n.vertexAttribPointer(nt,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(nt);const ft=n.getAttribLocation(q,"a_texcoord"),ut=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,ut),n.bufferData(n.ARRAY_BUFFER,new Float32Array(it),n.STATIC_DRAW),n.vertexAttribPointer(ft,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(ft),n.drawArrays(n.TRIANGLES,0,U.length/2)}if(x){const U=Kl(n,JE,qE);n.useProgram(U);const it=Vl(0,I,L,0,-1,1),q=n.getUniformLocation(U,"u_matrix");n.uniformMatrix4fv(q,!1,it);const K=Array.isArray(x)?x:[0,0,0,255],$=n.getUniformLocation(U,"u_val");n.uniform4fv($,K);const et=n.getAttribLocation(U,"a_position"),nt=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,nt),n.vertexAttribPointer(et,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(et);const rt=g.getTriangles().reduce(function(ft,ut){const ot=ut.target,{u1:dt,v1:Z,u0:Tt,v0:Xt,u2:ht,v2:Vt}=V(ot);return ft.concat([dt,Z,Tt,Xt,Tt,Xt,ht,Vt,ht,Vt,dt,Z])},[]);n.bufferData(n.ARRAY_BUFFER,new Float32Array(rt),n.STATIC_DRAW),n.drawArrays(n.LINES,0,rt.length/2)}return{width:I,height:L,framebuffer:O,texture:M}}class rx extends ea{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.renderEdges_=t.renderEdges!==void 0?t.renderEdges:!1,this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,i=e.getExtent(),r=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?r?Ne(i,r):i:r;const a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const p=f?Ne(a,f):a;if(Ms(p)===0){this.state=at.EMPTY;return}i&&(g?g=Ne(g,i):g=i);const y=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),v=t.targetProj,x=Sd(e,v,p,y);if(!isFinite(x)||x<=0){this.state=at.EMPTY;return}const R=t.errorThreshold!==void 0?t.errorThreshold:zh;if(this.triangulation_=new Bh(e,v,p,g,x*R,y,t.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=at.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(x);let S=this.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(S[1]=re(S[1],g[1],g[3]),S[3]=re(S[3],g[1],g[3])):S=Ne(S,g)),!Ms(S))this.state=at.EMPTY;else{let I=0,L=0;e.canWrapX()&&(I=It(i),L=Math.floor((S[0]-i[0])/I)),sh(S.slice(),e,!0).forEach(M=>{const P=this.sourceTileGrid_.getTileRangeForExtentAndZ(M,this.sourceZ_),X=t.getTileFunction;for(let b=P.minX;b<=P.maxX;b++)for(let G=P.minY;G<=P.maxY;G++){const W=X(this.sourceZ_,b,G,this.pixelRatio_);if(W){const j=L*I;this.sourceTiles_.push({tile:W,offset:j})}}++L}),this.sourceTiles_.length===0&&(this.state=at.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];let e=!1;if(this.sourceTiles_.forEach(b=>{var dt;const G=b.tile;if(!G||G.getState()!==at.LOADED)return;const W=G.getSize(),j=this.gutter_;let Y;const V=iE(G.getData());V?Y=V:(e=!0,Y=rE(ta(G.getData())));const U=[W[0]+2*j,W[1]+2*j],it=Y instanceof Float32Array,q=U[0]*U[1],K=it?Float32Array:Uint8ClampedArray,$=new K(Y.buffer),et=K.BYTES_PER_ELEMENT,nt=et*$.length/q,rt=$.byteLength/U[1],ft=Math.floor(rt/et/U[0]),ut=this.sourceTileGrid_.getTileCoordExtent(G.tileCoord);ut[0]+=b.offset,ut[2]+=b.offset;const ot=(dt=this.clipExtent_)==null?void 0:dt.slice();ot&&(ot[0]+=b.offset,ot[2]+=b.offset),t.push({extent:ut,clipExtent:ot,data:$,dataType:K,bytesPerPixel:nt,pixelSize:U,bandCount:ft})}),this.sourceTiles_.length=0,t.length===0){this.state=at.ERROR,this.changed();return}const i=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(i),a=typeof r=="number"?r:r[0],f=typeof r=="number"?r:r[1],g=a*this.pixelRatio_,p=f*this.pixelRatio_,y=this.targetTileGrid_.getResolution(i),v=this.sourceTileGrid_.getResolution(this.sourceZ_),x=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),R=t[0].bandCount,S=new t[0].dataType(R*g*p),I=ex(g,p,sf,{premultipliedAlpha:!1,antialias:!1});let L;const O=I.RGBA;let M;t[0].dataType==Float32Array?(M=I.FLOAT,I.getExtension("WEBGL_color_buffer_float"),I.getExtension("OES_texture_float"),I.getExtension("EXT_float_blend"),L=I.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(M=I.UNSIGNED_BYTE,L=this.interpolate);const P=4,X=Math.ceil(R/P);for(let b=X-1;b>=0;--b){const G=[];for(let K=0,$=t.length;K<$;++K){const et=t[K],nt=et.pixelSize,rt=nt[0],ft=nt[1],ut=new et.dataType(P*rt*ft),ot=et.data;let dt=b*P;for(let Tt=0,Xt=ut.length;Tt<Xt;Tt+=P)ut[Tt]=ot[dt],ut[Tt+1]=ot[dt+1],ut[Tt+2]=ot[dt+2],ut[Tt+3]=ot[dt+3],dt+=R;const Z=I.createTexture();I.bindTexture(I.TEXTURE_2D,Z),L?(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR)):(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST)),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texImage2D(I.TEXTURE_2D,0,O,rt,ft,0,O,M,ut),G.push({extent:et.extent,clipExtent:et.clipExtent,texture:Z,width:rt,height:ft})}const{framebuffer:W,width:j,height:Y}=nx(I,a,f,this.pixelRatio_,v,y,x,this.triangulation_,G,this.gutter_,M,this.renderEdges_,L),V=j,U=Y*P,it=new t[0].dataType(V*U);I.bindFramebuffer(I.FRAMEBUFFER,W),I.readPixels(0,0,j,Y,I.RGBA,M,it);let q=b*P;for(let K=0,$=it.length;K<$;K+=P){const et=(V-1-(K/U|0))*U+K%U;S[q]=it[et],S[q+1]=it[et+1],S[q+2]=it[et+2],S[q+3]=it[et+3],q+=R}}if(ix(I),sf.push(I.canvas),e){const b=ee(a,f),G=new ImageData(S,a);b.putImageData(G,0,0),this.reprojData_=b.canvas}else this.reprojData_=S;this.reprojSize_=[Math.round(g),Math.round(p)],this.state=at.LOADED,this.changed()}load(){if(this.state!==at.IDLE&&this.state!==at.ERROR)return;this.state=at.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i!==at.IDLE&&i!==at.LOADING)return;t++;const r=Ot(e,mt.CHANGE,()=>{const a=e.getState();(a==at.LOADED||a==at.ERROR||a==at.EMPTY)&&(Wt(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==at.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Wt),this.sourcesListenerKeys_=null}}const Tl={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class sx extends Dd{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let i=t.tileGrid;i===void 0&&e&&(i=wE({extent:Uh(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:i,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?pe(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?pe(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return(!e||Or(e,t))&&!this.transformMatrix?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,i,r,a){const f=this.tileGrid||this.getTileGridForProjection(a||r),g=Math.max.apply(null,f.getResolutions().map((S,I)=>{const L=pe(f.getTileSize(I)),O=this.getTileSize(I);return Math.max(O[0]/L[0],O[1]/L[1])})),p=this.getTileGridForProjection(r),y=[t,e,i],v=this.getTileCoordForTileUrlFunction(y,r),x=Object.assign({sourceProj:a||r,sourceTileGrid:f,targetProj:r,targetTileGrid:p,tileCoord:y,wrappedTileCoord:v,pixelRatio:g,gutter:this.gutter_,getTileFunction:(S,I,L,O)=>this.getTile(S,I,L,O),transformMatrix:this.transformMatrix},this.tileOptions),R=new rx(x);return R.key=this.getKey(),R}getTile(t,e,i,r,a){var X;const f=this.getProjection();if(a&&(f&&!Or(f,a)||this.transformMatrix))return this.getReprojTile_(t,e,i,a,f);const g=this.getTileSize(t),p=this.loader_,y=new AbortController,v={signal:y.signal,crossOrigin:this.crossOrigin_},x=this.getTileCoordForTileUrlFunction([t,e,i]);if(!x)return null;const R=x[0],S=x[1],I=x[2],L=(X=this.getTileGrid())==null?void 0:X.getFullTileRange(R);L&&(v.maxY=L.getHeight()-1);function O(){return Jl(function(){return p(R,S,I,v)})}const M=Object.assign({tileCoord:[t,e,i],loader:O,size:g,controller:y},this.tileOptions),P=new ea(M);return P.key=this.getKey(),P.addEventListener(mt.CHANGE,this.handleTileChange_),P}handleTileChange_(t){const e=t.target,i=Mt(e),r=e.getState();let a;r==at.LOADING?(this.tileLoadingKeys_[i]=!0,a=Tl.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],a=r==at.ERROR?Tl.TILELOADERROR:r==at.LOADED?Tl.TILELOADEND:void 0),a&&this.dispatchEvent(new TE(a,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Or(e,t))&&!this.transformMatrix)return this.tileGrid;const i=Mt(t);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=Md(t)),this.tileGridForProjection_[i]}setTileGridForProjection(t,e){const i=$t(t);if(i){const r=Mt(i);r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=e)}}}const ox=new Error("Image failed to load");function Xd(n,t,e,i,r){return new Promise((a,f)=>{const g=new Image;g.crossOrigin=r.crossOrigin??null,g.addEventListener("load",()=>a(g)),g.addEventListener("error",()=>f(ox)),g.src=zE(n,t,e,i,r.maxY)})}function of(n){return function(t,e,i,r){const a=UE(n,t,e,i);return Xd(a,t,e,i,r)}}function ax(n){return function(t,e,i,r){const a=n(t,e,i,r);return Xd(a,t,e,i,r)}}function af(n){let t;if(Array.isArray(n))t=of(n);else if(typeof n=="string"){const e=jE(n);t=of(e)}else if(typeof n=="function")t=ax(n);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return t}let lf=0;function hf(n){return Array.isArray(n)?n.join(`
`):typeof n=="string"?n:(++lf,"url-function-key-"+lf)}class lx extends sx{constructor(t){t=t||{};let e=t.loader,i;t.url&&(e=af(t.url),i=hf(t.url));const r=e?t.state:"loading",a=t.wrapX===void 0?!0:t.wrapX;super({loader:e,key:i,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize,gutter:t.gutter,maxResolution:t.maxResolution,projection:t.projection,tileGrid:t.tileGrid,state:r,wrapX:a,transition:t.transition,interpolate:t.interpolate!==!1,crossOrigin:t.crossOrigin,zDirection:t.zDirection})}setUrl(t){const e=af(t);this.setLoader(e),this.setKey(hf(t)),this.getState()!=="ready"&&this.setState("ready")}}function hx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yo={exports:{}},cx=Yo.exports,cf;function ux(){return cf||(cf=1,function(n,t){(function(e,i){n.exports=i()})(cx,function(){var e=function(){function _(c){this.propagationStopped,this.defaultPrevented,this.type=c,this.target=null}return _.prototype.preventDefault=function(){this.defaultPrevented=!0},_.prototype.stopPropagation=function(){this.propagationStopped=!0},_}(),i=e,r={PROPERTYCHANGE:"propertychange"},a=function(){function _(){this.disposed=!1}return _.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},_.prototype.disposeInternal=function(){},_}(),f=a;function g(_,c){return _>c?1:_<c?-1:0}function p(_,c,o){for(;c<o;){var u=_[c];_[c]=_[o],_[o]=u,++c,--o}}function y(_,c){for(var o=Array.isArray(c)?c:[c],u=o.length,d=0;d<u;d++)_[_.length]=o[d]}function v(_,c){var o=_.length;if(o!==c.length)return!1;for(var u=0;u<o;u++)if(_[u]!==c[u])return!1;return!0}function x(){return!0}function R(){}function S(_){var c=!1,o,u,d;return function(){var m=Array.prototype.slice.call(arguments);return(!c||this!==d||!v(m,u))&&(c=!0,d=this,u=m,o=_.apply(this,arguments)),o}}var I=typeof Object.assign=="function"?Object.assign:function(_,c){if(_==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(_),u=1,d=arguments.length;u<d;++u){var m=arguments[u];if(m!=null)for(var E in m)m.hasOwnProperty(E)&&(o[E]=m[E])}return o};function L(_){for(var c in _)delete _[c]}var O=typeof Object.values=="function"?Object.values:function(_){var c=[];for(var o in _)c.push(_[o]);return c};function M(_){var c;for(c in _)return!1;return!c}var P=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),X=function(_){P(c,_);function c(o){var u=_.call(this)||this;return u.eventTarget_=o,u.pendingRemovals_=null,u.dispatching_=null,u.listeners_=null,u}return c.prototype.addEventListener=function(o,u){if(!(!o||!u)){var d=this.listeners_||(this.listeners_={}),m=d[o]||(d[o]=[]);m.indexOf(u)===-1&&m.push(u)}},c.prototype.dispatchEvent=function(o){var u=typeof o=="string",d=u?o:o.type,m=this.listeners_&&this.listeners_[d];if(m){var E=u?new i(o):o;E.target||(E.target=this.eventTarget_||this);var C=this.dispatching_||(this.dispatching_={}),w=this.pendingRemovals_||(this.pendingRemovals_={});d in C||(C[d]=0,w[d]=0),++C[d];for(var T,A=0,D=m.length;A<D;++A)if("handleEvent"in m[A]?T=m[A].handleEvent(E):T=m[A].call(this,E),T===!1||E.propagationStopped){T=!1;break}if(--C[d]===0){var F=w[d];for(delete w[d];F--;)this.removeEventListener(d,R);delete C[d]}return T}},c.prototype.disposeInternal=function(){this.listeners_&&L(this.listeners_)},c.prototype.getListeners=function(o){return this.listeners_&&this.listeners_[o]||void 0},c.prototype.hasListener=function(o){return this.listeners_?o?o in this.listeners_:Object.keys(this.listeners_).length>0:!1},c.prototype.removeEventListener=function(o,u){var d=this.listeners_&&this.listeners_[o];if(d){var m=d.indexOf(u);m!==-1&&(this.pendingRemovals_&&o in this.pendingRemovals_?(d[m]=R,++this.pendingRemovals_[o]):(d.splice(m,1),d.length===0&&delete this.listeners_[o]))}},c}(f),b=X,G={CHANGE:"change",ERROR:"error",LOAD:"load"};function W(_,c,o,u,d){if(u&&u!==_&&(o=o.bind(u)),d){var m=o;o=function(){_.removeEventListener(c,o),m.apply(this,arguments)}}var E={target:_,type:c,listener:o};return _.addEventListener(c,o),E}function j(_,c,o,u){return W(_,c,o,u,!0)}function Y(_){_&&_.target&&(_.target.removeEventListener(_.type,_.listener),L(_))}var V=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),U=function(_){V(c,_);function c(){var o=_.call(this)||this;return o.on=o.onInternal,o.once=o.onceInternal,o.un=o.unInternal,o.revision_=0,o}return c.prototype.changed=function(){++this.revision_,this.dispatchEvent(G.CHANGE)},c.prototype.getRevision=function(){return this.revision_},c.prototype.onInternal=function(o,u){if(Array.isArray(o)){for(var d=o.length,m=new Array(d),E=0;E<d;++E)m[E]=W(this,o[E],u);return m}else return W(this,o,u)},c.prototype.onceInternal=function(o,u){var d;if(Array.isArray(o)){var m=o.length;d=new Array(m);for(var E=0;E<m;++E)d[E]=j(this,o[E],u)}else d=j(this,o,u);return u.ol_key=d,d},c.prototype.unInternal=function(o,u){var d=u.ol_key;if(d)it(d);else if(Array.isArray(o))for(var m=0,E=o.length;m<E;++m)this.removeEventListener(o[m],u);else this.removeEventListener(o,u)},c}(b);U.prototype.on,U.prototype.once,U.prototype.un;function it(_){if(Array.isArray(_))for(var c=0,o=_.length;c<o;++c)Y(_[c]);else Y(_)}var q=U;function K(){return function(){throw new Error("Unimplemented abstract method.")}()}var $=0;function et(_){return _.ol_uid||(_.ol_uid=String(++$))}var nt="6.14.1",rt=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),ft=function(_){rt(c,_);function c(o,u,d){var m=_.call(this,o)||this;return m.key=u,m.oldValue=d,m}return c}(i),ut=function(_){rt(c,_);function c(o){var u=_.call(this)||this;return u.on,u.once,u.un,et(u),u.values_=null,o!==void 0&&u.setProperties(o),u}return c.prototype.get=function(o){var u;return this.values_&&this.values_.hasOwnProperty(o)&&(u=this.values_[o]),u},c.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},c.prototype.getProperties=function(){return this.values_&&I({},this.values_)||{}},c.prototype.hasProperties=function(){return!!this.values_},c.prototype.notify=function(o,u){var d;d="change:".concat(o),this.hasListener(d)&&this.dispatchEvent(new ft(d,o,u)),d=r.PROPERTYCHANGE,this.hasListener(d)&&this.dispatchEvent(new ft(d,o,u))},c.prototype.addChangeListener=function(o,u){this.addEventListener("change:".concat(o),u)},c.prototype.removeChangeListener=function(o,u){this.removeEventListener("change:".concat(o),u)},c.prototype.set=function(o,u,d){var m=this.values_||(this.values_={});if(d)m[o]=u;else{var E=m[o];m[o]=u,E!==u&&this.notify(o,E)}},c.prototype.setProperties=function(o,u){for(var d in o)this.set(d,o[d],u)},c.prototype.applyProperties=function(o){o.values_&&I(this.values_||(this.values_={}),o.values_)},c.prototype.unset=function(o,u){if(this.values_&&o in this.values_){var d=this.values_[o];delete this.values_[o],M(this.values_)&&(this.values_=null),u||this.notify(o,d)}},c}(q),ot=ut,dt={ACTIVE:"active"},Z=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Tt=function(_){Z(c,_);function c(o){var u=_.call(this)||this;return u.on,u.once,u.un,o&&o.handleEvent&&(u.handleEvent=o.handleEvent),u.map_=null,u.setActive(!0),u}return c.prototype.getActive=function(){return this.get(dt.ACTIVE)},c.prototype.getMap=function(){return this.map_},c.prototype.handleEvent=function(o){return!0},c.prototype.setActive=function(o){this.set(dt.ACTIVE,o)},c.prototype.setMap=function(o){this.map_=o},c}(ot),Xt=Tt,ht={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"},Vt=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),se=function(_){Vt(c,_);function c(o){var u=this,d="v"+nt.split("-")[0],m="Assertion failed. See https://openlayers.org/en/"+d+"/doc/errors/#"+o+" for details.";return u=_.call(this,m)||this,u.code=o,u.name="AssertionError",u.message=m,u}return c}(Error),ue=se;function qt(_,c){if(!_)throw new ue(c)}function Bt(_,c,o){return Math.min(Math.max(_,c),o)}var ji=function(){var _;return"cosh"in Math?_=Math.cosh:_=function(c){var o=Math.exp(c);return(o+1/o)/2},_}();function Ei(_,c,o,u){var d=o-_,m=u-c;return d*d+m*m}function hi(_){return _*Math.PI/180}function _e(_,c,o){return _+o*(c-_)}var xi=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),we=function(_){xi(c,_);function c(o){var u=_.call(this)||this;u.on,u.once,u.un,u.background_=o.background;var d=I({},o);return typeof o.properties=="object"&&(delete d.properties,I(d,o.properties)),d[ht.OPACITY]=o.opacity!==void 0?o.opacity:1,qt(typeof d[ht.OPACITY]=="number",64),d[ht.VISIBLE]=o.visible!==void 0?o.visible:!0,d[ht.Z_INDEX]=o.zIndex,d[ht.MAX_RESOLUTION]=o.maxResolution!==void 0?o.maxResolution:1/0,d[ht.MIN_RESOLUTION]=o.minResolution!==void 0?o.minResolution:0,d[ht.MIN_ZOOM]=o.minZoom!==void 0?o.minZoom:-1/0,d[ht.MAX_ZOOM]=o.maxZoom!==void 0?o.maxZoom:1/0,u.className_=d.className!==void 0?d.className:"ol-layer",delete d.className,u.setProperties(d),u.state_=null,u}return c.prototype.getBackground=function(){return this.background_},c.prototype.getClassName=function(){return this.className_},c.prototype.getLayerState=function(o){var u=this.state_||{layer:this,managed:o===void 0?!0:o},d=this.getZIndex();return u.opacity=Bt(Math.round(this.getOpacity()*100)/100,0,1),u.visible=this.getVisible(),u.extent=this.getExtent(),u.zIndex=d===void 0&&!u.managed?1/0:d,u.maxResolution=this.getMaxResolution(),u.minResolution=Math.max(this.getMinResolution(),0),u.minZoom=this.getMinZoom(),u.maxZoom=this.getMaxZoom(),this.state_=u,u},c.prototype.getLayersArray=function(o){return K()},c.prototype.getLayerStatesArray=function(o){return K()},c.prototype.getExtent=function(){return this.get(ht.EXTENT)},c.prototype.getMaxResolution=function(){return this.get(ht.MAX_RESOLUTION)},c.prototype.getMinResolution=function(){return this.get(ht.MIN_RESOLUTION)},c.prototype.getMinZoom=function(){return this.get(ht.MIN_ZOOM)},c.prototype.getMaxZoom=function(){return this.get(ht.MAX_ZOOM)},c.prototype.getOpacity=function(){return this.get(ht.OPACITY)},c.prototype.getSourceState=function(){return K()},c.prototype.getVisible=function(){return this.get(ht.VISIBLE)},c.prototype.getZIndex=function(){return this.get(ht.Z_INDEX)},c.prototype.setBackground=function(o){this.background_=o,this.changed()},c.prototype.setExtent=function(o){this.set(ht.EXTENT,o)},c.prototype.setMaxResolution=function(o){this.set(ht.MAX_RESOLUTION,o)},c.prototype.setMinResolution=function(o){this.set(ht.MIN_RESOLUTION,o)},c.prototype.setMaxZoom=function(o){this.set(ht.MAX_ZOOM,o)},c.prototype.setMinZoom=function(o){this.set(ht.MIN_ZOOM,o)},c.prototype.setOpacity=function(o){qt(typeof o=="number",64),this.set(ht.OPACITY,o)},c.prototype.setVisible=function(o){this.set(ht.VISIBLE,o)},c.prototype.setZIndex=function(o){this.set(ht.Z_INDEX,o)},c.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),_.prototype.disposeInternal.call(this)},c}(ot),Ye=we,ci={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose"},We={UNDEFINED:"undefined",READY:"ready"},Vi=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Tn=function(_){Vi(c,_);function c(o){var u=this,d=I({},o);delete d.source,u=_.call(this,d)||this,u.on,u.once,u.un,u.mapPrecomposeKey_=null,u.mapRenderKey_=null,u.sourceChangeKey_=null,u.renderer_=null,u.rendered=!1,o.render&&(u.render=o.render),o.map&&u.setMap(o.map),u.addChangeListener(ht.SOURCE,u.handleSourcePropertyChange_);var m=o.source?o.source:null;return u.setSource(m),u}return c.prototype.getLayersArray=function(o){var u=o||[];return u.push(this),u},c.prototype.getLayerStatesArray=function(o){var u=o||[];return u.push(this.getLayerState()),u},c.prototype.getSource=function(){return this.get(ht.SOURCE)||null},c.prototype.getRenderSource=function(){return this.getSource()},c.prototype.getSourceState=function(){var o=this.getSource();return o?o.getState():We.UNDEFINED},c.prototype.handleSourceChange_=function(){this.changed()},c.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(Y(this.sourceChangeKey_),this.sourceChangeKey_=null);var o=this.getSource();o&&(this.sourceChangeKey_=W(o,G.CHANGE,this.handleSourceChange_,this)),this.changed()},c.prototype.getFeatures=function(o){return this.renderer_?this.renderer_.getFeatures(o):new Promise(function(u){return u([])})},c.prototype.getData=function(o){return!this.renderer_||!this.rendered?null:this.renderer_.getData(o)},c.prototype.render=function(o,u){var d=this.getRenderer();if(d.prepareFrame(o))return this.rendered=!0,d.renderFrame(o,u)},c.prototype.unrender=function(){this.rendered=!1},c.prototype.setMapInternal=function(o){o||this.unrender(),this.set(ht.MAP,o)},c.prototype.getMapInternal=function(){return this.get(ht.MAP)},c.prototype.setMap=function(o){this.mapPrecomposeKey_&&(Y(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),o||this.changed(),this.mapRenderKey_&&(Y(this.mapRenderKey_),this.mapRenderKey_=null),o&&(this.mapPrecomposeKey_=W(o,ci.PRECOMPOSE,function(u){var d=u,m=d.frameState.layerStatesArray,E=this.getLayerState(!1);qt(!m.some(function(C){return C.layer===E.layer}),67),m.push(E)},this),this.mapRenderKey_=W(this,G.CHANGE,o.render,o),this.changed())},c.prototype.setSource=function(o){this.set(ht.SOURCE,o)},c.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},c.prototype.hasRenderer=function(){return!!this.renderer_},c.prototype.createRenderer=function(){return null},c.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),_.prototype.disposeInternal.call(this)},c}(Ye),ti=Tn;function Ci(_,c,o,u,d){ae(_,c,o||0,u||_.length-1,d||Qn)}function ae(_,c,o,u,d){for(;u>o;){if(u-o>600){var m=u-o+1,E=c-o+1,C=Math.log(m),w=.5*Math.exp(2*C/3),T=.5*Math.sqrt(C*w*(m-w)/m)*(E-m/2<0?-1:1),A=Math.max(o,Math.floor(c-E*w/m+T)),D=Math.min(u,Math.floor(c+(m-E)*w/m+T));ae(_,c,A,D,d)}var F=_[c],k=o,N=u;for(Ri(_,o,c),d(_[u],F)>0&&Ri(_,o,u);k<N;){for(Ri(_,k,N),k++,N--;d(_[k],F)<0;)k++;for(;d(_[N],F)>0;)N--}d(_[o],F)===0?Ri(_,o,N):(N++,Ri(_,N,u)),N<=c&&(o=N+1),c<=N&&(u=N-1)}}function Ri(_,c,o){var u=_[c];_[c]=_[o],_[o]=u}function Qn(_,c){return _<c?-1:_>c?1:0}class Sn{constructor(c=9){this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(c){let o=this.data;const u=[];if(!Zi(c,o))return u;const d=this.toBBox,m=[];for(;o;){for(let E=0;E<o.children.length;E++){const C=o.children[E],w=o.leaf?d(C):C;Zi(c,w)&&(o.leaf?u.push(C):Vr(c,w)?this._all(C,u):m.push(C))}o=m.pop()}return u}collides(c){let o=this.data;if(!Zi(c,o))return!1;const u=[];for(;o;){for(let d=0;d<o.children.length;d++){const m=o.children[d],E=o.leaf?this.toBBox(m):m;if(Zi(c,E)){if(o.leaf||Vr(c,E))return!0;u.push(m)}}o=u.pop()}return!1}load(c){if(!(c&&c.length))return this;if(c.length<this._minEntries){for(let u=0;u<c.length;u++)this.insert(c[u]);return this}let o=this._build(c.slice(),0,c.length-1,0);if(!this.data.children.length)this.data=o;else if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){const u=this.data;this.data=o,o=u}this._insert(o,this.data.height-o.height-1,!0)}return this}insert(c){return c&&this._insert(c,this.data.height-1),this}clear(){return this.data=Be([]),this}remove(c,o){if(!c)return this;let u=this.data;const d=this.toBBox(c),m=[],E=[];let C,w,T;for(;u||m.length;){if(u||(u=m.pop(),w=m[m.length-1],C=E.pop(),T=!0),u.leaf){const A=Pa(c,u.children,o);if(A!==-1)return u.children.splice(A,1),m.push(u),this._condense(m),this}!T&&!u.leaf&&Vr(u,d)?(m.push(u),E.push(C),C=0,w=u,u=u.children[0]):w?(C++,u=w.children[C],T=!1):u=null}return this}toBBox(c){return c}compareMinX(c,o){return c.minX-o.minX}compareMinY(c,o){return c.minY-o.minY}toJSON(){return this.data}fromJSON(c){return this.data=c,this}_all(c,o){const u=[];for(;c;)c.leaf?o.push(...c.children):u.push(...c.children),c=u.pop();return o}_build(c,o,u,d){const m=u-o+1;let E=this._maxEntries,C;if(m<=E)return C=Be(c.slice(o,u+1)),wi(C,this.toBBox),C;d||(d=Math.ceil(Math.log(m)/Math.log(E)),E=Math.ceil(m/Math.pow(E,d-1))),C=Be([]),C.leaf=!1,C.height=d;const w=Math.ceil(m/E),T=w*Math.ceil(Math.sqrt(E));Hi(c,o,u,T,this.compareMinX);for(let A=o;A<=u;A+=T){const D=Math.min(A+T-1,u);Hi(c,A,D,w,this.compareMinY);for(let F=A;F<=D;F+=w){const k=Math.min(F+w-1,D);C.children.push(this._build(c,F,k,d-1))}}return wi(C,this.toBBox),C}_chooseSubtree(c,o,u,d){for(;d.push(o),!(o.leaf||d.length-1===u);){let m=1/0,E=1/0,C;for(let w=0;w<o.children.length;w++){const T=o.children[w],A=tr(T),D=jr(c,T)-A;D<E?(E=D,m=A<m?A:m,C=T):D===E&&A<m&&(m=A,C=T)}o=C||o.children[0]}return o}_insert(c,o,u){const d=u?c:this.toBBox(c),m=[],E=this._chooseSubtree(d,this.data,o,m);for(E.children.push(c),Ii(E,d);o>=0&&m[o].children.length>this._maxEntries;)this._split(m,o),o--;this._adjustParentBBoxes(d,m,o)}_split(c,o){const u=c[o],d=u.children.length,m=this._minEntries;this._chooseSplitAxis(u,m,d);const E=this._chooseSplitIndex(u,m,d),C=Be(u.children.splice(E,u.children.length-E));C.height=u.height,C.leaf=u.leaf,wi(u,this.toBBox),wi(C,this.toBBox),o?c[o-1].children.push(C):this._splitRoot(u,C)}_splitRoot(c,o){this.data=Be([c,o]),this.data.height=c.height+1,this.data.leaf=!1,wi(this.data,this.toBBox)}_chooseSplitIndex(c,o,u){let d,m=1/0,E=1/0;for(let C=o;C<=u-o;C++){const w=Ki(c,0,C,this.toBBox),T=Ki(c,C,u,this.toBBox),A=ro(w,T),D=tr(w)+tr(T);A<m?(m=A,d=C,E=D<E?D:E):A===m&&D<E&&(E=D,d=C)}return d||u-o}_chooseSplitAxis(c,o,u){const d=c.leaf?this.compareMinX:Da,m=c.leaf?this.compareMinY:Fa,E=this._allDistMargin(c,o,u,d),C=this._allDistMargin(c,o,u,m);E<C&&c.children.sort(d)}_allDistMargin(c,o,u,d){c.children.sort(d);const m=this.toBBox,E=Ki(c,0,o,m),C=Ki(c,u-o,u,m);let w=An(E)+An(C);for(let T=o;T<u-o;T++){const A=c.children[T];Ii(E,c.leaf?m(A):A),w+=An(E)}for(let T=u-o-1;T>=o;T--){const A=c.children[T];Ii(C,c.leaf?m(A):A),w+=An(C)}return w}_adjustParentBBoxes(c,o,u){for(let d=u;d>=0;d--)Ii(o[d],c)}_condense(c){for(let o=c.length-1,u;o>=0;o--)c[o].children.length===0?o>0?(u=c[o-1].children,u.splice(u.indexOf(c[o]),1)):this.clear():wi(c[o],this.toBBox)}}function Pa(_,c,o){if(!o)return c.indexOf(_);for(let u=0;u<c.length;u++)if(o(_,c[u]))return u;return-1}function wi(_,c){Ki(_,0,_.children.length,c,_)}function Ki(_,c,o,u,d){d||(d=Be(null)),d.minX=1/0,d.minY=1/0,d.maxX=-1/0,d.maxY=-1/0;for(let m=c;m<o;m++){const E=_.children[m];Ii(d,_.leaf?u(E):E)}return d}function Ii(_,c){return _.minX=Math.min(_.minX,c.minX),_.minY=Math.min(_.minY,c.minY),_.maxX=Math.max(_.maxX,c.maxX),_.maxY=Math.max(_.maxY,c.maxY),_}function Da(_,c){return _.minX-c.minX}function Fa(_,c){return _.minY-c.minY}function tr(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function An(_){return _.maxX-_.minX+(_.maxY-_.minY)}function jr(_,c){return(Math.max(c.maxX,_.maxX)-Math.min(c.minX,_.minX))*(Math.max(c.maxY,_.maxY)-Math.min(c.minY,_.minY))}function ro(_,c){const o=Math.max(_.minX,c.minX),u=Math.max(_.minY,c.minY),d=Math.min(_.maxX,c.maxX),m=Math.min(_.maxY,c.maxY);return Math.max(0,d-o)*Math.max(0,m-u)}function Vr(_,c){return _.minX<=c.minX&&_.minY<=c.minY&&c.maxX<=_.maxX&&c.maxY<=_.maxY}function Zi(_,c){return c.minX<=_.maxX&&c.minY<=_.maxY&&c.maxX>=_.minX&&c.maxY>=_.minY}function Be(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Hi(_,c,o,u,d){const m=[c,o];for(;m.length;){if(o=m.pop(),c=m.pop(),o-c<=u)continue;const E=c+Math.ceil((o-c)/u/2)*u;Ci(_,E,c,o,d),m.push(c,E,E,o)}}var Ft={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function Kr(_,c){return Array.isArray(_)?_:(c===void 0?c=[_,_]:(c[0]=_,c[1]=_),c)}var so=function(){function _(c){this.opacity_=c.opacity,this.rotateWithView_=c.rotateWithView,this.rotation_=c.rotation,this.scale_=c.scale,this.scaleArray_=Kr(c.scale),this.displacement_=c.displacement}return _.prototype.clone=function(){var c=this.getScale();return new _({opacity:this.getOpacity(),scale:Array.isArray(c)?c.slice():c,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},_.prototype.getOpacity=function(){return this.opacity_},_.prototype.getRotateWithView=function(){return this.rotateWithView_},_.prototype.getRotation=function(){return this.rotation_},_.prototype.getScale=function(){return this.scale_},_.prototype.getScaleArray=function(){return this.scaleArray_},_.prototype.getDisplacement=function(){return this.displacement_},_.prototype.getAnchor=function(){return K()},_.prototype.getImage=function(c){return K()},_.prototype.getHitDetectionImage=function(){return K()},_.prototype.getPixelRatio=function(c){return 1},_.prototype.getImageState=function(){return K()},_.prototype.getImageSize=function(){return K()},_.prototype.getOrigin=function(){return K()},_.prototype.getSize=function(){return K()},_.prototype.setDisplacement=function(c){this.displacement_=c},_.prototype.setOpacity=function(c){this.opacity_=c},_.prototype.setRotateWithView=function(c){this.rotateWithView_=c},_.prototype.setRotation=function(c){this.rotation_=c},_.prototype.setScale=function(c){this.scale_=c,this.scaleArray_=Kr(c)},_.prototype.listenImageChange=function(c){K()},_.prototype.load=function(){K()},_.prototype.unlistenImageChange=function(c){K()},_}(),xe=so,Ti=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Ie=/^([a-z]*)$|^hsla?\(.*\)$/i;function be(_){return typeof _=="string"?_:ze(_)}function Te(_){var c=document.createElement("div");if(c.style.color=_,c.style.color!==""){document.body.appendChild(c);var o=getComputedStyle(c).color;return document.body.removeChild(c),o}else return""}var ei=function(){var _=1024,c={},o=0;return function(u){var d;if(c.hasOwnProperty(u))d=c[u];else{if(o>=_){var m=0;for(var E in c)(m++&3)===0&&(delete c[E],--o)}d=Zt(u),c[u]=d,++o}return d}}();function Se(_){return Array.isArray(_)?_:ei(_)}function Zt(_){var c,o,u,d,m;if(Ie.exec(_)&&(_=Te(_)),Ti.exec(_)){var E=_.length-1,C=void 0;E<=4?C=1:C=2;var w=E===4||E===8;c=parseInt(_.substr(1+0*C,C),16),o=parseInt(_.substr(1+1*C,C),16),u=parseInt(_.substr(1+2*C,C),16),w?d=parseInt(_.substr(1+3*C,C),16):d=255,C==1&&(c=(c<<4)+c,o=(o<<4)+o,u=(u<<4)+u,w&&(d=(d<<4)+d)),m=[c,o,u,d/255]}else _.indexOf("rgba(")==0?(m=_.slice(5,-1).split(",").map(Number),fe(m)):_.indexOf("rgb(")==0?(m=_.slice(4,-1).split(",").map(Number),m.push(1),fe(m)):qt(!1,14);return m}function fe(_){return _[0]=Bt(_[0]+.5|0,0,255),_[1]=Bt(_[1]+.5|0,0,255),_[2]=Bt(_[2]+.5|0,0,255),_[3]=Bt(_[3],0,1),_}function ze(_){var c=_[0];c!=(c|0)&&(c=c+.5|0);var o=_[1];o!=(o|0)&&(o=o+.5|0);var u=_[2];u!=(u|0)&&(u=u+.5|0);var d=_[3]===void 0?1:Math.round(_[3]*100)/100;return"rgba("+c+","+o+","+u+","+d+")"}function Ue(_){return Array.isArray(_)?ze(_):_}var $i=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";$i.indexOf("firefox");var qd=$i.indexOf("safari")!==-1&&$i.indexOf("chrom")==-1;qd&&($i.indexOf("version/15.4")>=0||$i.match(/cpu (os|iphone os) 15_4 like mac os x/)),$i.indexOf("webkit")!==-1&&$i.indexOf("edge")==-1,$i.indexOf("macintosh");var oo=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Jd=typeof Image<"u"&&Image.prototype.decode;(function(){var _=!1;try{var c=Object.defineProperty({},"passive",{get:function(){_=!0}});window.addEventListener("_",null,c),window.removeEventListener("_",null,c)}catch{}return _})();function Si(_,c,o,u){var d;return oo?d=new OffscreenCanvas(_||300,c||300):d=document.createElement("canvas"),_&&(d.width=_),c&&(d.height=c),d.getContext("2d",u)}var Qd=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Jh=["style","variant","weight","size","lineHeight","family"],Qh=function(_){var c=_.match(Qd);if(!c)return null;for(var o={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},u=0,d=Jh.length;u<d;++u){var m=c[u+1];m!==void 0&&(o[Jh[u]]=m)}return o.families=o.family.split(/,\s?/),o};function tg(_){return _===1?"":String(Math.round(_*100)/100)}var tc="10px sans-serif",Ai="#000",ao="round",Zr=[],Hr=0,er="round",$r=10,qr="#000",Jr="center",lo="middle",Ln=[0,0,0,0],Qr=1,qi=new ot,eg=new b;eg.setSize=function(){console.warn("labelCache is deprecated.")};var ir=null,ba,Ga={},ig=function(){var _=100,c="32px ",o=["monospace","serif"],u=o.length,d="wmytzilWMYTZIL@#/&?$%10",m,E;function C(T,A,D){for(var F=!0,k=0;k<u;++k){var N=o[k];if(E=ho(T+" "+A+" "+c+N,d),D!=N){var z=ho(T+" "+A+" "+c+D+","+N,d);F=F&&z!=E}}return!!F}function w(){for(var T=!0,A=qi.getKeys(),D=0,F=A.length;D<F;++D){var k=A[D];qi.get(k)<_&&(C.apply(this,k.split(`
`))?(L(Ga),ir=null,ba=void 0,qi.set(k,_)):(qi.set(k,qi.get(k)+1,!0),T=!1))}T&&(clearInterval(m),m=void 0)}return function(T){var A=Qh(T);if(A)for(var D=A.families,F=0,k=D.length;F<k;++F){var N=D[F],z=A.style+`
`+A.weight+`
`+N;qi.get(z)===void 0&&(qi.set(z,_,!0),C(A.style,A.weight,N)||(qi.set(z,0,!0),m===void 0&&(m=setInterval(w,32))))}}}(),ng=function(){var _;return function(c){var o=Ga[c];if(o==null){if(oo){var u=Qh(c),d=ec(c,"g"),m=isNaN(Number(u.lineHeight))?1.2:Number(u.lineHeight);o=m*(d.actualBoundingBoxAscent+d.actualBoundingBoxDescent)}else _||(_=document.createElement("div"),_.innerHTML="M",_.style.minHeight="0",_.style.maxHeight="none",_.style.height="auto",_.style.padding="0",_.style.border="none",_.style.position="absolute",_.style.display="block",_.style.left="-99999px"),_.style.font=c,document.body.appendChild(_),o=_.offsetHeight,document.body.removeChild(_);Ga[c]=o}return o}}();function ec(_,c){return ir||(ir=Si(1,1)),_!=ba&&(ir.font=_,ba=ir.font),ir.measureText(c)}function ho(_,c){return ec(_,c).width}function ic(_,c,o){if(c in o)return o[c];var u=ho(_,c);return o[c]=u,u}function rg(_,c){for(var o=[],u=[],d=[],m=0,E=0,C=0,w=0,T=0,A=c.length;T<=A;T+=2){var D=c[T];if(D===`
`||T===A){m=Math.max(m,E),d.push(E),E=0,C+=w;continue}var F=c[T+1]||_.font,k=ho(F,D);o.push(k),E+=k;var N=ng(F);u.push(N),w=Math.max(w,N)}return{width:m,height:C,widths:o,heights:u,lineWidths:d}}function sg(_,c,o,u,d,m,E,C,w,T,A){_.save(),o!==1&&(_.globalAlpha*=o),c&&_.setTransform.apply(_,c),u.contextInstructions?(_.translate(w,T),_.scale(A[0],A[1]),og(u,_)):A[0]<0||A[1]<0?(_.translate(w,T),_.scale(A[0],A[1]),_.drawImage(u,d,m,E,C,0,0,E,C)):_.drawImage(u,d,m,E,C,w,T,E*A[0],C*A[1]),_.restore()}function og(_,c){for(var o=_.contextInstructions,u=0,d=o.length;u<d;u+=2)Array.isArray(o[u+1])?c[o[u]].apply(c,o[u+1]):c[o[u]]=o[u+1]}var ag=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),lg=function(_){ag(c,_);function c(o){var u=this,d=o.rotateWithView!==void 0?o.rotateWithView:!1;return u=_.call(this,{opacity:1,rotateWithView:d,rotation:o.rotation!==void 0?o.rotation:0,scale:o.scale!==void 0?o.scale:1,displacement:o.displacement!==void 0?o.displacement:[0,0]})||this,u.canvas_=void 0,u.hitDetectionCanvas_=null,u.fill_=o.fill!==void 0?o.fill:null,u.origin_=[0,0],u.points_=o.points,u.radius_=o.radius!==void 0?o.radius:o.radius1,u.radius2_=o.radius2,u.angle_=o.angle!==void 0?o.angle:0,u.stroke_=o.stroke!==void 0?o.stroke:null,u.size_=null,u.renderOptions_=null,u.render(),u}return c.prototype.clone=function(){var o=this.getScale(),u=new c({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(o)?o.slice():o,displacement:this.getDisplacement().slice()});return u.setOpacity(this.getOpacity()),u},c.prototype.getAnchor=function(){var o=this.size_;if(!o)return null;var u=this.getDisplacement();return[o[0]/2-u[0],o[1]/2+u[1]]},c.prototype.getAngle=function(){return this.angle_},c.prototype.getFill=function(){return this.fill_},c.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},c.prototype.getImage=function(o){var u=this.canvas_[o];if(!u){var d=this.renderOptions_,m=Si(d.size*o,d.size*o);this.draw_(d,m,o),u=m.canvas,this.canvas_[o]=u}return u},c.prototype.getPixelRatio=function(o){return o},c.prototype.getImageSize=function(){return this.size_},c.prototype.getImageState=function(){return Ft.LOADED},c.prototype.getOrigin=function(){return this.origin_},c.prototype.getPoints=function(){return this.points_},c.prototype.getRadius=function(){return this.radius_},c.prototype.getRadius2=function(){return this.radius2_},c.prototype.getSize=function(){return this.size_},c.prototype.getStroke=function(){return this.stroke_},c.prototype.listenImageChange=function(o){},c.prototype.load=function(){},c.prototype.unlistenImageChange=function(o){},c.prototype.calculateLineJoinSize_=function(o,u,d){if(u===0||this.points_===1/0||o!=="bevel"&&o!=="miter")return u;var m=this.radius_,E=this.radius2_===void 0?m:this.radius2_;if(m<E){var C=m;m=E,E=C}var w=this.radius2_===void 0?this.points_:this.points_*2,T=2*Math.PI/w,A=E*Math.sin(T),D=Math.sqrt(E*E-A*A),F=m-D,k=Math.sqrt(A*A+F*F),N=k/A;if(o==="miter"&&N<=d)return N*u;var z=u/2/N,H=u/2*(F/k),tt=Math.sqrt((m+z)*(m+z)+H*H),J=tt-m;if(this.radius2_===void 0||o==="bevel")return J*2;var st=m*Math.sin(T),vt=Math.sqrt(m*m-st*st),pt=E-vt,ct=Math.sqrt(st*st+pt*pt),Et=ct/st;if(Et<=d){var gt=Et*u/2-E-m;return 2*Math.max(J,gt)}return J*2},c.prototype.createRenderOptions=function(){var o=er,u=0,d=null,m=0,E,C=0;this.stroke_&&(E=this.stroke_.getColor(),E===null&&(E=qr),E=Ue(E),C=this.stroke_.getWidth(),C===void 0&&(C=Qr),d=this.stroke_.getLineDash(),m=this.stroke_.getLineDashOffset(),o=this.stroke_.getLineJoin(),o===void 0&&(o=er),u=this.stroke_.getMiterLimit(),u===void 0&&(u=$r));var w=this.calculateLineJoinSize_(o,C,u),T=Math.max(this.radius_,this.radius2_||0),A=Math.ceil(2*T+w);return{strokeStyle:E,strokeWidth:C,size:A,lineDash:d,lineDashOffset:m,lineJoin:o,miterLimit:u}},c.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var o=this.renderOptions_.size;this.canvas_={},this.size_=[o,o]},c.prototype.draw_=function(o,u,d){if(u.scale(d,d),u.translate(o.size/2,o.size/2),this.createPath_(u),this.fill_){var m=this.fill_.getColor();m===null&&(m=Ai),u.fillStyle=Ue(m),u.fill()}this.stroke_&&(u.strokeStyle=o.strokeStyle,u.lineWidth=o.strokeWidth,u.setLineDash&&o.lineDash&&(u.setLineDash(o.lineDash),u.lineDashOffset=o.lineDashOffset),u.lineJoin=o.lineJoin,u.miterLimit=o.miterLimit,u.stroke())},c.prototype.createHitDetectionCanvas_=function(o){if(this.fill_){var u=this.fill_.getColor(),d=0;if(typeof u=="string"&&(u=Se(u)),u===null?d=1:Array.isArray(u)&&(d=u.length===4?u[3]:1),d===0){var m=Si(o.size,o.size);this.hitDetectionCanvas_=m.canvas,this.drawHitDetectionCanvas_(o,m)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},c.prototype.createPath_=function(o){var u=this.points_,d=this.radius_;if(u===1/0)o.arc(0,0,d,0,2*Math.PI);else{var m=this.radius2_===void 0?d:this.radius2_;this.radius2_!==void 0&&(u*=2);for(var E=this.angle_-Math.PI/2,C=2*Math.PI/u,w=0;w<u;w++){var T=E+w*C,A=w%2===0?d:m;o.lineTo(A*Math.cos(T),A*Math.sin(T))}o.closePath()}},c.prototype.drawHitDetectionCanvas_=function(o,u){u.translate(o.size/2,o.size/2),this.createPath_(u),u.fillStyle=Ai,u.fill(),this.stroke_&&(u.strokeStyle=o.strokeStyle,u.lineWidth=o.strokeWidth,o.lineDash&&(u.setLineDash(o.lineDash),u.lineDashOffset=o.lineDashOffset),u.lineJoin=o.lineJoin,u.miterLimit=o.miterLimit,u.stroke())},c}(xe),hg=lg,cg=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),ug=function(_){cg(c,_);function c(o){var u=o||{};return _.call(this,{points:1/0,fill:u.fill,radius:u.radius,stroke:u.stroke,scale:u.scale!==void 0?u.scale:1,rotation:u.rotation!==void 0?u.rotation:0,rotateWithView:u.rotateWithView!==void 0?u.rotateWithView:!1,displacement:u.displacement!==void 0?u.displacement:[0,0]})||this}return c.prototype.clone=function(){var o=this.getScale(),u=new c({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(o)?o.slice():o,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return u.setOpacity(this.getOpacity()),u},c.prototype.setRadius=function(o){this.radius_=o,this.render()},c}(hg),fg=ug,dg=function(){function _(c){var o=c||{};this.color_=o.color!==void 0?o.color:null}return _.prototype.clone=function(){var c=this.getColor();return new _({color:Array.isArray(c)?c.slice():c||void 0})},_.prototype.getColor=function(){return this.color_},_.prototype.setColor=function(c){this.color_=c},_}(),gg=dg,St={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},_g=function(){function _(c){var o=c||{};this.color_=o.color!==void 0?o.color:null,this.lineCap_=o.lineCap,this.lineDash_=o.lineDash!==void 0?o.lineDash:null,this.lineDashOffset_=o.lineDashOffset,this.lineJoin_=o.lineJoin,this.miterLimit_=o.miterLimit,this.width_=o.width}return _.prototype.clone=function(){var c=this.getColor();return new _({color:Array.isArray(c)?c.slice():c||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},_.prototype.getColor=function(){return this.color_},_.prototype.getLineCap=function(){return this.lineCap_},_.prototype.getLineDash=function(){return this.lineDash_},_.prototype.getLineDashOffset=function(){return this.lineDashOffset_},_.prototype.getLineJoin=function(){return this.lineJoin_},_.prototype.getMiterLimit=function(){return this.miterLimit_},_.prototype.getWidth=function(){return this.width_},_.prototype.setColor=function(c){this.color_=c},_.prototype.setLineCap=function(c){this.lineCap_=c},_.prototype.setLineDash=function(c){this.lineDash_=c},_.prototype.setLineDashOffset=function(c){this.lineDashOffset_=c},_.prototype.setLineJoin=function(c){this.lineJoin_=c},_.prototype.setMiterLimit=function(c){this.miterLimit_=c},_.prototype.setWidth=function(c){this.width_=c},_}(),pg=_g,mg=function(){function _(c){var o=c||{};this.geometry_=null,this.geometryFunction_=nc,o.geometry!==void 0&&this.setGeometry(o.geometry),this.fill_=o.fill!==void 0?o.fill:null,this.image_=o.image!==void 0?o.image:null,this.renderer_=o.renderer!==void 0?o.renderer:null,this.hitDetectionRenderer_=o.hitDetectionRenderer!==void 0?o.hitDetectionRenderer:null,this.stroke_=o.stroke!==void 0?o.stroke:null,this.text_=o.text!==void 0?o.text:null,this.zIndex_=o.zIndex}return _.prototype.clone=function(){var c=this.getGeometry();return c&&typeof c=="object"&&(c=c.clone()),new _({geometry:c,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},_.prototype.getRenderer=function(){return this.renderer_},_.prototype.setRenderer=function(c){this.renderer_=c},_.prototype.setHitDetectionRenderer=function(c){this.hitDetectionRenderer_=c},_.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},_.prototype.getGeometry=function(){return this.geometry_},_.prototype.getGeometryFunction=function(){return this.geometryFunction_},_.prototype.getFill=function(){return this.fill_},_.prototype.setFill=function(c){this.fill_=c},_.prototype.getImage=function(){return this.image_},_.prototype.setImage=function(c){this.image_=c},_.prototype.getStroke=function(){return this.stroke_},_.prototype.setStroke=function(c){this.stroke_=c},_.prototype.getText=function(){return this.text_},_.prototype.setText=function(c){this.text_=c},_.prototype.getZIndex=function(){return this.zIndex_},_.prototype.setGeometry=function(c){typeof c=="function"?this.geometryFunction_=c:typeof c=="string"?this.geometryFunction_=function(o){return o.get(c)}:c?c!==void 0&&(this.geometryFunction_=function(){return c}):this.geometryFunction_=nc,this.geometry_=c},_.prototype.setZIndex=function(c){this.zIndex_=c},_}();function yg(_){var c;if(typeof _=="function")c=_;else{var o;if(Array.isArray(_))o=_;else{qt(typeof _.getZIndex=="function",41);var u=_;o=[u]}c=function(){return o}}return c}var ka=null;function vg(_,c){if(!ka){var o=new gg({color:"rgba(255,255,255,0.4)"}),u=new pg({color:"#3399CC",width:1.25});ka=[new mg({image:new fg({fill:o,stroke:u,radius:5}),fill:o,stroke:u})]}return ka}function nc(_){return _.getGeometry()}var Eg=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),rc={RENDER_ORDER:"renderOrder"},xg=function(_){Eg(c,_);function c(o){var u=this,d=o||{},m=I({},d);return delete m.style,delete m.renderBuffer,delete m.updateWhileAnimating,delete m.updateWhileInteracting,u=_.call(this,m)||this,u.declutter_=d.declutter!==void 0?d.declutter:!1,u.renderBuffer_=d.renderBuffer!==void 0?d.renderBuffer:100,u.style_=null,u.styleFunction_=void 0,u.setStyle(d.style),u.updateWhileAnimating_=d.updateWhileAnimating!==void 0?d.updateWhileAnimating:!1,u.updateWhileInteracting_=d.updateWhileInteracting!==void 0?d.updateWhileInteracting:!1,u}return c.prototype.getDeclutter=function(){return this.declutter_},c.prototype.getFeatures=function(o){return _.prototype.getFeatures.call(this,o)},c.prototype.getRenderBuffer=function(){return this.renderBuffer_},c.prototype.getRenderOrder=function(){return this.get(rc.RENDER_ORDER)},c.prototype.getStyle=function(){return this.style_},c.prototype.getStyleFunction=function(){return this.styleFunction_},c.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},c.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},c.prototype.renderDeclutter=function(o){o.declutterTree||(o.declutterTree=new Sn(9)),this.getRenderer().renderDeclutter(o)},c.prototype.setRenderOrder=function(o){this.set(rc.RENDER_ORDER,o)},c.prototype.setStyle=function(o){this.style_=o!==void 0?o:vg,this.styleFunction_=o===null?void 0:yg(this.style_),this.changed()},c}(ti),Cg=xg,ts={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},co=[ts.FILL],Ji=[ts.STROKE],On=[ts.BEGIN_PATH],sc=[ts.CLOSE_PATH],yt=ts,Qi={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},Rg=function(){function _(){}return _.prototype.drawCustom=function(c,o,u,d){},_.prototype.drawGeometry=function(c){},_.prototype.setStyle=function(c){},_.prototype.drawCircle=function(c,o){},_.prototype.drawFeature=function(c,o){},_.prototype.drawGeometryCollection=function(c,o){},_.prototype.drawLineString=function(c,o){},_.prototype.drawMultiLineString=function(c,o){},_.prototype.drawMultiPoint=function(c,o){},_.prototype.drawMultiPolygon=function(c,o){},_.prototype.drawPoint=function(c,o){},_.prototype.drawPolygon=function(c,o){},_.prototype.drawText=function(c,o){},_.prototype.setFillStrokeStyle=function(c,o){},_.prototype.setImageStyle=function(c,o){},_.prototype.setTextStyle=function(c,o){},_}(),oc=Rg;function Na(_,c,o){return o?(o[0]=_[0]-c,o[1]=_[1]-c,o[2]=_[2]+c,o[3]=_[3]+c,o):[_[0]-c,_[1]-c,_[2]+c,_[3]+c]}function wg(_,c){return _.slice()}function Ig(_,c,o){var u,d;return c<_[0]?u=_[0]-c:_[2]<c?u=c-_[2]:u=0,o<_[1]?d=_[1]-o:_[3]<o?d=o-_[3]:d=0,u*u+d*d}function ac(_,c){return Xa(_,c[0],c[1])}function es(_,c){return _[0]<=c[0]&&c[2]<=_[2]&&_[1]<=c[1]&&c[3]<=_[3]}function Xa(_,c,o){return _[0]<=c&&c<=_[2]&&_[1]<=o&&o<=_[3]}function Tg(_,c){var o=_[0],u=_[1],d=_[2],m=_[3],E=c[0],C=c[1],w=Qi.UNKNOWN;return E<o?w=w|Qi.LEFT:E>d&&(w=w|Qi.RIGHT),C<u?w=w|Qi.BELOW:C>m&&(w=w|Qi.ABOVE),w===Qi.UNKNOWN&&(w=Qi.INTERSECTING),w}function is(){return[1/0,1/0,-1/0,-1/0]}function ns(_,c,o,u,d){return d?(d[0]=_,d[1]=c,d[2]=o,d[3]=u,d):[_,c,o,u]}function lc(_){return ns(1/0,1/0,-1/0,-1/0,_)}function Sg(_,c){var o=_[0],u=_[1];return ns(o,u,o,u,c)}function Ag(_,c,o,u,d){var m=lc(d);return Og(m,_,c,o,u)}function hc(_,c){return _[0]==c[0]&&_[2]==c[2]&&_[1]==c[1]&&_[3]==c[3]}function Lg(_,c){c[0]<_[0]&&(_[0]=c[0]),c[0]>_[2]&&(_[2]=c[0]),c[1]<_[1]&&(_[1]=c[1]),c[1]>_[3]&&(_[3]=c[1])}function Og(_,c,o,u,d){for(;o<u;o+=d)Mg(_,c[o],c[o+1]);return _}function Mg(_,c,o){_[0]=Math.min(_[0],c),_[1]=Math.min(_[1],o),_[2]=Math.max(_[2],c),_[3]=Math.max(_[3],o)}function Pg(_){return[_[0],_[1]]}function Dg(_){return[_[2],_[1]]}function Ya(_){return[(_[0]+_[2])/2,(_[1]+_[3])/2]}function uo(_){return _[3]-_[1]}function Fg(_){return[_[0],_[3]]}function bg(_){return[_[2],_[3]]}function Mn(_){return _[2]-_[0]}function ui(_,c){return _[0]<=c[2]&&_[2]>=c[0]&&_[1]<=c[3]&&_[3]>=c[1]}function Gg(_,c){return c?(c[0]=_[0],c[1]=_[1],c[2]=_[2],c[3]=_[3],c):_}function kg(_,c){var o=c.getExtent(),u=Ya(_);if(c.canWrapX()&&(u[0]<o[0]||u[0]>=o[2])){var d=Mn(o),m=Math.floor((u[0]-o[0])/d),E=m*d;_[0]-=E,_[2]-=E}return _}function nr(_,c,o,u,d){for(var m=d!==void 0?d:[],E=0,C=c;C<o;C+=u)m[E++]=_.slice(C,C+u);return m.length=E,m}function Wa(_,c,o,u,d){for(var m=d!==void 0?d:[],E=0,C=0,w=o.length;C<w;++C){var T=o[C];m[E++]=nr(_,c,T,u,m[E]),c=T}return m.length=E,m}function cc(_,c,o,u,d){for(var m=d!==void 0?d:[],E=0,C=0,w=o.length;C<w;++C){var T=o[C];m[E++]=Wa(_,c,T,u,m[E]),c=T[T.length-1]}return m.length=E,m}var Ng=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Xg=function(_){Ng(c,_);function c(o,u,d,m){var E=_.call(this)||this;return E.tolerance=o,E.maxExtent=u,E.pixelRatio=m,E.maxLineWidth=0,E.resolution=d,E.beginGeometryInstruction1_=null,E.beginGeometryInstruction2_=null,E.bufferedMaxExtent_=null,E.instructions=[],E.coordinates=[],E.tmpCoordinate_=[],E.hitDetectionInstructions=[],E.state={},E}return c.prototype.applyPixelRatio=function(o){var u=this.pixelRatio;return u==1?o:o.map(function(d){return d*u})},c.prototype.appendFlatPointCoordinates=function(o,u){for(var d=this.getBufferedMaxExtent(),m=this.tmpCoordinate_,E=this.coordinates,C=E.length,w=0,T=o.length;w<T;w+=u)m[0]=o[w],m[1]=o[w+1],ac(d,m)&&(E[C++]=m[0],E[C++]=m[1]);return C},c.prototype.appendFlatLineCoordinates=function(o,u,d,m,E,C){var w=this.coordinates,T=w.length,A=this.getBufferedMaxExtent();C&&(u+=m);var D=o[u],F=o[u+1],k=this.tmpCoordinate_,N=!0,z,H,tt;for(z=u+m;z<d;z+=m)k[0]=o[z],k[1]=o[z+1],tt=Tg(A,k),tt!==H?(N&&(w[T++]=D,w[T++]=F,N=!1),w[T++]=k[0],w[T++]=k[1]):tt===Qi.INTERSECTING?(w[T++]=k[0],w[T++]=k[1],N=!1):N=!0,D=k[0],F=k[1],H=tt;return(E&&N||z===u+m)&&(w[T++]=D,w[T++]=F),T},c.prototype.drawCustomCoordinates_=function(o,u,d,m,E){for(var C=0,w=d.length;C<w;++C){var T=d[C],A=this.appendFlatLineCoordinates(o,u,T,m,!1,!1);E.push(A),u=T}return u},c.prototype.drawCustom=function(o,u,d,m){this.beginGeometry(o,u);var E=o.getType(),C=o.getStride(),w=this.coordinates.length,T,A,D,F,k;switch(E){case St.MULTI_POLYGON:T=o.getOrientedFlatCoordinates(),F=[];var N=o.getEndss();k=0;for(var z=0,H=N.length;z<H;++z){var tt=[];k=this.drawCustomCoordinates_(T,k,N[z],C,tt),F.push(tt)}this.instructions.push([yt.CUSTOM,w,F,o,d,cc]),this.hitDetectionInstructions.push([yt.CUSTOM,w,F,o,m||d,cc]);break;case St.POLYGON:case St.MULTI_LINE_STRING:D=[],T=E==St.POLYGON?o.getOrientedFlatCoordinates():o.getFlatCoordinates(),k=this.drawCustomCoordinates_(T,0,o.getEnds(),C,D),this.instructions.push([yt.CUSTOM,w,D,o,d,Wa]),this.hitDetectionInstructions.push([yt.CUSTOM,w,D,o,m||d,Wa]);break;case St.LINE_STRING:case St.CIRCLE:T=o.getFlatCoordinates(),A=this.appendFlatLineCoordinates(T,0,T.length,C,!1,!1),this.instructions.push([yt.CUSTOM,w,A,o,d,nr]),this.hitDetectionInstructions.push([yt.CUSTOM,w,A,o,m||d,nr]);break;case St.MULTI_POINT:T=o.getFlatCoordinates(),A=this.appendFlatPointCoordinates(T,C),A>w&&(this.instructions.push([yt.CUSTOM,w,A,o,d,nr]),this.hitDetectionInstructions.push([yt.CUSTOM,w,A,o,m||d,nr]));break;case St.POINT:T=o.getFlatCoordinates(),this.coordinates.push(T[0],T[1]),A=this.coordinates.length,this.instructions.push([yt.CUSTOM,w,A,o,d]),this.hitDetectionInstructions.push([yt.CUSTOM,w,A,o,m||d]);break}this.endGeometry(u)},c.prototype.beginGeometry=function(o,u){this.beginGeometryInstruction1_=[yt.BEGIN_GEOMETRY,u,0,o],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[yt.BEGIN_GEOMETRY,u,0,o],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},c.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},c.prototype.reverseHitDetectionInstructions=function(){var o=this.hitDetectionInstructions;o.reverse();var u,d=o.length,m,E,C=-1;for(u=0;u<d;++u)m=o[u],E=m[0],E==yt.END_GEOMETRY?C=u:E==yt.BEGIN_GEOMETRY&&(m[2]=u,p(this.hitDetectionInstructions,C,u),C=-1)},c.prototype.setFillStrokeStyle=function(o,u){var d=this.state;if(o){var m=o.getColor();d.fillStyle=Ue(m||Ai)}else d.fillStyle=void 0;if(u){var E=u.getColor();d.strokeStyle=Ue(E||qr);var C=u.getLineCap();d.lineCap=C!==void 0?C:ao;var w=u.getLineDash();d.lineDash=w?w.slice():Zr;var T=u.getLineDashOffset();d.lineDashOffset=T||Hr;var A=u.getLineJoin();d.lineJoin=A!==void 0?A:er;var D=u.getWidth();d.lineWidth=D!==void 0?D:Qr;var F=u.getMiterLimit();d.miterLimit=F!==void 0?F:$r,d.lineWidth>this.maxLineWidth&&(this.maxLineWidth=d.lineWidth,this.bufferedMaxExtent_=null)}else d.strokeStyle=void 0,d.lineCap=void 0,d.lineDash=null,d.lineDashOffset=void 0,d.lineJoin=void 0,d.lineWidth=void 0,d.miterLimit=void 0},c.prototype.createFill=function(o){var u=o.fillStyle,d=[yt.SET_FILL_STYLE,u];return typeof u!="string"&&d.push(!0),d},c.prototype.applyStroke=function(o){this.instructions.push(this.createStroke(o))},c.prototype.createStroke=function(o){return[yt.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth*this.pixelRatio,o.lineCap,o.lineJoin,o.miterLimit,this.applyPixelRatio(o.lineDash),o.lineDashOffset*this.pixelRatio]},c.prototype.updateFillStyle=function(o,u){var d=o.fillStyle;(typeof d!="string"||o.currentFillStyle!=d)&&(d!==void 0&&this.instructions.push(u.call(this,o)),o.currentFillStyle=d)},c.prototype.updateStrokeStyle=function(o,u){var d=o.strokeStyle,m=o.lineCap,E=o.lineDash,C=o.lineDashOffset,w=o.lineJoin,T=o.lineWidth,A=o.miterLimit;(o.currentStrokeStyle!=d||o.currentLineCap!=m||E!=o.currentLineDash&&!v(o.currentLineDash,E)||o.currentLineDashOffset!=C||o.currentLineJoin!=w||o.currentLineWidth!=T||o.currentMiterLimit!=A)&&(d!==void 0&&u.call(this,o),o.currentStrokeStyle=d,o.currentLineCap=m,o.currentLineDash=E,o.currentLineDashOffset=C,o.currentLineJoin=w,o.currentLineWidth=T,o.currentMiterLimit=A)},c.prototype.endGeometry=function(o){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var u=[yt.END_GEOMETRY,o];this.instructions.push(u),this.hitDetectionInstructions.push(u)},c.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=wg(this.maxExtent),this.maxLineWidth>0)){var o=this.resolution*(this.maxLineWidth+1)/2;Na(this.bufferedMaxExtent_,o,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},c}(oc),rs=Xg,Yg=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Wg=function(_){Yg(c,_);function c(o,u,d,m){var E=_.call(this,o,u,d,m)||this;return E.hitDetectionImage_=null,E.image_=null,E.imagePixelRatio_=void 0,E.anchorX_=void 0,E.anchorY_=void 0,E.height_=void 0,E.opacity_=void 0,E.originX_=void 0,E.originY_=void 0,E.rotateWithView_=void 0,E.rotation_=void 0,E.scale_=void 0,E.width_=void 0,E.declutterImageWithText_=void 0,E}return c.prototype.drawPoint=function(o,u){if(this.image_){this.beginGeometry(o,u);var d=o.getFlatCoordinates(),m=o.getStride(),E=this.coordinates.length,C=this.appendFlatPointCoordinates(d,m);this.instructions.push([yt.DRAW_IMAGE,E,C,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([yt.DRAW_IMAGE,E,C,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(u)}},c.prototype.drawMultiPoint=function(o,u){if(this.image_){this.beginGeometry(o,u);var d=o.getFlatCoordinates(),m=o.getStride(),E=this.coordinates.length,C=this.appendFlatPointCoordinates(d,m);this.instructions.push([yt.DRAW_IMAGE,E,C,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([yt.DRAW_IMAGE,E,C,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(u)}},c.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,_.prototype.finish.call(this)},c.prototype.setImageStyle=function(o,u){var d=o.getAnchor(),m=o.getSize(),E=o.getHitDetectionImage(),C=o.getImage(this.pixelRatio),w=o.getOrigin();this.imagePixelRatio_=o.getPixelRatio(this.pixelRatio),this.anchorX_=d[0],this.anchorY_=d[1],this.hitDetectionImage_=E,this.image_=C,this.height_=m[1],this.opacity_=o.getOpacity(),this.originX_=w[0]*this.imagePixelRatio_,this.originY_=w[1]*this.imagePixelRatio_,this.rotateWithView_=o.getRotateWithView(),this.rotation_=o.getRotation(),this.scale_=o.getScaleArray(),this.width_=m[0],this.declutterImageWithText_=u},c}(rs),Bg=Wg,zg=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Ug=function(_){zg(c,_);function c(o,u,d,m){return _.call(this,o,u,d,m)||this}return c.prototype.drawFlatCoordinates_=function(o,u,d,m){var E=this.coordinates.length,C=this.appendFlatLineCoordinates(o,u,d,m,!1,!1),w=[yt.MOVE_TO_LINE_TO,E,C];return this.instructions.push(w),this.hitDetectionInstructions.push(w),d},c.prototype.drawLineString=function(o,u){var d=this.state,m=d.strokeStyle,E=d.lineWidth;if(!(m===void 0||E===void 0)){this.updateStrokeStyle(d,this.applyStroke),this.beginGeometry(o,u),this.hitDetectionInstructions.push([yt.SET_STROKE_STYLE,d.strokeStyle,d.lineWidth,d.lineCap,d.lineJoin,d.miterLimit,Zr,Hr],On);var C=o.getFlatCoordinates(),w=o.getStride();this.drawFlatCoordinates_(C,0,C.length,w),this.hitDetectionInstructions.push(Ji),this.endGeometry(u)}},c.prototype.drawMultiLineString=function(o,u){var d=this.state,m=d.strokeStyle,E=d.lineWidth;if(!(m===void 0||E===void 0)){this.updateStrokeStyle(d,this.applyStroke),this.beginGeometry(o,u),this.hitDetectionInstructions.push([yt.SET_STROKE_STYLE,d.strokeStyle,d.lineWidth,d.lineCap,d.lineJoin,d.miterLimit,d.lineDash,d.lineDashOffset],On);for(var C=o.getEnds(),w=o.getFlatCoordinates(),T=o.getStride(),A=0,D=0,F=C.length;D<F;++D)A=this.drawFlatCoordinates_(w,A,C[D],T);this.hitDetectionInstructions.push(Ji),this.endGeometry(u)}},c.prototype.finish=function(){var o=this.state;return o.lastStroke!=null&&o.lastStroke!=this.coordinates.length&&this.instructions.push(Ji),this.reverseHitDetectionInstructions(),this.state=null,_.prototype.finish.call(this)},c.prototype.applyStroke=function(o){o.lastStroke!=null&&o.lastStroke!=this.coordinates.length&&(this.instructions.push(Ji),o.lastStroke=this.coordinates.length),o.lastStroke=0,_.prototype.applyStroke.call(this,o),this.instructions.push(On)},c}(rs),jg=Ug;function Vg(_,c){return c*Math.round(_/c)}var Kg=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Zg=function(_){Kg(c,_);function c(o,u,d,m){return _.call(this,o,u,d,m)||this}return c.prototype.drawFlatCoordinatess_=function(o,u,d,m){var E=this.state,C=E.fillStyle!==void 0,w=E.strokeStyle!==void 0,T=d.length;this.instructions.push(On),this.hitDetectionInstructions.push(On);for(var A=0;A<T;++A){var D=d[A],F=this.coordinates.length,k=this.appendFlatLineCoordinates(o,u,D,m,!0,!w),N=[yt.MOVE_TO_LINE_TO,F,k];this.instructions.push(N),this.hitDetectionInstructions.push(N),w&&(this.instructions.push(sc),this.hitDetectionInstructions.push(sc)),u=D}return C&&(this.instructions.push(co),this.hitDetectionInstructions.push(co)),w&&(this.instructions.push(Ji),this.hitDetectionInstructions.push(Ji)),u},c.prototype.drawCircle=function(o,u){var d=this.state,m=d.fillStyle,E=d.strokeStyle;if(!(m===void 0&&E===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(o,u),d.fillStyle!==void 0&&this.hitDetectionInstructions.push([yt.SET_FILL_STYLE,Ai]),d.strokeStyle!==void 0&&this.hitDetectionInstructions.push([yt.SET_STROKE_STYLE,d.strokeStyle,d.lineWidth,d.lineCap,d.lineJoin,d.miterLimit,d.lineDash,d.lineDashOffset]);var C=o.getFlatCoordinates(),w=o.getStride(),T=this.coordinates.length;this.appendFlatLineCoordinates(C,0,C.length,w,!1,!1);var A=[yt.CIRCLE,T];this.instructions.push(On,A),this.hitDetectionInstructions.push(On,A),d.fillStyle!==void 0&&(this.instructions.push(co),this.hitDetectionInstructions.push(co)),d.strokeStyle!==void 0&&(this.instructions.push(Ji),this.hitDetectionInstructions.push(Ji)),this.endGeometry(u)}},c.prototype.drawPolygon=function(o,u){var d=this.state,m=d.fillStyle,E=d.strokeStyle;if(!(m===void 0&&E===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(o,u),d.fillStyle!==void 0&&this.hitDetectionInstructions.push([yt.SET_FILL_STYLE,Ai]),d.strokeStyle!==void 0&&this.hitDetectionInstructions.push([yt.SET_STROKE_STYLE,d.strokeStyle,d.lineWidth,d.lineCap,d.lineJoin,d.miterLimit,d.lineDash,d.lineDashOffset]);var C=o.getEnds(),w=o.getOrientedFlatCoordinates(),T=o.getStride();this.drawFlatCoordinatess_(w,0,C,T),this.endGeometry(u)}},c.prototype.drawMultiPolygon=function(o,u){var d=this.state,m=d.fillStyle,E=d.strokeStyle;if(!(m===void 0&&E===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(o,u),d.fillStyle!==void 0&&this.hitDetectionInstructions.push([yt.SET_FILL_STYLE,Ai]),d.strokeStyle!==void 0&&this.hitDetectionInstructions.push([yt.SET_STROKE_STYLE,d.strokeStyle,d.lineWidth,d.lineCap,d.lineJoin,d.miterLimit,d.lineDash,d.lineDashOffset]);for(var C=o.getEndss(),w=o.getOrientedFlatCoordinates(),T=o.getStride(),A=0,D=0,F=C.length;D<F;++D)A=this.drawFlatCoordinatess_(w,A,C[D],T);this.endGeometry(u)}},c.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var o=this.tolerance;if(o!==0)for(var u=this.coordinates,d=0,m=u.length;d<m;++d)u[d]=Vg(u[d],o);return _.prototype.finish.call(this)},c.prototype.setFillStrokeStyles_=function(){var o=this.state,u=o.fillStyle;u!==void 0&&this.updateFillStyle(o,this.createFill),o.strokeStyle!==void 0&&this.updateStrokeStyle(o,this.applyStroke)},c}(rs),uc=Zg,Hg={LINE:"line"};function $g(_,c,o,u,d){var m=o,E=o,C=0,w=0,T=o,A,D,F,k,N,z,H,tt,J,st;for(D=o;D<u;D+=d){var vt=c[D],pt=c[D+1];N!==void 0&&(J=vt-N,st=pt-z,k=Math.sqrt(J*J+st*st),H!==void 0&&(w+=F,A=Math.acos((H*J+tt*st)/(F*k)),A>_&&(w>C&&(C=w,m=T,E=D),w=0,T=D-d)),F=k,H=J,tt=st),N=vt,z=pt}return w+=k,w>C?[T,D]:[m,E]}var qg=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),fo={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Jg=function(_){qg(c,_);function c(o,u,d,m){var E=_.call(this,o,u,d,m)||this;return E.labels_=null,E.text_="",E.textOffsetX_=0,E.textOffsetY_=0,E.textRotateWithView_=void 0,E.textRotation_=0,E.textFillState_=null,E.fillStates={},E.textStrokeState_=null,E.strokeStates={},E.textState_={},E.textStates={},E.textKey_="",E.fillKey_="",E.strokeKey_="",E.declutterImageWithText_=void 0,E}return c.prototype.finish=function(){var o=_.prototype.finish.call(this);return o.textStates=this.textStates,o.fillStates=this.fillStates,o.strokeStates=this.strokeStates,o},c.prototype.drawText=function(o,u){var d=this.textFillState_,m=this.textStrokeState_,E=this.textState_;if(!(this.text_===""||!E||!d&&!m)){var C=this.coordinates,w=C.length,T=o.getType(),A=null,D=o.getStride();if(E.placement===Hg.LINE&&(T==St.LINE_STRING||T==St.MULTI_LINE_STRING||T==St.POLYGON||T==St.MULTI_POLYGON)){if(!ui(this.getBufferedMaxExtent(),o.getExtent()))return;var F=void 0;if(A=o.getFlatCoordinates(),T==St.LINE_STRING)F=[A.length];else if(T==St.MULTI_LINE_STRING)F=o.getEnds();else if(T==St.POLYGON)F=o.getEnds().slice(0,1);else if(T==St.MULTI_POLYGON){var k=o.getEndss();F=[];for(var N=0,z=k.length;N<z;++N)F.push(k[N][0])}this.beginGeometry(o,u);for(var H=E.textAlign,tt=0,J=void 0,st=0,vt=F.length;st<vt;++st){if(H==null){var pt=$g(E.maxAngle,A,tt,F[st],D);tt=pt[0],J=pt[1]}else J=F[st];for(var N=tt;N<J;N+=D)C.push(A[N],A[N+1]);var ct=C.length;tt=F[st],this.drawChars_(w,ct),w=ct}this.endGeometry(u)}else{var Et=E.overflow?null:[];switch(T){case St.POINT:case St.MULTI_POINT:A=o.getFlatCoordinates();break;case St.LINE_STRING:A=o.getFlatMidpoint();break;case St.CIRCLE:A=o.getCenter();break;case St.MULTI_LINE_STRING:A=o.getFlatMidpoints(),D=2;break;case St.POLYGON:A=o.getFlatInteriorPoint(),E.overflow||Et.push(A[2]/this.resolution),D=3;break;case St.MULTI_POLYGON:var gt=o.getFlatInteriorPoints();A=[];for(var N=0,z=gt.length;N<z;N+=3)E.overflow||Et.push(gt[N+2]/this.resolution),A.push(gt[N],gt[N+1]);if(A.length===0)return;D=2;break}var ct=this.appendFlatPointCoordinates(A,D);if(ct===w)return;if(Et&&(ct-w)/2!==A.length/D){var Rt=w/2;Et=Et.filter(function(Qt,Yt){var Ut=C[(Rt+Yt)*2]===A[Yt*D]&&C[(Rt+Yt)*2+1]===A[Yt*D+1];return Ut||--Rt,Ut})}this.saveTextStates_(),(E.backgroundFill||E.backgroundStroke)&&(this.setFillStrokeStyle(E.backgroundFill,E.backgroundStroke),E.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),E.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(o,u);var kt=E.padding;if(kt!=Ln&&(E.scale[0]<0||E.scale[1]<0)){var zt=E.padding[0],At=E.padding[1],Pt=E.padding[2],Kt=E.padding[3];E.scale[0]<0&&(At=-At,Kt=-Kt),E.scale[1]<0&&(zt=-zt,Pt=-Pt),kt=[zt,At,Pt,Kt]}var oe=this.pixelRatio;this.instructions.push([yt.DRAW_IMAGE,w,ct,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,kt==Ln?Ln:kt.map(function(Qt){return Qt*oe}),!!E.backgroundFill,!!E.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,Et]);var ie=1/oe;this.hitDetectionInstructions.push([yt.DRAW_IMAGE,w,ct,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[ie,ie],NaN,this.declutterImageWithText_,kt,!!E.backgroundFill,!!E.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,Et]),this.endGeometry(u)}}},c.prototype.saveTextStates_=function(){var o=this.textStrokeState_,u=this.textState_,d=this.textFillState_,m=this.strokeKey_;o&&(m in this.strokeStates||(this.strokeStates[m]={strokeStyle:o.strokeStyle,lineCap:o.lineCap,lineDashOffset:o.lineDashOffset,lineWidth:o.lineWidth,lineJoin:o.lineJoin,miterLimit:o.miterLimit,lineDash:o.lineDash}));var E=this.textKey_;E in this.textStates||(this.textStates[E]={font:u.font,textAlign:u.textAlign||Jr,textBaseline:u.textBaseline||lo,scale:u.scale});var C=this.fillKey_;d&&(C in this.fillStates||(this.fillStates[C]={fillStyle:d.fillStyle}))},c.prototype.drawChars_=function(o,u){var d=this.textStrokeState_,m=this.textState_,E=this.strokeKey_,C=this.textKey_,w=this.fillKey_;this.saveTextStates_();var T=this.pixelRatio,A=fo[m.textBaseline],D=this.textOffsetY_*T,F=this.text_,k=d?d.lineWidth*Math.abs(m.scale[0])/2:0;this.instructions.push([yt.DRAW_CHARS,o,u,A,m.overflow,w,m.maxAngle,T,D,E,k*T,F,C,1]),this.hitDetectionInstructions.push([yt.DRAW_CHARS,o,u,A,m.overflow,w,m.maxAngle,1,D,E,k,F,C,1/T])},c.prototype.setTextStyle=function(o,u){var d,m,E;if(!o)this.text_="";else{var C=o.getFill();C?(m=this.textFillState_,m||(m={},this.textFillState_=m),m.fillStyle=Ue(C.getColor()||Ai)):(m=null,this.textFillState_=m);var w=o.getStroke();if(!w)E=null,this.textStrokeState_=E;else{E=this.textStrokeState_,E||(E={},this.textStrokeState_=E);var T=w.getLineDash(),A=w.getLineDashOffset(),D=w.getWidth(),F=w.getMiterLimit();E.lineCap=w.getLineCap()||ao,E.lineDash=T?T.slice():Zr,E.lineDashOffset=A===void 0?Hr:A,E.lineJoin=w.getLineJoin()||er,E.lineWidth=D===void 0?Qr:D,E.miterLimit=F===void 0?$r:F,E.strokeStyle=Ue(w.getColor()||qr)}d=this.textState_;var k=o.getFont()||tc;ig(k);var N=o.getScaleArray();d.overflow=o.getOverflow(),d.font=k,d.maxAngle=o.getMaxAngle(),d.placement=o.getPlacement(),d.textAlign=o.getTextAlign(),d.textBaseline=o.getTextBaseline()||lo,d.backgroundFill=o.getBackgroundFill(),d.backgroundStroke=o.getBackgroundStroke(),d.padding=o.getPadding()||Ln,d.scale=N===void 0?[1,1]:N;var z=o.getOffsetX(),H=o.getOffsetY(),tt=o.getRotateWithView(),J=o.getRotation();this.text_=o.getText()||"",this.textOffsetX_=z===void 0?0:z,this.textOffsetY_=H===void 0?0:H,this.textRotateWithView_=tt===void 0?!1:tt,this.textRotation_=J===void 0?0:J,this.strokeKey_=E?(typeof E.strokeStyle=="string"?E.strokeStyle:et(E.strokeStyle))+E.lineCap+E.lineDashOffset+"|"+E.lineWidth+E.lineJoin+E.miterLimit+"["+E.lineDash.join()+"]":"",this.textKey_=d.font+d.scale+(d.textAlign||"?")+(d.textBaseline||"?"),this.fillKey_=m?typeof m.fillStyle=="string"?m.fillStyle:"|"+et(m.fillStyle):""}this.declutterImageWithText_=u},c}(rs),Qg=Jg,t_={Circle:uc,Default:rs,Image:Bg,LineString:jg,Polygon:uc,Text:Qg},e_=function(){function _(c,o,u,d){this.tolerance_=c,this.maxExtent_=o,this.pixelRatio_=d,this.resolution_=u,this.buildersByZIndex_={}}return _.prototype.finish=function(){var c={};for(var o in this.buildersByZIndex_){c[o]=c[o]||{};var u=this.buildersByZIndex_[o];for(var d in u){var m=u[d].finish();c[o][d]=m}}return c},_.prototype.getBuilder=function(c,o){var u=c!==void 0?c.toString():"0",d=this.buildersByZIndex_[u];d===void 0&&(d={},this.buildersByZIndex_[u]=d);var m=d[o];if(m===void 0){var E=t_[o];m=new E(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),d[o]=m}return m},_}(),fc=e_,i_=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),n_=function(_){i_(c,_);function c(o){var u=_.call(this)||this;return u.ready=!0,u.boundHandleImageChange_=u.handleImageChange_.bind(u),u.layer_=o,u.declutterExecutorGroup=null,u}return c.prototype.getFeatures=function(o){return K()},c.prototype.getData=function(o){return null},c.prototype.prepareFrame=function(o){return K()},c.prototype.renderFrame=function(o,u){return K()},c.prototype.loadedTileCallback=function(o,u,d){o[u]||(o[u]={}),o[u][d.tileCoord.toString()]=d},c.prototype.createLoadedTileFinder=function(o,u,d){return(function(m,E){var C=this.loadedTileCallback.bind(this,d,m);return o.forEachLoadedTile(u,m,E,C)}).bind(this)},c.prototype.forEachFeatureAtCoordinate=function(o,u,d,m,E){},c.prototype.getDataAtPixel=function(o,u,d){return null},c.prototype.getLayer=function(){return this.layer_},c.prototype.handleFontsChanged=function(){},c.prototype.handleImageChange_=function(o){var u=o.target;u.getState()===Ft.LOADED&&this.renderIfReadyAndVisible()},c.prototype.loadImage=function(o){var u=o.getState();return u!=Ft.LOADED&&u!=Ft.ERROR&&o.addEventListener(G.CHANGE,this.boundHandleImageChange_),u==Ft.IDLE&&(o.load(),u=o.getState()),u==Ft.LOADED},c.prototype.renderIfReadyAndVisible=function(){var o=this.getLayer();o.getVisible()&&o.getSourceState()==We.READY&&o.changed()},c.prototype.disposeInternal=function(){delete this.layer_,_.prototype.disposeInternal.call(this)},c}(q),r_=n_,s_=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),o_=function(_){s_(c,_);function c(o,u,d,m){var E=_.call(this,o)||this;return E.inversePixelTransform=u,E.frameState=d,E.context=m,E}return c}(i),a_=o_;new Array(6);function tn(){return[1,0,0,1,0,0]}function l_(_,c,o,u,d,m,E){return _[0]=c,_[1]=o,_[2]=u,_[3]=d,_[4]=m,_[5]=E,_}function h_(_,c){return _[0]=c[0],_[1]=c[1],_[2]=c[2],_[3]=c[3],_[4]=c[4],_[5]=c[5],_}function ye(_,c){var o=c[0],u=c[1];return c[0]=_[0]*o+_[2]*u+_[4],c[1]=_[1]*o+_[3]*u+_[5],c}function c_(_,c,o){return l_(_,c,0,0,o,0,0)}function rr(_,c,o,u,d,m,E,C){var w=Math.sin(m),T=Math.cos(m);return _[0]=u*T,_[1]=d*w,_[2]=-u*w,_[3]=d*T,_[4]=E*u*T-C*u*w+c,_[5]=E*d*w+C*d*T+o,_}function u_(_,c){var o=f_(c);qt(o!==0,32);var u=c[0],d=c[1],m=c[2],E=c[3],C=c[4],w=c[5];return _[0]=E/o,_[1]=-d/o,_[2]=-m/o,_[3]=u/o,_[4]=(m*w-E*C)/o,_[5]=-(u*w-d*C)/o,_}function f_(_){return _[0]*_[3]-_[1]*_[2]}var dc;function d_(_){var c="matrix("+_.join(", ")+")";if(oo)return c;var o=dc||(dc=document.createElement("div"));return o.style.transform=c,o.style.transform}var g_=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),ss=null;function __(){var _=document.createElement("canvas");_.width=1,_.height=1,ss=_.getContext("2d")}var p_=function(_){g_(c,_);function c(o){var u=_.call(this,o)||this;return u.container=null,u.renderedResolution,u.tempTransform=tn(),u.pixelTransform=tn(),u.inversePixelTransform=tn(),u.context=null,u.containerReused=!1,u.pixelContext_=null,u.frameState=null,u}return c.prototype.getImageData=function(o,u,d){ss||__(),ss.clearRect(0,0,1,1);var m;try{ss.drawImage(o,u,d,1,1,0,0,1,1),m=ss.getImageData(0,0,1,1).data}catch{return null}return m},c.prototype.getBackground=function(o){var u=this.getLayer(),d=u.getBackground();return typeof d=="function"&&(d=d(o.viewState.resolution)),d||void 0},c.prototype.useContainer=function(o,u,d,m){var E=this.getLayer().getClassName(),C,w;if(o&&o.className===E&&o.style.opacity===""&&d===1&&(!m||o.style.backgroundColor&&v(Se(o.style.backgroundColor),Se(m)))){var T=o.firstElementChild;T instanceof HTMLCanvasElement&&(w=T.getContext("2d"))}if(w&&w.canvas.style.transform===u?(this.container=o,this.context=w,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){C=document.createElement("div"),C.className=E;var A=C.style;A.position="absolute",A.width="100%",A.height="100%",m&&(A.backgroundColor=m),w=Si();var T=w.canvas;C.appendChild(T),A=T.style,A.position="absolute",A.left="0",A.transformOrigin="top left",this.container=C,this.context=w}},c.prototype.clipUnrotated=function(o,u,d){var m=Fg(d),E=bg(d),C=Dg(d),w=Pg(d);ye(u.coordinateToPixelTransform,m),ye(u.coordinateToPixelTransform,E),ye(u.coordinateToPixelTransform,C),ye(u.coordinateToPixelTransform,w);var T=this.inversePixelTransform;ye(T,m),ye(T,E),ye(T,C),ye(T,w),o.save(),o.beginPath(),o.moveTo(Math.round(m[0]),Math.round(m[1])),o.lineTo(Math.round(E[0]),Math.round(E[1])),o.lineTo(Math.round(C[0]),Math.round(C[1])),o.lineTo(Math.round(w[0]),Math.round(w[1])),o.clip()},c.prototype.dispatchRenderEvent_=function(o,u,d){var m=this.getLayer();if(m.hasListener(o)){var E=new a_(o,this.inversePixelTransform,d,u);m.dispatchEvent(E)}},c.prototype.preRender=function(o,u){this.frameState=u,this.dispatchRenderEvent_(ci.PRERENDER,o,u)},c.prototype.postRender=function(o,u){this.dispatchRenderEvent_(ci.POSTRENDER,o,u)},c.prototype.getRenderTransform=function(o,u,d,m,E,C,w){var T=E/2,A=C/2,D=m/u,F=-D,k=-o[0]+w,N=-o[1];return rr(this.tempTransform,T,A,D,F,-d,k,N)},c.prototype.getDataAtPixel=function(o,u,d){var m=ye(this.inversePixelTransform,o.slice()),E=this.context,C=this.getLayer(),w=C.getExtent();if(w){var T=ye(u.pixelToCoordinateTransform,o.slice());if(!ac(w,T))return null}var A=Math.round(m[0]),D=Math.round(m[1]),F=this.pixelContext_;if(!F){var k=document.createElement("canvas");k.width=1,k.height=1,F=k.getContext("2d"),this.pixelContext_=F}F.clearRect(0,0,1,1);var N;try{F.drawImage(E.canvas,A,D,1,1,0,0,1,1),N=F.getImageData(0,0,1,1).data}catch(z){return z.name==="SecurityError"?(this.pixelContext_=null,new Uint8Array):N}return N[3]===0?null:N},c.prototype.disposeInternal=function(){delete this.frameState,_.prototype.disposeInternal.call(this)},c}(r_),m_=p_,Jt={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function Pn(_,c,o,u,d,m){for(var E=m||[],C=0,w=c;w<o;w+=u){var T=_[w],A=_[w+1];E[C++]=d[0]*T+d[2]*A+d[4],E[C++]=d[1]*T+d[3]*A+d[5]}return m&&E.length!=C&&(E.length=C),E}function gc(_,c,o,u,d,m,E){for(var C=E||[],w=Math.cos(d),T=Math.sin(d),A=m[0],D=m[1],F=0,k=c;k<o;k+=u){var N=_[k]-A,z=_[k+1]-D;C[F++]=A+N*w-z*T,C[F++]=D+N*T+z*w;for(var H=k+2;H<k+u;++H)C[F++]=_[H]}return E&&C.length!=F&&(C.length=F),C}function y_(_,c,o,u,d,m,E,C){for(var w=C||[],T=E[0],A=E[1],D=0,F=c;F<o;F+=u){var k=_[F]-T,N=_[F+1]-A;w[D++]=T+d*k,w[D++]=A+m*N;for(var z=F+2;z<F+u;++z)w[D++]=_[z]}return C&&w.length!=D&&(w.length=D),w}function v_(_,c,o,u,d,m,E){for(var C=E||[],w=0,T=c;T<o;T+=u){C[w++]=_[T]+d,C[w++]=_[T+1]+m;for(var A=T+2;A<T+u;++A)C[w++]=_[A]}return E&&C.length!=w&&(C.length=w),C}function E_(_,c,o,u,d,m,E,C,w,T,A,D){var F=_[c],k=_[c+1],N=0,z=0,H=0,tt=0;function J(){N=F,z=k,c+=u,F=_[c],k=_[c+1],tt+=H,H=Math.sqrt((F-N)*(F-N)+(k-z)*(k-z))}do J();while(c<o-u&&tt+H<m);for(var st=H===0?0:(m-tt)/H,vt=_e(N,F,st),pt=_e(z,k,st),ct=c-u,Et=tt,gt=m+C*w(T,d,A);c<o-u&&tt+H<gt;)J();st=H===0?0:(gt-tt)/H;var Rt=_e(N,F,st),kt=_e(z,k,st),zt;if(D){var At=[vt,pt,Rt,kt];gc(At,0,4,2,D,At,At),zt=At[0]>At[2]}else zt=vt>Rt;var Pt=Math.PI,Kt=[],oe=ct+u===c;c=ct,H=0,tt=Et,F=_[c],k=_[c+1];var ie;if(oe){J(),ie=Math.atan2(k-z,F-N),zt&&(ie+=ie>0?-Pt:Pt);var bt=(Rt+vt)/2,Qt=(kt+pt)/2;return Kt[0]=[bt,Qt,(gt-m)/2,ie,d],Kt}for(var Yt=0,Ut=d.length;Yt<Ut;){J();var le=Math.atan2(k-z,F-N);if(zt&&(le+=le>0?-Pt:Pt),ie!==void 0){var Q=le-ie;if(Q+=Q>Pt?-2*Pt:Q<-Pt?2*Pt:0,Math.abs(Q)>E)return null}ie=le;for(var Ae=Yt,Ve=0;Yt<Ut;++Yt){var us=zt?Ut-Yt-1:Yt,Eo=C*w(T,d[us],A);if(c+u<o&&tt+H<m+Ve+Eo/2)break;Ve+=Eo}if(Yt!==Ae){var Ha=zt?d.substring(Ut-Ae,Ut-Yt):d.substring(Ae,Yt);st=H===0?0:(m+Ve/2-tt)/H;var bt=_e(N,F,st),Qt=_e(z,k,st);Kt.push([bt,Qt,Ve/2,le,Ha]),m+=Ve}}return Kt}function x_(_,c,o,u){for(var d=_[c],m=_[c+1],E=0,C=c+u;C<o;C+=u){var w=_[C],T=_[C+1];E+=Math.sqrt((w-d)*(w-d)+(T-m)*(T-m)),d=w,m=T}return E}var sr=is(),en=[],Li=[],Oi=[],nn=[];function _c(_){return _[3].declutterBox}var C_=new RegExp("[-----]");function pc(_,c){return(c==="start"||c==="end")&&!C_.test(_)&&(c=c==="start"?"left":"right"),fo[c]}function R_(_,c,o){return o>0&&_.push(`
`,""),_.push(c,""),_}var w_=function(){function _(c,o,u,d){this.overlaps=u,this.pixelRatio=o,this.resolution=c,this.alignFill_,this.instructions=d.instructions,this.coordinates=d.coordinates,this.coordinateCache_={},this.renderedTransform_=tn(),this.hitDetectionInstructions=d.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=d.fillStates||{},this.strokeStates=d.strokeStates||{},this.textStates=d.textStates||{},this.widths_={},this.labels_={}}return _.prototype.createLabel=function(c,o,u,d){var m=c+o+u+d;if(this.labels_[m])return this.labels_[m];var E=d?this.strokeStates[d]:null,C=u?this.fillStates[u]:null,w=this.textStates[o],T=this.pixelRatio,A=[w.scale[0]*T,w.scale[1]*T],D=Array.isArray(c),F=pc(D?c[0]:c,w.textAlign||Jr),k=d&&E.lineWidth?E.lineWidth:0,N=D?c:c.split(`
`).reduce(R_,[]),z=rg(w,N),H=z.width,tt=z.height,J=z.widths,st=z.heights,vt=z.lineWidths,pt=H+k,ct=[],Et=(pt+2)*A[0],gt=(tt+k)*A[1],Rt={width:Et<0?Math.floor(Et):Math.ceil(Et),height:gt<0?Math.floor(gt):Math.ceil(gt),contextInstructions:ct};if((A[0]!=1||A[1]!=1)&&ct.push("scale",A),d){ct.push("strokeStyle",E.strokeStyle),ct.push("lineWidth",k),ct.push("lineCap",E.lineCap),ct.push("lineJoin",E.lineJoin),ct.push("miterLimit",E.miterLimit);var kt=oo?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;kt.prototype.setLineDash&&(ct.push("setLineDash",[E.lineDash]),ct.push("lineDashOffset",E.lineDashOffset))}u&&ct.push("fillStyle",C.fillStyle),ct.push("textBaseline","middle"),ct.push("textAlign","center");for(var zt=.5-F,At=F*pt+zt*k,Pt=[],Kt=[],oe=0,ie=0,bt=0,Qt=0,Yt,Ut=0,le=N.length;Ut<le;Ut+=2){var Q=N[Ut];if(Q===`
`){ie+=oe,oe=0,At=F*pt+zt*k,++Qt;continue}var Ae=N[Ut+1]||w.font;Ae!==Yt&&(d&&Pt.push("font",Ae),u&&Kt.push("font",Ae),Yt=Ae),oe=Math.max(oe,st[bt]);var Ve=[Q,At+zt*J[bt]+F*(J[bt]-vt[Qt]),.5*(k+oe)+ie];At+=J[bt],d&&Pt.push("strokeText",Ve),u&&Kt.push("fillText",Ve),++bt}return Array.prototype.push.apply(ct,Pt),Array.prototype.push.apply(ct,Kt),this.labels_[m]=Rt,Rt},_.prototype.replayTextBackground_=function(c,o,u,d,m,E,C){c.beginPath(),c.moveTo.apply(c,o),c.lineTo.apply(c,u),c.lineTo.apply(c,d),c.lineTo.apply(c,m),c.lineTo.apply(c,o),E&&(this.alignFill_=E[2],this.fill_(c)),C&&(this.setStrokeStyle_(c,C),c.stroke())},_.prototype.calculateImageOrLabelDimensions_=function(c,o,u,d,m,E,C,w,T,A,D,F,k,N,z,H){C*=F[0],w*=F[1];var tt=u-C,J=d-w,st=m+T>c?c-T:m,vt=E+A>o?o-A:E,pt=N[3]+st*F[0]+N[1],ct=N[0]+vt*F[1]+N[2],Et=tt-N[3],gt=J-N[0];(z||D!==0)&&(en[0]=Et,nn[0]=Et,en[1]=gt,Li[1]=gt,Li[0]=Et+pt,Oi[0]=Li[0],Oi[1]=gt+ct,nn[1]=Oi[1]);var Rt;return D!==0?(Rt=rr(tn(),u,d,1,1,D,-u,-d),ye(Rt,en),ye(Rt,Li),ye(Rt,Oi),ye(Rt,nn),ns(Math.min(en[0],Li[0],Oi[0],nn[0]),Math.min(en[1],Li[1],Oi[1],nn[1]),Math.max(en[0],Li[0],Oi[0],nn[0]),Math.max(en[1],Li[1],Oi[1],nn[1]),sr)):ns(Math.min(Et,Et+pt),Math.min(gt,gt+ct),Math.max(Et,Et+pt),Math.max(gt,gt+ct),sr),k&&(tt=Math.round(tt),J=Math.round(J)),{drawImageX:tt,drawImageY:J,drawImageW:st,drawImageH:vt,originX:T,originY:A,declutterBox:{minX:sr[0],minY:sr[1],maxX:sr[2],maxY:sr[3],value:H},canvasTransform:Rt,scale:F}},_.prototype.replayImageOrLabel_=function(c,o,u,d,m,E,C){var w=!!(E||C),T=d.declutterBox,A=c.canvas,D=C?C[2]*d.scale[0]/2:0,F=T.minX-D<=A.width/o&&T.maxX+D>=0&&T.minY-D<=A.height/o&&T.maxY+D>=0;return F&&(w&&this.replayTextBackground_(c,en,Li,Oi,nn,E,C),sg(c,d.canvasTransform,m,u,d.originX,d.originY,d.drawImageW,d.drawImageH,d.drawImageX,d.drawImageY,d.scale)),!0},_.prototype.fill_=function(c){if(this.alignFill_){var o=ye(this.renderedTransform_,[0,0]),u=512*this.pixelRatio;c.save(),c.translate(o[0]%u,o[1]%u),c.rotate(this.viewRotation_)}c.fill(),this.alignFill_&&c.restore()},_.prototype.setStrokeStyle_=function(c,o){c.strokeStyle=o[1],c.lineWidth=o[2],c.lineCap=o[3],c.lineJoin=o[4],c.miterLimit=o[5],c.setLineDash&&(c.lineDashOffset=o[7],c.setLineDash(o[6]))},_.prototype.drawLabelWithPointPlacement_=function(c,o,u,d){var m=this.textStates[o],E=this.createLabel(c,o,d,u),C=this.strokeStates[u],w=this.pixelRatio,T=pc(Array.isArray(c)?c[0]:c,m.textAlign||Jr),A=fo[m.textBaseline||lo],D=C&&C.lineWidth?C.lineWidth:0,F=E.width/w-2*m.scale[0],k=T*F+2*(.5-T)*D,N=A*E.height/w+2*(.5-A)*D;return{label:E,anchorX:k,anchorY:N}},_.prototype.execute_=function(c,o,u,d,m,E,C,w){var T;this.pixelCoordinates_&&v(u,this.renderedTransform_)?T=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),T=Pn(this.coordinates,0,this.coordinates.length,2,u,this.pixelCoordinates_),h_(this.renderedTransform_,u));for(var A=0,D=d.length,F=0,k,N,z,H,tt,J,st,vt,pt,ct,Et,gt,Rt=0,kt=0,zt=null,At=null,Pt=this.coordinateCache_,Kt=this.viewRotation_,oe=Math.round(Math.atan2(-u[1],u[0])*1e12)/1e12,ie={context:c,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Kt},bt=this.instructions!=d||this.overlaps?0:200,Qt,Yt,Ut,le;A<D;){var Q=d[A],Ae=Q[0];switch(Ae){case yt.BEGIN_GEOMETRY:Qt=Q[1],le=Q[3],Qt.getGeometry()?C!==void 0&&!ui(C,le.getExtent())?A=Q[2]+1:++A:A=Q[2];break;case yt.BEGIN_PATH:Rt>bt&&(this.fill_(c),Rt=0),kt>bt&&(c.stroke(),kt=0),!Rt&&!kt&&(c.beginPath(),H=NaN,tt=NaN),++A;break;case yt.CIRCLE:F=Q[1];var Ve=T[F],us=T[F+1],Eo=T[F+2],Ha=T[F+3],Uc=Eo-Ve,jc=Ha-us,Vc=Math.sqrt(Uc*Uc+jc*jc);c.moveTo(Ve+Vc,us),c.arc(Ve,us,Vc,0,2*Math.PI,!0),++A;break;case yt.CLOSE_PATH:c.closePath(),++A;break;case yt.CUSTOM:F=Q[1],k=Q[2];var mm=Q[3],ym=Q[4],Kc=Q.length==6?Q[5]:void 0;ie.geometry=mm,ie.feature=Qt,A in Pt||(Pt[A]=[]);var fs=Pt[A];Kc?Kc(T,F,k,2,fs):(fs[0]=T[F],fs[1]=T[F+1],fs.length=2),ym(fs,ie),++A;break;case yt.DRAW_IMAGE:F=Q[1],k=Q[2],vt=Q[3],N=Q[4],z=Q[5];var $a=Q[6],vm=Q[7],Em=Q[8],xm=Q[9],Zc=Q[10],qa=Q[11],Cm=Q[12],xo=Q[13],ds=Q[14];if(!vt&&Q.length>=19){pt=Q[18],ct=Q[19],Et=Q[20],gt=Q[21];var Ja=this.drawLabelWithPointPlacement_(pt,ct,Et,gt);vt=Ja.label,Q[3]=vt;var Rm=Q[22];N=(Ja.anchorX-Rm)*this.pixelRatio,Q[4]=N;var wm=Q[23];z=(Ja.anchorY-wm)*this.pixelRatio,Q[5]=z,$a=vt.height,Q[6]=$a,xo=vt.width,Q[13]=xo}var Qa=void 0;Q.length>24&&(Qa=Q[24]);var tl=void 0,Co=void 0,Ro=void 0;Q.length>16?(tl=Q[15],Co=Q[16],Ro=Q[17]):(tl=Ln,Co=!1,Ro=!1),Zc&&oe?qa+=Kt:!Zc&&!oe&&(qa-=Kt);for(var Im=0;F<k;F+=2)if(!(Qa&&Qa[Im++]<xo/this.pixelRatio)){var Pi=this.calculateImageOrLabelDimensions_(vt.width,vt.height,T[F],T[F+1],xo,$a,N,z,Em,xm,qa,Cm,m,tl,Co||Ro,Qt),Hc=[c,o,vt,Pi,vm,Co?zt:null,Ro?At:null],wo=void 0,el=void 0;if(w&&ds){var Io=k-F;if(!ds[Io]){ds[Io]=Hc;continue}if(wo=ds[Io],delete ds[Io],el=_c(wo),w.collides(el))continue}w&&w.collides(Pi.declutterBox)||(wo&&(w&&w.insert(el),this.replayImageOrLabel_.apply(this,wo)),w&&w.insert(Pi.declutterBox),this.replayImageOrLabel_.apply(this,Hc))}++A;break;case yt.DRAW_CHARS:var $c=Q[1],qc=Q[2],il=Q[3],Tm=Q[4];gt=Q[5];var Sm=Q[6],Jc=Q[7],Qc=Q[8];Et=Q[9];var nl=Q[10];pt=Q[11],ct=Q[12];var tu=[Q[13],Q[13]],rl=this.textStates[ct],gs=rl.font,_s=[rl.scale[0]*Jc,rl.scale[1]*Jc],ps=void 0;gs in this.widths_?ps=this.widths_[gs]:(ps={},this.widths_[gs]=ps);var eu=x_(T,$c,qc,2),iu=Math.abs(_s[0])*ic(gs,pt,ps);if(Tm||iu<=eu){var Am=this.textStates[ct].textAlign,Lm=(eu-iu)*fo[Am],ms=E_(T,$c,qc,2,pt,Lm,Sm,Math.abs(_s[0]),ic,gs,ps,oe?0:this.viewRotation_);t:if(ms){var ys=[],on=void 0,To=void 0,So=void 0,Le=void 0,Ke=void 0;if(Et)for(on=0,To=ms.length;on<To;++on){Ke=ms[on],So=Ke[4],Le=this.createLabel(So,ct,"",Et),N=Ke[2]+(_s[0]<0?-nl:nl),z=il*Le.height+(.5-il)*2*nl*_s[1]/_s[0]-Qc;var Pi=this.calculateImageOrLabelDimensions_(Le.width,Le.height,Ke[0],Ke[1],Le.width,Le.height,N,z,0,0,Ke[3],tu,!1,Ln,!1,Qt);if(w&&w.collides(Pi.declutterBox))break t;ys.push([c,o,Le,Pi,1,null,null])}if(gt)for(on=0,To=ms.length;on<To;++on){Ke=ms[on],So=Ke[4],Le=this.createLabel(So,ct,gt,""),N=Ke[2],z=il*Le.height-Qc;var Pi=this.calculateImageOrLabelDimensions_(Le.width,Le.height,Ke[0],Ke[1],Le.width,Le.height,N,z,0,0,Ke[3],tu,!1,Ln,!1,Qt);if(w&&w.collides(Pi.declutterBox))break t;ys.push([c,o,Le,Pi,1,null,null])}w&&w.load(ys.map(_c));for(var sl=0,Om=ys.length;sl<Om;++sl)this.replayImageOrLabel_.apply(this,ys[sl])}}++A;break;case yt.END_GEOMETRY:if(E!==void 0){Qt=Q[1];var nu=E(Qt,le);if(nu)return nu}++A;break;case yt.FILL:bt?Rt++:this.fill_(c),++A;break;case yt.MOVE_TO_LINE_TO:for(F=Q[1],k=Q[2],Yt=T[F],Ut=T[F+1],J=Yt+.5|0,st=Ut+.5|0,(J!==H||st!==tt)&&(c.moveTo(Yt,Ut),H=J,tt=st),F+=2;F<k;F+=2)Yt=T[F],Ut=T[F+1],J=Yt+.5|0,st=Ut+.5|0,(F==k-2||J!==H||st!==tt)&&(c.lineTo(Yt,Ut),H=J,tt=st);++A;break;case yt.SET_FILL_STYLE:zt=Q,this.alignFill_=Q[2],Rt&&(this.fill_(c),Rt=0,kt&&(c.stroke(),kt=0)),c.fillStyle=Q[1],++A;break;case yt.SET_STROKE_STYLE:At=Q,kt&&(c.stroke(),kt=0),this.setStrokeStyle_(c,Q),++A;break;case yt.STROKE:bt?kt++:c.stroke(),++A;break;default:++A;break}}Rt&&this.fill_(c),kt&&c.stroke()},_.prototype.execute=function(c,o,u,d,m,E){this.viewRotation_=d,this.execute_(c,o,u,this.instructions,m,void 0,void 0,E)},_.prototype.executeHitDetection=function(c,o,u,d,m){return this.viewRotation_=u,this.execute_(c,1,o,this.hitDetectionInstructions,!0,d,m)},_}(),I_=w_,Ba=[Jt.POLYGON,Jt.CIRCLE,Jt.LINE_STRING,Jt.IMAGE,Jt.TEXT,Jt.DEFAULT],T_=function(){function _(c,o,u,d,m,E){this.maxExtent_=c,this.overlaps_=d,this.pixelRatio_=u,this.resolution_=o,this.renderBuffer_=E,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=tn(),this.createExecutors_(m)}return _.prototype.clip=function(c,o){var u=this.getClipCoords(o);c.beginPath(),c.moveTo(u[0],u[1]),c.lineTo(u[2],u[3]),c.lineTo(u[4],u[5]),c.lineTo(u[6],u[7]),c.clip()},_.prototype.createExecutors_=function(c){for(var o in c){var u=this.executorsByZIndex_[o];u===void 0&&(u={},this.executorsByZIndex_[o]=u);var d=c[o];for(var m in d){var E=d[m];u[m]=new I_(this.resolution_,this.pixelRatio_,this.overlaps_,E)}}},_.prototype.hasExecutors=function(c){for(var o in this.executorsByZIndex_)for(var u=this.executorsByZIndex_[o],d=0,m=c.length;d<m;++d)if(c[d]in u)return!0;return!1},_.prototype.forEachFeatureAtCoordinate=function(c,o,u,d,m,E){d=Math.round(d);var C=d*2+1,w=rr(this.hitDetectionTransform_,d+.5,d+.5,1/o,-1/o,-u,-c[0],-c[1]),T=!this.hitDetectionContext_;T&&(this.hitDetectionContext_=Si(C,C));var A=this.hitDetectionContext_;A.canvas.width!==C||A.canvas.height!==C?(A.canvas.width=C,A.canvas.height=C):T||A.clearRect(0,0,C,C);var D;this.renderBuffer_!==void 0&&(D=is(),Lg(D,c),Na(D,o*(this.renderBuffer_+d),D));var F=S_(d),k;function N(ct,Et){for(var gt=A.getImageData(0,0,C,C).data,Rt=0,kt=F.length;Rt<kt;Rt++)if(gt[F[Rt]]>0){if(!E||k!==Jt.IMAGE&&k!==Jt.TEXT||E.indexOf(ct)!==-1){var zt=(F[Rt]-3)/4,At=d-zt%C,Pt=d-(zt/C|0),Kt=m(ct,Et,At*At+Pt*Pt);if(Kt)return Kt}A.clearRect(0,0,C,C);break}}var z=Object.keys(this.executorsByZIndex_).map(Number);z.sort(g);var H,tt,J,st,vt;for(H=z.length-1;H>=0;--H){var pt=z[H].toString();for(J=this.executorsByZIndex_[pt],tt=Ba.length-1;tt>=0;--tt)if(k=Ba[tt],st=J[k],st!==void 0&&(vt=st.executeHitDetection(A,w,u,N,D),vt))return vt}},_.prototype.getClipCoords=function(c){var o=this.maxExtent_;if(!o)return null;var u=o[0],d=o[1],m=o[2],E=o[3],C=[u,d,u,E,m,E,m,d];return Pn(C,0,8,2,c,C),C},_.prototype.isEmpty=function(){return M(this.executorsByZIndex_)},_.prototype.execute=function(c,o,u,d,m,E,C){var w=Object.keys(this.executorsByZIndex_).map(Number);w.sort(g),this.maxExtent_&&(c.save(),this.clip(c,u));var T=E||Ba,A,D,F,k,N,z;for(C&&w.reverse(),A=0,D=w.length;A<D;++A){var H=w[A].toString();for(N=this.executorsByZIndex_[H],F=0,k=T.length;F<k;++F){var tt=T[F];z=N[tt],z!==void 0&&z.execute(c,o,u,d,m,C)}}this.maxExtent_&&c.restore()},_}(),za={};function S_(_){if(za[_]!==void 0)return za[_];for(var c=_*2+1,o=_*_,u=new Array(o+1),d=0;d<=_;++d)for(var m=0;m<=_;++m){var E=d*d+m*m;if(E>o)break;var C=u[E];C||(C=[],u[E]=C),C.push(((_+d)*c+(_+m))*4+3),d>0&&C.push(((_-d)*c+(_+m))*4+3),m>0&&(C.push(((_+d)*c+(_-m))*4+3),d>0&&C.push(((_-d)*c+(_-m))*4+3))}for(var w=[],d=0,T=u.length;d<T;++d)u[d]&&w.push.apply(w,u[d]);return za[_]=w,w}var mc=T_,go={ANIMATING:0,INTERACTING:1},or={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},ar={};ar[or.RADIANS]=6370997/(2*Math.PI),ar[or.DEGREES]=2*Math.PI*6370997/360,ar[or.FEET]=.3048,ar[or.METERS]=1,ar[or.USFEET]=1200/3937;var Ua=or,A_=function(){function _(c){this.code_=c.code,this.units_=c.units,this.extent_=c.extent!==void 0?c.extent:null,this.worldExtent_=c.worldExtent!==void 0?c.worldExtent:null,this.axisOrientation_=c.axisOrientation!==void 0?c.axisOrientation:"enu",this.global_=c.global!==void 0?c.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=c.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=c.metersPerUnit}return _.prototype.canWrapX=function(){return this.canWrapX_},_.prototype.getCode=function(){return this.code_},_.prototype.getExtent=function(){return this.extent_},_.prototype.getUnits=function(){return this.units_},_.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ar[this.units_]},_.prototype.getWorldExtent=function(){return this.worldExtent_},_.prototype.getAxisOrientation=function(){return this.axisOrientation_},_.prototype.isGlobal=function(){return this.global_},_.prototype.setGlobal=function(c){this.global_=c,this.canWrapX_=!!(c&&this.extent_)},_.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},_.prototype.setDefaultTileGrid=function(c){this.defaultTileGrid_=c},_.prototype.setExtent=function(c){this.extent_=c,this.canWrapX_=!!(this.global_&&c)},_.prototype.setWorldExtent=function(c){this.worldExtent_=c},_.prototype.setGetPointResolution=function(c){this.getPointResolutionFunc_=c},_.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},_}(),yc=A_,L_=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),os=6378137,lr=Math.PI*os,O_=[-lr,-lr,lr,lr],M_=[-180,-85,180,85],_o=os*Math.log(Math.tan(Math.PI/2)),hr=function(_){L_(c,_);function c(o){return _.call(this,{code:o,units:Ua.METERS,extent:O_,global:!0,worldExtent:M_,getPointResolution:function(u,d){return u/ji(d[1]/os)}})||this}return c}(yc),vc=[new hr("EPSG:3857"),new hr("EPSG:102100"),new hr("EPSG:102113"),new hr("EPSG:900913"),new hr("http://www.opengis.net/def/crs/EPSG/0/3857"),new hr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function P_(_,c,o){var u=_.length,d=o>1?o:2,m=c;m===void 0&&(d>2?m=_.slice():m=new Array(u));for(var E=0;E<u;E+=d){m[E]=lr*_[E]/180;var C=os*Math.log(Math.tan(Math.PI*(+_[E+1]+90)/360));C>_o?C=_o:C<-_o&&(C=-_o),m[E+1]=C}return m}function D_(_,c,o){var u=_.length,d=o>1?o:2,m=c;m===void 0&&(d>2?m=_.slice():m=new Array(u));for(var E=0;E<u;E+=d)m[E]=180*_[E]/lr,m[E+1]=360*Math.atan(Math.exp(_[E+1]/os))/Math.PI-90;return m}var F_=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),b_=6378137,Ec=[-180,-90,180,90],G_=Math.PI*b_/180,Dn=function(_){F_(c,_);function c(o,u){return _.call(this,{code:o,units:Ua.DEGREES,extent:Ec,axisOrientation:u,global:!0,metersPerUnit:G_,worldExtent:Ec})||this}return c}(yc),xc=[new Dn("CRS:84"),new Dn("EPSG:4326","neu"),new Dn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Dn("urn:ogc:def:crs:OGC:2:84"),new Dn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Dn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Dn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],ja={};function k_(_){return ja[_]||ja[_.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function N_(_,c){ja[_]=c}var cr={};function po(_,c,o){var u=_.getCode(),d=c.getCode();u in cr||(cr[u]={}),cr[u][d]=o}function X_(_,c){var o;return _ in cr&&c in cr[_]&&(o=cr[_][c]),o}function Y_(_,c){if(c.canWrapX()){var o=Mn(c.getExtent()),u=W_(_,c,o);u&&(_[0]-=u*o)}return _}function W_(_,c,o){var u=c.getExtent(),d=0;if(c.canWrapX()&&(_[0]<u[0]||_[0]>u[2])){var m=o||Mn(u);d=Math.floor((_[0]-u[0])/m)}return d}var B_=63710088e-1;function as(_,c,o){var u=B_,d=hi(_[1]),m=hi(c[1]),E=(m-d)/2,C=hi(c[0]-_[0])/2,w=Math.sin(E)*Math.sin(E)+Math.sin(C)*Math.sin(C)*Math.cos(d)*Math.cos(m);return 2*u*Math.atan2(Math.sqrt(w),Math.sqrt(1-w))}function Cc(_,c,o){var u;if(c!==void 0){for(var d=0,m=_.length;d<m;++d)c[d]=_[d];u=c}else u=_.slice();return u}function z_(_,c,o){if(c!==void 0&&_!==c){for(var u=0,d=_.length;u<d;++u)c[u]=_[u];_=c}return _}function U_(_){N_(_.getCode(),_),po(_,_,Cc)}function j_(_){_.forEach(U_)}function mo(_){return typeof _=="string"?k_(_):_||null}function Rc(_){j_(_),_.forEach(function(c){_.forEach(function(o){c!==o&&po(c,o,Cc)})})}function V_(_,c,o,u){_.forEach(function(d){c.forEach(function(m){po(d,m,o),po(m,d,u)})})}function K_(_,c){var o=_.getCode(),u=c.getCode(),d=X_(o,u);return d||(d=z_),d}function Va(_,c){var o=mo(_),u=mo(c);return K_(o,u)}function wc(_,c,o){var u=Va(c,o);return u(_,void 0,_.length)}function Z_(_,c){return _}function H_(_,c){return _}function $_(){Rc(vc),Rc(xc),V_(xc,vc,P_,D_)}$_();var q_=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Ic=tn(),J_=function(_){q_(c,_);function c(){var o=_.call(this)||this;return o.extent_=is(),o.extentRevision_=-1,o.simplifiedGeometryMaxMinSquaredTolerance=0,o.simplifiedGeometryRevision=0,o.simplifyTransformedInternal=S(function(u,d,m){if(!m)return this.getSimplifiedGeometry(d);var E=this.clone();return E.applyTransform(m),E.getSimplifiedGeometry(d)}),o}return c.prototype.simplifyTransformed=function(o,u){return this.simplifyTransformedInternal(this.getRevision(),o,u)},c.prototype.clone=function(){return K()},c.prototype.closestPointXY=function(o,u,d,m){return K()},c.prototype.containsXY=function(o,u){var d=this.getClosestPoint([o,u]);return d[0]===o&&d[1]===u},c.prototype.getClosestPoint=function(o,u){var d=u||[NaN,NaN];return this.closestPointXY(o[0],o[1],d,1/0),d},c.prototype.intersectsCoordinate=function(o){return this.containsXY(o[0],o[1])},c.prototype.computeExtent=function(o){return K()},c.prototype.getExtent=function(o){if(this.extentRevision_!=this.getRevision()){var u=this.computeExtent(this.extent_);(isNaN(u[0])||isNaN(u[1]))&&lc(u),this.extentRevision_=this.getRevision()}return Gg(this.extent_,o)},c.prototype.rotate=function(o,u){K()},c.prototype.scale=function(o,u,d){K()},c.prototype.simplify=function(o){return this.getSimplifiedGeometry(o*o)},c.prototype.getSimplifiedGeometry=function(o){return K()},c.prototype.getType=function(){return K()},c.prototype.applyTransform=function(o){K()},c.prototype.intersectsExtent=function(o){return K()},c.prototype.translate=function(o,u){K()},c.prototype.transform=function(o,u){var d=mo(o),m=d.getUnits()==Ua.TILE_PIXELS?function(E,C,w){var T=d.getExtent(),A=d.getWorldExtent(),D=uo(A)/uo(T);return rr(Ic,A[0],A[3],D,-D,0,0,0),Pn(E,0,E.length,w,Ic,C),Va(d,u)(E,C,w)}:Va(d,u);return this.applyTransform(m),this},c}(ot),Q_=J_,Mi={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},tp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),ep=function(_){tp(c,_);function c(){var o=_.call(this)||this;return o.layout=Mi.XY,o.stride=2,o.flatCoordinates=null,o}return c.prototype.computeExtent=function(o){return Ag(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,o)},c.prototype.getCoordinates=function(){return K()},c.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},c.prototype.getFlatCoordinates=function(){return this.flatCoordinates},c.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},c.prototype.getLayout=function(){return this.layout},c.prototype.getSimplifiedGeometry=function(o){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),o<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&o<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var u=this.getSimplifiedGeometryInternal(o),d=u.getFlatCoordinates();return d.length<this.flatCoordinates.length?u:(this.simplifiedGeometryMaxMinSquaredTolerance=o,this)},c.prototype.getSimplifiedGeometryInternal=function(o){return this},c.prototype.getStride=function(){return this.stride},c.prototype.setFlatCoordinates=function(o,u){this.stride=Tc(o),this.layout=o,this.flatCoordinates=u},c.prototype.setCoordinates=function(o,u){K()},c.prototype.setLayout=function(o,u,d){var m;if(o)m=Tc(o);else{for(var E=0;E<d;++E)if(u.length===0){this.layout=Mi.XY,this.stride=2;return}else u=u[0];m=u.length,o=ip(m)}this.layout=o,this.stride=m},c.prototype.applyTransform=function(o){this.flatCoordinates&&(o(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},c.prototype.rotate=function(o,u){var d=this.getFlatCoordinates();if(d){var m=this.getStride();gc(d,0,d.length,m,o,u,d),this.changed()}},c.prototype.scale=function(o,u,d){var m=u;m===void 0&&(m=o);var E=d;E||(E=Ya(this.getExtent()));var C=this.getFlatCoordinates();if(C){var w=this.getStride();y_(C,0,C.length,w,o,m,E,C),this.changed()}},c.prototype.translate=function(o,u){var d=this.getFlatCoordinates();if(d){var m=this.getStride();v_(d,0,d.length,m,o,u,d),this.changed()}},c}(Q_);function ip(_){var c;return _==2?c=Mi.XY:_==3?c=Mi.XYZ:_==4&&(c=Mi.XYZM),c}function Tc(_){var c;return _==Mi.XY?c=2:_==Mi.XYZ||_==Mi.XYM?c=3:_==Mi.XYZM&&(c=4),c}function np(_,c,o){var u=_.getFlatCoordinates();if(u){var d=_.getStride();return Pn(u,0,u.length,d,c,o)}else return null}var Sc=ep,rp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),sp=function(_){rp(c,_);function c(o,u,d,m,E,C,w){var T=_.call(this)||this;return T.context_=o,T.pixelRatio_=u,T.extent_=d,T.transform_=m,T.viewRotation_=E,T.squaredTolerance_=C,T.userTransform_=w,T.contextFillState_=null,T.contextStrokeState_=null,T.contextTextState_=null,T.fillState_=null,T.strokeState_=null,T.image_=null,T.imageAnchorX_=0,T.imageAnchorY_=0,T.imageHeight_=0,T.imageOpacity_=0,T.imageOriginX_=0,T.imageOriginY_=0,T.imageRotateWithView_=!1,T.imageRotation_=0,T.imageScale_=[0,0],T.imageWidth_=0,T.text_="",T.textOffsetX_=0,T.textOffsetY_=0,T.textRotateWithView_=!1,T.textRotation_=0,T.textScale_=[0,0],T.textFillState_=null,T.textStrokeState_=null,T.textState_=null,T.pixelCoordinates_=[],T.tmpLocalTransform_=tn(),T}return c.prototype.drawImages_=function(o,u,d,m){if(this.image_){var E=Pn(o,u,d,m,this.transform_,this.pixelCoordinates_),C=this.context_,w=this.tmpLocalTransform_,T=C.globalAlpha;this.imageOpacity_!=1&&(C.globalAlpha=T*this.imageOpacity_);var A=this.imageRotation_;this.imageRotateWithView_&&(A+=this.viewRotation_);for(var D=0,F=E.length;D<F;D+=2){var k=E[D]-this.imageAnchorX_,N=E[D+1]-this.imageAnchorY_;if(A!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var z=k+this.imageAnchorX_,H=N+this.imageAnchorY_;rr(w,z,H,1,1,A,-z,-H),C.setTransform.apply(C,w),C.translate(z,H),C.scale(this.imageScale_[0],this.imageScale_[1]),C.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),C.setTransform(1,0,0,1,0,0)}else C.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,k,N,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(C.globalAlpha=T)}},c.prototype.drawText_=function(o,u,d,m){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var E=Pn(o,u,d,m,this.transform_,this.pixelCoordinates_),C=this.context_,w=this.textRotation_;for(this.textRotateWithView_&&(w+=this.viewRotation_);u<d;u+=m){var T=E[u]+this.textOffsetX_,A=E[u+1]+this.textOffsetY_;if(w!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var D=rr(this.tmpLocalTransform_,T,A,1,1,w,-T,-A);C.setTransform.apply(C,D),C.translate(T,A),C.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&C.strokeText(this.text_,0,0),this.textFillState_&&C.fillText(this.text_,0,0),C.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&C.strokeText(this.text_,T,A),this.textFillState_&&C.fillText(this.text_,T,A)}}},c.prototype.moveToLineTo_=function(o,u,d,m,E){var C=this.context_,w=Pn(o,u,d,m,this.transform_,this.pixelCoordinates_);C.moveTo(w[0],w[1]);var T=w.length;E&&(T-=2);for(var A=2;A<T;A+=2)C.lineTo(w[A],w[A+1]);return E&&C.closePath(),d},c.prototype.drawRings_=function(o,u,d,m){for(var E=0,C=d.length;E<C;++E)u=this.moveToLineTo_(o,u,d[E],m,!0);return u},c.prototype.drawCircle=function(o){if(ui(this.extent_,o.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var u=np(o,this.transform_,this.pixelCoordinates_),d=u[2]-u[0],m=u[3]-u[1],E=Math.sqrt(d*d+m*m),C=this.context_;C.beginPath(),C.arc(u[0],u[1],E,0,2*Math.PI),this.fillState_&&C.fill(),this.strokeState_&&C.stroke()}this.text_!==""&&this.drawText_(o.getCenter(),0,2,2)}},c.prototype.setStyle=function(o){this.setFillStrokeStyle(o.getFill(),o.getStroke()),this.setImageStyle(o.getImage()),this.setTextStyle(o.getText())},c.prototype.setTransform=function(o){this.transform_=o},c.prototype.drawGeometry=function(o){var u=o.getType();switch(u){case St.POINT:this.drawPoint(o);break;case St.LINE_STRING:this.drawLineString(o);break;case St.POLYGON:this.drawPolygon(o);break;case St.MULTI_POINT:this.drawMultiPoint(o);break;case St.MULTI_LINE_STRING:this.drawMultiLineString(o);break;case St.MULTI_POLYGON:this.drawMultiPolygon(o);break;case St.GEOMETRY_COLLECTION:this.drawGeometryCollection(o);break;case St.CIRCLE:this.drawCircle(o);break}},c.prototype.drawFeature=function(o,u){var d=u.getGeometryFunction()(o);!d||!ui(this.extent_,d.getExtent())||(this.setStyle(u),this.drawGeometry(d))},c.prototype.drawGeometryCollection=function(o){for(var u=o.getGeometriesArray(),d=0,m=u.length;d<m;++d)this.drawGeometry(u[d])},c.prototype.drawPoint=function(o){this.squaredTolerance_&&(o=o.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var u=o.getFlatCoordinates(),d=o.getStride();this.image_&&this.drawImages_(u,0,u.length,d),this.text_!==""&&this.drawText_(u,0,u.length,d)},c.prototype.drawMultiPoint=function(o){this.squaredTolerance_&&(o=o.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var u=o.getFlatCoordinates(),d=o.getStride();this.image_&&this.drawImages_(u,0,u.length,d),this.text_!==""&&this.drawText_(u,0,u.length,d)},c.prototype.drawLineString=function(o){if(this.squaredTolerance_&&(o=o.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ui(this.extent_,o.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var u=this.context_,d=o.getFlatCoordinates();u.beginPath(),this.moveToLineTo_(d,0,d.length,o.getStride(),!1),u.stroke()}if(this.text_!==""){var m=o.getFlatMidpoint();this.drawText_(m,0,2,2)}}},c.prototype.drawMultiLineString=function(o){this.squaredTolerance_&&(o=o.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var u=o.getExtent();if(ui(this.extent_,u)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var d=this.context_,m=o.getFlatCoordinates(),E=0,C=o.getEnds(),w=o.getStride();d.beginPath();for(var T=0,A=C.length;T<A;++T)E=this.moveToLineTo_(m,E,C[T],w,!1);d.stroke()}if(this.text_!==""){var D=o.getFlatMidpoints();this.drawText_(D,0,D.length,2)}}},c.prototype.drawPolygon=function(o){if(this.squaredTolerance_&&(o=o.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ui(this.extent_,o.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var u=this.context_;u.beginPath(),this.drawRings_(o.getOrientedFlatCoordinates(),0,o.getEnds(),o.getStride()),this.fillState_&&u.fill(),this.strokeState_&&u.stroke()}if(this.text_!==""){var d=o.getFlatInteriorPoint();this.drawText_(d,0,2,2)}}},c.prototype.drawMultiPolygon=function(o){if(this.squaredTolerance_&&(o=o.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ui(this.extent_,o.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var u=this.context_,d=o.getOrientedFlatCoordinates(),m=0,E=o.getEndss(),C=o.getStride();u.beginPath();for(var w=0,T=E.length;w<T;++w){var A=E[w];m=this.drawRings_(d,m,A,C)}this.fillState_&&u.fill(),this.strokeState_&&u.stroke()}if(this.text_!==""){var D=o.getFlatInteriorPoints();this.drawText_(D,0,D.length,2)}}},c.prototype.setContextFillState_=function(o){var u=this.context_,d=this.contextFillState_;d?d.fillStyle!=o.fillStyle&&(d.fillStyle=o.fillStyle,u.fillStyle=o.fillStyle):(u.fillStyle=o.fillStyle,this.contextFillState_={fillStyle:o.fillStyle})},c.prototype.setContextStrokeState_=function(o){var u=this.context_,d=this.contextStrokeState_;d?(d.lineCap!=o.lineCap&&(d.lineCap=o.lineCap,u.lineCap=o.lineCap),u.setLineDash&&(v(d.lineDash,o.lineDash)||u.setLineDash(d.lineDash=o.lineDash),d.lineDashOffset!=o.lineDashOffset&&(d.lineDashOffset=o.lineDashOffset,u.lineDashOffset=o.lineDashOffset)),d.lineJoin!=o.lineJoin&&(d.lineJoin=o.lineJoin,u.lineJoin=o.lineJoin),d.lineWidth!=o.lineWidth&&(d.lineWidth=o.lineWidth,u.lineWidth=o.lineWidth),d.miterLimit!=o.miterLimit&&(d.miterLimit=o.miterLimit,u.miterLimit=o.miterLimit),d.strokeStyle!=o.strokeStyle&&(d.strokeStyle=o.strokeStyle,u.strokeStyle=o.strokeStyle)):(u.lineCap=o.lineCap,u.setLineDash&&(u.setLineDash(o.lineDash),u.lineDashOffset=o.lineDashOffset),u.lineJoin=o.lineJoin,u.lineWidth=o.lineWidth,u.miterLimit=o.miterLimit,u.strokeStyle=o.strokeStyle,this.contextStrokeState_={lineCap:o.lineCap,lineDash:o.lineDash,lineDashOffset:o.lineDashOffset,lineJoin:o.lineJoin,lineWidth:o.lineWidth,miterLimit:o.miterLimit,strokeStyle:o.strokeStyle})},c.prototype.setContextTextState_=function(o){var u=this.context_,d=this.contextTextState_,m=o.textAlign?o.textAlign:Jr;d?(d.font!=o.font&&(d.font=o.font,u.font=o.font),d.textAlign!=m&&(d.textAlign=m,u.textAlign=m),d.textBaseline!=o.textBaseline&&(d.textBaseline=o.textBaseline,u.textBaseline=o.textBaseline)):(u.font=o.font,u.textAlign=m,u.textBaseline=o.textBaseline,this.contextTextState_={font:o.font,textAlign:m,textBaseline:o.textBaseline})},c.prototype.setFillStrokeStyle=function(o,u){var d=this;if(!o)this.fillState_=null;else{var m=o.getColor();this.fillState_={fillStyle:Ue(m||Ai)}}if(!u)this.strokeState_=null;else{var E=u.getColor(),C=u.getLineCap(),w=u.getLineDash(),T=u.getLineDashOffset(),A=u.getLineJoin(),D=u.getWidth(),F=u.getMiterLimit(),k=w||Zr;this.strokeState_={lineCap:C!==void 0?C:ao,lineDash:this.pixelRatio_===1?k:k.map(function(N){return N*d.pixelRatio_}),lineDashOffset:(T||Hr)*this.pixelRatio_,lineJoin:A!==void 0?A:er,lineWidth:(D!==void 0?D:Qr)*this.pixelRatio_,miterLimit:F!==void 0?F:$r,strokeStyle:Ue(E||qr)}}},c.prototype.setImageStyle=function(o){var u;if(!o||!(u=o.getSize())){this.image_=null;return}var d=o.getAnchor(),m=o.getOrigin();this.image_=o.getImage(this.pixelRatio_),this.imageAnchorX_=d[0]*this.pixelRatio_,this.imageAnchorY_=d[1]*this.pixelRatio_,this.imageHeight_=u[1]*this.pixelRatio_,this.imageOpacity_=o.getOpacity(),this.imageOriginX_=m[0],this.imageOriginY_=m[1],this.imageRotateWithView_=o.getRotateWithView(),this.imageRotation_=o.getRotation(),this.imageScale_=o.getScaleArray(),this.imageWidth_=u[0]*this.pixelRatio_},c.prototype.setTextStyle=function(o){if(!o)this.text_="";else{var u=o.getFill();if(!u)this.textFillState_=null;else{var d=u.getColor();this.textFillState_={fillStyle:Ue(d||Ai)}}var m=o.getStroke();if(!m)this.textStrokeState_=null;else{var E=m.getColor(),C=m.getLineCap(),w=m.getLineDash(),T=m.getLineDashOffset(),A=m.getLineJoin(),D=m.getWidth(),F=m.getMiterLimit();this.textStrokeState_={lineCap:C!==void 0?C:ao,lineDash:w||Zr,lineDashOffset:T||Hr,lineJoin:A!==void 0?A:er,lineWidth:D!==void 0?D:Qr,miterLimit:F!==void 0?F:$r,strokeStyle:Ue(E||qr)}}var k=o.getFont(),N=o.getOffsetX(),z=o.getOffsetY(),H=o.getRotateWithView(),tt=o.getRotation(),J=o.getScaleArray(),st=o.getText(),vt=o.getTextAlign(),pt=o.getTextBaseline();this.textState_={font:k!==void 0?k:tc,textAlign:vt!==void 0?vt:Jr,textBaseline:pt!==void 0?pt:lo},this.text_=st!==void 0?Array.isArray(st)?st.reduce(function(ct,Et,gt){return ct+=gt%2?" ":Et},""):st:"",this.textOffsetX_=N!==void 0?this.pixelRatio_*N:0,this.textOffsetY_=z!==void 0?this.pixelRatio_*z:0,this.textRotateWithView_=H!==void 0?H:!1,this.textRotation_=tt!==void 0?tt:0,this.textScale_=[this.pixelRatio_*J[0],this.pixelRatio_*J[1]]}},c}(oc),op=sp,rn={FRACTION:"fraction",PIXELS:"pixels"},je={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},ap=function(){function _(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return _.prototype.clear=function(){this.cache_={},this.cacheSize_=0},_.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},_.prototype.expire=function(){if(this.canExpireCache()){var c=0;for(var o in this.cache_){var u=this.cache_[o];(c++&3)===0&&!u.hasListener()&&(delete this.cache_[o],--this.cacheSize_)}}},_.prototype.get=function(c,o,u){var d=Ac(c,o,u);return d in this.cache_?this.cache_[d]:null},_.prototype.set=function(c,o,u,d){var m=Ac(c,o,u);this.cache_[m]=d,++this.cacheSize_},_.prototype.setSize=function(c){this.maxCacheSize_=c,this.expire()},_}();function Ac(_,c,o){var u=o?be(o):"null";return c+":"+_+":"+u}var Lc=new ap,lp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),hp=function(_){lp(c,_);function c(o,u,d,m){var E=_.call(this)||this;return E.extent=o,E.pixelRatio_=d,E.resolution=u,E.state=m,E}return c.prototype.changed=function(){this.dispatchEvent(G.CHANGE)},c.prototype.getExtent=function(){return this.extent},c.prototype.getImage=function(){return K()},c.prototype.getPixelRatio=function(){return this.pixelRatio_},c.prototype.getResolution=function(){return this.resolution},c.prototype.getState=function(){return this.state},c.prototype.load=function(){K()},c}(b),cp=hp,up=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}();(function(_){up(c,_);function c(o,u,d,m,E,C){var w=_.call(this,o,u,d,Ft.IDLE)||this;return w.src_=m,w.image_=new Image,E!==null&&(w.image_.crossOrigin=E),w.unlisten_=null,w.state=Ft.IDLE,w.imageLoadFunction_=C,w}return c.prototype.getImage=function(){return this.image_},c.prototype.handleImageError_=function(){this.state=Ft.ERROR,this.unlistenImage_(),this.changed()},c.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=uo(this.extent)/this.image_.height),this.state=Ft.LOADED,this.unlistenImage_(),this.changed()},c.prototype.load=function(){(this.state==Ft.IDLE||this.state==Ft.ERROR)&&(this.state=Ft.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Oc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},c.prototype.setImage=function(o){this.image_=o,this.resolution=uo(this.extent)/this.image_.height},c.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},c})(cp);function Oc(_,c,o){var u=_,d=!0,m=!1,E=!1,C=[j(u,G.LOAD,function(){E=!0,m||c()})];return u.src&&Jd?(m=!0,u.decode().then(function(){d&&c()}).catch(function(w){d&&(E?c():o())})):C.push(j(u,G.ERROR,o)),function(){d=!1,C.forEach(Y)}}var fp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),ls=null,dp=function(_){fp(c,_);function c(o,u,d,m,E,C){var w=_.call(this)||this;return w.hitDetectionImage_=null,w.image_=o||new Image,m!==null&&(w.image_.crossOrigin=m),w.canvas_={},w.color_=C,w.unlisten_=null,w.imageState_=E,w.size_=d,w.src_=u,w.tainted_,w}return c.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===Ft.LOADED){ls||(ls=Si(1,1)),ls.drawImage(this.image_,0,0);try{ls.getImageData(0,0,1,1),this.tainted_=!1}catch{ls=null,this.tainted_=!0}}return this.tainted_===!0},c.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(G.CHANGE)},c.prototype.handleImageError_=function(){this.imageState_=Ft.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},c.prototype.handleImageLoad_=function(){this.imageState_=Ft.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},c.prototype.getImage=function(o){return this.replaceColor_(o),this.canvas_[o]?this.canvas_[o]:this.image_},c.prototype.getPixelRatio=function(o){return this.replaceColor_(o),this.canvas_[o]?o:1},c.prototype.getImageState=function(){return this.imageState_},c.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var o=this.size_[0],u=this.size_[1],d=Si(o,u);d.fillRect(0,0,o,u),this.hitDetectionImage_=d.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},c.prototype.getSize=function(){return this.size_},c.prototype.getSrc=function(){return this.src_},c.prototype.load=function(){if(this.imageState_==Ft.IDLE){this.imageState_=Ft.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Oc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},c.prototype.replaceColor_=function(o){if(!(!this.color_||this.canvas_[o]||this.imageState_!==Ft.LOADED)){var u=document.createElement("canvas");this.canvas_[o]=u,u.width=Math.ceil(this.image_.width*o),u.height=Math.ceil(this.image_.height*o);var d=u.getContext("2d");if(d.scale(o,o),d.drawImage(this.image_,0,0),d.globalCompositeOperation="multiply",d.globalCompositeOperation==="multiply"||this.isTainted_())d.fillStyle=be(this.color_),d.fillRect(0,0,u.width/o,u.height/o),d.globalCompositeOperation="destination-in",d.drawImage(this.image_,0,0);else{for(var m=d.getImageData(0,0,u.width,u.height),E=m.data,C=this.color_[0]/255,w=this.color_[1]/255,T=this.color_[2]/255,A=this.color_[3],D=0,F=E.length;D<F;D+=4)E[D]*=C,E[D+1]*=w,E[D+2]*=T,E[D+3]*=A;d.putImageData(m,0,0)}}},c.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},c}(b);function gp(_,c,o,u,d,m){var E=Lc.get(c,u,m);return E||(E=new dp(_,c,o,u,d,m),Lc.set(c,u,m,E)),E}var _p=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),pp=function(_){_p(c,_);function c(o){var u=this,d=o||{},m=d.opacity!==void 0?d.opacity:1,E=d.rotation!==void 0?d.rotation:0,C=d.scale!==void 0?d.scale:1,w=d.rotateWithView!==void 0?d.rotateWithView:!1;u=_.call(this,{opacity:m,rotation:E,scale:C,displacement:d.displacement!==void 0?d.displacement:[0,0],rotateWithView:w})||this,u.anchor_=d.anchor!==void 0?d.anchor:[.5,.5],u.normalizedAnchor_=null,u.anchorOrigin_=d.anchorOrigin!==void 0?d.anchorOrigin:je.TOP_LEFT,u.anchorXUnits_=d.anchorXUnits!==void 0?d.anchorXUnits:rn.FRACTION,u.anchorYUnits_=d.anchorYUnits!==void 0?d.anchorYUnits:rn.FRACTION,u.crossOrigin_=d.crossOrigin!==void 0?d.crossOrigin:null;var T=d.img!==void 0?d.img:null;u.imgSize_=d.imgSize;var A=d.src;qt(!(A!==void 0&&T),4),qt(!T||T&&u.imgSize_,5),(A===void 0||A.length===0)&&T&&(A=T.src||et(T)),qt(A!==void 0&&A.length>0,6);var D=d.src!==void 0?Ft.IDLE:Ft.LOADED;return u.color_=d.color!==void 0?Se(d.color):null,u.iconImage_=gp(T,A,u.imgSize_!==void 0?u.imgSize_:null,u.crossOrigin_,D,u.color_),u.offset_=d.offset!==void 0?d.offset:[0,0],u.offsetOrigin_=d.offsetOrigin!==void 0?d.offsetOrigin:je.TOP_LEFT,u.origin_=null,u.size_=d.size!==void 0?d.size:null,u}return c.prototype.clone=function(){var o=this.getScale();return new c({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(o)?o.slice():o,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc()})},c.prototype.getAnchor=function(){var o=this.normalizedAnchor_;if(!o){o=this.anchor_;var u=this.getSize();if(this.anchorXUnits_==rn.FRACTION||this.anchorYUnits_==rn.FRACTION){if(!u)return null;o=this.anchor_.slice(),this.anchorXUnits_==rn.FRACTION&&(o[0]*=u[0]),this.anchorYUnits_==rn.FRACTION&&(o[1]*=u[1])}if(this.anchorOrigin_!=je.TOP_LEFT){if(!u)return null;o===this.anchor_&&(o=this.anchor_.slice()),(this.anchorOrigin_==je.TOP_RIGHT||this.anchorOrigin_==je.BOTTOM_RIGHT)&&(o[0]=-o[0]+u[0]),(this.anchorOrigin_==je.BOTTOM_LEFT||this.anchorOrigin_==je.BOTTOM_RIGHT)&&(o[1]=-o[1]+u[1])}this.normalizedAnchor_=o}var d=this.getDisplacement();return[o[0]-d[0],o[1]+d[1]]},c.prototype.setAnchor=function(o){this.anchor_=o,this.normalizedAnchor_=null},c.prototype.getColor=function(){return this.color_},c.prototype.getImage=function(o){return this.iconImage_.getImage(o)},c.prototype.getPixelRatio=function(o){return this.iconImage_.getPixelRatio(o)},c.prototype.getImageSize=function(){return this.iconImage_.getSize()},c.prototype.getImageState=function(){return this.iconImage_.getImageState()},c.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},c.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var o=this.offset_;if(this.offsetOrigin_!=je.TOP_LEFT){var u=this.getSize(),d=this.iconImage_.getSize();if(!u||!d)return null;o=o.slice(),(this.offsetOrigin_==je.TOP_RIGHT||this.offsetOrigin_==je.BOTTOM_RIGHT)&&(o[0]=d[0]-u[0]-o[0]),(this.offsetOrigin_==je.BOTTOM_LEFT||this.offsetOrigin_==je.BOTTOM_RIGHT)&&(o[1]=d[1]-u[1]-o[1])}return this.origin_=o,this.origin_},c.prototype.getSrc=function(){return this.iconImage_.getSrc()},c.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},c.prototype.listenImageChange=function(o){this.iconImage_.addEventListener(G.CHANGE,o)},c.prototype.load=function(){this.iconImage_.load()},c.prototype.unlistenImageChange=function(o){this.iconImage_.removeEventListener(G.CHANGE,o)},c}(xe),mp=pp,fi=.5;function yp(_,c,o,u,d,m,E){var C=_[0]*fi,w=_[1]*fi,T=Si(C,w);T.imageSmoothingEnabled=!1;for(var A=T.canvas,D=new op(T,fi,d,null,E),F=o.length,k=Math.floor((256*256*256-1)/F),N={},z=1;z<=F;++z){var H=o[z-1],tt=H.getStyleFunction()||u;if(u){var J=tt(H,m);if(J){Array.isArray(J)||(J=[J]);for(var st=z*k,vt="#"+("000000"+st.toString(16)).slice(-6),pt=0,ct=J.length;pt<ct;++pt){var Et=J[pt],gt=Et.getGeometryFunction()(H);if(!(!gt||!ui(d,gt.getExtent()))){var Rt=Et.clone(),kt=Rt.getFill();kt&&kt.setColor(vt);var zt=Rt.getStroke();zt&&(zt.setColor(vt),zt.setLineDash(null)),Rt.setText(void 0);var At=Et.getImage();if(At&&At.getOpacity()!==0){var Pt=At.getImageSize();if(!Pt)continue;var Kt=Si(Pt[0],Pt[1],void 0,{alpha:!1}),oe=Kt.canvas;Kt.fillStyle=vt,Kt.fillRect(0,0,oe.width,oe.height),Rt.setImage(new mp({img:oe,imgSize:Pt,anchor:At.getAnchor(),anchorXUnits:rn.PIXELS,anchorYUnits:rn.PIXELS,offset:At.getOrigin(),opacity:1,size:At.getSize(),scale:At.getScale(),rotation:At.getRotation(),rotateWithView:At.getRotateWithView()}))}var ie=Rt.getZIndex()||0,bt=N[ie];bt||(bt={},N[ie]=bt,bt[St.POLYGON]=[],bt[St.CIRCLE]=[],bt[St.LINE_STRING]=[],bt[St.POINT]=[]),bt[gt.getType().replace("Multi","")].push(gt,Rt)}}}}}for(var Qt=Object.keys(N).map(Number).sort(g),z=0,Yt=Qt.length;z<Yt;++z){var bt=N[Qt[z]];for(var Ut in bt)for(var le=bt[Ut],pt=0,ct=le.length;pt<ct;pt+=2){D.setStyle(le[pt+1]);for(var Q=0,Ae=c.length;Q<Ae;++Q)D.setTransform(c[Q]),D.drawGeometry(le[pt])}}return T.getImageData(0,0,A.width,A.height)}function vp(_,c,o){var u=[];if(o){var d=Math.floor(Math.round(_[0])*fi),m=Math.floor(Math.round(_[1])*fi),E=(Bt(d,0,o.width-1)+Bt(m,0,o.height-1)*o.width)*4,C=o.data[E],w=o.data[E+1],T=o.data[E+2],A=T+256*(w+256*C),D=Math.floor((256*256*256-1)/c.length);A&&A%D===0&&u.push(c[A/D-1])}return u}var Ep=.5,Mc={Point:Lp,LineString:Tp,Polygon:Mp,MultiPoint:Op,MultiLineString:Sp,MultiPolygon:Ap,GeometryCollection:Ip,Circle:Rp};function xp(_,c){return parseInt(et(_),10)-parseInt(et(c),10)}function Cp(_,c){var o=Ka(_,c);return o*o}function Ka(_,c){return Ep*_/c}function Rp(_,c,o,u,d){var m=o.getFill(),E=o.getStroke();if(m||E){var C=_.getBuilder(o.getZIndex(),Jt.CIRCLE);C.setFillStrokeStyle(m,E),C.drawCircle(c,u)}var w=o.getText();if(w&&w.getText()){var T=(d||_).getBuilder(o.getZIndex(),Jt.TEXT);T.setTextStyle(w),T.drawText(c,u)}}function Pc(_,c,o,u,d,m,E){var C=!1,w=o.getImage();if(w){var T=w.getImageState();T==Ft.LOADED||T==Ft.ERROR?w.unlistenImageChange(d):(T==Ft.IDLE&&w.load(),T=w.getImageState(),w.listenImageChange(d),C=!0)}return wp(_,c,o,u,m,E),C}function wp(_,c,o,u,d,m){var E=o.getGeometryFunction()(c);if(E){var C=E.simplifyTransformed(u,d),w=o.getRenderer();if(w)Dc(_,C,o,c);else{var T=Mc[C.getType()];T(_,C,o,c,m)}}}function Dc(_,c,o,u){if(c.getType()==St.GEOMETRY_COLLECTION){for(var d=c.getGeometries(),m=0,E=d.length;m<E;++m)Dc(_,d[m],o,u);return}var C=_.getBuilder(o.getZIndex(),Jt.DEFAULT);C.drawCustom(c,u,o.getRenderer(),o.getHitDetectionRenderer())}function Ip(_,c,o,u,d){var m=c.getGeometriesArray(),E,C;for(E=0,C=m.length;E<C;++E){var w=Mc[m[E].getType()];w(_,m[E],o,u,d)}}function Tp(_,c,o,u,d){var m=o.getStroke();if(m){var E=_.getBuilder(o.getZIndex(),Jt.LINE_STRING);E.setFillStrokeStyle(null,m),E.drawLineString(c,u)}var C=o.getText();if(C&&C.getText()){var w=(d||_).getBuilder(o.getZIndex(),Jt.TEXT);w.setTextStyle(C),w.drawText(c,u)}}function Sp(_,c,o,u,d){var m=o.getStroke();if(m){var E=_.getBuilder(o.getZIndex(),Jt.LINE_STRING);E.setFillStrokeStyle(null,m),E.drawMultiLineString(c,u)}var C=o.getText();if(C&&C.getText()){var w=(d||_).getBuilder(o.getZIndex(),Jt.TEXT);w.setTextStyle(C),w.drawText(c,u)}}function Ap(_,c,o,u,d){var m=o.getFill(),E=o.getStroke();if(E||m){var C=_.getBuilder(o.getZIndex(),Jt.POLYGON);C.setFillStrokeStyle(m,E),C.drawMultiPolygon(c,u)}var w=o.getText();if(w&&w.getText()){var T=(d||_).getBuilder(o.getZIndex(),Jt.TEXT);T.setTextStyle(w),T.drawText(c,u)}}function Lp(_,c,o,u,d){var m=o.getImage(),E=o.getText(),C;if(d&&(_=d,C=m&&E&&E.getText()?{}:void 0),m){if(m.getImageState()!=Ft.LOADED)return;var w=_.getBuilder(o.getZIndex(),Jt.IMAGE);w.setImageStyle(m,C),w.drawPoint(c,u)}if(E&&E.getText()){var T=_.getBuilder(o.getZIndex(),Jt.TEXT);T.setTextStyle(E,C),T.drawText(c,u)}}function Op(_,c,o,u,d){var m=o.getImage(),E=o.getText(),C;if(d&&(_=d,C=m&&E&&E.getText()?{}:void 0),m){if(m.getImageState()!=Ft.LOADED)return;var w=_.getBuilder(o.getZIndex(),Jt.IMAGE);w.setImageStyle(m,C),w.drawMultiPoint(c,u)}if(E&&E.getText()){var T=(d||_).getBuilder(o.getZIndex(),Jt.TEXT);T.setTextStyle(E,C),T.drawText(c,u)}}function Mp(_,c,o,u,d){var m=o.getFill(),E=o.getStroke();if(m||E){var C=_.getBuilder(o.getZIndex(),Jt.POLYGON);C.setFillStrokeStyle(m,E),C.drawPolygon(c,u)}var w=o.getText();if(w&&w.getText()){var T=(d||_).getBuilder(o.getZIndex(),Jt.TEXT);T.setTextStyle(w),T.drawText(c,u)}}var Pp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Dp=function(_){Pp(c,_);function c(o){var u=_.call(this,o)||this;return u.boundHandleStyleImageChange_=u.handleStyleImageChange_.bind(u),u.animatingOrInteracting_,u.dirty_=!1,u.hitDetectionImageData_=null,u.renderedFeatures_=null,u.renderedRevision_=-1,u.renderedResolution_=NaN,u.renderedExtent_=is(),u.wrappedRenderedExtent_=is(),u.renderedRotation_,u.renderedCenter_=null,u.renderedProjection_=null,u.renderedRenderOrder_=null,u.replayGroup_=null,u.replayGroupChanged=!0,u.declutterExecutorGroup=null,u.clipping=!0,u}return c.prototype.renderWorlds=function(o,u,d){var m=u.extent,E=u.viewState,C=E.center,w=E.resolution,T=E.projection,A=E.rotation,D=T.getExtent(),F=this.getLayer().getSource(),k=u.pixelRatio,N=u.viewHints,z=!(N[go.ANIMATING]||N[go.INTERACTING]),H=this.context,tt=Math.round(u.size[0]*k),J=Math.round(u.size[1]*k),st=F.getWrapX()&&T.canWrapX(),vt=st?Mn(D):null,pt=st?Math.ceil((m[2]-D[2])/vt)+1:1,ct=st?Math.floor((m[0]-D[0])/vt):0;do{var Et=this.getRenderTransform(C,w,A,k,tt,J,ct*vt);o.execute(H,1,Et,A,z,void 0,d)}while(++ct<pt)},c.prototype.renderDeclutter=function(o){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,o,o.declutterTree)},c.prototype.renderFrame=function(o,u){var d=o.pixelRatio,m=o.layerStatesArray[o.layerIndex];c_(this.pixelTransform,1/d,1/d),u_(this.inversePixelTransform,this.pixelTransform);var E=d_(this.pixelTransform);this.useContainer(u,E,m.opacity,this.getBackground(o));var C=this.context,w=C.canvas,T=this.replayGroup_,A=this.declutterExecutorGroup;if((!T||T.isEmpty())&&(!A||A.isEmpty()))return null;var D=Math.round(o.size[0]*d),F=Math.round(o.size[1]*d);w.width!=D||w.height!=F?(w.width=D,w.height=F,w.style.transform!==E&&(w.style.transform=E)):this.containerReused||C.clearRect(0,0,D,F),this.preRender(C,o);var k=o.viewState;k.projection;var N=!1,z=!0;if(m.extent&&this.clipping){var H=H_(m.extent);z=ui(H,o.extent),N=z&&!es(H,o.extent),N&&this.clipUnrotated(C,o,H)}z&&this.renderWorlds(T,o),N&&C.restore(),this.postRender(C,o);var tt=tg(m.opacity),J=this.container;return tt!==J.style.opacity&&(J.style.opacity=tt),this.renderedRotation_!==k.rotation&&(this.renderedRotation_=k.rotation,this.hitDetectionImageData_=null),this.container},c.prototype.getFeatures=function(o){return new Promise((function(u){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var d=[this.context.canvas.width,this.context.canvas.height];ye(this.pixelTransform,d);var m=this.renderedCenter_,E=this.renderedResolution_,C=this.renderedRotation_,w=this.renderedProjection_,T=this.wrappedRenderedExtent_,A=this.getLayer(),D=[],F=d[0]*fi,k=d[1]*fi;D.push(this.getRenderTransform(m,E,C,fi,F,k,0).slice());var N=A.getSource(),z=w.getExtent();if(N.getWrapX()&&w.canWrapX()&&!es(z,T)){for(var H=T[0],tt=Mn(z),J=0,st=void 0;H<z[0];)--J,st=tt*J,D.push(this.getRenderTransform(m,E,C,fi,F,k,st).slice()),H+=tt;for(J=0,H=T[2];H>z[2];)++J,st=tt*J,D.push(this.getRenderTransform(m,E,C,fi,F,k,st).slice()),H-=tt}this.hitDetectionImageData_=yp(d,D,this.renderedFeatures_,A.getStyleFunction(),T,E,C)}u(vp(o,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))},c.prototype.forEachFeatureAtCoordinate=function(o,u,d,m,E){var C=this;if(this.replayGroup_){var w=u.viewState.resolution,T=u.viewState.rotation,A=this.getLayer(),D={},F=function(z,H,tt){var J=et(z),st=D[J];if(st){if(st!==!0&&tt<st.distanceSq){if(tt===0)return D[J]=!0,E.splice(E.lastIndexOf(st),1),m(z,A,H);st.geometry=H,st.distanceSq=tt}}else{if(tt===0)return D[J]=!0,m(z,A,H);E.push(D[J]={feature:z,layer:A,geometry:H,distanceSq:tt,callback:m})}},k,N=[this.replayGroup_];return this.declutterExecutorGroup&&N.push(this.declutterExecutorGroup),N.some(function(z){return k=z.forEachFeatureAtCoordinate(o,w,T,d,F,z===C.declutterExecutorGroup&&u.declutterTree?u.declutterTree.all().map(function(H){return H.value}):null)}),k}},c.prototype.handleFontsChanged=function(){var o=this.getLayer();o.getVisible()&&this.replayGroup_&&o.changed()},c.prototype.handleStyleImageChange_=function(o){this.renderIfReadyAndVisible()},c.prototype.prepareFrame=function(o){var u=this.getLayer(),d=u.getSource();if(!d)return!1;var m=o.viewHints[go.ANIMATING],E=o.viewHints[go.INTERACTING],C=u.getUpdateWhileAnimating(),w=u.getUpdateWhileInteracting();if(!this.dirty_&&!C&&m||!w&&E)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var T=o.extent,A=o.viewState,D=A.projection,F=A.resolution,k=o.pixelRatio,N=u.getRevision(),z=u.getRenderBuffer(),H=u.getRenderOrder();H===void 0&&(H=xp);var tt=A.center.slice(),J=Na(T,z*F),st=J.slice(),vt=[J.slice()],pt=D.getExtent();if(d.getWrapX()&&D.canWrapX()&&!es(pt,o.extent)){var ct=Mn(pt),Et=Math.max(Mn(J)/2,ct);J[0]=pt[0]-Et,J[2]=pt[2]+Et,Y_(tt,D);var gt=kg(vt[0],D);gt[0]<pt[0]&&gt[2]<pt[2]?vt.push([gt[0]+ct,gt[1],gt[2]+ct,gt[3]]):gt[0]>pt[0]&&gt[2]>pt[2]&&vt.push([gt[0]-ct,gt[1],gt[2]-ct,gt[3]])}if(!this.dirty_&&this.renderedResolution_==F&&this.renderedRevision_==N&&this.renderedRenderOrder_==H&&es(this.wrappedRenderedExtent_,J))return v(this.renderedExtent_,st)||(this.hitDetectionImageData_=null,this.renderedExtent_=st),this.renderedCenter_=tt,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var Rt=new fc(Ka(F,k),J,F,k),kt;this.getLayer().getDeclutter()&&(kt=new fc(Ka(F,k),J,F,k));for(var zt,At,Pt,At=0,Pt=vt.length;At<Pt;++At)d.loadFeatures(vt[At],F,D);var Kt=Cp(F,k),oe=(function(Ut){var le,Q=Ut.getStyleFunction()||u.getStyleFunction();if(Q&&(le=Q(Ut,F)),le){var Ae=this.renderFeature(Ut,Kt,le,Rt,zt,kt);this.dirty_=this.dirty_||Ae}}).bind(this),ie=Z_(J),bt=d.getFeaturesInExtent(ie);H&&bt.sort(H);for(var At=0,Pt=bt.length;At<Pt;++At)oe(bt[At]);this.renderedFeatures_=bt;var Qt=Rt.finish(),Yt=new mc(J,F,k,d.getOverlaps(),Qt,u.getRenderBuffer());return kt&&(this.declutterExecutorGroup=new mc(J,F,k,d.getOverlaps(),kt.finish(),u.getRenderBuffer())),this.renderedResolution_=F,this.renderedRevision_=N,this.renderedRenderOrder_=H,this.renderedExtent_=st,this.wrappedRenderedExtent_=J,this.renderedCenter_=tt,this.renderedProjection_=D,this.replayGroup_=Yt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},c.prototype.renderFeature=function(o,u,d,m,E,C){if(!d)return!1;var w=!1;if(Array.isArray(d))for(var T=0,A=d.length;T<A;++T)w=Pc(m,o,d[T],u,this.boundHandleStyleImageChange_,E,C)||w;else w=Pc(m,o,d,u,this.boundHandleStyleImageChange_,E,C);return w},c}(m_),Fp=Dp,bp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Gp=function(_){bp(c,_);function c(o){return _.call(this,o)||this}return c.prototype.createRenderer=function(){return new Fp(this)},c}(Cg),kp=Gp,ur={ADD:"add",REMOVE:"remove"},Fc=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),bc={LENGTH:"length"},yo=function(_){Fc(c,_);function c(o,u,d){var m=_.call(this,o)||this;return m.element=u,m.index=d,m}return c}(i),Np=function(_){Fc(c,_);function c(o,u){var d=_.call(this)||this;d.on,d.once,d.un;var m=u||{};if(d.unique_=!!m.unique,d.array_=o||[],d.unique_)for(var E=0,C=d.array_.length;E<C;++E)d.assertUnique_(d.array_[E],E);return d.updateLength_(),d}return c.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},c.prototype.extend=function(o){for(var u=0,d=o.length;u<d;++u)this.push(o[u]);return this},c.prototype.forEach=function(o){for(var u=this.array_,d=0,m=u.length;d<m;++d)o(u[d],d,u)},c.prototype.getArray=function(){return this.array_},c.prototype.item=function(o){return this.array_[o]},c.prototype.getLength=function(){return this.get(bc.LENGTH)},c.prototype.insertAt=function(o,u){this.unique_&&this.assertUnique_(u),this.array_.splice(o,0,u),this.updateLength_(),this.dispatchEvent(new yo(ur.ADD,u,o))},c.prototype.pop=function(){return this.removeAt(this.getLength()-1)},c.prototype.push=function(o){this.unique_&&this.assertUnique_(o);var u=this.getLength();return this.insertAt(u,o),this.getLength()},c.prototype.remove=function(o){for(var u=this.array_,d=0,m=u.length;d<m;++d)if(u[d]===o)return this.removeAt(d)},c.prototype.removeAt=function(o){var u=this.array_[o];return this.array_.splice(o,1),this.updateLength_(),this.dispatchEvent(new yo(ur.REMOVE,u,o)),u},c.prototype.setAt=function(o,u){var d=this.getLength();if(o<d){this.unique_&&this.assertUnique_(u,o);var m=this.array_[o];this.array_[o]=u,this.dispatchEvent(new yo(ur.REMOVE,m,o)),this.dispatchEvent(new yo(ur.ADD,u,o))}else{for(var E=d;E<o;++E)this.insertAt(E,void 0);this.insertAt(o,u)}},c.prototype.updateLength_=function(){this.set(bc.LENGTH,this.array_.length)},c.prototype.assertUnique_=function(o,u){for(var d=0,m=this.array_.length;d<m;++d)if(this.array_[d]===o&&d!==u)throw new ue(58)},c}(ot),Xp=Np,Yp=function(){function _(c){this.rbush_=new Sn(c),this.items_={}}return _.prototype.insert=function(c,o){var u={minX:c[0],minY:c[1],maxX:c[2],maxY:c[3],value:o};this.rbush_.insert(u),this.items_[et(o)]=u},_.prototype.load=function(c,o){for(var u=new Array(o.length),d=0,m=o.length;d<m;d++){var E=c[d],C=o[d],w={minX:E[0],minY:E[1],maxX:E[2],maxY:E[3],value:C};u[d]=w,this.items_[et(C)]=w}this.rbush_.load(u)},_.prototype.remove=function(c){var o=et(c),u=this.items_[o];return delete this.items_[o],this.rbush_.remove(u)!==null},_.prototype.update=function(c,o){var u=this.items_[et(o)],d=[u.minX,u.minY,u.maxX,u.maxY];hc(d,c)||(this.remove(o),this.insert(c,o))},_.prototype.getAll=function(){var c=this.rbush_.all();return c.map(function(o){return o.value})},_.prototype.getInExtent=function(c){var o={minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]},u=this.rbush_.search(o);return u.map(function(d){return d.value})},_.prototype.forEach=function(c){return this.forEach_(this.getAll(),c)},_.prototype.forEachInExtent=function(c,o){return this.forEach_(this.getInExtent(c),o)},_.prototype.forEach_=function(c,o){for(var u,d=0,m=c.length;d<m;d++)if(u=o(c[d]),u)return u;return u},_.prototype.isEmpty=function(){return M(this.items_)},_.prototype.clear=function(){this.rbush_.clear(),this.items_={}},_.prototype.getExtent=function(c){var o=this.rbush_.toJSON();return ns(o.minX,o.minY,o.maxX,o.maxY,c)},_.prototype.concat=function(c){this.rbush_.load(c.rbush_.all());for(var o in c.items_)this.items_[o]=c.items_[o]},_}(),Gc=Yp,Wp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),Bp=function(_){Wp(c,_);function c(o){var u=_.call(this)||this;u.projection=mo(o.projection),u.attributions_=kc(o.attributions),u.attributionsCollapsible_=o.attributionsCollapsible!==void 0?o.attributionsCollapsible:!0,u.loading=!1,u.state_=o.state!==void 0?o.state:We.READY,u.wrapX_=o.wrapX!==void 0?o.wrapX:!1,u.interpolate_=!!o.interpolate,u.viewResolver=null,u.viewRejector=null;var d=u;return u.viewPromise_=new Promise(function(m,E){d.viewResolver=m,d.viewRejector=E}),u}return c.prototype.getAttributions=function(){return this.attributions_},c.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},c.prototype.getProjection=function(){return this.projection},c.prototype.getResolutions=function(){return K()},c.prototype.getView=function(){return this.viewPromise_},c.prototype.getState=function(){return this.state_},c.prototype.getWrapX=function(){return this.wrapX_},c.prototype.getInterpolate=function(){return this.interpolate_},c.prototype.refresh=function(){this.changed()},c.prototype.setAttributions=function(o){this.attributions_=kc(o),this.changed()},c.prototype.setState=function(o){this.state_=o,this.changed()},c}(ot);function kc(_){return _?Array.isArray(_)?function(c){return _}:typeof _=="function"?_:function(c){return[_]}:null}var zp=Bp,ii={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Up(_,c){return[[-1/0,-1/0,1/0,1/0]]}var hs={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},jp=!1;function Vp(_,c,o,u,d,m,E){var C=new XMLHttpRequest;C.open("GET",typeof _=="function"?_(o,u,d):_,!0),c.getType()==hs.ARRAY_BUFFER&&(C.responseType="arraybuffer"),C.withCredentials=jp,C.onload=function(w){if(!C.status||C.status>=200&&C.status<300){var T=c.getType(),A=void 0;T==hs.JSON||T==hs.TEXT?A=C.responseText:T==hs.XML?(A=C.responseXML,A||(A=new DOMParser().parseFromString(C.responseText,"application/xml"))):T==hs.ARRAY_BUFFER&&(A=C.response),A?m(c.readFeatures(A,{extent:o,featureProjection:d}),c.readProjection(A)):E()}else E()},C.onerror=E,C.send()}function Nc(_,c){return function(o,u,d,m,E){var C=this;Vp(_,c,o,u,d,function(w,T){C.addFeatures(w),m!==void 0&&m(w)},E||R)}}var Xc=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),sn=function(_){Xc(c,_);function c(o,u,d){var m=_.call(this,o)||this;return m.feature=u,m.features=d,m}return c}(i),Kp=function(_){Xc(c,_);function c(o){var u=this,d=o||{};u=_.call(this,{attributions:d.attributions,interpolate:!0,projection:void 0,state:We.READY,wrapX:d.wrapX!==void 0?d.wrapX:!0})||this,u.on,u.once,u.un,u.loader_=R,u.format_=d.format,u.overlaps_=d.overlaps===void 0?!0:d.overlaps,u.url_=d.url,d.loader!==void 0?u.loader_=d.loader:u.url_!==void 0&&(qt(u.format_,7),u.loader_=Nc(u.url_,u.format_)),u.strategy_=d.strategy!==void 0?d.strategy:Up;var m=d.useSpatialIndex!==void 0?d.useSpatialIndex:!0;u.featuresRtree_=m?new Gc:null,u.loadedExtentsRtree_=new Gc,u.loadingExtentsCount_=0,u.nullGeometryFeatures_={},u.idIndex_={},u.uidIndex_={},u.featureChangeKeys_={},u.featuresCollection_=null;var E,C;return Array.isArray(d.features)?C=d.features:d.features&&(E=d.features,C=E.getArray()),!m&&E===void 0&&(E=new Xp(C)),C!==void 0&&u.addFeaturesInternal(C),E!==void 0&&u.bindFeaturesCollection_(E),u}return c.prototype.addFeature=function(o){this.addFeatureInternal(o),this.changed()},c.prototype.addFeatureInternal=function(o){var u=et(o);if(!this.addToIndex_(u,o)){this.featuresCollection_&&this.featuresCollection_.remove(o);return}this.setupChangeEvents_(u,o);var d=o.getGeometry();if(d){var m=d.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(m,o)}else this.nullGeometryFeatures_[u]=o;this.dispatchEvent(new sn(ii.ADDFEATURE,o))},c.prototype.setupChangeEvents_=function(o,u){this.featureChangeKeys_[o]=[W(u,G.CHANGE,this.handleFeatureChange_,this),W(u,r.PROPERTYCHANGE,this.handleFeatureChange_,this)]},c.prototype.addToIndex_=function(o,u){var d=!0,m=u.getId();return m!==void 0&&(m.toString()in this.idIndex_?d=!1:this.idIndex_[m.toString()]=u),d&&(qt(!(o in this.uidIndex_),30),this.uidIndex_[o]=u),d},c.prototype.addFeatures=function(o){this.addFeaturesInternal(o),this.changed()},c.prototype.addFeaturesInternal=function(o){for(var u=[],d=[],m=[],E=0,C=o.length;E<C;E++){var w=o[E],T=et(w);this.addToIndex_(T,w)&&d.push(w)}for(var E=0,A=d.length;E<A;E++){var w=d[E],T=et(w);this.setupChangeEvents_(T,w);var D=w.getGeometry();if(D){var F=D.getExtent();u.push(F),m.push(w)}else this.nullGeometryFeatures_[T]=w}if(this.featuresRtree_&&this.featuresRtree_.load(u,m),this.hasListener(ii.ADDFEATURE))for(var E=0,k=d.length;E<k;E++)this.dispatchEvent(new sn(ii.ADDFEATURE,d[E]))},c.prototype.bindFeaturesCollection_=function(o){var u=!1;this.addEventListener(ii.ADDFEATURE,function(d){u||(u=!0,o.push(d.feature),u=!1)}),this.addEventListener(ii.REMOVEFEATURE,function(d){u||(u=!0,o.remove(d.feature),u=!1)}),o.addEventListener(ur.ADD,(function(d){u||(u=!0,this.addFeature(d.element),u=!1)}).bind(this)),o.addEventListener(ur.REMOVE,(function(d){u||(u=!0,this.removeFeature(d.element),u=!1)}).bind(this)),this.featuresCollection_=o},c.prototype.clear=function(o){if(o){for(var u in this.featureChangeKeys_){var d=this.featureChangeKeys_[u];d.forEach(Y)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var m=(function(w){this.removeFeatureInternal(w)}).bind(this);this.featuresRtree_.forEach(m);for(var E in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[E])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var C=new sn(ii.CLEAR);this.dispatchEvent(C),this.changed()},c.prototype.forEachFeature=function(o){if(this.featuresRtree_)return this.featuresRtree_.forEach(o);this.featuresCollection_&&this.featuresCollection_.forEach(o)},c.prototype.forEachFeatureAtCoordinateDirect=function(o,u){var d=[o[0],o[1],o[0],o[1]];return this.forEachFeatureInExtent(d,function(m){var E=m.getGeometry();if(E.intersectsCoordinate(o))return u(m)})},c.prototype.forEachFeatureInExtent=function(o,u){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(o,u);this.featuresCollection_&&this.featuresCollection_.forEach(u)},c.prototype.forEachFeatureIntersectingExtent=function(o,u){return this.forEachFeatureInExtent(o,function(d){var m=d.getGeometry();if(m.intersectsExtent(o)){var E=u(d);if(E)return E}})},c.prototype.getFeaturesCollection=function(){return this.featuresCollection_},c.prototype.getFeatures=function(){var o;return this.featuresCollection_?o=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(o=this.featuresRtree_.getAll(),M(this.nullGeometryFeatures_)||y(o,O(this.nullGeometryFeatures_))),o},c.prototype.getFeaturesAtCoordinate=function(o){var u=[];return this.forEachFeatureAtCoordinateDirect(o,function(d){u.push(d)}),u},c.prototype.getFeaturesInExtent=function(o){return this.featuresRtree_?this.featuresRtree_.getInExtent(o):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},c.prototype.getClosestFeatureToCoordinate=function(o,u){var d=o[0],m=o[1],E=null,C=[NaN,NaN],w=1/0,T=[-1/0,-1/0,1/0,1/0],A=u||x;return this.featuresRtree_.forEachInExtent(T,function(D){if(A(D)){var F=D.getGeometry(),k=w;if(w=F.closestPointXY(d,m,C,w),w<k){E=D;var N=Math.sqrt(w);T[0]=d-N,T[1]=m-N,T[2]=d+N,T[3]=m+N}}}),E},c.prototype.getExtent=function(o){return this.featuresRtree_.getExtent(o)},c.prototype.getFeatureById=function(o){var u=this.idIndex_[o.toString()];return u!==void 0?u:null},c.prototype.getFeatureByUid=function(o){var u=this.uidIndex_[o];return u!==void 0?u:null},c.prototype.getFormat=function(){return this.format_},c.prototype.getOverlaps=function(){return this.overlaps_},c.prototype.getUrl=function(){return this.url_},c.prototype.handleFeatureChange_=function(o){var u=o.target,d=et(u),m=u.getGeometry();if(!m)d in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(u),this.nullGeometryFeatures_[d]=u);else{var E=m.getExtent();d in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[d],this.featuresRtree_&&this.featuresRtree_.insert(E,u)):this.featuresRtree_&&this.featuresRtree_.update(E,u)}var C=u.getId();if(C!==void 0){var w=C.toString();this.idIndex_[w]!==u&&(this.removeFromIdIndex_(u),this.idIndex_[w]=u)}else this.removeFromIdIndex_(u),this.uidIndex_[d]=u;this.changed(),this.dispatchEvent(new sn(ii.CHANGEFEATURE,u))},c.prototype.hasFeature=function(o){var u=o.getId();return u!==void 0?u in this.idIndex_:et(o)in this.uidIndex_},c.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&M(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0},c.prototype.loadFeatures=function(o,u,d){for(var m=this.loadedExtentsRtree_,E=this.strategy_(o,u,d),C=function(D,F){var k=E[D],N=m.forEachInExtent(k,function(z){return es(z.extent,k)});N||(++w.loadingExtentsCount_,w.dispatchEvent(new sn(ii.FEATURESLOADSTART)),w.loader_.call(w,k,u,d,(function(z){--this.loadingExtentsCount_,this.dispatchEvent(new sn(ii.FEATURESLOADEND,void 0,z))}).bind(w),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new sn(ii.FEATURESLOADERROR))}).bind(w)),m.insert(k,{extent:k.slice()}))},w=this,T=0,A=E.length;T<A;++T)C(T);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},c.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),_.prototype.refresh.call(this)},c.prototype.removeLoadedExtent=function(o){var u=this.loadedExtentsRtree_,d;u.forEachInExtent(o,function(m){if(hc(m.extent,o))return d=m,!0}),d&&u.remove(d)},c.prototype.removeFeature=function(o){if(o){var u=et(o);u in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[u]:this.featuresRtree_&&this.featuresRtree_.remove(o);var d=this.removeFeatureInternal(o);d&&this.changed()}},c.prototype.removeFeatureInternal=function(o){var u=et(o),d=this.featureChangeKeys_[u];if(d){d.forEach(Y),delete this.featureChangeKeys_[u];var m=o.getId();return m!==void 0&&delete this.idIndex_[m.toString()],delete this.uidIndex_[u],this.dispatchEvent(new sn(ii.REMOVEFEATURE,o)),o}},c.prototype.removeFromIdIndex_=function(o){var u=!1;for(var d in this.idIndex_)if(this.idIndex_[d]===o){delete this.idIndex_[d],u=!0;break}return u},c.prototype.setLoader=function(o){this.loader_=o},c.prototype.setUrl=function(o){qt(this.format_,7),this.url_=o,this.setLoader(Nc(o,this.format_))},c}(zp),Zp=Kp,Hp=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),$p=function(_){Hp(c,_);function c(o){var u=_.call(this)||this;if(u.on,u.once,u.un,u.id_=void 0,u.geometryName_="geometry",u.style_=null,u.styleFunction_=void 0,u.geometryChangeKey_=null,u.addChangeListener(u.geometryName_,u.handleGeometryChanged_),o)if(typeof o.getSimplifiedGeometry=="function"){var d=o;u.setGeometry(d)}else{var m=o;u.setProperties(m)}return u}return c.prototype.clone=function(){var o=new c(this.hasProperties()?this.getProperties():null);o.setGeometryName(this.getGeometryName());var u=this.getGeometry();u&&o.setGeometry(u.clone());var d=this.getStyle();return d&&o.setStyle(d),o},c.prototype.getGeometry=function(){return this.get(this.geometryName_)},c.prototype.getId=function(){return this.id_},c.prototype.getGeometryName=function(){return this.geometryName_},c.prototype.getStyle=function(){return this.style_},c.prototype.getStyleFunction=function(){return this.styleFunction_},c.prototype.handleGeometryChange_=function(){this.changed()},c.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(Y(this.geometryChangeKey_),this.geometryChangeKey_=null);var o=this.getGeometry();o&&(this.geometryChangeKey_=W(o,G.CHANGE,this.handleGeometryChange_,this)),this.changed()},c.prototype.setGeometry=function(o){this.set(this.geometryName_,o)},c.prototype.setStyle=function(o){this.style_=o,this.styleFunction_=o?qp(o):void 0,this.changed()},c.prototype.setId=function(o){this.id_=o,this.changed()},c.prototype.setGeometryName=function(o){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=o,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},c}(ot);function qp(_){if(typeof _=="function")return _;var c;if(Array.isArray(_))c=_;else{qt(typeof _.getZIndex=="function",41);var o=_;c=[o]}return function(){return c}}var Jp=$p;function Qp(_,c,o,u){for(var d=0,m=o.length;d<m;++d)_[c++]=o[d];return c}function tm(_,c,o,u){for(var d=0,m=o.length;d<m;++d)for(var E=o[d],C=0;C<u;++C)_[c++]=E[C];return c}var em=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),im=function(_){em(c,_);function c(o,u){var d=_.call(this)||this;return d.setCoordinates(o,u),d}return c.prototype.clone=function(){var o=new c(this.flatCoordinates.slice(),this.layout);return o.applyProperties(this),o},c.prototype.closestPointXY=function(o,u,d,m){var E=this.flatCoordinates,C=Ei(o,u,E[0],E[1]);if(C<m){for(var w=this.stride,T=0;T<w;++T)d[T]=E[T];return d.length=w,C}else return m},c.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},c.prototype.computeExtent=function(o){return Sg(this.flatCoordinates,o)},c.prototype.getType=function(){return St.POINT},c.prototype.intersectsExtent=function(o){return Xa(o,this.flatCoordinates[0],this.flatCoordinates[1])},c.prototype.setCoordinates=function(o,u){this.setLayout(u,o,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Qp(this.flatCoordinates,0,o,this.stride),this.changed()},c}(Sc),vo=im,nm=function(){var _=function(c,o){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])},_(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");_(c,o);function u(){this.constructor=c}c.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),rm=function(_){nm(c,_);function c(o,u){var d=_.call(this)||this;return u&&!Array.isArray(o[0])?d.setFlatCoordinates(u,o):d.setCoordinates(o,u),d}return c.prototype.appendPoint=function(o){this.flatCoordinates?y(this.flatCoordinates,o.getFlatCoordinates()):this.flatCoordinates=o.getFlatCoordinates().slice(),this.changed()},c.prototype.clone=function(){var o=new c(this.flatCoordinates.slice(),this.layout);return o.applyProperties(this),o},c.prototype.closestPointXY=function(o,u,d,m){if(m<Ig(this.getExtent(),o,u))return m;for(var E=this.flatCoordinates,C=this.stride,w=0,T=E.length;w<T;w+=C){var A=Ei(o,u,E[w],E[w+1]);if(A<m){m=A;for(var D=0;D<C;++D)d[D]=E[w+D];d.length=C}}return m},c.prototype.getCoordinates=function(){return nr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},c.prototype.getPoint=function(o){var u=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return o<0||u<=o?null:new vo(this.flatCoordinates.slice(o*this.stride,(o+1)*this.stride),this.layout)},c.prototype.getPoints=function(){for(var o=this.flatCoordinates,u=this.layout,d=this.stride,m=[],E=0,C=o.length;E<C;E+=d){var w=new vo(o.slice(E,E+d),u);m.push(w)}return m},c.prototype.getType=function(){return St.MULTI_POINT},c.prototype.intersectsExtent=function(o){for(var u=this.flatCoordinates,d=this.stride,m=0,E=u.length;m<E;m+=d){var C=u[m],w=u[m+1];if(Xa(o,C,w))return!0}return!1},c.prototype.setCoordinates=function(o,u){this.setLayout(u,o,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tm(this.flatCoordinates,0,o,this.stride),this.changed()},c}(Sc),sm=rm;const om=[0,0],Yc=10,am=64;class lm extends Xt{constructor(c){const o=c||{};super(o),this.originCoordinate=o.originCoordinate||om,this.rotationAnchorCoordinate=o.rotationAnchorCoordinate||null,this.xGridSize=o.xGridSize||Yc,this.yGridSize=o.yGridSize||Yc,this.maxPointsPerSide=o.maxPointsPerSide||am,this.overlay_=new kp({source:pm(),style:o.style,updateWhileInteracting:!0}),this.gridFeature_=new Jp({geometry:new sm([])}),this.updateGridDescription_(),this.overlay_.getSource().addFeature(this.gridFeature_),this.overlay_.on("postrender",this.handleGridLayerPostRender_.bind(this)),this.addEventListener("change:active",this.updateState_)}getGridFeature(){return this.gridFeature_}setOriginPoint(c){this.originCoordinate=c,this.updateGridDescription_()}setRotationControlPoint(c){this.rotationAnchorCoordinate=c,this.updateGridDescription_()}setXGridSize(c){this.xGridSize=c,this.updateGridDescription_()}setYGridSize(c){this.yGridSize=c,this.updateGridDescription_()}setMaxPointsPerSide(c){this.maxPointsPerSide=c,this.changed()}setStyle(c){this.overlay_.setStyle(c)}setMap(c){super.setMap(c),this.updateState_()}updateState_(){const c=this.getMap(),o=this.getActive();this.overlay_.setMap(o?c:null),this.updateGridDescription_()}updateGridDescription_(){const c=this.getMap();if(!c||!this.originCoordinate||!this.xGridSize||!this.yGridSize||!this.getActive()){this.gridDescription_=null,this.lastGridDescription_=null,this.gridFeature_.getGeometry().setCoordinates([]),this.changed();return}const o=c.getView().getProjection(),u=wc(this.originCoordinate,o,"EPSG:4326"),d=this.rotationAnchorCoordinate||Za(this.originCoordinate,[1,0]),m=wc(d,o,"EPSG:4326"),E=[u[0],m[1]],C=[m[0],u[1]],w=as(u,m);let T=as(u,E),A=as(u,C);u[0]>m[0]&&(A*=-1),u[1]>m[1]&&(T*=-1);const D=T/w,F=A/w;this.gridDescription_,this.gridDescription_={originCoordinate:this.originCoordinate,riseFactor:D,runFactor:F,xDim:this.xGridSize,yDim:this.yGridSize},this.changed()}changed(){super.changed(),this.overlay_.changed()}handleGridLayerPostRender_(c){const o=this.getMap(),u=this.gridDescription_;if(!u)return;const d=o.getView().calculateExtent(o.getSize()),m=u===this.lastGridDescription_||JSON.stringify(u)===JSON.stringify(this.lastGridDescription_),E=d===this.lastViewExtent_||JSON.stringify(d)===JSON.stringify(this.lastViewExtent_);if(m&&E)return;const C=u.originCoordinate;let w=[u.xDim*u.runFactor,u.xDim*u.riseFactor],T=[u.yDim*-1*u.riseFactor,u.yDim*u.runFactor];const A=this.calculateLocalSphereNormalizationCoefficients(new vo(u.originCoordinate));w=zc(w,A),T=zc(T,A);const D=Ya(d),F=cs(C,w,T,D),k=Za(C,Wc([w,T],F)),N=new vo(k),z=gm(k,w,T,d),H=_m(d,N,z,w,T,this.maxPointsPerSide);this.lastGridDescription_=u,this.lastViewExtent_=d,this.gridFeature_.getGeometry().setCoordinates(H)}calculateLocalSphereNormalizationCoefficients(c){const o=this.getMap().getView().getProjection().getCode();function u(w){return w.transform(o,"EPSG:4326").getCoordinates()}function d(w,T,A){const D=w.clone();return D.translate(T,A),D}const m=u(c.clone()),E=u(d(c,1,0)),C=u(d(c,0,1));return[1/as(m,E),1/as(m,C)]}}function hm(_,c,o,u,d){const m=Bc(u,c),E=Bc(d,o),C=_.clone();return C.setCoordinates(Za(_.getCoordinates(),m,E)),C}function cm(_){const c=_[0][0],o=_[0][1],u=_[1][0],d=_[1][1],m=c*d-o*u;return[[d/m,-o/m],[-u/m,c/m]]}function Wc(_,c){const o=_[0][0],u=_[0][1],d=_[1][0],m=_[1][1],E=c[0],C=c[1];return[o*E+d*C,u*E+m*C]}function um(_,c,o){const u=cm([_,c]);return Wc(u,o)}function fm(_,c,o,u){const d=u||Math.round,m=um(_,c,o);return[d(m[0]),d(m[1])]}function dm(_,c){return[_[0]-c[0],_[1]-c[1]]}function Za(_,c,o){return o?[_[0]+c[0]+o[0],_[1]+c[1]+o[1]]:[_[0]+c[0],_[1]+c[1]]}function Bc(_,c){return[_[0]*c,_[1]*c]}function zc(_,c){return[_[0]*c[0],_[1]*c[1]]}function cs(_,c,o,u,d){const m=dm(u,_);return fm(c,o,m,d)}function gm(_,c,o,u){return[cs(_,c,o,[u[0],u[1]],Math.ceil),cs(_,c,o,[u[2],u[3]],Math.ceil),cs(_,c,o,[u[0],u[3]],Math.ceil),cs(_,c,o,[u[2],u[1]],Math.ceil)]}function _m(_,c,o,u,d,m){const E=o[0][0],C=o[0][1],w=o[1][0],T=o[1][1],A=o[2][0],D=o[2][1],F=o[3][0],k=o[3][1],N=Math.min(E,w,A,F),z=Math.min(C,T,D,k),H=Math.max(E,w,A,F),tt=Math.max(C,T,D,k),J=H-N,st=tt-z,vt=Math.max(1,Math.floor(J/m)),pt=Math.max(1,Math.floor(st/m)),ct=[];for(let Et=N;Et<=H;Et+=vt)for(let gt=z;gt<=tt;gt+=pt){const Rt=hm(c,Et,gt,u,d);Rt.intersectsExtent(_)&&ct.push(Rt.getCoordinates())}return ct}function pm(){const _=new Zp({useSpatialIndex:!1,features:[],wrapX:!1});return _.getFeaturesInExtent=_.getFeatures,_}return lm})}(Yo)),Yo.exports}var fx=ux();const dx=hx(fx);class gx{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=io,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?$t(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=$t(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Ct()}readFeature(t,e){return Ct()}readFeatures(t,e){return Ct()}readGeometry(t,e){return Ct()}readProjection(t){return Ct()}writeFeature(t,e){return Ct()}writeFeatures(t,e){return Ct()}writeGeometry(t,e){return Ct()}}function jh(n,t,e){const i=e?$t(e.featureProjection):null,r=e?$t(e.dataProjection):null;let a=n;if(i&&r&&!Or(i,r)){t&&(a=n.clone());const f=t?i:r,g=t?r:i;f.getUnits()==="tile-pixels"?a.transform(f,g):a.applyTransform(Ds(f,g))}if(t&&e&&e.decimals!==void 0){const f=Math.pow(10,e.decimals),g=function(p){for(let y=0,v=p.length;y<v;++y)p[y]=Math.round(p[y]*f)/f;return p};a===n&&(a=n.clone()),a.applyTransform(g)}return a}const _x={Point:Vn,LineString:Yr,Polygon:zi,MultiPoint:Oa,MultiLineString:sa,MultiPolygon:oa};function px(n,t,e){return Array.isArray(t[0])?(Qf(n,0,t,e)||(n=n.slice(),kl(n,0,t,e)),n):(xh(n,0,t,e)||(n=n.slice(),Zo(n,0,t,e)),n)}function Yd(n,t){var a;const e=n.geometry;if(!e)return[];if(Array.isArray(e))return e.map(f=>Yd({...n,geometry:f})).flat();const i=e.type==="MultiPolygon"?"Polygon":e.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const r=e.layout.length;return jh(new ke(i,i==="Polygon"?px(e.flatCoordinates,e.ends,r):e.flatCoordinates,(a=e.ends)==null?void 0:a.flat(),r,n.properties||{},n.id).enableSimplifyTransformed(),!1,t)}function Vh(n,t){if(!n)return null;if(Array.isArray(n)){const i=n.map(r=>Vh(r,t));return new ra(i)}const e=_x[n.type];return jh(new e(n.flatCoordinates,n.layout||"XY",n.ends),!1,t)}class mx extends gx{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(No(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(No(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return Ct()}readFeaturesFromObject(t,e){return Ct()}readGeometry(t,e){return this.readGeometryFromObject(No(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return Ct()}readProjection(t){return this.readProjectionFromObject(No(t))}readProjectionFromObject(t){return Ct()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return Ct()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return Ct()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return Ct()}}function No(n){if(typeof n=="string"){const t=JSON.parse(n);return t||null}return n!==null?n:null}class yx extends mx{constructor(t){t=t||{},super(),this.dataProjection=$t(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=$t(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const r=Kh(i.geometry);if(this.featureClass===ke)return Yd({geometry:r,id:i.id,properties:i.properties},e);const a=new io;return this.geometryName_?a.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&a.setGeometryName(i.geometry_name),a.setGeometry(Vh(r,e)),"id"in i&&a.setId(i.id),i.properties&&a.setProperties(i.properties,!0),a}readFeaturesFromObject(t,e){const i=t;let r=null;if(i.type==="FeatureCollection"){const a=t;r=[];const f=a.features;for(let g=0,p=f.length;g<p;++g){const y=this.readFeatureFromObject(f[g],e);y&&r.push(y)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return vx(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=$t(e.properties.name);else if(e.type==="EPSG")i=$t("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(i.id=r),!t.hasProperties())return i;const a=t.getProperties(),f=t.getGeometry();return f&&(i.geometry=Zl(f,e),delete a[t.getGeometryName()]),Un(a)||(i.properties=a),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let r=0,a=t.length;r<a;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Zl(t,this.adaptOptions(e))}}function Kh(n,t){if(!n)return null;let e;switch(n.type){case"Point":{e=xx(n);break}case"LineString":{e=Cx(n);break}case"Polygon":{e=Tx(n);break}case"MultiPoint":{e=wx(n);break}case"MultiLineString":{e=Rx(n);break}case"MultiPolygon":{e=Ix(n);break}case"GeometryCollection":{e=Ex(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return e}function vx(n,t){const e=Kh(n);return Vh(e,t)}function Ex(n,t){return n.geometries.map(function(i){return Kh(i)})}function xx(n){const t=n.coordinates;return{type:"Point",flatCoordinates:t,layout:qn(t.length)}}function Cx(n){var i;const t=n.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:qn(((i=t[0])==null?void 0:i.length)||2)}}function Rx(n){var a,f;const t=n.coordinates,e=((f=(a=t[0])==null?void 0:a[0])==null?void 0:f.length)||2,i=[],r=Hs(i,0,t,e);return{type:"MultiLineString",flatCoordinates:i,ends:r,layout:qn(e)}}function wx(n){var e;const t=n.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:qn(((e=t[0])==null?void 0:e.length)||2)}}function Ix(n){var a,f;const t=n.coordinates,e=[],i=((f=(a=t[0])==null?void 0:a[0])==null?void 0:f[0].length)||2,r=Kf(e,0,t,i);return{type:"MultiPolygon",flatCoordinates:e,ends:r,layout:qn(i)}}function Tx(n){var a,f;const t=n.coordinates,e=[],i=(f=(a=t[0])==null?void 0:a[0])==null?void 0:f.length,r=Hs(e,0,t,i);return{type:"Polygon",flatCoordinates:e,ends:r,layout:qn(i)}}function Zl(n,t){n=jh(n,!0,t);const e=n.getType();let i;switch(e){case"Point":{i=Px(n);break}case"LineString":{i=Ax(n);break}case"Polygon":{i=Dx(n,t);break}case"MultiPoint":{i=Ox(n);break}case"MultiLineString":{i=Lx(n);break}case"MultiPolygon":{i=Mx(n,t);break}case"GeometryCollection":{i=Sx(n,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Sx(n,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return Zl(i,t)})}}function Ax(n,t){return{type:"LineString",coordinates:n.getCoordinates()}}function Lx(n,t){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Ox(n,t){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Mx(n,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(e)}}function Px(n,t){return{type:"Point",coordinates:n.getCoordinates()}}function Dx(n,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(e)}}class Wd{drawCustom(t,e,i,r,a){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const _t={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Xo=[_t.FILL],En=[_t.STROKE],Bn=[_t.BEGIN_PATH],uf=[_t.CLOSE_PATH];class no extends Wd{constructor(t,e,i,r){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,a=this.coordinates;let f=a.length;for(let g=0,p=t.length;g<p;g+=e)r[0]=t[g],r[1]=t[g+1],jn(i,r)&&(a[f++]=r[0],a[f++]=r[1]);return f}appendFlatLineCoordinates(t,e,i,r,a,f){const g=this.coordinates;let p=g.length;const y=this.getBufferedMaxExtent();f&&(e+=r);let v=t[e],x=t[e+1];const R=this.tmpCoordinate_;let S=!0,I,L,O;for(I=e+r;I<i;I+=r)R[0]=t[I],R[1]=t[I+1],O=Ml(y,R),O!==L?(S&&(g[p++]=v,g[p++]=x,S=!1),g[p++]=R[0],g[p++]=R[1]):O===de.INTERSECTING?(g[p++]=R[0],g[p++]=R[1],S=!1):S=!0,v=R[0],x=R[1],L=O;return(a&&S||I===e+r)&&(g[p++]=v,g[p++]=x),p}drawCustomCoordinates_(t,e,i,r,a){for(let f=0,g=i.length;f<g;++f){const p=i[f],y=this.appendFlatLineCoordinates(t,e,p,r,!1,!1);a.push(y),e=p}return e}drawCustom(t,e,i,r,a){this.beginGeometry(t,e,a);const f=t.getType(),g=t.getStride(),p=this.coordinates.length;let y,v,x,R,S;switch(f){case"MultiPolygon":y=t.getOrientedFlatCoordinates(),R=[];const I=t.getEndss();S=0;for(let L=0,O=I.length;L<O;++L){const M=[];S=this.drawCustomCoordinates_(y,S,I[L],g,M),R.push(M)}this.instructions.push([_t.CUSTOM,p,R,t,i,Gl,a]),this.hitDetectionInstructions.push([_t.CUSTOM,p,R,t,r||i,Gl,a]);break;case"Polygon":case"MultiLineString":x=[],y=f=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),S=this.drawCustomCoordinates_(y,0,t.getEnds(),g,x),this.instructions.push([_t.CUSTOM,p,x,t,i,Fs,a]),this.hitDetectionInstructions.push([_t.CUSTOM,p,x,t,r||i,Fs,a]);break;case"LineString":case"Circle":y=t.getFlatCoordinates(),v=this.appendFlatLineCoordinates(y,0,y.length,g,!1,!1),this.instructions.push([_t.CUSTOM,p,v,t,i,vn,a]),this.hitDetectionInstructions.push([_t.CUSTOM,p,v,t,r||i,vn,a]);break;case"MultiPoint":y=t.getFlatCoordinates(),v=this.appendFlatPointCoordinates(y,g),v>p&&(this.instructions.push([_t.CUSTOM,p,v,t,i,vn,a]),this.hitDetectionInstructions.push([_t.CUSTOM,p,v,t,r||i,vn,a]));break;case"Point":y=t.getFlatCoordinates(),this.coordinates.push(y[0],y[1]),v=this.coordinates.length,this.instructions.push([_t.CUSTOM,p,v,t,i,void 0,a]),this.hitDetectionInstructions.push([_t.CUSTOM,p,v,t,r||i,void 0,a]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[_t.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[_t.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let r,a,f=-1;for(e=0;e<i;++e)r=t[e],a=r[0],a==_t.END_GEOMETRY?f=e:a==_t.BEGIN_GEOMETRY&&(r[2]=e,bm(this.hitDetectionInstructions,f,e),f=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=mi(i||Pe)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=mi(i||Ns);const r=t.getLineCap();e.lineCap=r!==void 0?r:Nr;const a=t.getLineDash();e.lineDash=a?a.slice():Yi;const f=t.getLineDashOffset();e.lineDashOffset=f||Wi;const g=t.getLineJoin();e.lineJoin=g!==void 0?g:Xr;const p=t.getWidth();e.lineWidth=p!==void 0?p:Ys;const y=t.getMiterLimit();e.miterLimit=y!==void 0?y:ks,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[_t.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[_t.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,r=t.lineCap,a=t.lineDash,f=t.lineDashOffset,g=t.lineJoin,p=t.lineWidth,y=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=r||a!=t.currentLineDash&&!In(t.currentLineDash,a)||t.currentLineDashOffset!=f||t.currentLineJoin!=g||t.currentLineWidth!=p||t.currentMiterLimit!=y)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=r,t.currentLineDash=a,t.currentLineDashOffset=f,t.currentLineJoin=g,t.currentLineWidth=p,t.currentMiterLimit=y)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[_t.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=wf(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;fa(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Fx extends no{constructor(t,e,i,r){super(t,e,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!jn(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),a=t.getStride(),f=this.coordinates.length,g=this.appendFlatPointCoordinates(r,a);this.instructions.push([_t.DRAW_IMAGE,f,g,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([_t.DRAW_IMAGE,f,g,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),a=[];for(let p=0,y=r.length;p<y;p+=t.getStride())(!this.maxExtent||jn(this.maxExtent,r.slice(p,p+2)))&&a.push(r[p],r[p+1]);const f=this.coordinates.length,g=this.appendFlatPointCoordinates(a,2);this.instructions.push([_t.DRAW_IMAGE,f,g,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([_t.DRAW_IMAGE,f,g,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),r=t.getSize(),a=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class bx extends no{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinates_(t,e,i,r){const a=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,i,r,!1,!1),g=[_t.MOVE_TO_LINE_TO,a,f];return this.instructions.push(g),this.hitDetectionInstructions.push(g),i}drawLineString(t,e,i){const r=this.state,a=r.strokeStyle,f=r.lineWidth;if(a===void 0||f===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Yi,Wi],Bn);const g=t.getFlatCoordinates(),p=t.getStride();this.drawFlatCoordinates_(g,0,g.length,p),this.hitDetectionInstructions.push(En),this.endGeometry(e)}drawMultiLineString(t,e,i){const r=this.state,a=r.strokeStyle,f=r.lineWidth;if(a===void 0||f===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Yi,Wi],Bn);const g=t.getEnds(),p=t.getFlatCoordinates(),y=t.getStride();let v=0;for(let x=0,R=g.length;x<R;++x)v=this.drawFlatCoordinates_(p,v,g[x],y);this.hitDetectionInstructions.push(En),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(En),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(En),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Bn)}}class ff extends no{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinatess_(t,e,i,r){const a=this.state,f=a.fillStyle!==void 0,g=a.strokeStyle!==void 0,p=i.length;this.instructions.push(Bn),this.hitDetectionInstructions.push(Bn);for(let y=0;y<p;++y){const v=i[y],x=this.coordinates.length,R=this.appendFlatLineCoordinates(t,e,v,r,!0,!g),S=[_t.MOVE_TO_LINE_TO,x,R];this.instructions.push(S),this.hitDetectionInstructions.push(S),g&&(this.instructions.push(uf),this.hitDetectionInstructions.push(uf)),e=v}return f&&(this.instructions.push(Xo),this.hitDetectionInstructions.push(Xo)),g&&(this.instructions.push(En),this.hitDetectionInstructions.push(En)),e}drawCircle(t,e,i){const r=this.state,a=r.fillStyle,f=r.strokeStyle;if(a===void 0&&f===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_FILL_STYLE,Pe]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Yi,Wi]);const g=t.getFlatCoordinates(),p=t.getStride(),y=this.coordinates.length;this.appendFlatLineCoordinates(g,0,g.length,p,!1,!1);const v=[_t.CIRCLE,y];this.instructions.push(Bn,v),this.hitDetectionInstructions.push(Bn,v),r.fillStyle!==void 0&&(this.instructions.push(Xo),this.hitDetectionInstructions.push(Xo)),r.strokeStyle!==void 0&&(this.instructions.push(En),this.hitDetectionInstructions.push(En)),this.endGeometry(e)}drawPolygon(t,e,i){const r=this.state,a=r.fillStyle,f=r.strokeStyle;if(a===void 0&&f===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_FILL_STYLE,Pe]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Yi,Wi]);const g=t.getEnds(),p=t.getOrientedFlatCoordinates(),y=t.getStride();this.drawFlatCoordinatess_(p,0,g,y),this.endGeometry(e)}drawMultiPolygon(t,e,i){const r=this.state,a=r.fillStyle,f=r.strokeStyle;if(a===void 0&&f===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_FILL_STYLE,Pe]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Yi,Wi]);const g=t.getEndss(),p=t.getOrientedFlatCoordinates(),y=t.getStride();let v=0;for(let x=0,R=g.length;x<R;++x)v=this.drawFlatCoordinatess_(p,v,g[x],y);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,r=e.length;i<r;++i)e[i]=kn(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function Gx(n,t,e,i,r){const a=[];let f=e,g=0,p=t.slice(e,2);for(;g<n&&f+r<i;){const[y,v]=p.slice(-2),x=t[f+r],R=t[f+r+1],S=Math.sqrt((x-y)*(x-y)+(R-v)*(R-v));if(g+=S,g>=n){const I=(n-g+S)/S,L=Ge(y,x,I),O=Ge(v,R,I);p.push(L,O),a.push(p),p=[L,O],g==n&&(f+=r),g=0}else if(g<n)p.push(t[f+r],t[f+r+1]),f+=r;else{const I=S-g,L=Ge(y,x,I/S),O=Ge(v,R,I/S);p.push(L,O),a.push(p),p=[L,O],g=0,f+=r}}return g>0&&a.push(p),a}function kx(n,t,e,i,r){let a=e,f=e,g=0,p=0,y=e,v,x,R,S,I,L,O,M,P,X;for(x=e;x<i;x+=r){const b=t[x],G=t[x+1];I!==void 0&&(P=b-I,X=G-L,S=Math.sqrt(P*P+X*X),O!==void 0&&(p+=R,v=Math.acos((O*P+M*X)/(R*S)),v>n&&(p>g&&(g=p,a=y,f=x),p=0,y=x-r)),R=S,O=P,M=X),I=b,L=G}return p+=S,p>g?[y,x]:[a,f]}const aa={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Nx extends no{constructor(t,e,i,r){super(t,e,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Pe]={fillStyle:Pe},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const r=this.textFillState_,a=this.textStrokeState_,f=this.textState_;if(this.text_===""||!f||!r&&!a)return;const g=this.coordinates;let p=g.length;const y=t.getType();let v=null,x=t.getStride();if(f.placement==="line"&&(y=="LineString"||y=="MultiLineString"||y=="Polygon"||y=="MultiPolygon")){if(!Re(this.maxExtent,t.getExtent()))return;let R;if(v=t.getFlatCoordinates(),y=="LineString")R=[v.length];else if(y=="MultiLineString")R=t.getEnds();else if(y=="Polygon")R=t.getEnds().slice(0,1);else if(y=="MultiPolygon"){const O=t.getEndss();R=[];for(let M=0,P=O.length;M<P;++M)R.push(O[M][0])}this.beginGeometry(t,e,i);const S=f.repeat,I=S?void 0:f.textAlign;let L=0;for(let O=0,M=R.length;O<M;++O){let P;S?P=Gx(S*this.resolution,v,L,R[O],x):P=[v.slice(L,R[O])];for(let X=0,b=P.length;X<b;++X){const G=P[X];let W=0,j=G.length;if(I==null){const V=kx(f.maxAngle,G,0,G.length,2);W=V[0],j=V[1]}for(let V=W;V<j;V+=x)g.push(G[V],G[V+1]);const Y=g.length;L=R[O],this.drawChars_(p,Y),p=Y}}this.endGeometry(e)}else{let R=f.overflow?null:[];switch(y){case"Point":case"MultiPoint":v=t.getFlatCoordinates();break;case"LineString":v=t.getFlatMidpoint();break;case"Circle":v=t.getCenter();break;case"MultiLineString":v=t.getFlatMidpoints(),x=2;break;case"Polygon":v=t.getFlatInteriorPoint(),f.overflow||R.push(v[2]/this.resolution),x=3;break;case"MultiPolygon":const b=t.getFlatInteriorPoints();v=[];for(let G=0,W=b.length;G<W;G+=3)f.overflow||R.push(b[G+2]/this.resolution),v.push(b[G],b[G+1]);if(v.length===0)return;x=2;break}const S=this.appendFlatPointCoordinates(v,x);if(S===p)return;if(R&&(S-p)/2!==v.length/x){let b=p/2;R=R.filter((G,W)=>{const j=g[(b+W)*2]===v[W*x]&&g[(b+W)*2+1]===v[W*x+1];return j||--b,j})}this.saveTextStates_();const I=f.backgroundFill?this.createFill(this.fillStyleToState(f.backgroundFill)):null,L=f.backgroundStroke?this.createStroke(this.strokeStyleToState(f.backgroundStroke)):null;this.beginGeometry(t,e,i);let O=f.padding;if(O!=Wn&&(f.scale[0]<0||f.scale[1]<0)){let b=f.padding[0],G=f.padding[1],W=f.padding[2],j=f.padding[3];f.scale[0]<0&&(G=-G,j=-j),f.scale[1]<0&&(b=-b,W=-W),O=[b,G,W,j]}const M=this.pixelRatio;this.instructions.push([_t.DRAW_IMAGE,p,S,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,O==Wn?Wn:O.map(function(b){return b*M}),I,L,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,R]);const P=1/M,X=I?I.slice(0):null;X&&(X[1]=Pe),this.hitDetectionInstructions.push([_t.DRAW_IMAGE,p,S,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[P,P],NaN,this.declutterMode_,this.declutterImageWithText_,O,X,L,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Pe:this.fillKey_,this.textOffsetX_,this.textOffsetY_,R]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const a=this.textKey_;a in this.textStates||(this.textStates[a]={font:e.font,textAlign:e.textAlign||Xs,justify:e.justify,textBaseline:e.textBaseline||$o,scale:e.scale});const f=this.fillKey_;i&&(f in this.fillStates||(this.fillStates[f]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,r=this.textState_,a=this.strokeKey_,f=this.textKey_,g=this.fillKey_;this.saveTextStates_();const p=this.pixelRatio,y=aa[r.textBaseline],v=this.textOffsetY_*p,x=this.text_,R=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([_t.DRAW_CHARS,t,e,y,r.overflow,g,r.maxAngle,p,v,a,R*p,x,f,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([_t.DRAW_CHARS,t,e,y,r.overflow,g&&Pe,r.maxAngle,p,v,a,R*p,x,f,1/p,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,r,a;if(!t)this.text_="";else{const f=t.getFill();f?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=mi(f.getColor()||Pe)):(r=null,this.textFillState_=r);const g=t.getStroke();if(!g)a=null,this.textStrokeState_=a;else{a=this.textStrokeState_,a||(a={},this.textStrokeState_=a);const L=g.getLineDash(),O=g.getLineDashOffset(),M=g.getWidth(),P=g.getMiterLimit();a.lineCap=g.getLineCap()||Nr,a.lineDash=L?L.slice():Yi,a.lineDashOffset=O===void 0?Wi:O,a.lineJoin=g.getLineJoin()||Xr,a.lineWidth=M===void 0?Ys:M,a.miterLimit=P===void 0?ks:P,a.strokeStyle=mi(g.getColor()||Ns)}i=this.textState_;const p=t.getFont()||gd;Rv(p);const y=t.getScaleArray();i.overflow=t.getOverflow(),i.font=p,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||$o,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Wn,i.scale=y===void 0?[1,1]:y;const v=t.getOffsetX(),x=t.getOffsetY(),R=t.getRotateWithView(),S=t.getKeepUpright(),I=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=v===void 0?0:v,this.textOffsetY_=x===void 0?0:x,this.textRotateWithView_=R===void 0?!1:R,this.textKeepUpright_=S===void 0?!0:S,this.textRotation_=I===void 0?0:I,this.strokeKey_=a?(typeof a.strokeStyle=="string"?a.strokeStyle:Mt(a.strokeStyle))+a.lineCap+a.lineDashOffset+"|"+a.lineWidth+a.lineJoin+a.miterLimit+"["+a.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Mt(r.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Xx={Circle:ff,Default:no,Image:Fx,LineString:bx,Polygon:ff,Text:Nx};class Yx{constructor(t,e,i,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const r in i){const a=i[r].finish();t[e][r]=a}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let a=r[e];if(a===void 0){const f=Xx[e];a=new f(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=a}return a}}function Wx(n,t,e,i,r,a,f,g,p,y,v,x,R=!0){let S=n[t],I=n[t+1],L=0,O=0,M=0,P=0;function X(){L=S,O=I,t+=i,S=n[t],I=n[t+1],P+=M,M=Math.sqrt((S-L)*(S-L)+(I-O)*(I-O))}do X();while(t<e-i&&P+M<a);let b=M===0?0:(a-P)/M;const G=Ge(L,S,b),W=Ge(O,I,b),j=t-i,Y=P,V=a+g*p(y,r,v);for(;t<e-i&&P+M<V;)X();b=M===0?0:(V-P)/M;const U=Ge(L,S,b),it=Ge(O,I,b);let q=!1;if(R)if(x){const rt=[G,W,U,it];zf(rt,0,4,2,x,rt,rt),q=rt[0]>rt[2]}else q=G>U;const K=Math.PI,$=[],et=j+i===t;t=j,M=0,P=Y,S=n[t],I=n[t+1];let nt;if(et){X(),nt=Math.atan2(I-O,S-L),q&&(nt+=nt>0?-K:K);const rt=(U+G)/2,ft=(it+W)/2;return $[0]=[rt,ft,(V-a)/2,nt,r],$}r=r.replace(/\n/g," ");for(let rt=0,ft=r.length;rt<ft;){X();let ut=Math.atan2(I-O,S-L);if(q&&(ut+=ut>0?-K:K),nt!==void 0){let ht=ut-nt;if(ht+=ht>K?-2*K:ht<-K?2*K:0,Math.abs(ht)>f)return null}nt=ut;const ot=rt;let dt=0;for(;rt<ft;++rt){const ht=q?ft-rt-1:rt,Vt=g*p(y,r[ht],v);if(t+i<e&&P+M<a+dt+Vt/2)break;dt+=Vt}if(rt===ot)continue;const Z=q?r.substring(ft-ot,ft-rt):r.substring(ot,rt);b=M===0?0:(a+dt/2-P)/M;const Tt=Ge(L,S,b),Xt=Ge(O,I,b);$.push([Tt,Xt,dt/2,ut,Z]),a+=dt}return $}const vr=Fe(),cn=[],Di=[],Fi=[],un=[];function df(n){return n[3].declutterBox}const gf=new RegExp("[-----]");function Sl(n,t){return t==="start"?t=gf.test(n)?"right":"left":t==="end"&&(t=gf.test(n)?"left":"right"),aa[t]}function Bx(n,t,e){return e>0&&n.push(`
`,""),n.push(t,""),n}class zx{constructor(t,e,i,r,a){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Xe(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=a?new Id:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,r){const a=t+e+i+r;if(this.labels_[a])return this.labels_[a];const f=r?this.strokeStates[r]:null,g=i?this.fillStates[i]:null,p=this.textStates[e],y=this.pixelRatio,v=[p.scale[0]*y,p.scale[1]*y],x=p.justify?aa[p.justify]:Sl(Array.isArray(t)?t[0]:t,p.textAlign||Xs),R=r&&f.lineWidth?f.lineWidth:0,S=Array.isArray(t)?t:String(t).split(`
`).reduce(Bx,[]),{width:I,height:L,widths:O,heights:M,lineWidths:P}=Iv(p,S),X=I+R,b=[],G=(X+2)*v[0],W=(L+R)*v[1],j={width:G<0?Math.floor(G):Math.ceil(G),height:W<0?Math.floor(W):Math.ceil(W),contextInstructions:b};(v[0]!=1||v[1]!=1)&&b.push("scale",v),r&&(b.push("strokeStyle",f.strokeStyle),b.push("lineWidth",R),b.push("lineCap",f.lineCap),b.push("lineJoin",f.lineJoin),b.push("miterLimit",f.miterLimit),b.push("setLineDash",[f.lineDash]),b.push("lineDashOffset",f.lineDashOffset)),i&&b.push("fillStyle",g.fillStyle),b.push("textBaseline","middle"),b.push("textAlign","center");const Y=.5-x;let V=x*X+Y*R;const U=[],it=[];let q=0,K=0,$=0,et=0,nt;for(let rt=0,ft=S.length;rt<ft;rt+=2){const ut=S[rt];if(ut===`
`){K+=q,q=0,V=x*X+Y*R,++et;continue}const ot=S[rt+1]||p.font;ot!==nt&&(r&&U.push("font",ot),i&&it.push("font",ot),nt=ot),q=Math.max(q,M[$]);const dt=[ut,V+Y*O[$]+x*(O[$]-P[et]),.5*(R+q)+K];V+=O[$],r&&U.push("strokeText",dt),i&&it.push("fillText",dt),++$}return Array.prototype.push.apply(b,U),Array.prototype.push.apply(b,it),this.labels_[a]=j,j}replayTextBackground_(t,e,i,r,a,f,g){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,r),t.lineTo.apply(t,a),t.lineTo.apply(t,e),f&&(this.alignAndScaleFill_=f[2],t.fillStyle=f[1],this.fill_(t)),g&&(this.setStrokeStyle_(t,g),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,r,a,f,g,p,y,v,x,R,S,I,L,O){g*=R[0],p*=R[1];let M=i-g,P=r-p;const X=a+y>t?t-y:a,b=f+v>e?e-v:f,G=I[3]+X*R[0]+I[1],W=I[0]+b*R[1]+I[2],j=M-I[3],Y=P-I[0];(L||x!==0)&&(cn[0]=j,un[0]=j,cn[1]=Y,Di[1]=Y,Di[0]=j+G,Fi[0]=Di[0],Fi[1]=Y+W,un[1]=Fi[1]);let V;return x!==0?(V=vi(Xe(),i,r,1,1,x,-i,-r),ce(V,cn),ce(V,Di),ce(V,Fi),ce(V,un),Rn(Math.min(cn[0],Di[0],Fi[0],un[0]),Math.min(cn[1],Di[1],Fi[1],un[1]),Math.max(cn[0],Di[0],Fi[0],un[0]),Math.max(cn[1],Di[1],Fi[1],un[1]),vr)):Rn(Math.min(j,j+G),Math.min(Y,Y+W),Math.max(j,j+G),Math.max(Y,Y+W),vr),S&&(M=Math.round(M),P=Math.round(P)),{drawImageX:M,drawImageY:P,drawImageW:X,drawImageH:b,originX:y,originY:v,declutterBox:{minX:vr[0],minY:vr[1],maxX:vr[2],maxY:vr[3],value:O},canvasTransform:V,scale:R}}replayImageOrLabel_(t,e,i,r,a,f,g){const p=!!(f||g),y=r.declutterBox,v=g?g[2]*r.scale[0]/2:0;return y.minX-v<=e[0]&&y.maxX+v>=0&&y.minY-v<=e[1]&&y.maxY+v>=0&&(p&&this.replayTextBackground_(t,cn,Di,Fi,un,f,g),Tv(t,r.canvasTransform,a,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=ce(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(i[0]%r,i[1]%r),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,r){const a=this.textStates[e],f=this.createLabel(t,e,r,i),g=this.strokeStates[i],p=this.pixelRatio,y=Sl(Array.isArray(t)?t[0]:t,a.textAlign||Xs),v=aa[a.textBaseline||$o],x=g&&g.lineWidth?g.lineWidth:0,R=f.width/p-2*a.scale[0],S=y*R+2*(.5-y)*x,I=v*f.height/p+2*(.5-v)*x;return{label:f,anchorX:S,anchorY:I}}execute_(t,e,i,r,a,f,g,p){const y=this.zIndexContext_;let v;this.pixelCoordinates_&&In(i,this.renderedTransform_)?v=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),v=xn(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Dy(this.renderedTransform_,i));let x=0;const R=r.length;let S=0,I,L,O,M,P,X,b,G,W,j,Y,V,U,it=0,q=0;const K=this.coordinateCache_,$=this.viewRotation_,et=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,nt={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:$},rt=this.instructions!=r||this.overlaps?0:200;let ft,ut,ot,dt;for(;x<R;){const Z=r[x];switch(Z[0]){case _t.BEGIN_GEOMETRY:ft=Z[1],dt=Z[3],ft.getGeometry()?g!==void 0&&!Re(g,dt.getExtent())?x=Z[2]+1:++x:x=Z[2],y&&(y.zIndex=Z[4]);break;case _t.BEGIN_PATH:it>rt&&(this.fill_(t),it=0),q>rt&&(t.stroke(),q=0),!it&&!q&&(t.beginPath(),P=NaN,X=NaN),++x;break;case _t.CIRCLE:S=Z[1];const Xt=v[S],ht=v[S+1],Vt=v[S+2],se=v[S+3],ue=Vt-Xt,qt=se-ht,Bt=Math.sqrt(ue*ue+qt*qt);t.moveTo(Xt+Bt,ht),t.arc(Xt,ht,Bt,0,2*Math.PI,!0),++x;break;case _t.CLOSE_PATH:t.closePath(),++x;break;case _t.CUSTOM:S=Z[1],I=Z[2];const ji=Z[3],Ei=Z[4],hi=Z[5];nt.geometry=ji,nt.feature=ft,x in K||(K[x]=[]);const _e=K[x];hi?hi(v,S,I,2,_e):(_e[0]=v[S],_e[1]=v[S+1],_e.length=2),y&&(y.zIndex=Z[6]),Ei(_e,nt),++x;break;case _t.DRAW_IMAGE:S=Z[1],I=Z[2],W=Z[3],L=Z[4],O=Z[5];let xi=Z[6];const we=Z[7],Ye=Z[8],ci=Z[9],We=Z[10];let Vi=Z[11];const Tn=Z[12];let ti=Z[13];M=Z[14]||"declutter";const Ci=Z[15];if(!W&&Z.length>=20){j=Z[19],Y=Z[20],V=Z[21],U=Z[22];const xe=this.drawLabelWithPointPlacement_(j,Y,V,U);W=xe.label,Z[3]=W;const Ti=Z[23];L=(xe.anchorX-Ti)*this.pixelRatio,Z[4]=L;const Ie=Z[24];O=(xe.anchorY-Ie)*this.pixelRatio,Z[5]=O,xi=W.height,Z[6]=xi,ti=W.width,Z[13]=ti}let ae;Z.length>25&&(ae=Z[25]);let Ri,Qn,Sn;Z.length>17?(Ri=Z[16],Qn=Z[17],Sn=Z[18]):(Ri=Wn,Qn=null,Sn=null),We&&et?Vi+=$:!We&&!et&&(Vi-=$);let Pa=0;for(;S<I;S+=2){if(ae&&ae[Pa++]<ti/this.pixelRatio)continue;const xe=this.calculateImageOrLabelDimensions_(W.width,W.height,v[S],v[S+1],ti,xi,L,O,Ye,ci,Vi,Tn,a,Ri,!!Qn||!!Sn,ft),Ti=[t,e,W,xe,we,Qn,Sn];if(p){let Ie,be,Te;if(Ci){const Zt=I-S;if(!Ci[Zt]){Ci[Zt]={args:Ti,declutterMode:M};continue}const fe=Ci[Zt];Ie=fe.args,be=fe.declutterMode,delete Ci[Zt],Te=df(Ie)}let ei,Se;if(Ie&&(be!=="declutter"||!p.collides(Te))&&(ei=!0),(M!=="declutter"||!p.collides(xe.declutterBox))&&(Se=!0),be==="declutter"&&M==="declutter"){const Zt=ei&&Se;ei=Zt,Se=Zt}ei&&(be!=="none"&&p.insert(Te),this.replayImageOrLabel_.apply(this,Ie)),Se&&(M!=="none"&&p.insert(xe.declutterBox),this.replayImageOrLabel_.apply(this,Ti))}else this.replayImageOrLabel_.apply(this,Ti)}++x;break;case _t.DRAW_CHARS:const wi=Z[1],Ki=Z[2],Ii=Z[3],Da=Z[4];U=Z[5];const Fa=Z[6],tr=Z[7],An=Z[8];V=Z[9];const jr=Z[10];j=Z[11],Y=Z[12];const ro=[Z[13],Z[13]];M=Z[14]||"declutter";const Vr=Z[15],Zi=this.textStates[Y],Be=Zi.font,Hi=[Zi.scale[0]*tr,Zi.scale[1]*tr];let Ft;Be in this.widths_?Ft=this.widths_[Be]:(Ft={},this.widths_[Be]=Ft);const Kr=kd(v,wi,Ki,2),so=Math.abs(Hi[0])*Nu(Be,j,Ft);if(Da||so<=Kr){const xe=this.textStates[Y].textAlign,Ti=(Kr-so)*Sl(j,xe),Ie=Wx(v,wi,Ki,2,j,Ti,Fa,Math.abs(Hi[0]),Nu,Be,Ft,et?0:this.viewRotation_,Vr);t:if(Ie){const be=[];let Te,ei,Se,Zt,fe;if(V)for(Te=0,ei=Ie.length;Te<ei;++Te){fe=Ie[Te],Se=fe[4],Zt=this.createLabel(Se,Y,"",V),L=fe[2]+(Hi[0]<0?-jr:jr),O=Ii*Zt.height+(.5-Ii)*2*jr*Hi[1]/Hi[0]-An;const ze=this.calculateImageOrLabelDimensions_(Zt.width,Zt.height,fe[0],fe[1],Zt.width,Zt.height,L,O,0,0,fe[3],ro,!1,Wn,!1,ft);if(p&&M==="declutter"&&p.collides(ze.declutterBox))break t;be.push([t,e,Zt,ze,1,null,null])}if(U)for(Te=0,ei=Ie.length;Te<ei;++Te){fe=Ie[Te],Se=fe[4],Zt=this.createLabel(Se,Y,U,""),L=fe[2],O=Ii*Zt.height-An;const ze=this.calculateImageOrLabelDimensions_(Zt.width,Zt.height,fe[0],fe[1],Zt.width,Zt.height,L,O,0,0,fe[3],ro,!1,Wn,!1,ft);if(p&&M==="declutter"&&p.collides(ze.declutterBox))break t;be.push([t,e,Zt,ze,1,null,null])}p&&M!=="none"&&p.load(be.map(df));for(let ze=0,Ue=be.length;ze<Ue;++ze)this.replayImageOrLabel_.apply(this,be[ze])}}++x;break;case _t.END_GEOMETRY:if(f!==void 0){ft=Z[1];const xe=f(ft,dt,M);if(xe)return xe}++x;break;case _t.FILL:rt?it++:this.fill_(t),++x;break;case _t.MOVE_TO_LINE_TO:for(S=Z[1],I=Z[2],ut=v[S],ot=v[S+1],t.moveTo(ut,ot),P=ut+.5|0,X=ot+.5|0,S+=2;S<I;S+=2)ut=v[S],ot=v[S+1],b=ut+.5|0,G=ot+.5|0,(S==I-2||b!==P||G!==X)&&(t.lineTo(ut,ot),P=b,X=G);++x;break;case _t.SET_FILL_STYLE:this.alignAndScaleFill_=Z[2],it&&(this.fill_(t),it=0,q&&(t.stroke(),q=0)),t.fillStyle=Z[1],++x;break;case _t.SET_STROKE_STYLE:q&&(t.stroke(),q=0),this.setStrokeStyle_(t,Z),++x;break;case _t.STROKE:rt?q++:t.stroke(),++x;break;default:++x;break}}it&&this.fill_(t),q&&t.stroke()}execute(t,e,i,r,a,f){this.viewRotation_=r,this.execute_(t,e,i,this.instructions,a,void 0,void 0,f)}executeHitDetection(t,e,i,r,a){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,r,a)}}const Sr=["Polygon","Circle","LineString","Image","Text","Default"],Bd=["Image","Text"],Ux=Sr.filter(n=>!Bd.includes(n));class jx{constructor(t,e,i,r,a,f,g){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=f,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Xe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(a,g)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const a=t[i];for(const f in a){const g=a[f];r[f]=new zx(this.resolution_,this.pixelRatio_,this.overlaps_,g,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let r=0,a=t.length;r<a;++r)if(t[r]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,r,a,f){r=Math.round(r);const g=r*2+1,p=vi(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),y=!this.hitDetectionContext_;y&&(this.hitDetectionContext_=ee(g,g,void 0,{willReadFrequently:!0}));const v=this.hitDetectionContext_;v.canvas.width!==g||v.canvas.height!==g?(v.canvas.width=g,v.canvas.height=g):y||v.clearRect(0,0,g,g);let x;this.renderBuffer_!==void 0&&(x=Fe(),Ls(x,t),fa(x,e*(this.renderBuffer_+r),x));const R=Vx(r);let S;function I(G,W,j){const Y=v.getImageData(0,0,g,g).data;for(let V=0,U=R.length;V<U;V++)if(Y[R[V]]>0){if(!f||j==="none"||S!=="Image"&&S!=="Text"||f.includes(G)){const it=(R[V]-3)/4,q=r-it%g,K=r-(it/g|0),$=a(G,W,q*q+K*K);if($)return $}v.clearRect(0,0,g,g);break}}const L=Object.keys(this.executorsByZIndex_).map(Number);L.sort(Xi);let O,M,P,X,b;for(O=L.length-1;O>=0;--O){const G=L[O].toString();for(P=this.executorsByZIndex_[G],M=Sr.length-1;M>=0;--M)if(S=Sr[M],X=P[S],X!==void 0&&(b=X.executeHitDetection(v,p,i,I,x),b))return b}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],r=e[1],a=e[2],f=e[3],g=[i,r,i,f,a,f,a,r];return xn(g,0,8,2,t,g),g}isEmpty(){return Un(this.executorsByZIndex_)}execute(t,e,i,r,a,f,g){const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(g?Fm:Xi),f=f||Sr;const y=Sr.length;for(let v=0,x=p.length;v<x;++v){const R=p[v].toString(),S=this.executorsByZIndex_[R];for(let I=0,L=f.length;I<L;++I){const O=f[I],M=S[O];if(M!==void 0){const P=g===null?void 0:M.getZIndexContext(),X=P?P.getContext():t,b=this.maxExtent_&&O!=="Image"&&O!=="Text";if(b&&(X.save(),this.clip(X,i)),!P||O==="Text"||O==="Image"?M.execute(X,e,i,r,a,g):P.pushFunction(G=>M.execute(G,e,i,r,a,g)),b&&X.restore(),P){P.offset();const G=p[v]*y+I;this.deferredZIndexContexts_[G]||(this.deferredZIndexContexts_[G]=[]),this.deferredZIndexContexts_[G].push(P)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Xi);for(let i=0,r=e.length;i<r;++i)t[e[i]].forEach(a=>{a.draw(this.renderedContext_),a.clear()}),t[e[i]].length=0}}const Al={};function Vx(n){if(Al[n]!==void 0)return Al[n];const t=n*2+1,e=n*n,i=new Array(e+1);for(let a=0;a<=n;++a)for(let f=0;f<=n;++f){const g=a*a+f*f;if(g>e)break;let p=i[g];p||(p=[],i[g]=p),p.push(((n+a)*t+(n+f))*4+3),a>0&&p.push(((n-a)*t+(n+f))*4+3),f>0&&(p.push(((n+a)*t+(n-f))*4+3),a>0&&p.push(((n-a)*t+(n-f))*4+3))}const r=[];for(let a=0,f=i.length;a<f;++a)i[a]&&r.push(...i[a]);return Al[n]=r,r}class Kx extends Wd{constructor(t,e,i,r,a,f,g){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=r,this.transformRotation_=r?th(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=a,this.squaredTolerance_=f,this.userTransform_=g,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Xe()}drawImages_(t,e,i,r){if(!this.image_)return;const a=xn(t,e,i,r,this.transform_,this.pixelCoordinates_),f=this.context_,g=this.tmpLocalTransform_,p=f.globalAlpha;this.imageOpacity_!=1&&(f.globalAlpha=p*this.imageOpacity_);let y=this.imageRotation_;this.transformRotation_===0&&(y-=this.viewRotation_),this.imageRotateWithView_&&(y+=this.viewRotation_);for(let v=0,x=a.length;v<x;v+=2){const R=a[v]-this.imageAnchorX_,S=a[v+1]-this.imageAnchorY_;if(y!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const I=R+this.imageAnchorX_,L=S+this.imageAnchorY_;vi(g,I,L,1,1,y,-I,-L),f.save(),f.transform.apply(f,g),f.translate(I,L),f.scale(this.imageScale_[0],this.imageScale_[1]),f.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),f.restore()}else f.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,R,S,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(f.globalAlpha=p)}drawText_(t,e,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const a=xn(t,e,i,r,this.transform_,this.pixelCoordinates_),f=this.context_;let g=this.textRotation_;for(this.transformRotation_===0&&(g-=this.viewRotation_),this.textRotateWithView_&&(g+=this.viewRotation_);e<i;e+=r){const p=a[e]+this.textOffsetX_,y=a[e+1]+this.textOffsetY_;g!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(f.save(),f.translate(p-this.textOffsetX_,y-this.textOffsetY_),f.rotate(g),f.translate(this.textOffsetX_,this.textOffsetY_),f.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&f.strokeText(this.text_,0,0),this.textFillState_&&f.fillText(this.text_,0,0),f.restore()):(this.textStrokeState_&&f.strokeText(this.text_,p,y),this.textFillState_&&f.fillText(this.text_,p,y))}}moveToLineTo_(t,e,i,r,a){const f=this.context_,g=xn(t,e,i,r,this.transform_,this.pixelCoordinates_);f.moveTo(g[0],g[1]);let p=g.length;a&&(p-=2);for(let y=2;y<p;y+=2)f.lineTo(g[y],g[y+1]);return a&&f.closePath(),i}drawRings_(t,e,i,r){for(let a=0,f=i.length;a<f;++a)e=this.moveToLineTo_(t,e,i[a],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Re(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Xy(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],a=Math.sqrt(i*i+r*r),f=this.context_;f.beginPath(),f.arc(e[0],e[1],a,0,2*Math.PI),this.fillState_&&f.fill(),this.strokeState_&&f.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Re(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Re(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=t.getFlatCoordinates();let a=0;const f=t.getEnds(),g=t.getStride();i.beginPath();for(let p=0,y=f.length;p<y;++p)a=this.moveToLineTo_(r,a,f[p],g,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Re(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Re(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let r=0;const a=t.getEndss(),f=t.getStride();e.beginPath();for(let g=0,p=a.length;g<p;++g){const y=a[g];r=this.drawRings_(i,r,y,f)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),In(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:Xs;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=r&&(i.textAlign=r,e.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:mi(i||Pe)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),r=e.getLineCap(),a=e.getLineDash(),f=e.getLineDashOffset(),g=e.getLineJoin(),p=e.getWidth(),y=e.getMiterLimit(),v=a||Yi;this.strokeState_={lineCap:r!==void 0?r:Nr,lineDash:this.pixelRatio_===1?v:v.map(x=>x*this.pixelRatio_),lineDashOffset:(f||Wi)*this.pixelRatio_,lineJoin:g!==void 0?g:Xr,lineWidth:(p!==void 0?p:Ys)*this.pixelRatio_,miterLimit:y!==void 0?y:ks,strokeStyle:mi(i||Ns)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),a=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=a[0],this.imageOriginY_=a[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const f=t.getScaleArray();this.imageScale_=[f[0]*this.pixelRatio_/i,f[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const S=e.getColor();this.textFillState_={fillStyle:mi(S||Pe)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const S=i.getColor(),I=i.getLineCap(),L=i.getLineDash(),O=i.getLineDashOffset(),M=i.getLineJoin(),P=i.getWidth(),X=i.getMiterLimit();this.textStrokeState_={lineCap:I!==void 0?I:Nr,lineDash:L||Yi,lineDashOffset:O||Wi,lineJoin:M!==void 0?M:Xr,lineWidth:P!==void 0?P:Ys,miterLimit:X!==void 0?X:ks,strokeStyle:mi(S||Ns)}}const r=t.getFont(),a=t.getOffsetX(),f=t.getOffsetY(),g=t.getRotateWithView(),p=t.getRotation(),y=t.getScaleArray(),v=t.getText(),x=t.getTextAlign(),R=t.getTextBaseline();this.textState_={font:r!==void 0?r:gd,textAlign:x!==void 0?x:Xs,textBaseline:R!==void 0?R:$o},this.text_=v!==void 0?Array.isArray(v)?v.reduce((S,I,L)=>S+=L%2?" ":I,""):v:"",this.textOffsetX_=a!==void 0?this.pixelRatio_*a:0,this.textOffsetY_=f!==void 0?this.pixelRatio_*f:0,this.textRotateWithView_=g!==void 0?g:!1,this.textRotation_=p!==void 0?p:0,this.textScale_=[this.pixelRatio_*y[0],this.pixelRatio_*y[1]]}}}const gi=.5;function Zx(n,t,e,i,r,a,f,g,p){const y=r,v=n[0]*gi,x=n[1]*gi,R=ee(v,x);R.imageSmoothingEnabled=!1;const S=R.canvas,I=new Kx(R,gi,r,null,f,g,null),L=e.length,O=Math.floor((256*256*256-1)/L),M={};for(let X=1;X<=L;++X){const b=e[X-1],G=b.getStyleFunction()||i;if(!G)continue;let W=G(b,a);if(!W)continue;Array.isArray(W)||(W=[W]);const Y=(X*O).toString(16).padStart(7,"#00000");for(let V=0,U=W.length;V<U;++V){const it=W[V],q=it.getGeometryFunction()(b);if(!q||!Re(y,q.getExtent()))continue;const K=it.clone(),$=K.getFill();$&&$.setColor(Y);const et=K.getStroke();et&&(et.setColor(Y),et.setLineDash(null)),K.setText(void 0);const nt=it.getImage();if(nt){const ot=nt.getImageSize();if(!ot)continue;const dt=ee(ot[0],ot[1],void 0,{alpha:!1}),Z=dt.canvas;dt.fillStyle=Y,dt.fillRect(0,0,Z.width,Z.height),K.setImage(new Ur({img:Z,anchor:nt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:nt.getOrigin(),opacity:1,size:nt.getSize(),scale:nt.getScale(),rotation:nt.getRotation(),rotateWithView:nt.getRotateWithView()}))}const rt=K.getZIndex()||0;let ft=M[rt];ft||(ft={},M[rt]=ft,ft.Polygon=[],ft.Circle=[],ft.LineString=[],ft.Point=[]);const ut=q.getType();if(ut==="GeometryCollection"){const ot=q.getGeometriesArrayRecursive();for(let dt=0,Z=ot.length;dt<Z;++dt){const Tt=ot[dt];ft[Tt.getType().replace("Multi","")].push(Tt,K)}}else ft[ut.replace("Multi","")].push(q,K)}}const P=Object.keys(M).map(Number).sort(Xi);for(let X=0,b=P.length;X<b;++X){const G=M[P[X]];for(const W in G){const j=G[W];for(let Y=0,V=j.length;Y<V;Y+=2){I.setStyle(j[Y+1]);for(let U=0,it=t.length;U<it;++U)I.setTransform(t[U]),I.drawGeometry(j[Y])}}}return R.getImageData(0,0,S.width,S.height)}function Hx(n,t,e){const i=[];if(e){const r=Math.floor(Math.round(n[0])*gi),a=Math.floor(Math.round(n[1])*gi),f=(re(r,0,e.width-1)+re(a,0,e.height-1)*e.width)*4,g=e.data[f],p=e.data[f+1],v=e.data[f+2]+256*(p+256*g),x=Math.floor((256*256*256-1)/t.length);v&&v%x===0&&i.push(t[v/x-1])}return i}const $x=.5,zd={Point:r1,LineString:e1,Polygon:o1,MultiPoint:s1,MultiLineString:i1,MultiPolygon:n1,GeometryCollection:t1,Circle:Jx};function qx(n,t){return parseInt(Mt(n),10)-parseInt(Mt(t),10)}function _f(n,t){const e=Ud(n,t);return e*e}function Ud(n,t){return $x*n/t}function Jx(n,t,e,i,r){const a=e.getFill(),f=e.getStroke();if(a||f){const p=n.getBuilder(e.getZIndex(),"Circle");p.setFillStrokeStyle(a,f),p.drawCircle(t,i,r)}const g=e.getText();if(g&&g.getText()){const p=n.getBuilder(e.getZIndex(),"Text");p.setTextStyle(g),p.drawText(t,i)}}function pf(n,t,e,i,r,a,f,g){const p=[],y=e.getImage();if(y){let R=!0;const S=y.getImageState();S==lt.LOADED||S==lt.ERROR?R=!1:S==lt.IDLE&&y.load(),R&&p.push(y.ready())}const v=e.getFill();v&&v.loading()&&p.push(v.ready());const x=p.length>0;return x&&Promise.all(p).then(()=>r(null)),Qx(n,t,e,i,a,f,g),x}function Qx(n,t,e,i,r,a,f){const g=e.getGeometryFunction()(t);if(!g)return;const p=g.simplifyTransformed(i,r);if(e.getRenderer())jd(n,p,e,t,f);else{const v=zd[p.getType()];v(n,p,e,t,f,a)}}function jd(n,t,e,i,r){if(t.getType()=="GeometryCollection"){const f=t.getGeometries();for(let g=0,p=f.length;g<p;++g)jd(n,f[g],e,i,r);return}n.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),r)}function t1(n,t,e,i,r,a){const f=t.getGeometriesArray();let g,p;for(g=0,p=f.length;g<p;++g){const y=zd[f[g].getType()];y(n,f[g],e,i,r,a)}}function e1(n,t,e,i,r){const a=e.getStroke();if(a){const g=n.getBuilder(e.getZIndex(),"LineString");g.setFillStrokeStyle(null,a),g.drawLineString(t,i,r)}const f=e.getText();if(f&&f.getText()){const g=n.getBuilder(e.getZIndex(),"Text");g.setTextStyle(f),g.drawText(t,i,r)}}function i1(n,t,e,i,r){const a=e.getStroke();if(a){const g=n.getBuilder(e.getZIndex(),"LineString");g.setFillStrokeStyle(null,a),g.drawMultiLineString(t,i,r)}const f=e.getText();if(f&&f.getText()){const g=n.getBuilder(e.getZIndex(),"Text");g.setTextStyle(f),g.drawText(t,i,r)}}function n1(n,t,e,i,r){const a=e.getFill(),f=e.getStroke();if(f||a){const p=n.getBuilder(e.getZIndex(),"Polygon");p.setFillStrokeStyle(a,f),p.drawMultiPolygon(t,i,r)}const g=e.getText();if(g&&g.getText()){const p=n.getBuilder(e.getZIndex(),"Text");p.setTextStyle(g),p.drawText(t,i,r)}}function r1(n,t,e,i,r,a){const f=e.getImage(),g=e.getText(),p=g&&g.getText(),y=a&&f&&p?{}:void 0;if(f){if(f.getImageState()!=lt.LOADED)return;const v=n.getBuilder(e.getZIndex(),"Image");v.setImageStyle(f,y),v.drawPoint(t,i,r)}if(p){const v=n.getBuilder(e.getZIndex(),"Text");v.setTextStyle(g,y),v.drawText(t,i,r)}}function s1(n,t,e,i,r,a){const f=e.getImage(),g=f&&f.getOpacity()!==0,p=e.getText(),y=p&&p.getText(),v=a&&g&&y?{}:void 0;if(g){if(f.getImageState()!=lt.LOADED)return;const x=n.getBuilder(e.getZIndex(),"Image");x.setImageStyle(f,v),x.drawMultiPoint(t,i,r)}if(y){const x=n.getBuilder(e.getZIndex(),"Text");x.setTextStyle(p,v),x.drawText(t,i,r)}}function o1(n,t,e,i,r){const a=e.getFill(),f=e.getStroke();if(a||f){const p=n.getBuilder(e.getZIndex(),"Polygon");p.setFillStrokeStyle(a,f),p.drawPolygon(t,i,r)}const g=e.getText();if(g&&g.getText()){const p=n.getBuilder(e.getZIndex(),"Text");p.setTextStyle(g),p.drawText(t,i,r)}}class a1 extends Xh{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Fe(),this.wrappedRenderedExtent_=Fe(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const r=e.extent,a=e.viewState,f=a.center,g=a.resolution,p=a.projection,y=a.rotation,v=p.getExtent(),x=this.getLayer().getSource(),R=this.getLayer().getDeclutter(),S=e.pixelRatio,I=e.viewHints,L=!(I[ge.ANIMATING]||I[ge.INTERACTING]),O=this.context,M=Math.round(It(r)/g*S),P=Math.round(Ht(r)/g*S),X=x.getWrapX()&&p.canWrapX(),b=X?It(v):null,G=X?Math.ceil((r[2]-v[2])/b)+1:1;let W=X?Math.floor((r[0]-v[0])/b):0;do{let j=this.getRenderTransform(f,g,0,S,M,P,W*b);e.declutter&&(j=j.slice(0)),t.execute(O,[O.canvas.width,O.canvas.height],j,y,L,i===void 0?Sr:i?Bd:Ux,i?R&&e.declutter[R]:void 0)}while(++W<G)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=ee(this.context.canvas.width,this.context.canvas.height,Vu))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Ra(this.context),Vu.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const r=t.viewState;this.prepareContainer(t,e);const a=this.context,f=this.replayGroup_;let g=f&&!f.isEmpty();if(!g&&!(this.getLayer().hasListener(He.PRERENDER)||this.getLayer().hasListener(He.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(a,t),r.projection,this.clipped_=!1,g&&i.extent&&this.clipping){const p=pi(i.extent);g=Re(p,t.extent),this.clipped_=g&&!yn(p,t.extent),this.clipped_&&this.clipUnrotated(a,t,p)}return g&&this.renderWorlds(f,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&a.restore(),this.postRender(a,t),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),r=this.renderedCenter_,a=this.renderedResolution_,f=this.renderedRotation_,g=this.renderedProjection_,p=this.wrappedRenderedExtent_,y=this.getLayer(),v=[],x=i[0]*gi,R=i[1]*gi;v.push(this.getRenderTransform(r,a,f,gi,x,R,0).slice());const S=y.getSource(),I=g.getExtent();if(S.getWrapX()&&g.canWrapX()&&!yn(I,p)){let L=p[0];const O=It(I);let M=0,P;for(;L<I[0];)--M,P=O*M,v.push(this.getRenderTransform(r,a,f,gi,x,R,P).slice()),L+=O;for(M=0,L=p[2];L>I[2];)++M,P=O*M,v.push(this.getRenderTransform(r,a,f,gi,x,R,P).slice()),L-=O}this.hitDetectionImageData_=Zx(i,v,this.renderedFeatures_,y.getStyleFunction(),p,a,f,_f(a,this.renderedPixelRatio_))}e(Hx(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,r,a){var R,S;if(!this.replayGroup_)return;const f=e.viewState.resolution,g=e.viewState.rotation,p=this.getLayer(),y={},v=function(I,L,O){const M=Mt(I),P=y[M];if(P){if(P!==!0&&O<P.distanceSq){if(O===0)return y[M]=!0,a.splice(a.lastIndexOf(P),1),r(I,p,L);P.geometry=L,P.distanceSq=O}}else{if(O===0)return y[M]=!0,r(I,p,L);a.push(y[M]={feature:I,layer:p,geometry:L,distanceSq:O,callback:r})}},x=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,f,g,i,v,x?(S=(R=e.declutter)==null?void 0:R[x])==null?void 0:S.all().map(I=>I.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const r=t.viewHints[ge.ANIMATING],a=t.viewHints[ge.INTERACTING],f=e.getUpdateWhileAnimating(),g=e.getUpdateWhileInteracting();if(this.ready&&!f&&r||!g&&a)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const p=t.extent,y=t.viewState,v=y.projection,x=y.resolution,R=t.pixelRatio,S=e.getRevision(),I=e.getRenderBuffer();let L=e.getRenderOrder();L===void 0&&(L=qx);const O=y.center.slice(),M=fa(p,I*x),P=M.slice(),X=[M.slice()],b=v.getExtent();if(i.getWrapX()&&v.canWrapX()&&!yn(b,t.extent)){const $=It(b),et=Math.max(It(M)/2,$);M[0]=b[0]-et,M[2]=b[2]+et,Mf(O,v);const nt=Af(X[0],v);nt[0]<b[0]&&nt[2]<b[2]?X.push([nt[0]+$,nt[1],nt[2]+$,nt[3]]):nt[0]>b[0]&&nt[2]>b[2]&&X.push([nt[0]-$,nt[1],nt[2]-$,nt[3]])}if(this.ready&&this.renderedResolution_==x&&this.renderedRevision_==S&&this.renderedRenderOrder_==L&&this.renderedFrameDeclutter_===!!t.declutter&&yn(this.wrappedRenderedExtent_,M))return In(this.renderedExtent_,P)||(this.hitDetectionImageData_=null,this.renderedExtent_=P),this.renderedCenter_=O,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const G=new Yx(Ud(x,R),M,x,R);let W;for(let $=0,et=X.length;$<et;++$)i.loadFeatures(X[$],x,v);const j=_f(x,R);let Y=!0;const V=($,et)=>{let nt;const rt=$.getStyleFunction()||e.getStyleFunction();if(rt&&(nt=rt($,x)),nt){const ft=this.renderFeature($,j,nt,G,W,this.getLayer().getDeclutter(),et);Y=Y&&!ft}},U=Wf(M),it=i.getFeaturesInExtent(U);L&&it.sort(L);for(let $=0,et=it.length;$<et;++$)V(it[$],$);this.renderedFeatures_=it,this.ready=Y;const q=G.finish(),K=new jx(M,x,R,i.getOverlaps(),q,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=x,this.renderedRevision_=S,this.renderedRenderOrder_=L,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=P,this.wrappedRenderedExtent_=M,this.renderedCenter_=O,this.renderedProjection_=v,this.renderedPixelRatio_=R,this.replayGroup_=K,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,r,a,f,g){if(!i)return!1;let p=!1;if(Array.isArray(i))for(let y=0,v=i.length;y<v;++y)p=pf(r,t,i[y],e,this.boundHandleStyleImageChange_,a,f,g)||p;else p=pf(r,t,i,e,this.boundHandleStyleImageChange_,a,f,g);return p}}class Vd extends xd{constructor(t){super(t)}createRenderer(){return new a1(this)}}class l1 extends Nd{constructor(t){t=t||{},super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(e){const i=e.getGeometry();return Dt(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,i){var r;(r=this.source)==null||r.loadFeatures(t,e,i),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(mt.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(mt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const i=t===0?0:Math.min(e,t)/t,r=t!==this.distance||this.interpolationRatio!==i;this.distance=t,this.minDistance=e,this.interpolationRatio=i,r&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=Fe(),e=this.distance*this.resolution,i=this.source.getFeatures(),r={};for(let a=0,f=i.length;a<f;a++){const g=i[a];if(!(Mt(g)in r)){const p=this.geometryFunction(g);if(p){const y=p.getCoordinates();ih(y,t),fa(t,e,t);const v=this.source.getFeaturesInExtent(t).filter(function(x){const R=Mt(x);return R in r?!1:(r[R]=!0,!0)});this.features.push(this.createCluster(v,t))}}}}createCluster(t,e){const i=[0,0];for(let g=t.length-1;g>=0;--g){const p=this.geometryFunction(t[g]);p?Lf(i,p.getCoordinates()):t.splice(g,1)}Of(i,1/t.length);const r=Je(e),a=this.interpolationRatio,f=new Vn([i[0]*(1-a)+r[0]*a,i[1]*(1-a)+r[1]*a]);return this.createCustomCluster_?this.createCustomCluster_(f,t):new io({geometry:f,features:t})}}const h1="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5%201H6V5H10V6H6V10H5V6H1L1%205H5V1Z'%20fill='white'/%3e%3c/svg%3e",c1="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M15%203H18V15H30V18H18V30H15V18H3V15L15%2015V3Z'%20fill='white'/%3e%3c/svg%3e",te={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},u1={ERROR:"error"};class f1 extends Qe{constructor(t){super(u1.ERROR),this.code=t.code,this.message=t.message}}class d1 extends li{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.position_=null,this.transform_=Ay,this.watchId_=void 0,this.addChangeListener(te.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(te.TRACKING,this.handleTrackingChanged_),t.projection!==void 0&&this.setProjection(t.projection),t.trackingOptions!==void 0&&this.setTrackingOptions(t.trackingOptions),this.setTracking(t.tracking!==void 0?t.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const t=this.getProjection();t&&(this.transform_=ya($t("EPSG:4326"),t),this.position_&&this.set(te.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const t=this.getTracking();t&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!t&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(t){const e=t.coords;this.set(te.ACCURACY,e.accuracy),this.set(te.ALTITUDE,e.altitude===null?void 0:e.altitude),this.set(te.ALTITUDE_ACCURACY,e.altitudeAccuracy===null?void 0:e.altitudeAccuracy),this.set(te.HEADING,e.heading===null?void 0:oi(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];const i=this.transform_(this.position_);this.set(te.POSITION,i.slice()),this.set(te.SPEED,e.speed===null?void 0:e.speed);const r=Jy(this.position_,e.accuracy);r.applyTransform(this.transform_),this.set(te.ACCURACY_GEOMETRY,r),this.changed()}positionError_(t){this.dispatchEvent(new f1(t))}getAccuracy(){return this.get(te.ACCURACY)}getAccuracyGeometry(){return this.get(te.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(te.ALTITUDE)}getAltitudeAccuracy(){return this.get(te.ALTITUDE_ACCURACY)}getHeading(){return this.get(te.HEADING)}getPosition(){return this.get(te.POSITION)}getProjection(){return this.get(te.PROJECTION)}getSpeed(){return this.get(te.SPEED)}getTracking(){return this.get(te.TRACKING)}getTrackingOptions(){return this.get(te.TRACKING_OPTIONS)}setProjection(t){this.set(te.PROJECTION,$t(t))}setTracking(t){this.set(te.TRACKING,t)}setTrackingOptions(t){this.set(te.TRACKING_OPTIONS,t)}}const Nn=window.innerWidth/2,wr=window.innerHeight/2;let mf,jt,Hl=[Nn,wr],Zh=0,$l="",gn="black",la=6,Dr=8,Kd=150,ha=new di({center:[11834170421e-3,1879590664e-3],zoom:6,maxZoom:18}),Zd=new d1({trackingOptions:{enableHighAccuracy:!0},projection:ha.getProjection()});Zd.setTracking(1);window.addEventListener("resize",Hd,!1);function Hh(n){return{"No protection":"yellow",Demolished:"black","In danger":"red",Protected:"green"}[n]}function g1(n,t,e,i,r){return(i-r)/(t-e)*(n-e)+r}function _1(n,t,e=!0){const i=Math.ceil(window.devicePixelRatio),r=document.getElementById("myCanvas");return r.width=n*i,r.height=t*i,r.style.width=`${n}px`,r.style.height=`${t}px`,e&&r.getContext("2d").setTransform(i,0,0,i,0,0),r}function Hd(){mf=_1(window.innerWidth,window.innerHeight),jt=mf.getContext("2d"),$h()}Hd();function $h(){if(jt.clearRect(0,0,Nn*2,wr*2),Zh>0){jt.strokeStyle=gn,jt.beginPath(),jt.moveTo(Nn,wr),jt.lineTo(Hl[0],Hl[1]),jt.stroke(),jt.font="bold 16px Courier",jt.textAlign="center";let n=$l.length*5;console.log(Nn-n),(gn=="#FFFFFF"||gn==null)&&(jt.fillStyle="white"),jt.fillStyle=gn,jt.beginPath(),jt.rect(Nn-n,wr-16,n*2,20),jt.fill(),gn=="#FFFFFF"||gn==null||gn=="yellow"?jt.fillStyle="black":jt.fillStyle="white",jt.fillText($l,Nn,wr)}else jt.beginPath(),jt.arc(Nn,wr,Kd,0,2*Math.PI),jt.strokeStyle="white",jt.lineWidth=1,jt.setLineDash([1,3]),jt.stroke(),jt.fillStyle="#FFFFFF30",jt.fill(),jt.setLineDash([])}let p1=new yi({image:new Ur({color:"white",scale:1,crossOrigin:"anonymous",src:h1})});var $d=new Nd({projection:"EPSG:3857",url:"https://raw.githubusercontent.com/kaheetonaa/GridsforAll/refs/heads/main/data/output.geojson",format:new yx});const m1=new l1({distance:30,minDistance:0,source:$d}),y1=new Vd({className:"building",source:m1,style:function(n){Hh(n.values_.features[0].values_.STATUS);const t=n.get("features").length;let e;return e=new yi({image:new Qs({radius:g1(t,100,2,50,10),fill:new Zn({color:"black"})}),text:new Sa({text:t.toString(),fill:new Zn({color:"white"}),offsetX:0,offsetY:0})}),e},maxZoom:Dr}),v1=new Vd({className:"building",source:$d,style:function(n){console.log(n);let t=Hh(n.values_.STATUS),e;return e=new yi({image:new Ur({color:t,scale:1,crossOrigin:"anonymous",src:c1})}),e},minZoom:Dr}),qh=new bd({sources:[new lx({attributions:'Tiles  <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})],operation:function(n){function t(a){const f=255-a[0],g=255-a[1],p=255-a[2];return a[0]=f,a[1]=g,a[2]=p,a}function e(a){let f=a[0]/255,g=a[1]/255,p=a[2]/255;var y=Math.max(f,g,p),v=Math.min(f,g,p),x=(y+v)/2,R,S;if(y==v)R=0,S=0;else{var I=y-v;switch(S=I/(1-Math.abs(2*x-1)),y){case f:break;case g:R=(p-f)/I+2;break;case p:R=(f-g)/I+4;break}}let L=Math.round(R*60),O=Math.round(S*100),M=Math.round(x*100);return a[0]=L,a[1]=O,a[2]=M,a}function i(a){h=a[0],s=a[1],l=a[2];let f,g,p,y,v,x;return isFinite(h)||(h=0),isFinite(s)||(s=0),isFinite(l)||(l=0),h/=60,h<0&&(h=6- -h%6),h%=6,s=Math.max(0,Math.min(1,s/100)),l=Math.max(0,Math.min(1,l/100)),v=(1-Math.abs(2*l-1))*s,x=v*(1-Math.abs(h%2-1)),h<1?(f=v,g=x,p=0):h<2?(f=x,g=v,p=0):h<3?(f=0,g=v,p=x):h<4?(f=0,g=x,p=v):h<5?(f=x,g=0,p=v):(f=v,g=0,p=x),y=l-v/2,a[0]=Math.round((f+y)*255),a[1]=Math.round((g+y)*255),a[2]=Math.round((p+y)*255),a}const r=e(n[0]);return r[1]*=0,r[2]*=1,t(i(r))}}),pn=new Zv({layers:[new Td({source:qh}),v1,y1],target:"map",view:ha});let Ir=[25e4,5e4,5e3,1e3,200],ki=Ir[0],ql=new dx({originCoordinate:[0,0],rotationAnchorCoordinate:[0,1],xGridSize:ki,yGridSize:ki,style:p1});pn.addInteraction(ql);qh.on("beforeoperations",()=>{});qh.on("afteroperations",()=>{});pn.on("movestart",n=>{Zh=0,$h()});pn.on("moveend",n=>{let t=pn.getView().getZoom();la=t,t<=8&&(ki=Ir[0]),t<=11&&t>8&&(ki=Ir[1]),t<=14&&t>11&&(ki=Ir[2]),t<=16&&t>14&&(ki=Ir[3]),t>16&&(ki=Ir[4]),ql.setXGridSize(ki),ql.setYGridSize(ki),la>=Dr&&(pn.forEachFeatureAtPixel(pn.getPixelFromCoordinate(pn.getView().getCenter()),e=>(Zh=1,Hl=pn.getPixelFromCoordinate(e.values_.geometry.flatCoordinates),$l=e.values_["(1) BUILDING NAME "],gn=Hh(e.values_.STATUS),!0),{layerFilter:e=>e.className_=="building",hitTolerance:Kd}),$h())});document.getElementById("geolocate_button").onclick=()=>{E1()};function E1(){let n=Zd.getPosition();ha.setCenter(n),la<Dr&&(la=Dr,ha.setZoom(Dr))}
