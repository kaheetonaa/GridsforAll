var E_=Object.defineProperty;var x_=(i,t,e)=>t in i?E_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var rh=(i,t,e)=>x_(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const c of h.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(s){if(s.ep)return;s.ep=!0;const h=e(s);fetch(s.href,h)}})();const Re={ADD:"add",REMOVE:"remove"},hr={PROPERTYCHANGE:"propertychange"},ct={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class mr{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function As(i,t){return i>t?1:i<t?-1:0}function Os(i,t,e){if(i[0]<=t)return 0;const r=i.length;if(t<=i[r-1])return r-1;if(typeof e=="function"){for(let s=1;s<r;++s){const h=i[s];if(h===t)return s;if(h<t)return e(t,i[s-1],h)>0?s-1:s}return r-1}if(e>0){for(let s=1;s<r;++s)if(i[s]<t)return s-1;return r-1}if(e<0){for(let s=1;s<r;++s)if(i[s]<=t)return s;return r-1}for(let s=1;s<r;++s){if(i[s]==t)return s;if(i[s]<t)return i[s-1]-t<t-i[s]?s-1:s}return r-1}function R_(i,t){const e=Array.isArray(t)?t:[t],r=e.length;for(let s=0;s<r;s++)i[i.length]=e[s]}function Ls(i,t){const e=i.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function w_(i,t,e){const r=t||As;return i.every(function(s,h){if(h===0)return!0;const c=r(i[h-1],s);return!(c>0||c===0)})}function ds(){return!0}function Ms(){return!1}function gs(){}function T_(i){let t,e,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!Ls(s,e))&&(r=this,e=s,t=i.apply(this,arguments)),t}}function sa(i){function t(){let e;try{e=i()}catch(r){return Promise.reject(r)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Ps(i){for(const t in i)delete i[t]}function gu(i){let t;for(t in i)return!1;return!t}class Ne{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class vr extends mr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const r=this.listeners_||(this.listeners_={}),s=r[t]||(r[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",r=e?t:t.type,s=this.listeners_&&this.listeners_[r];if(!s)return;const h=e?new Ne(t):t;h.target||(h.target=this.eventTarget_||this);const c=this.dispatching_||(this.dispatching_={}),d=this.pendingRemovals_||(this.pendingRemovals_={});r in c||(c[r]=0,d[r]=0),++c[r];let g;for(let m=0,y=s.length;m<y;++m)if("handleEvent"in s[m]?g=s[m].handleEvent(h):g=s[m].call(this,h),g===!1||h.propagationStopped){g=!1;break}if(--c[r]===0){let m=d[r];for(delete d[r];m--;)this.removeEventListener(r,gs);delete c[r]}return g}disposeInternal(){this.listeners_&&Ps(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const r=this.listeners_[t];if(!r)return;const s=r.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[s]=gs,++this.pendingRemovals_[t]):(r.splice(s,1),r.length===0&&delete this.listeners_[t]))}}function St(i,t,e,r,s){if(s){const c=e;e=function(d){return i.removeEventListener(t,e),c.call(r??this,d)}}else r&&r!==i&&(e=e.bind(r));const h={target:i,type:t,listener:e};return i.addEventListener(t,e),h}function _s(i,t,e,r){return St(i,t,e,r,!0)}function Gt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Ps(i))}class _u extends vr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ct.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const r=t.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=St(this,t[h],e);return s}return St(this,t,e)}onceInternal(t,e){let r;if(Array.isArray(t)){const s=t.length;r=new Array(s);for(let h=0;h<s;++h)r[h]=_s(this,t[h],e)}else r=_s(this,t,e);return e.ol_key=r,r}unInternal(t,e){const r=e.ol_key;if(r)I_(r);else if(Array.isArray(t))for(let s=0,h=t.length;s<h;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}function I_(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Gt(i[t]);else Gt(i)}function Tt(){throw new Error("Unimplemented abstract method.")}let C_=0;function ee(i){return i.ol_uid||(i.ol_uid=String(++C_))}class sh extends Ne{constructor(t,e,r){super(t),this.key=e,this.oldValue=r}}class $e extends _u{constructor(t){super(),this.on,this.once,this.un,ee(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new sh(r,t,e)),r=hr.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new sh(r,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,r){const s=this.values_||(this.values_={});if(r)s[t]=e;else{const h=s[t];s[t]=e,h!==e&&this.notify(t,h)}}setProperties(t,e){for(const r in t)this.set(r,t[r],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const r=this.values_[t];delete this.values_[t],gu(this.values_)&&(this.values_=null),e||this.notify(t,r)}}}const oh={LENGTH:"length"};class qr extends Ne{constructor(t,e,r){super(t),this.element=e,this.index=r}}class Ve extends $e{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let r=0,s=this.array_.length;r<s;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,r=t.length;e<r;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let r=0,s=e.length;r<s;++r)t(e[r],r,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(oh.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new qr(Re.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let r=0,s=e.length;r<s;++r)if(e[r]===t)return this.removeAt(r)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new qr(Re.REMOVE,e,t)),e}setAt(t,e){const r=this.getLength();if(t>=r){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new qr(Re.REMOVE,s,t)),this.dispatchEvent(new qr(Re.ADD,e,t))}updateLength_(){this.set(oh.LENGTH,this.array_.length)}assertUnique_(t,e){for(let r=0,s=this.array_.length;r<s;++r)if(this.array_[r]===t&&r!==e)throw new Error("Duplicate item added to a unique collection")}}class si extends Ne{constructor(t,e,r){super(t),this.map=e,this.frameState=r!==void 0?r:null}}class fn extends si{constructor(t,e,r,s,h,c){super(t,e,h),this.originalEvent=r,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=c}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Ut={SINGLECLICK:"singleclick",CLICK:ct.CLICK,DBLCLICK:ct.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},yn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",S_=yn.includes("firefox"),A_=yn.includes("safari")&&!yn.includes("chrom");A_&&(yn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(yn));const O_=yn.includes("webkit")&&!yn.includes("edge"),pu=yn.includes("macintosh"),mu=typeof devicePixelRatio<"u"?devicePixelRatio:1,vu=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,yu=typeof Image<"u"&&Image.prototype.decode,L_=typeof createImageBitmap=="function",Eu=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}(),jo={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class M_ extends vr{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const r=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=r,this.pointerdownListenerKey_=St(r,jo.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=St(r,jo.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ct.TOUCHMOVE,this.boundHandleTouchMove_,Eu?{passive:!1}:!1)}emulateClick_(t){let e=new fn(Ut.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new fn(Ut.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const r=new fn(Ut.SINGLECLICK,this.map_,t);this.dispatchEvent(r)},250)}updateActivePointers_(t){const e=t,r=e.pointerId;if(e.type==Ut.POINTERUP||e.type==Ut.POINTERCANCEL){delete this.trackedTouches_[r];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==Ut.POINTERDOWN||e.type==Ut.POINTERMOVE)&&(this.trackedTouches_[r]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new fn(Ut.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Gt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new fn(Ut.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const r=this.map_.getOwnerDocument();this.dragListenerKeys_.push(St(r,Ut.POINTERMOVE,this.handlePointerMove_,this),St(r,Ut.POINTERUP,this.handlePointerUp_,this),St(this.element_,Ut.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==r&&this.dragListenerKeys_.push(St(this.element_.getRootNode(),Ut.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new fn(Ut.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new fn(Ut.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Gt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ct.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Gt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Gt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const dn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},se={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},K={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Mt(i,t){if(!i)throw new Error(t)}const ps=1/0;class P_{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Ps(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,r=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(r);return delete this.queuedElements_[s],r}enqueue(t){Mt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=ps?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,r=this.priorities_,s=e.length,h=e[t],c=r[t],d=t;for(;t<s>>1;){const g=this.getLeftChildIndex_(t),m=this.getRightChildIndex_(t),y=m<s&&r[m]<r[g]?m:g;e[t]=e[y],r[t]=r[y],t=y}e[t]=h,r[t]=c,this.siftDown_(d,t)}siftDown_(t,e){const r=this.elements_,s=this.priorities_,h=r[e],c=s[e];for(;e>t;){const d=this.getParentIndex_(e);if(s[d]>c)r[e]=r[d],s[e]=s[d],e=d;else break}r[e]=h,s[e]=c}reprioritize(){const t=this.priorityFunction_,e=this.elements_,r=this.priorities_;let s=0;const h=e.length;let c,d,g;for(d=0;d<h;++d)c=e[d],g=t(c),g==ps?delete this.queuedElements_[this.keyFunction_(c)]:(r[s]=g,e[s++]=c);e.length=s,r.length=s,this.heapify_()}}class xu extends P_{constructor(t,e){super(r=>t.apply(null,r),r=>r[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(ct.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,r=e.getState();if(r===K.LOADED||r===K.ERROR||r===K.EMPTY){r!==K.ERROR&&e.removeEventListener(ct.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let r=0;for(;this.tilesLoading_<t&&r<e&&this.getCount()>0;){const s=this.dequeue()[0],h=s.getKey();s.getState()===K.IDLE&&!(h in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[h]=!0,++this.tilesLoading_,++r,s.load())}}}function D_(i,t,e,r,s){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return ps;const h=i.viewState.center,c=r[0]-h[0],d=r[1]-h[1];return 65536*Math.log(s)+Math.sqrt(c*c+d*d)/s}const fe={ANIMATING:0,INTERACTING:1},Se={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Kt(i,t,e){return Math.min(Math.max(i,t),e)}function F_(i,t,e,r,s,h){const c=s-e,d=h-r;if(c!==0||d!==0){const g=((i-e)*c+(t-r)*d)/(c*c+d*d);g>1?(e=s,r=h):g>0&&(e+=c*g,r+=d*g)}return hi(i,t,e,r)}function hi(i,t,e,r){const s=e-i,h=r-t;return s*s+h*h}function b_(i){const t=i.length;for(let r=0;r<t;r++){let s=r,h=Math.abs(i[r][r]);for(let d=r+1;d<t;d++){const g=Math.abs(i[d][r]);g>h&&(h=g,s=d)}if(h===0)return null;const c=i[s];i[s]=i[r],i[r]=c;for(let d=r+1;d<t;d++){const g=-i[d][r]/i[r][r];for(let m=r;m<t+1;m++)r==m?i[d][m]=0:i[d][m]+=g*i[r][m]}}const e=new Array(t);for(let r=t-1;r>=0;r--){e[r]=i[r][t]/i[r][r];for(let s=r-1;s>=0;s--)i[s][t]-=i[s][r]*e[r]}return e}function ah(i){return i*180/Math.PI}function pn(i){return i*Math.PI/180}function ui(i,t){const e=i%t;return e*t<0?e+t:e}function N_(i,t,e){return i+e*(t-i)}function Ru(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function Jr(i,t){return Math.floor(Ru(i,t))}function _n(i,t){return Math.ceil(Ru(i,t))}function Vo(i,t,e){if(i>=t&&i<e)return i;const r=e-t;return((i-t)%r+r)%r+t}function lh(i,t,e){return function(r,s,h,c,d){if(!r)return;if(!s&&!t)return r;const g=t?0:h[0]*s,m=t?0:h[1]*s,y=d?d[0]:0,x=d?d[1]:0;let R=i[0]+g/2+y,C=i[2]-g/2+y,T=i[1]+m/2+x,O=i[3]-m/2+x;R>C&&(R=(C+R)/2,C=R),T>O&&(T=(O+T)/2,O=T);let M=Kt(r[0],R,C),F=Kt(r[1],T,O);if(c&&e&&s){const D=30*s;M+=-D*Math.log(1+Math.max(0,R-r[0])/D)+D*Math.log(1+Math.max(0,r[0]-C)/D),F+=-D*Math.log(1+Math.max(0,T-r[1])/D)+D*Math.log(1+Math.max(0,r[1]-O)/D)}return[M,F]}}function G_(i){return i}const te={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function hh(i){const t=En();for(let e=0,r=i.length;e<r;++e)as(t,i[e]);return t}function k_(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function wu(i,t,e){let r,s;return t<i[0]?r=i[0]-t:i[2]<t?r=t-i[2]:r=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,r*r+s*s}function Ds(i,t){return Tu(i,t[0],t[1])}function Zo(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function Tu(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function uh(i,t){const e=i[0],r=i[1],s=i[2],h=i[3],c=t[0],d=t[1];let g=te.UNKNOWN;return c<e?g=g|te.LEFT:c>s&&(g=g|te.RIGHT),d<r?g=g|te.BELOW:d>h&&(g=g|te.ABOVE),g===te.UNKNOWN&&(g=te.INTERSECTING),g}function En(){return[1/0,1/0,-1/0,-1/0]}function yr(i,t,e,r,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=r,s):[i,t,e,r]}function Fs(i){return yr(1/0,1/0,-1/0,-1/0,i)}function X_(i,t){const e=i[0],r=i[1];return yr(e,r,e,r,t)}function z_(i,t,e,r,s){const h=Fs(s);return Cu(h,i,t,e,r)}function gi(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function Iu(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function as(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function Cu(i,t,e,r,s){for(;e<r;e+=s)Y_(i,t[e],t[e+1]);return i}function Y_(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Su(i,t){let e;return e=t(bs(i)),e||(e=t(Ns(i)),e)||(e=t(Gs(i)),e)||(e=t(He(i)),e)?e:!1}function ur(i){let t=0;return yi(i)||(t=yt(i)*Wt(i)),t}function bs(i){return[i[0],i[1]]}function Ns(i){return[i[2],i[1]]}function Ke(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function B_(i,t){let e;if(t==="bottom-left")e=bs(i);else if(t==="bottom-right")e=Ns(i);else if(t==="top-left")e=He(i);else if(t==="top-right")e=Gs(i);else throw new Error("Invalid corner");return e}function ms(i,t,e,r,s){const[h,c,d,g,m,y,x,R]=Au(i,t,e,r);return yr(Math.min(h,d,m,x),Math.min(c,g,y,R),Math.max(h,d,m,x),Math.max(c,g,y,R),s)}function Au(i,t,e,r){const s=t*r[0]/2,h=t*r[1]/2,c=Math.cos(e),d=Math.sin(e),g=s*c,m=s*d,y=h*c,x=h*d,R=i[0],C=i[1];return[R-g+x,C-m-y,R-g-x,C-m+y,R+g-x,C+m+y,R+g+x,C+m-y,R-g+x,C-m-y]}function Wt(i){return i[3]-i[1]}function pe(i,t,e){const r=e||En();return vi(i,t)?(i[0]>t[0]?r[0]=i[0]:r[0]=t[0],i[1]>t[1]?r[1]=i[1]:r[1]=t[1],i[2]<t[2]?r[2]=i[2]:r[2]=t[2],i[3]<t[3]?r[3]=i[3]:r[3]=t[3]):Fs(r),r}function He(i){return[i[0],i[3]]}function Gs(i){return[i[2],i[3]]}function yt(i){return i[2]-i[0]}function vi(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function yi(i){return i[2]<i[0]||i[3]<i[1]}function U_(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function W_(i,t,e){let r=!1;const s=uh(i,t),h=uh(i,e);if(s===te.INTERSECTING||h===te.INTERSECTING)r=!0;else{const c=i[0],d=i[1],g=i[2],m=i[3],y=t[0],x=t[1],R=e[0],C=e[1],T=(C-x)/(R-y);let O,M;h&te.ABOVE&&!(s&te.ABOVE)&&(O=R-(C-m)/T,r=O>=c&&O<=g),!r&&h&te.RIGHT&&!(s&te.RIGHT)&&(M=C-(R-g)*T,r=M>=d&&M<=m),!r&&h&te.BELOW&&!(s&te.BELOW)&&(O=R-(C-d)/T,r=O>=c&&O<=g),!r&&h&te.LEFT&&!(s&te.LEFT)&&(M=C-(R-c)*T,r=M>=d&&M<=m)}return r}function j_(i,t){const e=t.getExtent(),r=Ke(i);if(t.canWrapX()&&(r[0]<e[0]||r[0]>=e[2])){const s=yt(e),c=Math.floor((r[0]-e[0])/s)*s;i[0]-=c,i[2]-=c}return i}function Ou(i,t,e){if(t.canWrapX()){const r=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[r[0],i[1],r[2],i[3]]];j_(i,t);const s=yt(r);if(yt(i)>s,i[0]<r[0])return[[i[0]+s,i[1],r[2],i[3]],[r[0],i[1],i[2],i[3]]];if(i[2]>r[2])return[[i[0],i[1],r[2],i[3]],[r[0],i[1],i[2]-s,i[3]]]}return[i]}function V_(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function vs(i,t){let e=!0;for(let r=i.length-1;r>=0;--r)if(i[r]!=t[r]){e=!1;break}return e}function oa(i,t){const e=Math.cos(t),r=Math.sin(t),s=i[0]*e-i[1]*r,h=i[1]*e+i[0]*r;return i[0]=s,i[1]=h,i}function Z_(i,t){return i[0]*=t,i[1]*=t,i}function K_(i,t){if(t.canWrapX()){const e=yt(t.getExtent()),r=H_(i,t,e);r&&(i[0]-=r*e)}return i}function H_(i,t,e){const r=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<r[0]||i[0]>r[2])&&(e=e||yt(r),s=Math.floor((i[0]-r[0])/e)),s}function Lu(i){return Math.pow(i,3)}function Ei(i){return 1-Lu(1-i)}function $_(i){return 3*i*i-2*i*i*i}function q_(i){return i}const J_=63710088e-1;function ch(i,t,e){e=e||J_;const r=pn(i[1]),s=pn(t[1]),h=(s-r)/2,c=pn(t[0]-i[0])/2,d=Math.sin(h)*Math.sin(h)+Math.sin(c)*Math.sin(c)*Math.cos(r)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}function Mu(...i){console.warn(...i)}const aa={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class la{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||aa[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Er=6378137,li=Math.PI*Er,Q_=[-li,-li,li,li],tp=[-180,-85,180,85],Qr=Er*Math.log(Math.tan(Math.PI/2));class qn extends la{constructor(t){super({code:t,units:"m",extent:Q_,global:!0,worldExtent:tp,getPointResolution:function(e,r){return e/Math.cosh(r[1]/Er)}})}}const fh=[new qn("EPSG:3857"),new qn("EPSG:102100"),new qn("EPSG:102113"),new qn("EPSG:900913"),new qn("http://www.opengis.net/def/crs/EPSG/0/3857"),new qn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ep(i,t,e,r){const s=i.length;e=e>1?e:2,r=r??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let h=0;h<s;h+=r){t[h]=li*i[h]/180;let c=Er*Math.log(Math.tan(Math.PI*(+i[h+1]+90)/360));c>Qr?c=Qr:c<-Qr&&(c=-Qr),t[h+1]=c}return t}function np(i,t,e,r){const s=i.length;e=e>1?e:2,r=r??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let h=0;h<s;h+=r)t[h]=180*i[h]/li,t[h+1]=360*Math.atan(Math.exp(i[h+1]/Er))/Math.PI-90;return t}const ip=6378137,dh=[-180,-90,180,90],rp=Math.PI*ip/180;class An extends la{constructor(t,e){super({code:t,units:"degrees",extent:dh,axisOrientation:e,global:!0,metersPerUnit:rp,worldExtent:dh})}}const gh=[new An("CRS:84"),new An("EPSG:4326","neu"),new An("urn:ogc:def:crs:OGC:1.3:CRS84"),new An("urn:ogc:def:crs:OGC:2:84"),new An("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new An("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new An("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ko={};function sp(i){return Ko[i]||Ko[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function op(i,t){Ko[i]=t}let ci={};function cr(i,t,e){const r=i.getCode(),s=t.getCode();r in ci||(ci[r]={}),ci[r][s]=e}function Io(i,t){return i in ci&&t in ci[i]?ci[i][t]:null}const ys=.9996,Te=.00669438,ks=Te*Te,Xs=ks*Te,Mn=Te/(1-Te),_h=Math.sqrt(1-Te),_i=(1-_h)/(1+_h),Pu=_i*_i,ha=Pu*_i,ua=ha*_i,Du=ua*_i,Fu=1-Te/4-3*ks/64-5*Xs/256,ap=3*Te/8+3*ks/32+45*Xs/1024,lp=15*ks/256+45*Xs/1024,hp=35*Xs/3072,up=3/2*_i-27/32*ha+269/512*Du,cp=21/16*Pu-55/32*ua,fp=151/96*ha-417/128*Du,dp=1097/512*ua,Es=6378137;function gp(i,t,e){const r=i-5e5,c=(e.north?t:t-1e7)/ys/(Es*Fu),d=c+up*Math.sin(2*c)+cp*Math.sin(4*c)+fp*Math.sin(6*c)+dp*Math.sin(8*c),g=Math.sin(d),m=g*g,y=Math.cos(d),x=g/y,R=x*x,C=R*R,T=1-Te*m,O=Math.sqrt(1-Te*m),M=Es/O,F=(1-Te)/T,D=Mn*y**2,U=D*D,N=r/(M*ys),P=N*N,j=P*N,$=j*N,X=$*N,H=X*N,z=d-x/F*(P/2-$/24*(5+3*R+10*D-4*U-9*Mn))+H/720*(61+90*R+298*D+45*C-252*Mn-3*U);let ht=(N-j/6*(1+2*R+D)+X/120*(5-2*D+28*R-3*U+8*Mn+24*C))/y;return ht=Vo(ht+pn(bu(e.number)),-Math.PI,Math.PI),[ah(ht),ah(z)]}const ph=-80,mh=84,_p=-180,pp=180;function mp(i,t,e){i=Vo(i,_p,pp),t<ph?t=ph:t>mh&&(t=mh);const r=pn(t),s=Math.sin(r),h=Math.cos(r),c=s/h,d=c*c,g=d*d,m=pn(i),y=bu(e.number),x=pn(y),R=Es/Math.sqrt(1-Te*s**2),C=Mn*h**2,T=h*Vo(m-x,-Math.PI,Math.PI),O=T*T,M=O*T,F=M*T,D=F*T,U=D*T,N=Es*(Fu*r-ap*Math.sin(2*r)+lp*Math.sin(4*r)-hp*Math.sin(6*r)),P=ys*R*(T+M/6*(1-d+C)+D/120*(5-18*d+g+72*C-58*Mn))+5e5;let j=ys*(N+R*c*(O/2+F/24*(5-d+9*C+4*C**2)+U/720*(61-58*d+g+600*C-330*Mn)));return e.north||(j+=1e7),[P,j]}function bu(i){return(i-1)*6-180+3}const vp=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Nu(i){let t=0;for(const s of vp){const h=i.match(s);if(h){t=parseInt(h[1]);break}}if(!t)return null;let e=0,r=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(r=!0,e=t-32600),e?{number:e,north:r}:null}function vh(i,t){return function(e,r,s,h){const c=e.length;s=s>1?s:2,h=h??s,r||(s>2?r=e.slice():r=new Array(c));for(let d=0;d<c;d+=h){const g=e[d],m=e[d+1],y=i(g,m,t);r[d]=y[0],r[d+1]=y[1]}return r}}function yp(i){return Nu(i)?new la({code:i,units:"m"}):null}function Ep(i){const t=Nu(i.getCode());return t?{forward:vh(mp,t),inverse:vh(gp,t)}:null}const xp=[Ep],Rp=[yp];let Ho=!0;function wp(i){Ho=!1}function ca(i,t){if(t!==void 0){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];t=t}else t=i.slice();return t}function $o(i){op(i.getCode(),i),cr(i,i,ca)}function Tp(i){i.forEach($o)}function me(i){if(typeof i!="string")return i;const t=sp(i);if(t)return t;for(const e of Rp){const r=e(i);if(r)return r}return null}function yh(i,t,e,r){i=me(i);let s;const h=i.getPointResolutionFunc();if(h)s=h(t,e);else{const c=i.getUnits();if(c=="degrees"||r=="degrees")s=t;else{const d=da(i,me("EPSG:4326"));if(!d&&c!=="degrees")s=t*i.getMetersPerUnit();else{let m=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];m=d(m,m,2);const y=ch(m.slice(0,2),m.slice(2,4)),x=ch(m.slice(4,6),m.slice(6,8));s=(y+x)/2}const g=i.getMetersPerUnit();g!==void 0&&(s/=g)}}return s}function Eh(i){Tp(i),i.forEach(function(t){i.forEach(function(e){t!==e&&cr(t,e,ca)})})}function Ip(i,t,e,r){i.forEach(function(s){t.forEach(function(h){cr(s,h,e),cr(h,s,r)})})}function fa(i,t){return i?typeof i=="string"?me(i):i:me(t)}function Cp(i){return function(t,e,r,s){const h=t.length;r=r!==void 0?r:2,s=s??r,e=e!==void 0?e:new Array(h);for(let c=0;c<h;c+=s){const d=i(t.slice(c,c+r)),g=d.length;for(let m=0,y=s;m<y;++m)e[c+m]=m>=g?t[c+m]:d[m]}return e}}function lr(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||da(i,t)===ca)&&e}function da(i,t){const e=i.getCode(),r=t.getCode();let s=Io(e,r);if(s)return s;let h=null,c=null;for(const g of xp)h||(h=g(i)),c||(c=g(t));if(!h&&!c)return null;const d="EPSG:4326";if(c)if(h)s=Co(h.inverse,c.forward);else{const g=Io(e,d);g&&(s=Co(g,c.forward))}else{const g=Io(d,r);g&&(s=Co(h.inverse,g))}return s&&($o(i),$o(t),cr(i,t,s)),s}function Co(i,t){return function(e,r,s,h){return r=i(e,r,s,h),t(r,r,s,h)}}function xs(i,t){const e=me(i),r=me(t);return da(e,r)}function Gu(i,t,e){const r=xs(t,e);if(!r){const s=me(t).getCode(),h=me(e).getCode();throw new Error(`No transform available between ${s} and ${h}`)}return r(i,void 0,i.length)}function qo(i,t){return i}function We(i,t){return Ho&&!vs(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Ho=!1,Mu("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function Sp(i,t){return i}function Ze(i,t){return i}function Ap(){Eh(fh),Eh(gh),Ip(gh,fh,ep,np)}Ap();new Array(6);function mn(){return[1,0,0,1,0,0]}function de(i,t){const e=t[0],r=t[1];return t[0]=i[0]*e+i[2]*r+i[4],t[1]=i[1]*e+i[3]*r+i[5],t}function pi(i,t,e,r,s,h,c,d){const g=Math.sin(h),m=Math.cos(h);return i[0]=r*m,i[1]=s*g,i[2]=-r*g,i[3]=s*m,i[4]=c*r*m-d*r*g+t,i[5]=c*s*g+d*s*m+e,i}function ku(i,t){const e=Op(t);Mt(e!==0,"Transformation matrix cannot be inverted");const r=t[0],s=t[1],h=t[2],c=t[3],d=t[4],g=t[5];return i[0]=c/e,i[1]=-s/e,i[2]=-h/e,i[3]=r/e,i[4]=(h*g-c*d)/e,i[5]=-(r*g-s*d)/e,i}function Op(i){return i[0]*i[3]-i[1]*i[2]}const xh=[1e6,1e6,1e6,1e6,2,2];function Lp(i){return"matrix("+i.map((e,r)=>Math.round(e*xh[r])/xh[r]).join(", ")+")"}function Mp(i,t,e,r,s,h,c){h=h||[],c=c||2;let d=0;for(let g=t;g<e;g+=r){const m=i[g],y=i[g+1];h[d++]=s[0]*m+s[2]*y+s[4],h[d++]=s[1]*m+s[3]*y+s[5];for(let x=2;x<c;x++)h[d++]=i[g+x]}return h&&h.length!=d&&(h.length=d),h}function Pp(i,t,e,r,s,h,c){c=c||[];const d=Math.cos(s),g=Math.sin(s),m=h[0],y=h[1];let x=0;for(let R=t;R<e;R+=r){const C=i[R]-m,T=i[R+1]-y;c[x++]=m+C*d-T*g,c[x++]=y+C*g+T*d;for(let O=R+2;O<R+r;++O)c[x++]=i[O]}return c&&c.length!=x&&(c.length=x),c}function Dp(i,t,e,r,s,h,c,d){d=d||[];const g=c[0],m=c[1];let y=0;for(let x=t;x<e;x+=r){const R=i[x]-g,C=i[x+1]-m;d[y++]=g+s*R,d[y++]=m+h*C;for(let T=x+2;T<x+r;++T)d[y++]=i[T]}return d&&d.length!=y&&(d.length=y),d}function Fp(i,t,e,r,s,h,c){c=c||[];let d=0;for(let g=t;g<e;g+=r){c[d++]=i[g]+s,c[d++]=i[g+1]+h;for(let m=g+2;m<g+r;++m)c[d++]=i[m]}return c&&c.length!=d&&(c.length=d),c}const Rh=mn(),bp=[NaN,NaN];class Np extends $e{constructor(){super(),this.extent_=En(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=T_((t,e,r)=>{if(!r)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(r),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Tt()}closestPointXY(t,e,r,s){return Tt()}containsXY(t,e){return this.closestPointXY(t,e,bp,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Tt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Fs(e),this.extentRevision_=this.getRevision()}return U_(this.extent_,t)}rotate(t,e){Tt()}scale(t,e,r){Tt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Tt()}getType(){return Tt()}applyTransform(t){Tt()}intersectsExtent(t){return Tt()}translate(t,e){Tt()}transform(t,e){const r=me(t),s=r.getUnits()=="tile-pixels"?function(h,c,d){const g=r.getExtent(),m=r.getWorldExtent(),y=Wt(m)/Wt(g);pi(Rh,m[0],m[3],y,-y,0,0,0);const x=Mp(h,0,h.length,d,Rh,c),R=xs(r,e);return R?R(x,x,d):x}:xs(r,e);return this.applyTransform(s),this}}class ga extends Np{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return z_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Tt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=wh(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Tt()}setLayout(t,e,r){let s;if(t)s=wh(t);else{for(let h=0;h<r;++h){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=Gp(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const r=this.getFlatCoordinates();if(r){const s=this.getStride();Pp(r,0,r.length,s,t,e,r),this.changed()}}scale(t,e,r){e===void 0&&(e=t),r||(r=Ke(this.getExtent()));const s=this.getFlatCoordinates();if(s){const h=this.getStride();Dp(s,0,s.length,h,t,e,r,s),this.changed()}}translate(t,e){const r=this.getFlatCoordinates();if(r){const s=this.getStride();Fp(r,0,r.length,s,t,e,r),this.changed()}}}function Gp(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function wh(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Xu(i,t,e,r){let s=0;const h=i[e-r],c=i[e-r+1];let d=0,g=0;for(;t<e;t+=r){const m=i[t]-h,y=i[t+1]-c;s+=g*m-d*y,d=m,g=y}return s/2}function kp(i,t,e,r){let s=0;for(let h=0,c=e.length;h<c;++h){const d=e[h];s+=Xu(i,t,d,r),t=d}return s}function Th(i,t,e,r,s,h,c){const d=i[t],g=i[t+1],m=i[e]-d,y=i[e+1]-g;let x;if(m===0&&y===0)x=t;else{const R=((s-d)*m+(h-g)*y)/(m*m+y*y);if(R>1)x=e;else if(R>0){for(let C=0;C<r;++C)c[C]=N_(i[t+C],i[e+C],R);c.length=r;return}else x=t}for(let R=0;R<r;++R)c[R]=i[x+R];c.length=r}function zu(i,t,e,r,s){let h=i[t],c=i[t+1];for(t+=r;t<e;t+=r){const d=i[t],g=i[t+1],m=hi(h,c,d,g);m>s&&(s=m),h=d,c=g}return s}function Xp(i,t,e,r,s){for(let h=0,c=e.length;h<c;++h){const d=e[h];s=zu(i,t,d,r,s),t=d}return s}function Yu(i,t,e,r,s,h,c,d,g,m,y){if(t==e)return m;let x,R;if(s===0){if(R=hi(c,d,i[t],i[t+1]),R<m){for(x=0;x<r;++x)g[x]=i[t+x];return g.length=r,R}return m}y=y||[NaN,NaN];let C=t+r;for(;C<e;)if(Th(i,C-r,C,r,c,d,y),R=hi(c,d,y[0],y[1]),R<m){for(m=R,x=0;x<r;++x)g[x]=y[x];g.length=r,C+=r}else C+=r*Math.max((Math.sqrt(R)-Math.sqrt(m))/s|0,1);if(Th(i,e-r,t,r,c,d,y),R=hi(c,d,y[0],y[1]),R<m){for(m=R,x=0;x<r;++x)g[x]=y[x];g.length=r}return m}function zp(i,t,e,r,s,h,c,d,g,m,y){y=y||[NaN,NaN];for(let x=0,R=e.length;x<R;++x){const C=e[x];m=Yu(i,t,C,r,s,h,c,d,g,m,y),t=C}return m}function Yp(i,t,e,r){for(let s=0,h=e.length;s<h;++s)i[t++]=e[s];return t}function Bu(i,t,e,r){for(let s=0,h=e.length;s<h;++s){const c=e[s];for(let d=0;d<r;++d)i[t++]=c[d]}return t}function Bp(i,t,e,r,s){s=s||[];let h=0;for(let c=0,d=e.length;c<d;++c){const g=Bu(i,t,e[c],r);s[h++]=g,t=g}return s.length=h,s}function Uu(i,t,e,r,s){s=s!==void 0?s:[];let h=0;for(let c=t;c<e;c+=r)s[h++]=i.slice(c,c+r);return s.length=h,s}function Up(i,t,e,r,s){s=s!==void 0?s:[];let h=0;for(let c=0,d=e.length;c<d;++c){const g=e[c];s[h++]=Uu(i,t,g,r,s[h]),t=g}return s.length=h,s}function Wp(i,t,e,r,s,h,c){const d=(e-t)/r;if(d<3){for(;t<e;t+=r)h[c++]=i[t],h[c++]=i[t+1];return c}const g=new Array(d);g[0]=1,g[d-1]=1;const m=[t,e-r];let y=0;for(;m.length>0;){const x=m.pop(),R=m.pop();let C=0;const T=i[R],O=i[R+1],M=i[x],F=i[x+1];for(let D=R+r;D<x;D+=r){const U=i[D],N=i[D+1],P=F_(U,N,T,O,M,F);P>C&&(y=D,C=P)}C>s&&(g[(y-t)/r]=1,R+r<y&&m.push(R,y),y+r<x&&m.push(y,x))}for(let x=0;x<d;++x)g[x]&&(h[c++]=i[t+x*r],h[c++]=i[t+x*r+1]);return c}function Jn(i,t){return t*Math.round(i/t)}function jp(i,t,e,r,s,h,c){if(t==e)return c;let d=Jn(i[t],s),g=Jn(i[t+1],s);t+=r,h[c++]=d,h[c++]=g;let m,y;do if(m=Jn(i[t],s),y=Jn(i[t+1],s),t+=r,t==e)return h[c++]=m,h[c++]=y,c;while(m==d&&y==g);for(;t<e;){const x=Jn(i[t],s),R=Jn(i[t+1],s);if(t+=r,x==m&&R==y)continue;const C=m-d,T=y-g,O=x-d,M=R-g;if(C*M==T*O&&(C<0&&O<C||C==O||C>0&&O>C)&&(T<0&&M<T||T==M||T>0&&M>T)){m=x,y=R;continue}h[c++]=m,h[c++]=y,d=m,g=y,m=x,y=R}return h[c++]=m,h[c++]=y,c}function Vp(i,t,e,r,s,h,c,d){for(let g=0,m=e.length;g<m;++g){const y=e[g];c=jp(i,t,y,r,s,h,c),d.push(c),t=y}return c}class fr extends ga{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new fr(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,r,s){return s<wu(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(zu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,s))}getArea(){return Xu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Uu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Wp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new fr(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bu(this.flatCoordinates,0,t,this.stride),this.changed()}}class _a extends ga{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new _a(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,s){const h=this.flatCoordinates,c=hi(t,e,h[0],h[1]);if(c<s){const d=this.stride;for(let g=0;g<d;++g)r[g]=h[g];return r.length=d,c}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return X_(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Tu(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Yp(this.flatCoordinates,0,t,this.stride),this.changed()}}function Zp(i,t,e,r,s){return!Su(s,function(c){return!Pn(i,t,e,r,c[0],c[1])})}function Pn(i,t,e,r,s,h){let c=0,d=i[e-r],g=i[e-r+1];for(;t<e;t+=r){const m=i[t],y=i[t+1];g<=h?y>h&&(m-d)*(h-g)-(s-d)*(y-g)>0&&c++:y<=h&&(m-d)*(h-g)-(s-d)*(y-g)<0&&c--,d=m,g=y}return c!==0}function Wu(i,t,e,r,s,h){if(e.length===0||!Pn(i,t,e[0],r,s,h))return!1;for(let c=1,d=e.length;c<d;++c)if(Pn(i,e[c-1],e[c],r,s,h))return!1;return!0}function Kp(i,t,e,r,s,h,c){let d,g,m,y,x,R,C;const T=s[h+1],O=[];for(let D=0,U=e.length;D<U;++D){const N=e[D];for(y=i[N-r],R=i[N-r+1],d=t;d<N;d+=r)x=i[d],C=i[d+1],(T<=R&&C<=T||R<=T&&T<=C)&&(m=(T-R)/(C-R)*(x-y)+y,O.push(m)),y=x,R=C}let M=NaN,F=-1/0;for(O.sort(As),y=O[0],d=1,g=O.length;d<g;++d){x=O[d];const D=Math.abs(x-y);D>F&&(m=(y+x)/2,Wu(i,t,e,r,m,T)&&(M=m,F=D)),y=x}return isNaN(M)&&(M=s[h]),[M,T,F]}function Hp(i,t,e,r,s){let h;for(t+=r;t<e;t+=r)if(h=s(i.slice(t-r,t),i.slice(t,t+r)),h)return h;return!1}function ju(i,t,e,r,s,h){return h=h??Cu(En(),i,t,e,r),vi(s,h)?h[0]>=s[0]&&h[2]<=s[2]||h[1]>=s[1]&&h[3]<=s[3]?!0:Hp(i,t,e,r,function(c,d){return W_(s,c,d)}):!1}function Vu(i,t,e,r,s){return!!(ju(i,t,e,r,s)||Pn(i,t,e,r,s[0],s[1])||Pn(i,t,e,r,s[0],s[3])||Pn(i,t,e,r,s[2],s[1])||Pn(i,t,e,r,s[2],s[3]))}function $p(i,t,e,r,s){if(!Vu(i,t,e[0],r,s))return!1;if(e.length===1)return!0;for(let h=1,c=e.length;h<c;++h)if(Zp(i,e[h-1],e[h],r,s)&&!ju(i,e[h-1],e[h],r,s))return!1;return!0}function qp(i,t,e,r){for(;t<e-r;){for(let s=0;s<r;++s){const h=i[t+s];i[t+s]=i[e-r+s],i[e-r+s]=h}t+=r,e-=r}}function Zu(i,t,e,r){let s=0,h=i[e-r],c=i[e-r+1];for(;t<e;t+=r){const d=i[t],g=i[t+1];s+=(d-h)*(g+c),h=d,c=g}return s===0?void 0:s>0}function Jp(i,t,e,r,s){s=s!==void 0?s:!1;for(let h=0,c=e.length;h<c;++h){const d=e[h],g=Zu(i,t,d,r);if(h===0){if(s&&g||!s&&!g)return!1}else if(s&&!g||!s&&g)return!1;t=d}return!0}function Ih(i,t,e,r,s){s=s!==void 0?s:!1;for(let h=0,c=e.length;h<c;++h){const d=e[h],g=Zu(i,t,d,r);(h===0?s&&g||!s&&!g:s&&!g||!s&&g)&&qp(i,t,d,r),t=d}return t}class dr extends ga{constructor(t,e,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&r?(this.setFlatCoordinates(e,t),this.ends_=r):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?R_(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new dr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,s){return s<wu(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xp(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),zp(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,s))}containsXY(t,e){return Wu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return kp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ih(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Up(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ke(this.getExtent());this.flatInteriorPoint_=Kp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new _a(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new fr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,r=this.ends_,s=[];let h=0;for(let c=0,d=r.length;c<d;++c){const g=r[c],m=new fr(e.slice(h,g),t);s.push(m),h=g}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Jp(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ih(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],r=[];return e.length=Vp(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,r),new dr(e,"XY",r)}getType(){return"Polygon"}intersectsExtent(t){return $p(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=Bp(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}}function Ch(i){if(yi(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],r=i[2],s=i[3],h=[t,e,t,s,r,s,r,e,t,e];return new dr(h,"XY",[h.length])}function pa(i,t,e,r){const s=yt(t)/e[0],h=Wt(t)/e[1];return r?Math.min(i,Math.max(s,h)):Math.min(i,Math.min(s,h))}function ma(i,t,e){let r=Math.min(i,t);const s=50;return r*=Math.log(1+s*Math.max(0,i/t-1))/s+1,e&&(r=Math.max(r,e),r/=Math.log(1+s*Math.max(0,e/i-1))/s+1),Kt(r,e/2,t*2)}function Qp(i,t,e,r){return t=t!==void 0?t:!0,function(s,h,c,d){if(s!==void 0){const g=i[0],m=i[i.length-1],y=e?pa(g,e,c,r):g;if(d)return t?ma(s,y,m):Kt(s,m,y);const x=Math.min(y,s),R=Math.floor(Os(i,x,h));return i[R]>y&&R<i.length-1?i[R+1]:i[R]}}}function tm(i,t,e,r,s,h){return r=r!==void 0?r:!0,e=e!==void 0?e:0,function(c,d,g,m){if(c!==void 0){const y=s?pa(t,s,g,h):t;if(m)return r?ma(c,y,e):Kt(c,e,y);const x=1e-9,R=Math.ceil(Math.log(t/y)/Math.log(i)-x),C=-d*(.5-x)+.5,T=Math.min(y,c),O=Math.floor(Math.log(t/T)/Math.log(i)+C),M=Math.max(R,O),F=t/Math.pow(i,M);return Kt(F,e,y)}}}function Sh(i,t,e,r,s){return e=e!==void 0?e:!0,function(h,c,d,g){if(h!==void 0){const m=r?pa(i,r,d,s):i;return!e||!g?Kt(h,t,m):ma(h,m,t)}}}function va(i){if(i!==void 0)return 0}function Ah(i){if(i!==void 0)return i}function em(i){const t=2*Math.PI/i;return function(e,r){if(r)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function nm(i){const t=pn(5);return function(e,r){return r||e===void 0?e:Math.abs(e)<=t?0:e}}const im=42,ya=256,So=0;class Fe extends $e{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=fa(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&wp(),t.center&&(t.center=We(t.center,this.projection_)),t.extent&&(t.extent=Ze(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const d in Se)delete e[d];this.setProperties(e,!0);const r=sm(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;const s=rm(t),h=r.constraint,c=om(t);this.constraints_={center:s,resolution:h,rotation:c},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const r=this.getCenterInternal();if(r){const s=t||[0,0,0,0];e=e||[0,0,0,0];const h=this.getResolution(),c=h/2*(s[3]-e[3]+e[1]-s[1]),d=h/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([r[0]+c,r[1]-d])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let r=0;r<e.length;++r){let s=arguments[r];s.center&&(s=Object.assign({},s),s.center=We(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=We(s.anchor,this.getProjection())),e[r]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,r;e>1&&typeof arguments[e-1]=="function"&&(r=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const y=arguments[s];y.center&&this.setCenterInternal(y.center),y.zoom!==void 0?this.setZoom(y.zoom):y.resolution&&this.setResolution(y.resolution),y.rotation!==void 0&&this.setRotation(y.rotation)}if(s===e){r&&ts(r,!0);return}let h=Date.now(),c=this.targetCenter_.slice(),d=this.targetResolution_,g=this.targetRotation_;const m=[];for(;s<e;++s){const y=arguments[s],x={start:h,complete:!1,anchor:y.anchor,duration:y.duration!==void 0?y.duration:1e3,easing:y.easing||$_,callback:r};if(y.center&&(x.sourceCenter=c,x.targetCenter=y.center.slice(),c=x.targetCenter),y.zoom!==void 0?(x.sourceResolution=d,x.targetResolution=this.getResolutionForZoom(y.zoom),d=x.targetResolution):y.resolution&&(x.sourceResolution=d,x.targetResolution=y.resolution,d=x.targetResolution),y.rotation!==void 0){x.sourceRotation=g;const R=ui(y.rotation-g+Math.PI,2*Math.PI)-Math.PI;x.targetRotation=g+R,g=x.targetRotation}am(x)?x.complete=!0:h+=x.duration,m.push(x)}this.animations_.push(m),this.setHint(fe.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[fe.ANIMATING]>0}getInteracting(){return this.hints_[fe.INTERACTING]>0}cancelAnimations(){this.setHint(fe.ANIMATING,-this.hints_[fe.ANIMATING]);let t;for(let e=0,r=this.animations_.length;e<r;++e){const s=this.animations_[e];if(s[0].callback&&ts(s[0].callback,!1),!t)for(let h=0,c=s.length;h<c;++h){const d=s[h];if(!d.complete){t=d.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let r=this.animations_.length-1;r>=0;--r){const s=this.animations_[r];let h=!0;for(let c=0,d=s.length;c<d;++c){const g=s[c];if(g.complete)continue;const m=t-g.start;let y=g.duration>0?m/g.duration:1;y>=1?(g.complete=!0,y=1):h=!1;const x=g.easing(y);if(g.sourceCenter){const R=g.sourceCenter[0],C=g.sourceCenter[1],T=g.targetCenter[0],O=g.targetCenter[1];this.nextCenter_=g.targetCenter;const M=R+x*(T-R),F=C+x*(O-C);this.targetCenter_=[M,F]}if(g.sourceResolution&&g.targetResolution){const R=x===1?g.targetResolution:g.sourceResolution+x*(g.targetResolution-g.sourceResolution);if(g.anchor){const C=this.getViewportSize_(this.getRotation()),T=this.constraints_.resolution(R,0,C,!0);this.targetCenter_=this.calculateCenterZoom(T,g.anchor)}this.nextResolution_=g.targetResolution,this.targetResolution_=R,this.applyTargetState_(!0)}if(g.sourceRotation!==void 0&&g.targetRotation!==void 0){const R=x===1?ui(g.targetRotation+Math.PI,2*Math.PI)-Math.PI:g.sourceRotation+x*(g.targetRotation-g.sourceRotation);if(g.anchor){const C=this.constraints_.rotation(R,!0);this.targetCenter_=this.calculateCenterRotate(C,g.anchor)}this.nextRotation_=g.targetRotation,this.targetRotation_=R}if(this.applyTargetState_(!0),e=!0,!g.complete)break}if(h){this.animations_[r]=null,this.setHint(fe.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const c=s[0].callback;c&&ts(c,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let r;const s=this.getCenterInternal();return s!==void 0&&(r=[s[0]-e[0],s[1]-e[1]],oa(r,t-this.getRotation()),V_(r,e)),r}calculateCenterZoom(t,e){let r;const s=this.getCenterInternal(),h=this.getResolution();if(s!==void 0&&h!==void 0){const c=e[0]-t*(e[0]-s[0])/h,d=e[1]-t*(e[1]-s[1])/h;r=[c,d]}return r}getViewportSize_(t){const e=this.viewportSize_;if(t){const r=e[0],s=e[1];return[Math.abs(r*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&qo(t,this.getProjection())}getCenterInternal(){return this.get(Se.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Sp(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Mt(e,"The view center is not defined");const r=this.getResolution();Mt(r!==void 0,"The view resolution is not defined");const s=this.getRotation();return Mt(s!==void 0,"The view rotation is not defined"),ms(e,r,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Se.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ze(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const r=yt(t)/e[0],s=Wt(t)/e[1];return Math.max(r,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(e/r)/Math.log(t);return function(h){return e/Math.pow(t,h*s)}}getRotation(){return this.get(Se.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,h=Math.log(r/s)/e;return function(c){return Math.log(r/c)/e/h}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const r=this.padding_;return r&&(e=[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),r=this.getRotation();let s=this.getCenterInternal();const h=this.padding_;if(h){const c=this.getViewportSizeMinusPadding_();s=Ao(s,this.getViewportSize_(),[c[0]/2+h[3],c[1]/2+h[0]],e,r)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,r,s;if(this.resolutions_){const h=Os(this.resolutions_,t,1);e=h,r=this.resolutions_[h],h==this.resolutions_.length-1?s=2:s=r/this.resolutions_[h+1]}else r=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(r/t)/Math.log(s)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const r=Kt(Math.floor(t),0,this.resolutions_.length-2),s=this.resolutions_[r]/this.resolutions_[r+1];return this.resolutions_[r]/Math.pow(s,Kt(t-r,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let r;if(Mt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Mt(!yi(t),"Cannot fit empty extent provided as `geometry`");const s=Ze(t,this.getProjection());r=Ch(s)}else if(t.getType()==="Circle"){const s=Ze(t.getExtent(),this.getProjection());r=Ch(s),r.rotate(this.getRotation(),Ke(s))}else r=t;this.fitInternal(r,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),r=Math.cos(e),s=Math.sin(-e),h=t.getFlatCoordinates(),c=t.getStride();let d=1/0,g=1/0,m=-1/0,y=-1/0;for(let x=0,R=h.length;x<R;x+=c){const C=h[x]*r-h[x+1]*s,T=h[x]*s+h[x+1]*r;d=Math.min(d,C),g=Math.min(g,T),m=Math.max(m,C),y=Math.max(y,T)}return[d,g,m,y]}fitInternal(t,e){e=e||{};let r=e.size;r||(r=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],h=e.nearest!==void 0?e.nearest:!1;let c;e.minResolution!==void 0?c=e.minResolution:e.maxZoom!==void 0?c=this.getResolutionForZoom(e.maxZoom):c=0;const d=this.rotatedExtentForGeometry(t);let g=this.getResolutionForExtentInternal(d,[r[0]-s[1]-s[3],r[1]-s[0]-s[2]]);g=isNaN(g)?c:Math.max(g,c),g=this.getConstrainedResolution(g,h?0:1);const m=this.getRotation(),y=Math.sin(m),x=Math.cos(m),R=Ke(d);R[0]+=(s[1]-s[3])/2*g,R[1]+=(s[0]-s[2])/2*g;const C=R[0]*x-R[1]*y,T=R[1]*x+R[0]*y,O=this.getConstrainedCenter([C,T],g),M=e.callback?e.callback:gs;e.duration!==void 0?this.animateInternal({resolution:g,center:O,duration:e.duration,easing:e.easing},M):(this.targetResolution_=g,this.targetCenter_=O,this.applyTargetState_(!1,!0),ts(M,!0))}centerOn(t,e,r){this.centerOnInternal(We(t,this.getProjection()),e,r)}centerOnInternal(t,e,r){this.setCenterInternal(Ao(t,e,r,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,r,s){let h;const c=this.padding_;if(c&&t){const d=this.getViewportSizeMinusPadding_(-r),g=Ao(t,s,[d[0]/2+c[3],d[1]/2+c[0]],e,r);h=[t[0]-g[0],t[1]-g[1]]}return h}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=qo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&We(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const r=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),h=this.constraints_.resolution(this.targetResolution_*t,0,s,r);e&&(this.targetCenter_=this.calculateCenterZoom(h,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=We(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const r=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,r);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&We(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const r=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,r),h=this.getViewportSize_(s),c=this.constraints_.resolution(this.targetResolution_,0,h,r),d=this.constraints_.center(this.targetCenter_,c,h,r,this.calculateCenterShift(this.targetCenter_,c,s,h));this.get(Se.ROTATION)!==s&&this.set(Se.ROTATION,s),this.get(Se.RESOLUTION)!==c&&(this.set(Se.RESOLUTION,c),this.set("zoom",this.getZoom(),!0)),(!d||!this.get(Se.CENTER)||!vs(this.get(Se.CENTER),d))&&this.set(Se.CENTER,d),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,r){t=t!==void 0?t:200;const s=e||0,h=this.constraints_.rotation(this.targetRotation_),c=this.getViewportSize_(h),d=this.constraints_.resolution(this.targetResolution_,s,c),g=this.constraints_.center(this.targetCenter_,d,c,!1,this.calculateCenterShift(this.targetCenter_,d,h,c));if(t===0&&!this.cancelAnchor_){this.targetResolution_=d,this.targetRotation_=h,this.targetCenter_=g,this.applyTargetState_();return}r=r||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==d||this.getRotation()!==h||!this.getCenterInternal()||!vs(this.getCenterInternal(),g))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:h,center:g,resolution:d,duration:t,easing:Ei,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(fe.INTERACTING,1)}endInteraction(t,e,r){r=r&&We(r,this.getProjection()),this.endInteractionInternal(t,e,r)}endInteractionInternal(t,e,r){this.getInteracting()&&(this.setHint(fe.INTERACTING,-1),this.resolveConstraints(t,e,r))}getConstrainedCenter(t,e){const r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),r)}getConstrainedZoom(t,e){const r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,e))}getConstrainedResolution(t,e){e=e||0;const r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,r)}}function ts(i,t){setTimeout(function(){i(t)},0)}function rm(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return lh(i.extent,i.constrainOnlyCenter,e)}const t=fa(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,lh(e,!1,!1)}return G_}function sm(i){let t,e,r,c=i.minZoom!==void 0?i.minZoom:So,d=i.maxZoom!==void 0?i.maxZoom:28;const g=i.zoomFactor!==void 0?i.zoomFactor:2,m=i.multiWorld!==void 0?i.multiWorld:!1,y=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,x=i.showFullExtent!==void 0?i.showFullExtent:!1,R=fa(i.projection,"EPSG:3857"),C=R.getExtent();let T=i.constrainOnlyCenter,O=i.extent;if(!m&&!O&&R.isGlobal()&&(T=!1,O=C),i.resolutions!==void 0){const M=i.resolutions;e=M[c],r=M[d]!==void 0?M[d]:M[M.length-1],i.constrainResolution?t=Qp(M,y,!T&&O,x):t=Sh(e,r,y,!T&&O,x)}else{const F=(C?Math.max(yt(C),Wt(C)):360*aa.degrees/R.getMetersPerUnit())/ya/Math.pow(2,So),D=F/Math.pow(2,28-So);e=i.maxResolution,e!==void 0?c=0:e=F/Math.pow(g,c),r=i.minResolution,r===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?r=e/Math.pow(g,d):r=F/Math.pow(g,d):r=D),d=c+Math.floor(Math.log(e/r)/Math.log(g)),r=e/Math.pow(g,d-c),i.constrainResolution?t=tm(g,e,r,y,!T&&O,x):t=Sh(e,r,y,!T&&O,x)}return{constraint:t,maxResolution:e,minResolution:r,minZoom:c,zoomFactor:g}}function om(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?nm():e===!1?Ah:typeof e=="number"?em(e):Ah}return va}function am(i){return!(i.sourceCenter&&i.targetCenter&&!vs(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Ao(i,t,e,r,s){const h=Math.cos(-s);let c=Math.sin(-s),d=i[0]*h-i[1]*c,g=i[1]*h+i[0]*c;d+=(t[0]/2-e[0])*r,g+=(e[1]-t[1]/2)*r,c=-c;const m=d*h-g*c,y=g*h+d*c;return[m,y]}const es="ol-hidden",zs="ol-unselectable",Ea="ol-control",Oh="ol-collapsed";function Qt(i,t,e,r){let s;return e&&e.length?s=e.shift():vu?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",r)}let Oo;function Rs(){return Oo||(Oo=Qt(1,1)),Oo}function xa(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Lh(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function lm(i){for(;i.lastChild;)i.lastChild.remove()}function hm(i,t){const e=i.childNodes;for(let r=0;;++r){const s=e[r],h=t[r];if(!s&&!h)break;if(s!==h){if(!s){i.appendChild(h);continue}if(!h){i.removeChild(s),--r;continue}i.insertBefore(h,s)}}}class Ra extends $e{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let r=0,s=this.listenerKeys.length;r<s;++r)Gt(this.listenerKeys[r]);if(this.listenerKeys.length=0,this.map_=t,t){const r=this.target_??t.getOverlayContainerStopEvent();this.element&&r.appendChild(this.element),this.render!==gs&&this.listenerKeys.push(St(t,dn.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class um extends Ra{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",r=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",h=t.collapseLabel!==void 0?t.collapseLabel:"›",c=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof h=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=h,this.collapseLabel_.className=c):this.collapseLabel_=h;const d=t.label!==void 0?t.label:"i";typeof d=="string"?(this.label_=document.createElement("span"),this.label_.textContent=d,this.label_.className=s):this.label_=d;const g=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=r,this.toggleButton_.appendChild(g),this.toggleButton_.addEventListener(ct.CLICK,this.handleClick_.bind(this),!1);const m=e+" "+zs+" "+Ea+(this.collapsed_&&this.collapsible_?" "+Oh:"")+(this.collapsible_?"":" ol-uncollapsible"),y=this.element;y.className=m,y.appendChild(this.toggleButton_),y.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),r=new Set(e.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>r.add(s)):r.add(this.attributions_)),!this.overrideCollapsible_){const s=!e.some(h=>{var c;return((c=h.getSource())==null?void 0:c.getAttributionsCollapsible())===!1});this.setCollapsible(s)}return Array.from(r)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>sa(()=>s))),r=e.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!Ls(e,this.renderedAttributions_)){lm(this.ulElement_);for(let s=0,h=e.length;s<h;++s){const c=document.createElement("li");c.innerHTML=e[s],this.ulElement_.appendChild(c)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Oh),this.collapsed_?Lh(this.collapseLabel_,this.label_):Lh(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class cm extends Ra{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",r=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof r=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=r):(this.label_=r,this.label_.classList.add(s));const h=t.tipLabel?t.tipLabel:"Reset rotation",c=document.createElement("button");c.className=e+"-reset",c.setAttribute("type","button"),c.title=h,c.appendChild(this.label_),c.addEventListener(ct.CLICK,this.handleClick_.bind(this),!1);const d=e+" "+zs+" "+Ea,g=this.element;g.className=d,g.appendChild(c),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(es)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const r=e.getRotation();r!==void 0&&(this.duration_>0&&r%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Ei}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const r=e.viewState.rotation;if(r!=this.rotation_){const s="rotate("+r+"rad)";if(this.autoHide_){const h=this.element.classList.contains(es);!h&&r===0?this.element.classList.add(es):h&&r!==0&&this.element.classList.remove(es)}this.label_.style.transform=s}this.rotation_=r}}class fm extends Ra{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",r=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",h=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",c=t.zoomInLabel!==void 0?t.zoomInLabel:"+",d=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",g=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",m=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",y=document.createElement("button");y.className=s,y.setAttribute("type","button"),y.title=g,y.appendChild(typeof c=="string"?document.createTextNode(c):c),y.addEventListener(ct.CLICK,this.handleClick_.bind(this,r),!1);const x=document.createElement("button");x.className=h,x.setAttribute("type","button"),x.title=m,x.appendChild(typeof d=="string"?document.createTextNode(d):d),x.addEventListener(ct.CLICK,this.handleClick_.bind(this,-r),!1);const R=e+" "+zs+" "+Ea,C=this.element;C.className=R,C.appendChild(y),C.appendChild(x),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const r=this.getMap().getView();if(!r)return;const s=r.getZoom();if(s!==void 0){const h=r.getConstrainedZoom(s+t);this.duration_>0?(r.getAnimating()&&r.cancelAnimations(),r.animate({zoom:h,duration:this.duration_,easing:Ei})):r.setZoom(h)}}}function dm(i){i=i||{};const t=new Ve;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new fm(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new cm(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new um(i.attributionOptions)),t}class gm{constructor(t,e,r){this.decay_=t,this.minVelocity_=e,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let r=e-3;for(;r>0&&this.points_[r+2]>t;)r-=3;const s=this.points_[e+2]-this.points_[r+2];if(s<1e3/60)return!1;const h=this.points_[e]-this.points_[r],c=this.points_[e+1]-this.points_[r+1];return this.angle_=Math.atan2(c,h),this.initialVelocity_=Math.sqrt(h*h+c*c)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Mh={ACTIVE:"active"};class xr extends $e{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Mh.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Mh.ACTIVE,t)}setMap(t){this.map_=t}}function _m(i,t,e){const r=i.getCenterInternal();if(r){const s=[r[0]+t[0],r[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:q_,center:i.getConstrainedCenter(s)})}}function wa(i,t,e,r){const s=i.getZoom();if(s===void 0)return;const h=i.getConstrainedZoom(s+t),c=i.getResolutionForZoom(h);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:c,anchor:e,duration:r!==void 0?r:250,easing:Ei})}class pm extends xr{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Ut.DBLCLICK){const r=t.originalEvent,s=t.map,h=t.coordinate,c=r.shiftKey?-this.delta_:this.delta_,d=s.getView();wa(d,c,h,this.duration_),r.preventDefault(),e=!0}return!e}}function Jo(i){const t=arguments;return function(e){let r=!0;for(let s=0,h=t.length;s<h&&(r=r&&t[s](e),!!r);++s);return r}}const mm=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},vm=function(i){const t=i.map.getTargetElement(),e=t.getRootNode(),r=i.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(r):t.contains(r)},Ku=function(i){const t=i.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?vm(i):!0},ym=ds,Hu=function(i){const t=i.originalEvent;return t.button==0&&!(O_&&pu&&t.ctrlKey)},$u=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Em=function(i){const t=i.originalEvent;return pu?t.metaKey:t.ctrlKey},xm=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},qu=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Lo=function(i){const t=i.originalEvent;return Mt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},Rm=function(i){const t=i.originalEvent;return Mt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class Rr extends xr{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ut.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Ut.POINTERUP){const r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==Ut.POINTERDOWN){const r=this.handleDownEvent(t);this.handlingDownUpSequence=r,e=this.stopDown(r)}else t.type==Ut.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Ta(i){const t=i.length;let e=0,r=0;for(let s=0;s<t;s++)e+=i[s].clientX,r+=i[s].clientY;return{clientX:e/t,clientY:r/t}}class wm extends Rr{constructor(t){super({stopDown:Ms}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Jo($u,Rm);this.condition_=t.onFocusOnly?Jo(Ku,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const r=this.targetPointers,s=e.getEventPixel(Ta(r));if(r.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const h=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],d=t.map.getView();Z_(h,d.getResolution()),oa(h,d.getRotation()),d.adjustCenterInternal(h)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=r.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,r=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),h=this.kinetic_.getAngle(),c=r.getCenterInternal(),d=e.getPixelFromCoordinateInternal(c),g=e.getCoordinateFromPixelInternal([d[0]-s*Math.cos(h),d[1]-s*Math.sin(h)]);r.animateInternal({center:r.getConstrainedCenter(g),duration:500,easing:Ei})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const r=t.map.getView();return this.lastCentroid=null,r.getAnimating()&&r.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Tm extends Rr{constructor(t){t=t||{},super({stopDown:Ms}),this.condition_=t.condition?t.condition:mm,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Lo(t))return;const e=t.map,r=e.getView();if(r.getConstraints().rotation===va)return;const s=e.getSize(),h=t.pixel,c=Math.atan2(s[1]/2-h[1],h[0]-s[0]/2);if(this.lastAngle_!==void 0){const d=c-this.lastAngle_;r.adjustRotationInternal(-d)}this.lastAngle_=c}handleUpEvent(t){return Lo(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Lo(t)&&Hu(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Im extends mr{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,r="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+r,s.top=Math.min(t[1],e[1])+r,s.width=Math.abs(e[0]-t[0])+r,s.height=Math.abs(e[1]-t[1])+r}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new dr([s])}getGeometry(){return this.geometry_}}const Qn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Ji extends Ne{constructor(t,e,r){super(t),this.coordinate=e,this.mapBrowserEvent=r}}class Cm extends Rr{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new Im(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??Hu,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,r){const s=r[0]-e[0],h=r[1]-e[1];return s*s+h*h>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ji(Qn.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ji(e?Qn.BOXEND:Qn.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ji(Qn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Ji(Qn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Ji(Qn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class Sm extends Cm{constructor(t){t=t||{};const e=t.condition?t.condition:xm;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const r=this.getMap().getView();let s=this.getGeometry();if(this.out_){const h=r.rotatedExtentForGeometry(s),c=r.getResolutionForExtentInternal(h),d=r.getResolution()/c;s=s.clone(),s.scale(d*d)}r.fitInternal(s,{duration:this.duration_,easing:Ei})}}const On={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Am extends xr{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return $u(e)&&qu(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==ct.KEYDOWN){const r=t.originalEvent,s=r.key;if(this.condition_(t)&&(s==On.DOWN||s==On.LEFT||s==On.RIGHT||s==On.UP)){const c=t.map.getView(),d=c.getResolution()*this.pixelDelta_;let g=0,m=0;s==On.DOWN?m=-d:s==On.LEFT?g=-d:s==On.RIGHT?g=d:m=d;const y=[g,m];oa(y,c.getRotation()),_m(c,y,this.duration_),r.preventDefault(),e=!0}}return!e}}class Om extends xr{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!Em(e)&&qu(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==ct.KEYDOWN||t.type==ct.KEYPRESS){const r=t.originalEvent,s=r.key;if(this.condition_(t)&&(s==="+"||s==="-")){const h=t.map,c=s==="+"?this.delta_:-this.delta_,d=h.getView();wa(d,c,void 0,this.duration_),r.preventDefault(),e=!0}}return!e}}class Lm extends xr{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:ym;this.condition_=t.onFocusOnly?Jo(Ku,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==ct.WHEEL)return!0;const r=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let h;if(t.type==ct.WHEEL&&(h=s.deltaY,S_&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(h/=mu),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(h*=40)),h===0)return!1;this.lastDelta_=h;const c=Date.now();this.startTime_===void 0&&(this.startTime_=c),(!this.mode_||c-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(h)<4?"trackpad":"wheel");const d=r.getView();if(this.mode_==="trackpad"&&!(d.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(d.getAnimating()&&d.cancelAnimations(),d.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),d.adjustZoom(-h/this.deltaPerZoom_,this.lastAnchor_?r.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=c,!1;this.totalDelta_+=h;const g=Math.max(this.timeout_-(c-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),g),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let r=-Kt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),wa(e,r,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class Mm extends Rr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Ms),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const r=this.targetPointers[0],s=this.targetPointers[1],h=Math.atan2(s.clientY-r.clientY,s.clientX-r.clientX);if(this.lastAngle_!==void 0){const g=h-this.lastAngle_;this.rotationDelta_+=g,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=g}this.lastAngle_=h;const c=t.map,d=c.getView();d.getConstraints().rotation!==va&&(this.anchor_=c.getCoordinateFromPixelInternal(c.getEventPixel(Ta(this.targetPointers))),this.rotating_&&(c.render(),d.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class Pm extends Rr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Ms),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const r=this.targetPointers[0],s=this.targetPointers[1],h=r.clientX-s.clientX,c=r.clientY-s.clientY,d=Math.sqrt(h*h+c*c);this.lastDistance_!==void 0&&(e=this.lastDistance_/d),this.lastDistance_=d;const g=t.map,m=g.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=g.getCoordinateFromPixelInternal(g.getEventPixel(Ta(this.targetPointers))),g.render(),m.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const r=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return r.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function Dm(i){i=i||{};const t=new Ve,e=new gm(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new Tm),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new pm({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new wm({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new Mm),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new Pm({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new Am),t.push(new Om({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new Lm({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new Sm({duration:i.zoomDuration})),t}const Ot={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Ju extends $e{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Ot.OPACITY]=t.opacity!==void 0?t.opacity:1,Mt(typeof e[Ot.OPACITY]=="number","Layer opacity must be a number"),e[Ot.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Ot.Z_INDEX]=t.zIndex,e[Ot.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Ot.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Ot.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Ot.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},r=this.getZIndex();return e.opacity=Kt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=r===void 0&&!e.managed?1/0:r,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Tt()}getLayerStatesArray(t){return Tt()}getExtent(){return this.get(Ot.EXTENT)}getMaxResolution(){return this.get(Ot.MAX_RESOLUTION)}getMinResolution(){return this.get(Ot.MIN_RESOLUTION)}getMinZoom(){return this.get(Ot.MIN_ZOOM)}getMaxZoom(){return this.get(Ot.MAX_ZOOM)}getOpacity(){return this.get(Ot.OPACITY)}getSourceState(){return Tt()}getVisible(){return this.get(Ot.VISIBLE)}getZIndex(){return this.get(Ot.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ot.EXTENT,t)}setMaxResolution(t){this.set(Ot.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Ot.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Ot.MAX_ZOOM,t)}setMinZoom(t){this.set(Ot.MIN_ZOOM,t)}setOpacity(t){Mt(typeof t=="number","Layer opacity must be a number"),this.set(Ot.OPACITY,t)}setVisible(t){this.set(Ot.VISIBLE,t)}setZIndex(t){this.set(Ot.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class gn extends Ne{constructor(t,e){super(t),this.layer=e}}const Mo={LAYERS:"layers"};class xi extends Ju{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let r=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Mo.LAYERS,this.handleLayersChanged_),r?Array.isArray(r)?r=new Ve(r.slice(),{unique:!0}):Mt(typeof r.getArray=="function","Expected `layers` to be an array or a `Collection`"):r=new Ve(void 0,{unique:!0}),this.setLayers(r)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Gt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(St(t,Re.ADD,this.handleLayersAdd_,this),St(t,Re.REMOVE,this.handleLayersRemove_,this));for(const r in this.listenerKeys_)this.listenerKeys_[r].forEach(Gt);Ps(this.listenerKeys_);const e=t.getArray();for(let r=0,s=e.length;r<s;r++){const h=e[r];this.registerLayerListeners_(h),this.dispatchEvent(new gn("addlayer",h))}this.changed()}registerLayerListeners_(t){const e=[St(t,hr.PROPERTYCHANGE,this.handleLayerChange_,this),St(t,ct.CHANGE,this.handleLayerChange_,this)];t instanceof xi&&e.push(St(t,"addlayer",this.handleLayerGroupAdd_,this),St(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ee(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new gn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new gn("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new gn("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,r=ee(e);this.listenerKeys_[r].forEach(Gt),delete this.listenerKeys_[r],this.dispatchEvent(new gn("removelayer",e)),this.changed()}getLayers(){return this.get(Mo.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const r=e.getArray();for(let s=0,h=r.length;s<h;++s)this.dispatchEvent(new gn("removelayer",r[s]))}this.set(Mo.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],r=e.length;this.getLayers().forEach(function(c){c.getLayerStatesArray(e)});const s=this.getLayerState();let h=s.zIndex;!t&&s.zIndex===void 0&&(h=0);for(let c=r,d=e.length;c<d;c++){const g=e[c];g.opacity*=s.opacity,g.visible=g.visible&&s.visible,g.maxResolution=Math.min(g.maxResolution,s.maxResolution),g.minResolution=Math.max(g.minResolution,s.minResolution),g.minZoom=Math.max(g.minZoom,s.minZoom),g.maxZoom=Math.min(g.maxZoom,s.maxZoom),s.extent!==void 0&&(g.extent!==void 0?g.extent=pe(g.extent,s.extent):g.extent=s.extent),g.zIndex===void 0&&(g.zIndex=h)}return e}getSourceState(){return"ready"}}const be={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class wr extends Ju{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Ot.SOURCE,this.handleSourcePropertyChange_);const r=t.source?t.source:null;this.setSource(r)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Ot.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Gt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=St(t,ct.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const r=this.getMapInternal();!t&&r&&(t=r.getView()),t instanceof Fe?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&r&&(e.layerStatesArray=r.getLayerGroup().getLayerStatesArray());let s;if(e.layerStatesArray){if(s=e.layerStatesArray.find(c=>c.layer===this),!s)return!1}else s=this.getLayerState();const h=this.getExtent();return Ia(s,e.viewState)&&(!h||vi(h,e.extent))}getAttributions(t){var h;if(!this.isVisible(t))return[];const e=(h=this.getSource())==null?void 0:h.getAttributions();if(!e)return[];const r=t instanceof Fe?t.getViewStateAndExtent():t;let s=e(r);return Array.isArray(s)||(s=[s]),s}render(t,e){const r=this.getRenderer();return r.prepareFrame(t)?(this.rendered=!0,r.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Ot.MAP,t)}getMapInternal(){return this.get(Ot.MAP)}setMap(t){this.mapPrecomposeKey_&&(Gt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Gt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=St(t,be.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=St(this,ct.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,r=this.getLayerState(!1);Mt(!e.some(s=>s.layer===r.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(r)}setSource(t){this.set(Ot.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Ia(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const r=t.zoom;return r>i.minZoom&&r<=i.maxZoom}function Qu(i,t,e=0,r=i.length-1,s=Fm){for(;r>e;){if(r-e>600){const g=r-e+1,m=t-e+1,y=Math.log(g),x=.5*Math.exp(2*y/3),R=.5*Math.sqrt(y*x*(g-x)/g)*(m-g/2<0?-1:1),C=Math.max(e,Math.floor(t-m*x/g+R)),T=Math.min(r,Math.floor(t+(g-m)*x/g+R));Qu(i,t,C,T,s)}const h=i[t];let c=e,d=r;for(Qi(i,e,t),s(i[r],h)>0&&Qi(i,e,r);c<d;){for(Qi(i,c,d),c++,d--;s(i[c],h)<0;)c++;for(;s(i[d],h)>0;)d--}s(i[e],h)===0?Qi(i,e,d):(d++,Qi(i,d,r)),d<=t&&(e=d+1),t<=d&&(r=d-1)}}function Qi(i,t,e){const r=i[t];i[t]=i[e],i[e]=r}function Fm(i,t){return i<t?-1:i>t?1:0}class bm{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!is(t,e))return r;const s=this.toBBox,h=[];for(;e;){for(let c=0;c<e.children.length;c++){const d=e.children[c],g=e.leaf?s(d):d;is(t,g)&&(e.leaf?r.push(d):Do(t,g)?this._all(d,r):h.push(d))}e=h.pop()}return r}collides(t){let e=this.data;if(!is(t,e))return!1;const r=[];for(;e;){for(let s=0;s<e.children.length;s++){const h=e.children[s],c=e.leaf?this.toBBox(h):h;if(is(t,c)){if(e.leaf||Do(t,c))return!0;r.push(h)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=oi([]),this}remove(t,e){if(!t)return this;let r=this.data;const s=this.toBBox(t),h=[],c=[];let d,g,m;for(;r||h.length;){if(r||(r=h.pop(),g=h[h.length-1],d=c.pop(),m=!0),r.leaf){const y=Nm(t,r.children,e);if(y!==-1)return r.children.splice(y,1),h.push(r),this._condense(h),this}!m&&!r.leaf&&Do(r,s)?(h.push(r),c.push(d),d=0,g=r,r=r.children[0]):g?(d++,r=g.children[d],m=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,s){const h=r-e+1;let c=this._maxEntries,d;if(h<=c)return d=oi(t.slice(e,r+1)),ti(d,this.toBBox),d;s||(s=Math.ceil(Math.log(h)/Math.log(c)),c=Math.ceil(h/Math.pow(c,s-1))),d=oi([]),d.leaf=!1,d.height=s;const g=Math.ceil(h/c),m=g*Math.ceil(Math.sqrt(c));Ph(t,e,r,m,this.compareMinX);for(let y=e;y<=r;y+=m){const x=Math.min(y+m-1,r);Ph(t,y,x,g,this.compareMinY);for(let R=y;R<=x;R+=g){const C=Math.min(R+g-1,x);d.children.push(this._build(t,R,C,s-1))}}return ti(d,this.toBBox),d}_chooseSubtree(t,e,r,s){for(;s.push(e),!(e.leaf||s.length-1===r);){let h=1/0,c=1/0,d;for(let g=0;g<e.children.length;g++){const m=e.children[g],y=Po(m),x=Xm(t,m)-y;x<c?(c=x,h=y<h?y:h,d=m):x===c&&y<h&&(h=y,d=m)}e=d||e.children[0]}return e}_insert(t,e,r){const s=r?t:this.toBBox(t),h=[],c=this._chooseSubtree(s,this.data,e,h);for(c.children.push(t),ir(c,s);e>=0&&h[e].children.length>this._maxEntries;)this._split(h,e),e--;this._adjustParentBBoxes(s,h,e)}_split(t,e){const r=t[e],s=r.children.length,h=this._minEntries;this._chooseSplitAxis(r,h,s);const c=this._chooseSplitIndex(r,h,s),d=oi(r.children.splice(c,r.children.length-c));d.height=r.height,d.leaf=r.leaf,ti(r,this.toBBox),ti(d,this.toBBox),e?t[e-1].children.push(d):this._splitRoot(r,d)}_splitRoot(t,e){this.data=oi([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ti(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let s,h=1/0,c=1/0;for(let d=e;d<=r-e;d++){const g=nr(t,0,d,this.toBBox),m=nr(t,d,r,this.toBBox),y=zm(g,m),x=Po(g)+Po(m);y<h?(h=y,s=d,c=x<c?x:c):y===h&&x<c&&(c=x,s=d)}return s||r-e}_chooseSplitAxis(t,e,r){const s=t.leaf?this.compareMinX:Gm,h=t.leaf?this.compareMinY:km,c=this._allDistMargin(t,e,r,s),d=this._allDistMargin(t,e,r,h);c<d&&t.children.sort(s)}_allDistMargin(t,e,r,s){t.children.sort(s);const h=this.toBBox,c=nr(t,0,e,h),d=nr(t,r-e,r,h);let g=ns(c)+ns(d);for(let m=e;m<r-e;m++){const y=t.children[m];ir(c,t.leaf?h(y):y),g+=ns(c)}for(let m=r-e-1;m>=e;m--){const y=t.children[m];ir(d,t.leaf?h(y):y),g+=ns(d)}return g}_adjustParentBBoxes(t,e,r){for(let s=r;s>=0;s--)ir(e[s],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():ti(t[e],this.toBBox)}}function Nm(i,t,e){if(!e)return t.indexOf(i);for(let r=0;r<t.length;r++)if(e(i,t[r]))return r;return-1}function ti(i,t){nr(i,0,i.children.length,t,i)}function nr(i,t,e,r,s){s||(s=oi(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let h=t;h<e;h++){const c=i.children[h];ir(s,i.leaf?r(c):c)}return s}function ir(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function Gm(i,t){return i.minX-t.minX}function km(i,t){return i.minY-t.minY}function Po(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function ns(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Xm(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function zm(i,t){const e=Math.max(i.minX,t.minX),r=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),h=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,h-r)}function Do(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function is(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function oi(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ph(i,t,e,r,s){const h=[t,e];for(;h.length;){if(e=h.pop(),t=h.pop(),e-t<=r)continue;const c=t+Math.ceil((e-t)/r/2)*r;Qu(i,c,t,e,s),h.push(t,c,c,e)}}const Dh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Fh={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Ym(i){var y,x;var t,e=[],r=1,s;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Dh[i])e=Dh[i].slice(),s="rgb";else if(i==="transparent")r=0,s="rgb",e=[0,0,0];else if(i[0]==="#"){var h=i.slice(1),c=h.length,d=c<=4;r=1,d?(e=[parseInt(h[0]+h[0],16),parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16)],c===4&&(r=parseInt(h[3]+h[3],16)/255)):(e=[parseInt(h[0]+h[1],16),parseInt(h[2]+h[3],16),parseInt(h[4]+h[5],16)],c===8&&(r=parseInt(h[6]+h[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),s="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var g=t[1];s=g.replace(/a$/,"");var m=s==="cmyk"?4:s==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=e.shift()),e=e.map(function(R,C){if(R[R.length-1]==="%")return R=parseFloat(R)/100,C===3?R:s==="rgb"?R*255:s[0]==="h"||s[0]==="l"&&!C?R*100:s==="lab"?R*125:s==="lch"?C<2?R*150:R*360:s[0]==="o"&&!C?R:s==="oklab"?R*.4:s==="oklch"?C<2?R*.4:R*360:R;if(s[C]==="h"||C===2&&s[s.length-1]==="h"){if(Fh[R]!==void 0)return Fh[R];if(R.endsWith("deg"))return parseFloat(R);if(R.endsWith("turn"))return parseFloat(R)*360;if(R.endsWith("grad"))return parseFloat(R)*360/400;if(R.endsWith("rad"))return parseFloat(R)*180/Math.PI}return R==="none"?0:parseFloat(R)}),r=e.length>m?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(R){return parseFloat(R)}),s=((x=(y=i.match(/([a-z])/ig))==null?void 0:y.join(""))==null?void 0:x.toLowerCase())||"rgb");return{space:s,values:e,alpha:r}}const gr={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Fo={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,r=i[2]/100,s,h,c,d,g,m=0;if(e===0)return g=r*255,[g,g,g];for(h=r<.5?r*(1+e):r+e-r*e,s=2*r-h,d=[0,0,0];m<3;)c=t+1/3*-(m-1),c<0?c++:c>1&&c--,g=6*c<1?s+(h-s)*6*c:2*c<1?h:3*c<2?s+(h-s)*(2/3-c)*6:s,d[m++]=g*255;return d}};gr.hsl=function(i){var t=i[0]/255,e=i[1]/255,r=i[2]/255,s=Math.min(t,e,r),h=Math.max(t,e,r),c=h-s,d,g,m;return h===s?d=0:t===h?d=(e-r)/c:e===h?d=2+(r-t)/c:r===h&&(d=4+(t-e)/c),d=Math.min(d*60,360),d<0&&(d+=360),m=(s+h)/2,h===s?g=0:m<=.5?g=c/(h+s):g=c/(2-h-s),[d,g*100,m*100]};function Bm(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=Ym(i);if(!e.space)return[];const r=e.space[0]==="h"?Fo.min:gr.min,s=e.space[0]==="h"?Fo.max:gr.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],r[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],r[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],r[2]),s[2]),e.space[0]==="h"&&(t=Fo.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const oe={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};oe.max=oe.whitepoint[2].D65;oe.rgb=function(i,t){t=t||oe.whitepoint[2].E;var e=i[0]/t[0],r=i[1]/t[1],s=i[2]/t[2],h,c,d;return h=e*3.240969941904521+r*-1.537383177570093+s*-.498610760293,c=e*-.96924363628087+r*1.87596750150772+s*.041555057407175,d=e*.055630079696993+r*-.20397695888897+s*1.056971514242878,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:h=h*12.92,c=c>.0031308?1.055*Math.pow(c,1/2.4)-.055:c=c*12.92,d=d>.0031308?1.055*Math.pow(d,1/2.4)-.055:d=d*12.92,h=Math.min(Math.max(0,h),1),c=Math.min(Math.max(0,c),1),d=Math.min(Math.max(0,d),1),[h*255,c*255,d*255]};gr.xyz=function(i,t){var e=i[0]/255,r=i[1]/255,s=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var h=e*.41239079926595+r*.35758433938387+s*.18048078840183,c=e*.21263900587151+r*.71516867876775+s*.072192315360733,d=e*.019330818715591+r*.11919477979462+s*.95053215224966;return t=t||oe.whitepoint[2].E,[h*t[0],c*t[1],d*t[2]]};var Ca={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var r,s,h,c,d,g,m,y,x,R,C,T,O;if(h=i[0],c=i[1],d=i[2],h===0)return[0,0,0];var M=.0011070564598794539;return t=t||"D65",e=e||2,x=oe.whitepoint[e][t][0],R=oe.whitepoint[e][t][1],C=oe.whitepoint[e][t][2],T=4*x/(x+15*R+3*C),O=9*R/(x+15*R+3*C),r=c/(13*h)+T||0,s=d/(13*h)+O||0,m=h>8?R*Math.pow((h+16)/116,3):R*h*M,g=m*9*r/(4*s)||0,y=m*(12-3*r-20*s)/(4*s)||0,[g,m,y]}};oe.luv=function(i,t,e){var r,s,h,c,d,g,m,y,x,R,C,T,O,M=.008856451679035631,F=903.2962962962961;t=t||"D65",e=e||2,x=oe.whitepoint[e][t][0],R=oe.whitepoint[e][t][1],C=oe.whitepoint[e][t][2],T=4*x/(x+15*R+3*C),O=9*R/(x+15*R+3*C),g=i[0],m=i[1],y=i[2],r=4*g/(g+15*m+3*y)||0,s=9*m/(g+15*m+3*y)||0;var D=m/R;return h=D<=M?F*D:116*Math.pow(D,1/3)-16,c=13*h*(r-T),d=13*h*(s-O),[h,c,d]};var tc={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var t=i[0],e=i[1],r=i[2],s,h,c;return c=r/360*2*Math.PI,s=e*Math.cos(c),h=e*Math.sin(c),[t,s,h]},xyz:function(i){return Ca.xyz(tc.luv(i))}};Ca.lchuv=function(i){var t=i[0],e=i[1],r=i[2],s=Math.sqrt(e*e+r*r),h=Math.atan2(r,e),c=h*360/2/Math.PI;return c<0&&(c+=360),[t,s,c]};oe.lchuv=function(i){return Ca.lchuv(oe.luv(i))};const Sa=[NaN,NaN,NaN,0];function Um(i){return typeof i=="string"?i:Oa(i)}const Wm=1024,tr={};let bo=0;function jm(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function bh(i){const t=oe.lchuv(gr.xyz(i));return t[3]=i[3],t}function Vm(i){const t=oe.rgb(tc.xyz(i));return t[3]=i[3],t}function Aa(i){if(i==="none")return Sa;if(tr.hasOwnProperty(i))return tr[i];if(bo>=Wm){let e=0;for(const r in tr)(e++&3)===0&&(delete tr[r],--bo)}const t=Bm(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return ec(t),tr[i]=t,++bo,t}function mi(i){return Array.isArray(i)?i:Aa(i)}function ec(i){return i[0]=Kt(i[0]+.5|0,0,255),i[1]=Kt(i[1]+.5|0,0,255),i[2]=Kt(i[2]+.5|0,0,255),i[3]=Kt(i[3],0,1),i}function Oa(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let r=i[2];r!=(r|0)&&(r=r+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+r+","+s+")"}function Nh(i){return i[0]>0&&i[1]>0}function Zm(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function ne(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}let bn=0;const he=1<<bn++,vt=1<<bn++,ge=1<<bn++,Ae=1<<bn++,Fn=1<<bn++,rr=1<<bn++,rs=Math.pow(2,bn)-1,La={[he]:"boolean",[vt]:"number",[ge]:"string",[Ae]:"color",[Fn]:"number[]",[rr]:"size"},Km=Object.keys(La).map(Number).sort(As);function Hm(i){return i in La}function sr(i){const t=[];for(const e of Km)or(i,e)&&t.push(La[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function or(i,t){return(i&t)===t}function un(i,t){return i===t}class Jt{constructor(t,e){if(!Hm(t))throw new Error(`literal expressions must have a specific type, got ${sr(t)}`);this.type=t,this.value=e}}class $m{constructor(t,e,...r){this.type=t,this.operator=e,this.args=r}}function nc(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function ie(i,t,e){switch(typeof i){case"boolean":{if(un(t,ge))return new Jt(ge,i?"true":"false");if(!or(t,he))throw new Error(`got a boolean, but expected ${sr(t)}`);return new Jt(he,i)}case"number":{if(un(t,rr))return new Jt(rr,ne(i));if(un(t,he))return new Jt(he,!!i);if(un(t,ge))return new Jt(ge,i.toString());if(!or(t,vt))throw new Error(`got a number, but expected ${sr(t)}`);return new Jt(vt,i)}case"string":{if(un(t,Ae))return new Jt(Ae,Aa(i));if(un(t,he))return new Jt(he,!!i);if(!or(t,ge))throw new Error(`got a string, but expected ${sr(t)}`);return new Jt(ge,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return av(i,t,e);for(const r of i)if(typeof r!="number")throw new Error("expected an array of numbers");if(un(t,rr)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new Jt(rr,i)}if(un(t,Ae)){if(i.length===3)return new Jt(Ae,[...i,1]);if(i.length===4)return new Jt(Ae,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!or(t,Fn))throw new Error(`got an array of numbers, but expected ${sr(t)}`);return new Jt(Fn,i)}const b={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},qm={[b.Get]:lt(dt(1,1/0),Gh),[b.Var]:lt(dt(1,1),Jm),[b.Has]:lt(dt(1,1/0),Gh),[b.Id]:lt(Qm,ei),[b.Concat]:lt(dt(2,1/0),Ct(ge)),[b.GeometryType]:lt(tv,ei),[b.LineMetric]:lt(ei),[b.Resolution]:lt(No,ei),[b.Zoom]:lt(No,ei),[b.Time]:lt(No,ei),[b.Any]:lt(dt(2,1/0),Ct(he)),[b.All]:lt(dt(2,1/0),Ct(he)),[b.Not]:lt(dt(1,1),Ct(he)),[b.Equal]:lt(dt(2,2),Ct(rs)),[b.NotEqual]:lt(dt(2,2),Ct(rs)),[b.GreaterThan]:lt(dt(2,2),Ct(vt)),[b.GreaterThanOrEqualTo]:lt(dt(2,2),Ct(vt)),[b.LessThan]:lt(dt(2,2),Ct(vt)),[b.LessThanOrEqualTo]:lt(dt(2,2),Ct(vt)),[b.Multiply]:lt(dt(2,1/0),kh),[b.Coalesce]:lt(dt(2,1/0),kh),[b.Divide]:lt(dt(2,2),Ct(vt)),[b.Add]:lt(dt(2,1/0),Ct(vt)),[b.Subtract]:lt(dt(2,2),Ct(vt)),[b.Clamp]:lt(dt(3,3),Ct(vt)),[b.Mod]:lt(dt(2,2),Ct(vt)),[b.Pow]:lt(dt(2,2),Ct(vt)),[b.Abs]:lt(dt(1,1),Ct(vt)),[b.Floor]:lt(dt(1,1),Ct(vt)),[b.Ceil]:lt(dt(1,1),Ct(vt)),[b.Round]:lt(dt(1,1),Ct(vt)),[b.Sin]:lt(dt(1,1),Ct(vt)),[b.Cos]:lt(dt(1,1),Ct(vt)),[b.Atan]:lt(dt(1,2),Ct(vt)),[b.Sqrt]:lt(dt(1,1),Ct(vt)),[b.Match]:lt(dt(4,1/0),Xh,nv),[b.Between]:lt(dt(3,3),Ct(vt)),[b.Interpolate]:lt(dt(6,1/0),Xh,iv),[b.Case]:lt(dt(3,1/0),ev,rv),[b.In]:lt(dt(2,2),sv),[b.Number]:lt(dt(1,1/0),Ct(rs)),[b.String]:lt(dt(1,1/0),Ct(rs)),[b.Array]:lt(dt(1,1/0),Ct(vt)),[b.Color]:lt(dt(1,4),Ct(vt)),[b.Band]:lt(dt(1,3),Ct(vt)),[b.Palette]:lt(dt(2,2),ov),[b.ToString]:lt(dt(1,1),Ct(he|vt|ge|Ae))};function Gh(i,t,e){const r=i.length-1,s=new Array(r);for(let h=0;h<r;++h){const c=i[h+1];switch(typeof c){case"number":{s[h]=new Jt(vt,c);break}case"string":{s[h]=new Jt(ge,c);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${c}`)}h===0&&e.properties.add(String(c))}return s}function Jm(i,t,e){const r=i[1];if(typeof r!="string")throw new Error("expected a string argument for var operation");return e.variables.add(r),[new Jt(ge,r)]}function Qm(i,t,e){e.featureId=!0}function tv(i,t,e){e.geometryType=!0}function No(i,t,e){e.mapState=!0}function ei(i,t,e){const r=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${r} operation`);return[]}function dt(i,t){return function(e,r,s){const h=e[0],c=e.length-1;if(i===t){if(c!==i){const d=i===1?"":"s";throw new Error(`expected ${i} argument${d} for ${h}, got ${c}`)}}else if(c<i||c>t){const d=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${d} arguments for ${h}, got ${c}`)}}}function kh(i,t,e){const r=i.length-1,s=new Array(r);for(let h=0;h<r;++h){const c=ie(i[h+1],t,e);s[h]=c}return s}function Ct(i){return function(t,e,r){const s=t.length-1,h=new Array(s);for(let c=0;c<s;++c){const d=ie(t[c+1],i,r);h[c]=d}return h}}function ev(i,t,e){const r=i[0],s=i.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${r}, got ${s} instead`)}function Xh(i,t,e){const r=i[0],s=i.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${r}, got ${s} instead`)}function nv(i,t,e){const r=i.length-1,s=ge|vt|he,h=ie(i[1],s,e),c=ie(i[i.length-1],t,e),d=new Array(r-2);for(let g=0;g<r-2;g+=2){try{const m=ie(i[g+2],h.type,e);d[g]=m}catch(m){throw new Error(`failed to parse argument ${g+1} of match expression: ${m.message}`)}try{const m=ie(i[g+3],c.type,e);d[g+1]=m}catch(m){throw new Error(`failed to parse argument ${g+2} of match expression: ${m.message}`)}}return[h,...d,c]}function iv(i,t,e){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":const g=r[1];if(typeof g!="number"||g<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(g)} instead`);s=g;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(r)}`)}const h=new Jt(vt,s);let c;try{c=ie(i[2],vt,e)}catch(g){throw new Error(`failed to parse argument 1 in interpolate expression: ${g.message}`)}const d=new Array(i.length-3);for(let g=0;g<d.length;g+=2){try{const m=ie(i[g+3],vt,e);d[g]=m}catch(m){throw new Error(`failed to parse argument ${g+2} for interpolate expression: ${m.message}`)}try{const m=ie(i[g+4],t,e);d[g+1]=m}catch(m){throw new Error(`failed to parse argument ${g+3} for interpolate expression: ${m.message}`)}}return[h,c,...d]}function rv(i,t,e){const r=ie(i[i.length-1],t,e),s=new Array(i.length-1);for(let h=0;h<s.length-1;h+=2){try{const c=ie(i[h+1],he,e);s[h]=c}catch(c){throw new Error(`failed to parse argument ${h} of case expression: ${c.message}`)}try{const c=ie(i[h+2],r.type,e);s[h+1]=c}catch(c){throw new Error(`failed to parse argument ${h+1} of case expression: ${c.message}`)}}return s[s.length-1]=r,s}function sv(i,t,e){let r=i[2];if(!Array.isArray(r))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof r[0]=="string"){if(r[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(r[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');r=r[1],s=ge}else s=vt;const h=new Array(r.length);for(let d=0;d<h.length;d++)try{const g=ie(r[d],s,e);h[d]=g}catch(g){throw new Error(`failed to parse haystack item ${d} for "in" expression: ${g.message}`)}return[ie(i[1],s,e),...h]}function ov(i,t,e){let r;try{r=ie(i[1],vt,e)}catch(c){throw new Error(`failed to parse first argument in palette expression: ${c.message}`)}const s=i[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const h=new Array(s.length);for(let c=0;c<h.length;c++){let d;try{d=ie(s[c],Ae,e)}catch(g){throw new Error(`failed to parse color at index ${c} in palette expression: ${g.message}`)}if(!(d instanceof Jt))throw new Error(`the palette color at index ${c} must be a literal value`);h[c]=d}return[r,...h]}function lt(...i){return function(t,e,r){const s=t[0];let h;for(let c=0;c<i.length;c++){const d=i[c](t,e,r);if(c==i.length-1){if(!d)throw new Error("expected last argument validator to return the parsed args");h=d}}return new $m(e,s,...h)}}function av(i,t,e){const r=i[0],s=qm[r];if(!s)throw new Error(`unknown operator: ${r}`);return s(i,t,e)}function ic(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return ic(i.getGeometries()[0]);default:return""}}function rc(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function qe(i,t,e){const r=ie(i,t,e);return Oe(r)}function Oe(i,t){if(i instanceof Jt){if(i.type===Ae&&typeof i.value=="string"){const r=Aa(i.value);return function(){return r}}return function(){return i.value}}const e=i.operator;switch(e){case b.Number:case b.String:case b.Coalesce:return lv(i);case b.Get:case b.Var:case b.Has:return hv(i);case b.Id:return r=>r.featureId;case b.GeometryType:return r=>r.geometryType;case b.Concat:{const r=i.args.map(s=>Oe(s));return s=>"".concat(...r.map(h=>h(s).toString()))}case b.Resolution:return r=>r.resolution;case b.Any:case b.All:case b.Between:case b.In:case b.Not:return cv(i);case b.Equal:case b.NotEqual:case b.LessThan:case b.LessThanOrEqualTo:case b.GreaterThan:case b.GreaterThanOrEqualTo:return uv(i);case b.Multiply:case b.Divide:case b.Add:case b.Subtract:case b.Clamp:case b.Mod:case b.Pow:case b.Abs:case b.Floor:case b.Ceil:case b.Round:case b.Sin:case b.Cos:case b.Atan:case b.Sqrt:return fv(i);case b.Case:return dv(i);case b.Match:return gv(i);case b.Interpolate:return _v(i);case b.ToString:return pv(i);default:throw new Error(`Unsupported operator ${e}`)}}function lv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case b.Coalesce:return h=>{for(let c=0;c<r;++c){const d=s[c](h);if(typeof d<"u"&&d!==null)return d}throw new Error("Expected one of the values to be non-null")};case b.Number:case b.String:return h=>{for(let c=0;c<r;++c){const d=s[c](h);if(typeof d===e)return d}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function hv(i,t){const r=i.args[0].value;switch(i.operator){case b.Get:return s=>{const h=i.args;let c=s.properties[r];for(let d=1,g=h.length;d<g;++d){const y=h[d].value;c=c[y]}return c};case b.Var:return s=>s.variables[r];case b.Has:return s=>{const h=i.args;if(!(r in s.properties))return!1;let c=s.properties[r];for(let d=1,g=h.length;d<g;++d){const y=h[d].value;if(!c||!Object.hasOwn(c,y))return!1;c=c[y]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function uv(i,t){const e=i.operator,r=Oe(i.args[0]),s=Oe(i.args[1]);switch(e){case b.Equal:return h=>r(h)===s(h);case b.NotEqual:return h=>r(h)!==s(h);case b.LessThan:return h=>r(h)<s(h);case b.LessThanOrEqualTo:return h=>r(h)<=s(h);case b.GreaterThan:return h=>r(h)>s(h);case b.GreaterThanOrEqualTo:return h=>r(h)>=s(h);default:throw new Error(`Unsupported comparison operator ${e}`)}}function cv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case b.Any:return h=>{for(let c=0;c<r;++c)if(s[c](h))return!0;return!1};case b.All:return h=>{for(let c=0;c<r;++c)if(!s[c](h))return!1;return!0};case b.Between:return h=>{const c=s[0](h),d=s[1](h),g=s[2](h);return c>=d&&c<=g};case b.In:return h=>{const c=s[0](h);for(let d=1;d<r;++d)if(c===s[d](h))return!0;return!1};case b.Not:return h=>!s[0](h);default:throw new Error(`Unsupported logical operator ${e}`)}}function fv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case b.Multiply:return h=>{let c=1;for(let d=0;d<r;++d)c*=s[d](h);return c};case b.Divide:return h=>s[0](h)/s[1](h);case b.Add:return h=>{let c=0;for(let d=0;d<r;++d)c+=s[d](h);return c};case b.Subtract:return h=>s[0](h)-s[1](h);case b.Clamp:return h=>{const c=s[0](h),d=s[1](h);if(c<d)return d;const g=s[2](h);return c>g?g:c};case b.Mod:return h=>s[0](h)%s[1](h);case b.Pow:return h=>Math.pow(s[0](h),s[1](h));case b.Abs:return h=>Math.abs(s[0](h));case b.Floor:return h=>Math.floor(s[0](h));case b.Ceil:return h=>Math.ceil(s[0](h));case b.Round:return h=>Math.round(s[0](h));case b.Sin:return h=>Math.sin(s[0](h));case b.Cos:return h=>Math.cos(s[0](h));case b.Atan:return r===2?h=>Math.atan2(s[0](h),s[1](h)):h=>Math.atan(s[0](h));case b.Sqrt:return h=>Math.sqrt(s[0](h));default:throw new Error(`Unsupported numeric operator ${e}`)}}function dv(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=Oe(i.args[s]);return s=>{for(let h=0;h<e-1;h+=2)if(r[h](s))return r[h+1](s);return r[e-1](s)}}function gv(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=Oe(i.args[s]);return s=>{const h=r[0](s);for(let c=1;c<e;c+=2)if(h===r[c](s))return r[c+1](s);return r[e-1](s)}}function _v(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=Oe(i.args[s]);return s=>{const h=r[0](s),c=r[1](s);let d,g;for(let m=2;m<e;m+=2){const y=r[m](s);let x=r[m+1](s);const R=Array.isArray(x);if(R&&(x=jm(x)),y>=c)return m===2?x:R?mv(h,c,d,g,y,x):ar(h,c,d,g,y,x);d=y,g=x}return g}}function pv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let h=0;h<r;++h)s[h]=Oe(i.args[h]);switch(e){case b.ToString:return h=>{const c=s[0](h);return i.args[0].type===Ae?Oa(c):c.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function ar(i,t,e,r,s,h){const c=s-e;if(c===0)return r;const d=t-e,g=i===1?d/c:(Math.pow(i,d)-1)/(Math.pow(i,c)-1);return r+g*(h-r)}function mv(i,t,e,r,s,h){if(s-e===0)return r;const d=bh(r),g=bh(h);let m=g[2]-d[2];m>180?m-=360:m<-180&&(m+=360);const y=[ar(i,t,e,d[0],s,g[0]),ar(i,t,e,d[1],s,g[1]),d[2]+ar(i,t,e,0,s,m),ar(i,t,e,r[3],s,h[3])];return ec(Vm(y))}const J={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Ma extends vr{constructor(t,e,r,s){super(),this.extent=t,this.pixelRatio_=r,this.resolution=e,this.state=typeof s=="function"?J.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(ct.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==J.IDLE&&this.loader){this.state=J.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;sa(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(r=>{"image"in r&&(this.image_=r.image),"extent"in r&&(this.extent=r.extent),"resolution"in r&&(this.resolution=r.resolution),"pixelRatio"in r&&(this.pixelRatio_=r.pixelRatio),(r instanceof HTMLImageElement||L_&&r instanceof ImageBitmap||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)&&(this.image_=r),this.state=J.LOADED}).catch(r=>{this.state=J.ERROR,console.error(r)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function vv(i,t,e){const r=i;let s=!0,h=!1,c=!1;const d=[_s(r,ct.LOAD,function(){c=!0,h||t()})];return r.src&&yu?(h=!0,r.decode().then(function(){s&&t()}).catch(function(g){s&&(c?t():e())})):d.push(_s(r,ct.ERROR,e)),function(){s=!1,d.forEach(Gt)}}function yv(i,t){return new Promise((e,r)=>{function s(){c(),e(i)}function h(){c(),r(new Error("Image load error"))}function c(){i.removeEventListener("load",s),i.removeEventListener("error",h)}i.addEventListener("load",s),i.addEventListener("error",h)})}function Ev(i,t){return t&&(i.src=t),i.src&&yu?new Promise((e,r)=>i.decode().then(()=>e(i)).catch(s=>i.complete&&i.width?e(i):r(s))):yv(i)}class xv{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const r=this.cache_[e];(t++&3)===0&&!r.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,r){const s=Go(t,e,r);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,r){const s=Go(t,e,r);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,r,s,h){const c=Go(t,e,r),d=c in this.cache_;this.cache_[c]=s,h&&(s.getImageState()===J.IDLE&&s.load(),s.getImageState()===J.LOADING?s.ready().then(()=>{this.patternCache_[c]=Rs().createPattern(s.getImage(1),"repeat")}):this.patternCache_[c]=Rs().createPattern(s.getImage(1),"repeat")),d||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Go(i,t,e){const r=e?mi(e):"null";return t+":"+i+":"+r}const we=new xv;let er=null;class sc extends vr{constructor(t,e,r,s,h){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=r,this.canvas_={},this.color_=h,this.imageState_=s===void 0?J.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===J.LOADED){er||(er=Qt(1,1,void 0,{willReadFrequently:!0})),er.drawImage(this.image_,0,0);try{er.getImageData(0,0,1,1),this.tainted_=!1}catch{er=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ct.CHANGE)}handleImageError_(){this.imageState_=J.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=J.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],r=Qt(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===J.IDLE){this.image_||this.initializeImage_(),this.imageState_=J.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ev(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==J.LOADED)return;const e=this.image_,r=Qt(Math.ceil(e.width*t),Math.ceil(e.height*t)),s=r.canvas;r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=Um(this.color_),r.fillRect(0,0,s.width/t,s.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===J.LOADED||this.imageState_===J.ERROR)t();else{const e=()=>{(this.imageState_===J.LOADED||this.imageState_===J.ERROR)&&(this.removeEventListener(ct.CHANGE,e),t())};this.addEventListener(ct.CHANGE,e)}})),this.ready_}}function Pa(i,t,e,r,s,h){let c=t===void 0?void 0:we.get(t,e,s);return c||(c=new sc(i,i&&"src"in i?i.src||void 0:t,e,r,s),we.set(t,e,s,c,h)),h&&c&&!we.getPattern(t,e,s)&&we.set(t,e,s,c,h),c}function zh(i){return i?Array.isArray(i)?Oa(i):typeof i=="object"&&"src"in i?Rv(i):i:null}function Rv(i){if(!i.offset||!i.size)return we.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=we.getPattern(t,void 0,i.color);if(e)return e;const r=we.get(i.src,"anonymous",null);if(r.getImageState()!==J.LOADED)return null;const s=Qt(i.size[0],i.size[1]);return s.drawImage(r.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Pa(s.canvas,t,void 0,J.LOADED,i.color,!0),we.getPattern(t,void 0,i.color)}const Yh="#000",Bh="round",Uh="round",wv=10,Tv="#000",Iv=1,Cv=new $e;class Ys{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ne(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ys({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Tt()}getImage(t){return Tt()}getHitDetectionImage(){return Tt()}getPixelRatio(t){return 1}getImageState(){return Tt()}getImageSize(){return Tt()}getOrigin(){return Tt()}getSize(){return Tt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ne(t)}listenImageChange(t){Tt()}load(){Tt()}unlistenImageChange(t){Tt()}ready(){return Promise.resolve()}}class Bs extends Ys{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?J.LOADING:J.LOADED,this.imageState_===J.LOADING&&this.ready().then(()=>this.imageState_=J.LOADED),this.render()}clone(){const t=this.getScale(),e=new Bs({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),r=this.getScaleArray();return[t[0]/2-e[0]/r[0],t[1]/2+e[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var h,c;const e=(h=this.fill_)==null?void 0:h.getKey(),r=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let s=(c=we.get(r,null,null))==null?void 0:c.getImage(1);if(!s){const d=this.renderOptions_,g=Math.ceil(d.size*t),m=Qt(g,g);this.draw_(d,m,t),s=m.canvas,we.set(r,null,null,new sc(s,void 0,null,J.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,r){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius,h=this.radius2_===void 0?s:this.radius2_;if(s<h){const j=s;s=h,h=j}const c=this.radius2_===void 0?this.points_:this.points_*2,d=2*Math.PI/c,g=h*Math.sin(d),m=Math.sqrt(h*h-g*g),y=s-m,x=Math.sqrt(g*g+y*y),R=x/g;if(t==="miter"&&R<=r)return R*e;const C=e/2/R,T=e/2*(y/x),M=Math.sqrt((s+C)*(s+C)+T*T)-s;if(this.radius2_===void 0||t==="bevel")return M*2;const F=s*Math.sin(d),D=Math.sqrt(s*s-F*F),U=h-D,P=Math.sqrt(F*F+U*U)/F;if(P<=r){const j=P*e/2-h-s;return 2*Math.max(M,j)}return M*2}createRenderOptions(){let t=Bh,e=Uh,r=0,s=null,h=0,c,d=0;this.stroke_&&(c=zh(this.stroke_.getColor()??Tv),d=this.stroke_.getWidth()??Iv,s=this.stroke_.getLineDash(),h=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Uh,t=this.stroke_.getLineCap()??Bh,r=this.stroke_.getMiterLimit()??wv);const g=this.calculateLineJoinSize_(e,d,r),m=Math.max(this.radius,this.radius2_||0),y=Math.ceil(2*m+g);return{strokeStyle:c,strokeWidth:d,size:y,lineCap:t,lineDash:s,lineDashOffset:h,lineJoin:e,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=Yh),e.fillStyle=zh(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let r=this.fill_.getColor(),s=0;typeof r=="string"&&(r=mi(r)),r===null?s=1:Array.isArray(r)&&(s=r.length===4?r[3]:1),s===0&&(e=Qt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const r=this.radius;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{const s=this.radius2_===void 0?r:this.radius2_;this.radius2_!==void 0&&(e*=2);const h=this.angle_-Math.PI/2,c=2*Math.PI/e;for(let d=0;d<e;d++){const g=h+d*c,m=d%2===0?r:s;t.lineTo(m*Math.cos(g),m*Math.sin(g))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Yh,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Us extends Bs{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Us({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class Tr{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Tr({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Pa(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===J.IDLE&&e.load(),e.getImageState()===J.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?ee(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:mi(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Wh(i,t,e,r){return e!==void 0&&r!==void 0?[e/i,r/t]:e!==void 0?e/i:r!==void 0?r/t:1}class Ws extends Ys{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,r=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,h=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:r,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:h,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const c=t.img!==void 0?t.img:null;let d=t.src;Mt(!(d!==void 0&&c),"`image` and `src` cannot be provided at the same time"),(d===void 0||d.length===0)&&c&&(d=c.src||ee(c)),Mt(d!==void 0&&d.length>0,"A defined and non-empty `src` or `image` must be provided"),Mt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let g;if(t.src!==void 0?g=J.IDLE:c!==void 0&&("complete"in c?c.complete?g=c.src?J.LOADED:J.IDLE:g=J.LOADING:g=J.LOADED),this.color_=t.color!==void 0?mi(t.color):null,this.iconImage_=Pa(c,d,this.crossOrigin_,g,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let m,y;if(t.size)[m,y]=t.size;else{const x=this.getImage(1);if(x.width&&x.height)m=x.width,y=x.height;else if(x instanceof HTMLImageElement){this.initialOptions_=t;const R=()=>{if(this.unlistenImageChange(R),!this.initialOptions_)return;const C=this.iconImage_.getSize();this.setScale(Wh(C[0],C[1],t.width,t.height))};this.listenImageChange(R);return}}m!==void 0&&this.setScale(Wh(m,y,t.width,t.height))}}clone(){let t,e,r;return this.initialOptions_?(e=this.initialOptions_.width,r=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Ws({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:r,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),r=this.getScaleArray();return[t[0]-e[0]/r[0],t[1]+e[1]/r[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=r[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==J.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==J.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(ct.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(ct.CHANGE,t)}ready(){return this.iconImage_.ready()}}class js{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new js({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class vn{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=jh,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new vn({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=jh,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Sv(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(Mt(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let ko=null;function oc(i,t){if(!ko){const e=new Tr({color:"rgba(255,255,255,0.4)"}),r=new js({color:"#3399CC",width:1.25});ko=[new vn({image:new Us({fill:e,stroke:r,radius:5}),fill:e,stroke:r})]}return ko}function jh(i){return i.getGeometry()}const Av="#333";class Da{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=ne(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Tr({color:Av}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Da({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ne(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function Ov(i){return!0}function Lv(i){const t=nc(),e=Mv(i,t),r=rc();return function(s,h){if(r.properties=s.getPropertiesInternal(),r.resolution=h,t.featureId){const c=s.getId();c!==void 0?r.featureId=c:r.featureId=null}return t.geometryType&&(r.geometryType=ic(s.getGeometry())),e(r)}}function Vh(i){const t=nc(),e=i.length,r=new Array(e);for(let c=0;c<e;++c)r[c]=Qo(i[c],t);const s=rc(),h=new Array(e);return function(c,d){if(s.properties=c.getPropertiesInternal(),s.resolution=d,t.featureId){const m=c.getId();m!==void 0?s.featureId=m:s.featureId=null}let g=0;for(let m=0;m<e;++m){const y=r[m](s);y&&(h[g]=y,g+=1)}return h.length=g,h}}function Mv(i,t){const e=i.length,r=new Array(e);for(let s=0;s<e;++s){const h=i[s],c="filter"in h?qe(h.filter,he,t):Ov;let d;if(Array.isArray(h.style)){const g=h.style.length;d=new Array(g);for(let m=0;m<g;++m)d[m]=Qo(h.style[m],t)}else d=[Qo(h.style,t)];r[s]={filter:c,styles:d}}return function(s){const h=[];let c=!1;for(let d=0;d<e;++d){const g=r[d].filter;if(g(s)&&!(i[d].else&&c)){c=!0;for(const m of r[d].styles){const y=m(s);y&&h.push(y)}}}return h}}function Qo(i,t){const e=_r(i,"",t),r=pr(i,"",t),s=Pv(i,t),h=Dv(i,t),c=_e(i,"z-index",t);if(!e&&!r&&!s&&!h&&!gu(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const d=new vn;return function(g){let m=!0;if(e){const y=e(g);y&&(m=!1),d.setFill(y)}if(r){const y=r(g);y&&(m=!1),d.setStroke(y)}if(s){const y=s(g);y&&(m=!1),d.setText(y)}if(h){const y=h(g);y&&(m=!1),d.setImage(y)}return c&&d.setZIndex(c(g)),m?null:d}}function _r(i,t,e){let r;if(t+"fill-pattern-src"in i)r=Gv(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return h=>null;r=Fa(i,t+"fill-color",e)}if(!r)return null;const s=new Tr;return function(h){const c=r(h);return c===Sa?null:(s.setColor(c),s)}}function pr(i,t,e){const r=_e(i,t+"stroke-width",e),s=Fa(i,t+"stroke-color",e);if(!r&&!s)return null;const h=je(i,t+"stroke-line-cap",e),c=je(i,t+"stroke-line-join",e),d=ac(i,t+"stroke-line-dash",e),g=_e(i,t+"stroke-line-dash-offset",e),m=_e(i,t+"stroke-miter-limit",e),y=new js;return function(x){if(s){const R=s(x);if(R===Sa)return null;y.setColor(R)}if(r&&y.setWidth(r(x)),h){const R=h(x);if(R!=="butt"&&R!=="round"&&R!=="square")throw new Error("Expected butt, round, or square line cap");y.setLineCap(R)}if(c){const R=c(x);if(R!=="bevel"&&R!=="round"&&R!=="miter")throw new Error("Expected bevel, round, or miter line join");y.setLineJoin(R)}return d&&y.setLineDash(d(x)),g&&y.setLineDashOffset(g(x)),m&&y.setMiterLimit(m(x)),y}}function Pv(i,t){const e="text-",r=je(i,e+"value",t);if(!r)return null;const s=_r(i,e,t),h=_r(i,e+"background-",t),c=pr(i,e,t),d=pr(i,e+"background-",t),g=je(i,e+"font",t),m=_e(i,e+"max-angle",t),y=_e(i,e+"offset-x",t),x=_e(i,e+"offset-y",t),R=fi(i,e+"overflow",t),C=je(i,e+"placement",t),T=_e(i,e+"repeat",t),O=Vs(i,e+"scale",t),M=fi(i,e+"rotate-with-view",t),F=_e(i,e+"rotation",t),D=je(i,e+"align",t),U=je(i,e+"justify",t),N=je(i,e+"baseline",t),P=fi(i,e+"keep-upright",t),j=ac(i,e+"padding",t),$=Zs(i,e+"declutter-mode"),X=new Da({declutterMode:$});return function(H){if(X.setText(r(H)),s&&X.setFill(s(H)),h&&X.setBackgroundFill(h(H)),c&&X.setStroke(c(H)),d&&X.setBackgroundStroke(d(H)),g&&X.setFont(g(H)),m&&X.setMaxAngle(m(H)),y&&X.setOffsetX(y(H)),x&&X.setOffsetY(x(H)),R&&X.setOverflow(R(H)),C){const z=C(H);if(z!=="point"&&z!=="line")throw new Error("Expected point or line for text-placement");X.setPlacement(z)}if(T&&X.setRepeat(T(H)),O&&X.setScale(O(H)),M&&X.setRotateWithView(M(H)),F&&X.setRotation(F(H)),D){const z=D(H);if(z!=="left"&&z!=="center"&&z!=="right"&&z!=="end"&&z!=="start")throw new Error("Expected left, right, center, start, or end for text-align");X.setTextAlign(z)}if(U){const z=U(H);if(z!=="left"&&z!=="right"&&z!=="center")throw new Error("Expected left, right, or center for text-justify");X.setJustify(z)}if(N){const z=N(H);if(z!=="bottom"&&z!=="top"&&z!=="middle"&&z!=="alphabetic"&&z!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");X.setTextBaseline(z)}return j&&X.setPadding(j(H)),P&&X.setKeepUpright(P(H)),X}}function Dv(i,t){return"icon-src"in i?Fv(i,t):"shape-points"in i?bv(i,t):"circle-radius"in i?Nv(i,t):null}function Fv(i,t){const e="icon-",r=e+"src",s=lc(i[r],r),h=ws(i,e+"anchor",t),c=Vs(i,e+"scale",t),d=_e(i,e+"opacity",t),g=ws(i,e+"displacement",t),m=_e(i,e+"rotation",t),y=fi(i,e+"rotate-with-view",t),x=Kh(i,e+"anchor-origin"),R=Hh(i,e+"anchor-x-units"),C=Hh(i,e+"anchor-y-units"),T=Yv(i,e+"color"),O=Xv(i,e+"cross-origin"),M=zv(i,e+"offset"),F=Kh(i,e+"offset-origin"),D=Ts(i,e+"width"),U=Ts(i,e+"height"),N=kv(i,e+"size"),P=Zs(i,e+"declutter-mode"),j=new Ws({src:s,anchorOrigin:x,anchorXUnits:R,anchorYUnits:C,color:T,crossOrigin:O,offset:M,offsetOrigin:F,height:U,width:D,size:N,declutterMode:P});return function($){return d&&j.setOpacity(d($)),g&&j.setDisplacement(g($)),m&&j.setRotation(m($)),y&&j.setRotateWithView(y($)),c&&j.setScale(c($)),h&&j.setAnchor(h($)),j}}function bv(i,t){const e="shape-",r=e+"points",s=e+"radius",h=ta(i[r],r),c=ta(i[s],s),d=_r(i,e,t),g=pr(i,e,t),m=Vs(i,e+"scale",t),y=ws(i,e+"displacement",t),x=_e(i,e+"rotation",t),R=fi(i,e+"rotate-with-view",t),C=Ts(i,e+"radius2"),T=Ts(i,e+"angle"),O=Zs(i,e+"declutter-mode"),M=new Bs({points:h,radius:c,radius2:C,angle:T,declutterMode:O});return function(F){return d&&M.setFill(d(F)),g&&M.setStroke(g(F)),y&&M.setDisplacement(y(F)),x&&M.setRotation(x(F)),R&&M.setRotateWithView(R(F)),m&&M.setScale(m(F)),M}}function Nv(i,t){const e="circle-",r=_r(i,e,t),s=pr(i,e,t),h=_e(i,e+"radius",t),c=Vs(i,e+"scale",t),d=ws(i,e+"displacement",t),g=_e(i,e+"rotation",t),m=fi(i,e+"rotate-with-view",t),y=Zs(i,e+"declutter-mode"),x=new Us({radius:5,declutterMode:y});return function(R){return h&&x.setRadius(h(R)),r&&x.setFill(r(R)),s&&x.setStroke(s(R)),d&&x.setDisplacement(d(R)),g&&x.setRotation(g(R)),m&&x.setRotateWithView(m(R)),c&&x.setScale(c(R)),x}}function _e(i,t,e){if(!(t in i))return;const r=qe(i[t],vt,e);return function(s){return ta(r(s),t)}}function je(i,t,e){if(!(t in i))return null;const r=qe(i[t],ge,e);return function(s){return lc(r(s),t)}}function Gv(i,t,e){const r=je(i,t+"pattern-src",e),s=Zh(i,t+"pattern-offset",e),h=Zh(i,t+"pattern-size",e),c=Fa(i,t+"color",e);return function(d){return{src:r(d),offset:s&&s(d),size:h&&h(d),color:c&&c(d)}}}function fi(i,t,e){if(!(t in i))return null;const r=qe(i[t],he,e);return function(s){const h=r(s);if(typeof h!="boolean")throw new Error(`Expected a boolean for ${t}`);return h}}function Fa(i,t,e){if(!(t in i))return null;const r=qe(i[t],Ae,e);return function(s){return hc(r(s),t)}}function ac(i,t,e){if(!(t in i))return null;const r=qe(i[t],Fn,e);return function(s){return Ir(r(s),t)}}function ws(i,t,e){if(!(t in i))return null;const r=qe(i[t],Fn,e);return function(s){const h=Ir(r(s),t);if(h.length!==2)throw new Error(`Expected two numbers for ${t}`);return h}}function Zh(i,t,e){if(!(t in i))return null;const r=qe(i[t],Fn,e);return function(s){return uc(r(s),t)}}function Vs(i,t,e){if(!(t in i))return null;const r=qe(i[t],Fn|vt,e);return function(s){return Bv(r(s),t)}}function Ts(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function kv(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return ne(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Xv(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function Kh(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function Hh(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function zv(i,t){const e=i[t];if(e!==void 0)return Ir(e,t)}function Zs(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Yv(i,t){const e=i[t];if(e!==void 0)return hc(e,t)}function Ir(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let r=0;r<e;++r)if(typeof i[r]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function lc(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function ta(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function hc(i,t){if(typeof i=="string")return i;const e=Ir(i,t),r=e.length;if(r<3||r>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function uc(i,t){const e=Ir(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Bv(i,t){return typeof i=="number"?i:uc(i,t)}const $h={RENDER_ORDER:"renderOrder"};class Uv extends wr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get($h.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const r=this.getDeclutter();r in t.declutter||(t.declutter[r]=new bm(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set($h.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?oc:t;const e=Wv(t);this.styleFunction_=t===null?void 0:Sv(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function Wv(i){if(i===void 0)return oc;if(!i)return null;if(typeof i=="function"||i instanceof vn)return i;if(!Array.isArray(i))return Vh([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof vn){const s=new Array(t);for(let h=0;h<t;++h){const c=i[h];if(!(c instanceof vn))throw new Error("Expected a list of style instances");s[h]=c}return s}if("style"in e){const s=new Array(t);for(let h=0;h<t;++h){const c=i[h];if(!("style"in c))throw new Error("Expected a list of rules with a style property");s[h]=c}return Lv(s)}return Vh(i)}class cc extends Ne{constructor(t,e,r,s){super(t),this.inversePixelTransform=e,this.frameState=r,this.context=s}}class jv extends mr{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){Tt()}calculateMatrices2D(t){const e=t.viewState,r=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;pi(r,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ku(s,r)}forEachFeatureAtCoordinate(t,e,r,s,h,c,d,g){let m;const y=e.viewState;function x(N,P,j,$){return h.call(c,P,N?j:null,$)}const R=y.projection,C=K_(t.slice(),R),T=[[0,0]];if(R.canWrapX()&&s){const N=R.getExtent(),P=yt(N);T.push([-P,0],[P,0])}const O=e.layerStatesArray,M=O.length,F=[],D=[];for(let N=0;N<T.length;N++)for(let P=M-1;P>=0;--P){const j=O[P],$=j.layer;if($.hasRenderer()&&Ia(j,y)&&d.call(g,$)){const X=$.getRenderer(),H=$.getSource();if(X&&H){const z=H.getWrapX()?C:t,ht=x.bind(null,j.managed);D[0]=z[0]+T[N][0],D[1]=z[1]+T[N][1],m=X.forEachFeatureAtCoordinate(D,e,r,ht,F)}if(m)return m}}if(F.length===0)return;const U=1/F.length;return F.forEach((N,P)=>N.distanceSq+=P*U),F.sort((N,P)=>N.distanceSq-P.distanceSq),F.some(N=>m=N.callback(N.feature,N.layer,N.geometry)),m}hasFeatureAtCoordinate(t,e,r,s,h,c){return this.forEachFeatureAtCoordinate(t,e,r,s,ds,this,h,c)!==void 0}getMap(){return this.map_}renderFrame(t){Tt()}scheduleExpireIconCache(t){we.canExpireCache()&&t.postRenderFunctions.push(Vv)}}function Vv(i,t){we.expire()}class Zv extends jv{constructor(t){super(t),this.fontChangeListenerKey_=St(Cv,hr.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=zs+" ol-layers";const r=t.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const r=this.getMap();if(r.hasListener(t)){const s=new cc(t,void 0,e);r.dispatchEvent(s)}}disposeInternal(){Gt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(be.PRECOMPOSE,t);const e=t.layerStatesArray.sort((d,g)=>d.zIndex-g.zIndex);e.some(d=>d.layer instanceof Uv&&d.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const h=[];let c=null;for(let d=0,g=e.length;d<g;++d){const m=e[d];t.layerIndex=d;const y=m.layer,x=y.getSourceState();if(!Ia(m,s)||x!="ready"&&x!="undefined"){y.unrender();continue}const R=y.render(t,c);R&&(R!==c&&(this.children_.push(R),c=R),h.push(m))}this.declutter(t,h),hm(this.element_,this.children_),this.dispatchRenderEvent(be.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let r=e.length-1;r>=0;--r){const s=e[r],h=s.layer;h.getDeclutter()&&h.renderDeclutter(t,s)}e.forEach(r=>r.layer.renderDeferred(t))}}}function fc(i){if(i instanceof wr){i.setMapInternal(null);return}i instanceof xi&&i.getLayers().forEach(fc)}function dc(i,t){if(i instanceof wr){i.setMapInternal(t);return}if(i instanceof xi){const e=i.getLayers().getArray();for(let r=0,s=e.length;r<s;++r)dc(e[r],t)}}class Kv extends $e{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Hv(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:mu,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=mn(),this.pixelToCoordinateTransform_=mn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||dm(),this.interactions=e.interactions||Dm({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new xu(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(se.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(se.VIEW,this.handleViewChanged_),this.addChangeListener(se.SIZE,this.handleSizeChanged_),this.addChangeListener(se.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const r=this;t.view&&!(t.view instanceof Fe)&&t.view.then(function(s){r.setView(new Fe(s))}),this.controls.addEventListener(Re.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(Re.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(Re.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(Re.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(Re.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(Re.REMOVE,s=>{const h=s.element.getId();h!==void 0&&delete this.overlayIdIndex_[h.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){dc(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,r){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};const h=r.hitTolerance!==void 0?r.hitTolerance:0,c=r.layerFilter!==void 0?r.layerFilter:ds,d=r.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,h,d,e,null,c,null)}getFeaturesAtPixel(t,e){const r=[];return this.forEachFeatureAtPixel(t,function(s){r.push(s)},e),r}getAllLayers(){const t=[];function e(r){r.forEach(function(s){s instanceof xi?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const r=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:ds,h=e.hitTolerance!==void 0?e.hitTolerance:0,c=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,h,c,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const r=this.viewport_.getBoundingClientRect(),s=this.getSize(),h=r.width/s[0],c=r.height/s[1],d="changedTouches"in t?t.changedTouches[0]:t;return[(d.clientX-r.left)/h,(d.clientY-r.top)/c]}getTarget(){return this.get(se.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return qo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?de(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(se.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Ve){e.setLayers(t);return}const r=e.getLayers();r.clear(),r.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,r=t.length;e<r;++e){const s=t[e];if(!s.visible)continue;const h=s.layer.getRenderer();if(h&&!h.ready)return!0;const c=s.layer.getSource();if(c&&c.loading)return!0}return!1}getPixelFromCoordinate(t){const e=We(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?de(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(se.SIZE)}getView(){return this.get(se.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,r,s){return D_(this.frameState_,t,e,r,s)}handleBrowserEvent(t,e){e=e||t.type;const r=new fn(e,this,t);this.handleMapBrowserEvent(r)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,r=e.type;if(r===jo.POINTERDOWN||r===ct.WHEEL||r===ct.KEYDOWN){const s=this.getOwnerDocument(),h=this.viewport_.getRootNode?this.viewport_.getRootNode():s,c=e.target,d=h instanceof ShadowRoot?h.host===c?h.host.ownerDocument:h:h===s?s.documentElement:h;if(this.overlayContainerStopEvent_.contains(c)||!d.contains(c))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let h=s.length-1;h>=0;h--){const c=s[h];if(c.getMap()!==this||!c.getActive()||!this.getTargetElement())continue;if(!c.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,h=s;if(t){const c=t.viewHints;if(c[fe.ANIMATING]||c[fe.INTERACTING]){const d=Date.now()-t.time>8;s=d?0:8,h=d?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,h))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(be.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(be.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new si(dn.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new si(dn.LOADSTART,this,t))));const r=this.postRenderFunctions_;if(t)for(let s=0,h=r.length;s<h;++s)r[s](this,t);r.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let r=0,s=this.targetChangeHandlerKeys_.length;r<s;++r)Gt(this.targetChangeHandlerKeys_[r]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ct.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ct.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const r=this.targetElement_.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.unobserve(r.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Zv(this)),this.mapBrowserEventHandler_=new M_(this,this.moveTolerance_);for(const h in Ut)this.mapBrowserEventHandler_.addEventListener(Ut[h],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ct.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ct.WHEEL,this.boundHandleBrowserEvent_,Eu?{passive:!1}:!1);let r;if(this.keyboardEventTarget_)r=this.keyboardEventTarget_;else{const h=e.getRootNode();r=h instanceof ShadowRoot?h.host:e}this.targetChangeHandlerKeys_=[St(r,ct.KEYDOWN,this.handleBrowserEvent,this),St(r,ct.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Gt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Gt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=St(t,hr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=St(t,ct.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Gt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new gn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[St(t,hr.PROPERTYCHANGE,this.render,this),St(t,ct.CHANGE,this.render,this),St(t,"addlayer",this.handleLayerAdd_,this),St(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,r=t.length;e<r;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){fc(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),r=this.getView(),s=this.frameState_;let h=null;if(e!==void 0&&Nh(e)&&r&&r.isDef()){const c=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),d=r.getState();if(h={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:ms(d.center,d.resolution,d.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:d,viewHints:c,wantedTiles:{},mapId:ee(this),renderTargets:{}},d.nextCenter&&d.nextResolution){const g=isNaN(d.nextRotation)?d.rotation:d.nextRotation;h.nextExtent=ms(d.nextCenter,d.nextResolution,g,e)}}this.frameState_=h,this.renderer_.renderFrame(h),h&&(h.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,h.postRenderFunctions),s&&(!this.previousExtent_||!yi(this.previousExtent_)&&!gi(h.extent,this.previousExtent_))&&(this.dispatchEvent(new si(dn.MOVESTART,this,s)),this.previousExtent_=Fs(this.previousExtent_)),this.previousExtent_&&!h.viewHints[fe.ANIMATING]&&!h.viewHints[fe.INTERACTING]&&!gi(h.extent,this.previousExtent_)&&(this.dispatchEvent(new si(dn.MOVEEND,this,h)),k_(h.extent,this.previousExtent_))),this.dispatchEvent(new si(dn.POSTRENDER,this,h)),this.renderComplete_=(this.hasListener(dn.LOADSTART)||this.hasListener(dn.LOADEND)||this.hasListener(be.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new gn("removelayer",e)),this.set(se.LAYERGROUP,t)}setSize(t){this.set(se.SIZE,t)}setTarget(t){this.set(se.TARGET,t)}setView(t){if(!t||t instanceof Fe){this.set(se.VIEW,t);return}this.set(se.VIEW,new Fe);const e=this;t.then(function(r){e.setView(new Fe(r))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),h=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),c=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(h)&&!isNaN(c)&&(e=[Math.max(0,h),Math.max(0,c)],!Nh(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Mu("No map visible because the map container's width or height are 0."))}const r=this.getSize();e&&(!r||!Ls(e,r))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}}function Hv(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},r=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new xi({layers:i.layers});e[se.LAYERGROUP]=r,e[se.TARGET]=i.target,e[se.VIEW]=i.view instanceof Fe?i.view:new Fe;let s;i.controls!==void 0&&(Array.isArray(i.controls)?s=new Ve(i.controls.slice()):(Mt(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=i.controls));let h;i.interactions!==void 0&&(Array.isArray(i.interactions)?h=new Ve(i.interactions.slice()):(Mt(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),h=i.interactions));let c;return i.overlays!==void 0?Array.isArray(i.overlays)?c=new Ve(i.overlays.slice()):(Mt(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),c=i.overlays):c=new Ve,{controls:s,interactions:h,keyboardEventTarget:t,overlays:c,values:e}}class $v{constructor(){rh(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Rs(),{get:(t,e)=>{if(typeof Rs()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,r)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,r),!0)})}pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let r=0,s=e.length;r<s;++r){const h=e[r];if(typeof h=="function"){h(t);continue}const c=e[++r];if(typeof t[h]=="function")t[h](...c);else{if(typeof c=="function"){t[h]=c(t);continue}t[h]=c}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const qv=5;class Jv extends _u{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=qv}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Tt()}getData(t){return null}prepareFrame(t){return Tt()}renderFrame(t,e){return Tt()}forEachFeatureAtCoordinate(t,e,r,s,h){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===J.LOADED||e.getState()===J.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=J.LOADED&&e!=J.ERROR&&t.addEventListener(ct.CHANGE,this.boundHandleImageChange_),e==J.IDLE&&(t.load(),e=t.getState()),e==J.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}let ai=null;function Qv(){ai=Qt(1,1,void 0,{willReadFrequently:!0})}class gc extends Jv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=mn(),this.pixelTransform=mn(),this.inversePixelTransform=mn(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,r){ai||Qv(),ai.clearRect(0,0,1,1);let s;try{ai.drawImage(t,e,r,1,1,0,0,1,1),s=ai.getImageData(0,0,1,1).data}catch{return ai=null,null}return s}getBackground(t){let r=this.getLayer().getBackground();return typeof r=="function"&&(r=r(t.viewState.resolution)),r||void 0}useContainer(t,e,r){const s=this.getLayer().getClassName();let h,c;if(t&&t.className===s&&(!r||t&&t.style.backgroundColor&&Ls(mi(t.style.backgroundColor),mi(r)))){const d=t.firstElementChild;d instanceof HTMLCanvasElement&&(c=d.getContext("2d"))}if(c&&c.canvas.style.transform===e?(this.container=t,this.context=c,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){h=document.createElement("div"),h.className=s;let d=h.style;d.position="absolute",d.width="100%",d.height="100%",c=Qt();const g=c.canvas;h.appendChild(g),d=g.style,d.position="absolute",d.left="0",d.transformOrigin="top left",this.container=h,this.context=c}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(t,e,r){const s=He(r),h=Gs(r),c=Ns(r),d=bs(r);de(e.coordinateToPixelTransform,s),de(e.coordinateToPixelTransform,h),de(e.coordinateToPixelTransform,c),de(e.coordinateToPixelTransform,d);const g=this.inversePixelTransform;de(g,s),de(g,h),de(g,c),de(g,d),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(h[0]),Math.round(h[1])),t.lineTo(Math.round(c[0]),Math.round(c[1])),t.lineTo(Math.round(d[0]),Math.round(d[1])),t.clip()}prepareContainer(t,e){const r=t.extent,s=t.viewState.resolution,h=t.viewState.rotation,c=t.pixelRatio,d=Math.round(yt(r)/s*c),g=Math.round(Wt(r)/s*c);pi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,h,-d/2,-g/2),ku(this.inversePixelTransform,this.pixelTransform);const m=Lp(this.pixelTransform);if(this.useContainer(e,m,this.getBackground(t)),!this.containerReused){const y=this.context.canvas;y.width!=d||y.height!=g?(y.width=d,y.height=g):this.context.clearRect(0,0,d,g),m!==y.style.transform&&(y.style.transform=m)}}dispatchRenderEvent_(t,e,r){const s=this.getLayer();if(s.hasListener(t)){const h=new cc(t,this.inversePixelTransform,r,e);s.dispatchEvent(h)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(be.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(be.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new $v),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(be.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(be.POSTRENDER,this.context,t))}getRenderTransform(t,e,r,s,h,c,d){const g=h/2,m=c/2,y=s/e,x=-y,R=-t[0]+d,C=-t[1];return pi(this.tempTransform,g,m,y,x,-r,R,C)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class ty extends gc{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,s=t.viewState,h=s.resolution,c=this.getLayer().getSource(),d=t.viewHints;let g=t.extent;if(e.extent!==void 0&&(g=pe(g,Ze(e.extent,s.projection))),!d[fe.ANIMATING]&&!d[fe.INTERACTING]&&!yi(g))if(c){const m=s.projection,y=c.getImage(g,h,r,m);y&&(this.loadImage(y)?this.image=y:y.getState()===J.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const r=this.getLayer(),s=de(e.pixelToCoordinateTransform,t.slice()),h=r.getExtent();if(h&&!Ds(h,s))return null;const c=this.image.getExtent(),d=this.image.getImage(),g=yt(c),m=Math.floor(d.width*((s[0]-c[0])/g));if(m<0||m>=d.width)return null;const y=Wt(c),x=Math.floor(d.height*((c[3]-s[1])/y));return x<0||x>=d.height?null:this.getImageData(d,m,x)}renderFrame(t,e){const r=this.image,s=r.getExtent(),h=r.getResolution(),[c,d]=Array.isArray(h)?h:[h,h],g=r.getPixelRatio(),m=t.layerStatesArray[t.layerIndex],y=t.pixelRatio,x=t.viewState,R=x.center,C=x.resolution,T=y*c/(C*g),O=y*d/(C*g);this.prepareContainer(t,e);const M=this.context.canvas.width,F=this.context.canvas.height,D=this.getRenderContext(t);let U=!1,N=!0;if(m.extent){const H=Ze(m.extent,x.projection);N=vi(H,t.extent),U=N&&!Zo(H,t.extent),U&&this.clipUnrotated(D,t,H)}const P=r.getImage(),j=pi(this.tempTransform,M/2,F/2,T,O,0,g*(s[0]-R[0])/c,g*(R[1]-s[3])/d);this.renderedResolution=d*y/g;const $=P.width*j[0],X=P.height*j[3];if(this.getLayer().getSource().getInterpolate()||(D.imageSmoothingEnabled=!1),this.preRender(D,t),N&&$>=.5&&X>=.5){const H=j[4],z=j[5],ht=m.opacity;ht!==1&&(D.save(),D.globalAlpha=ht),D.drawImage(P,0,0,+P.width,+P.height,H,z,$,X),ht!==1&&D.restore()}return this.postRender(this.context,t),U&&D.restore(),D.imageSmoothingEnabled=!0,this.container}}class ey extends wr{constructor(t){t=t||{},super(t)}}class _c extends ey{constructor(t){super(t)}createRenderer(){return new ty(this)}getData(t){return super.getData(t)}}class ny extends Ma{constructor(t,e,r,s,h){const c=h!==void 0?J.IDLE:J.LOADED;super(t,e,r,c),this.loader_=h!==void 0?h:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=J.ERROR):this.state=J.LOADED,this.changed()}load(){this.state==J.IDLE&&(this.state=J.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class ba extends vr{constructor(t,e,r){super(),r=r||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent(ct.CHANGE)}release(){this.setState(K.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==K.EMPTY){if(this.state!==K.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Tt()}getAlpha(t,e){if(!this.transition_)return 1;let r=this.transitionStarts_[t];if(!r)r=e,this.transitionStarts_[t]=r;else if(r===-1)return 1;const s=e-r+1e3/60;return s>=this.transition_?1:Lu(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function Is(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function iy(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}const ry=new Error("disposed");let ni=null;function sy(i){ni||(ni=Qt(i.width,i.height,void 0,{willReadFrequently:!0}));const t=ni.canvas,e=i.width;t.width!==e&&(t.width=e);const r=i.height;return t.height!==r&&(t.height=r),ni.clearRect(0,0,e,r),ni.drawImage(i,0,0),ni.getImageData(0,0,e,r).data}const oy=[256,256];class Cs extends ba{constructor(t){const e=K.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=Is(this.data_);return t?[t.width,t.height]:oy}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==K.IDLE&&this.state!==K.ERROR)return;this.state=K.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=K.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=K.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(ry),this.controller_=null),super.disposeInternal()}}class ay extends ba{constructor(t,e,r,s,h,c){super(t,e,c),this.crossOrigin_=s,this.src_=r,this.key=r,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=h}getImage(){return this.image_}setImage(t){this.image_=t,this.state=K.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=K.ERROR,this.unlistenImage_(),this.image_=ly(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=K.LOADED:this.state=K.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==K.ERROR&&(this.state=K.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==K.IDLE&&(this.state=K.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=vv(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function ly(){const i=Qt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}class Na{constructor(t,e,r,s){this.minX=t,this.maxX=e,this.minY=r,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ii(i,t,e,r,s){return s!==void 0?(s.minX=i,s.maxX=t,s.minY=e,s.maxY=r,s):new Na(i,t,e,r)}let Xo;const di=[];function qh(i,t,e,r,s){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(r,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,r)+1,Math.max(e,s)),i.restore()}function zo(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function hy(){if(Xo===void 0){const i=Qt(6,6,di);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",qh(i,4,5,4,0),qh(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Xo=zo(t,0)||zo(t,4)||zo(t,8),xa(i),di.push(i.canvas)}return Xo}function ea(i,t,e,r){const s=Gu(e,t,i);let h=yh(t,r,e);const c=t.getMetersPerUnit();c!==void 0&&(h*=c);const d=i.getMetersPerUnit();d!==void 0&&(h/=d);const g=i.getExtent();if(!g||Ds(g,s)){const m=yh(i,h,s)/h;isFinite(m)&&m>0&&(h/=m)}return h}function pc(i,t,e,r){const s=Ke(e);let h=ea(i,t,s,r);return(!isFinite(h)||h<=0)&&Su(e,function(c){return h=ea(i,t,c,r),isFinite(h)&&h>0}),h}function mc(i,t,e,r,s,h,c,d,g,m,y,x,R,C){const T=Qt(Math.round(e*i),Math.round(e*t),di);if(x||(T.imageSmoothingEnabled=!1),g.length===0)return T.canvas;T.scale(e,e);function O(P){return Math.round(P*e)/e}T.globalCompositeOperation="lighter";const M=En();g.forEach(function(P,j,$){Iu(M,P.extent)});let F;const D=e/r,U=(x?1:1+Math.pow(2,-24))/D;if(!R||g.length!==1||m!==0){if(F=Qt(Math.round(yt(M)*D),Math.round(Wt(M)*D),di),x||(F.imageSmoothingEnabled=!1),s&&C){const P=(s[0]-M[0])*D,j=-(s[3]-M[3])*D,$=yt(s)*D,X=Wt(s)*D;F.rect(P,j,$,X),F.clip()}g.forEach(function(P,j,$){if(P.image.width>0&&P.image.height>0){if(P.clipExtent){F.save();const it=(P.clipExtent[0]-M[0])*D,V=-(P.clipExtent[3]-M[3])*D,st=yt(P.clipExtent)*D,Q=Wt(P.clipExtent)*D;F.rect(x?it:Math.round(it),x?V:Math.round(V),x?st:Math.round(it+st)-Math.round(it),x?Q:Math.round(V+Q)-Math.round(V)),F.clip()}const X=(P.extent[0]-M[0])*D,H=-(P.extent[3]-M[3])*D,z=yt(P.extent)*D,ht=Wt(P.extent)*D;F.drawImage(P.image,m,m,P.image.width-2*m,P.image.height-2*m,x?X:Math.round(X),x?H:Math.round(H),x?z:Math.round(X+z)-Math.round(X),x?ht:Math.round(H+ht)-Math.round(H)),P.clipExtent&&F.restore()}})}const N=He(c);return d.getTriangles().forEach(function(P,j,$){const X=P.source,H=P.target;let z=X[0][0],ht=X[0][1],it=X[1][0],V=X[1][1],st=X[2][0],Q=X[2][1];const Rt=O((H[0][0]-N[0])/h),gt=O(-(H[0][1]-N[1])/h),Nt=O((H[1][0]-N[0])/h),_t=O(-(H[1][1]-N[1])/h),ut=O((H[2][0]-N[0])/h),Et=O(-(H[2][1]-N[1])/h),Ht=z,wt=ht;z=0,ht=0,it-=Ht,V-=wt,st-=Ht,Q-=wt;const Yt=[[it,V,0,0,Nt-Rt],[st,Q,0,0,ut-Rt],[0,0,it,V,_t-gt],[0,0,st,Q,Et-gt]],et=b_(Yt);if(!et)return;if(T.save(),T.beginPath(),hy()||!x){T.moveTo(Nt,_t);const $t=4,ae=Rt-Nt,Vt=gt-_t;for(let kt=0;kt<$t;kt++)T.lineTo(Nt+O((kt+1)*ae/$t),_t+O(kt*Vt/($t-1))),kt!=$t-1&&T.lineTo(Nt+O((kt+1)*ae/$t),_t+O((kt+1)*Vt/($t-1)));T.lineTo(ut,Et)}else T.moveTo(Nt,_t),T.lineTo(Rt,gt),T.lineTo(ut,Et);T.clip(),T.transform(et[0],et[2],et[1],et[3],Rt,gt),T.translate(M[0]-Ht,M[3]-wt);let jt;if(F)jt=F.canvas,T.scale(U,-U);else{const $t=g[0],ae=$t.extent;jt=$t.image,T.scale(yt(ae)/jt.width,-Wt(ae)/jt.height)}T.drawImage(jt,0,0),T.restore()}),F&&(xa(F),di.push(F.canvas)),y&&(T.save(),T.globalCompositeOperation="source-over",T.strokeStyle="black",T.lineWidth=1,d.getTriangles().forEach(function(P,j,$){const X=P.target,H=(X[0][0]-N[0])/h,z=-(X[0][1]-N[1])/h,ht=(X[1][0]-N[0])/h,it=-(X[1][1]-N[1])/h,V=(X[2][0]-N[0])/h,st=-(X[2][1]-N[1])/h;T.beginPath(),T.moveTo(ht,it),T.lineTo(H,z),T.lineTo(V,st),T.closePath(),T.stroke()}),T.restore()),T.canvas}const uy=10,Jh=.25;class Ga{constructor(t,e,r,s,h,c,d){this.sourceProj_=t,this.targetProj_=e;let g={};const m=d?Cp(U=>de(d,Gu(U,this.targetProj_,this.sourceProj_))):xs(this.targetProj_,this.sourceProj_);this.transformInv_=function(U){const N=U[0]+"/"+U[1];return g[N]||(g[N]=m(U)),g[N]},this.maxSourceExtent_=s,this.errorThresholdSquared_=h*h,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&yt(s)>=yt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?yt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?yt(this.targetProj_.getExtent()):null;const y=He(r),x=Gs(r),R=Ns(r),C=bs(r),T=this.transformInv_(y),O=this.transformInv_(x),M=this.transformInv_(R),F=this.transformInv_(C),D=uy+(c?Math.max(0,Math.ceil(Math.log2(ur(r)/(c*c*256*256)))):0);if(this.addQuad_(y,x,R,C,T,O,M,F,D),this.wrapsXInSource_){let U=1/0;this.triangles_.forEach(function(N,P,j){U=Math.min(U,N.source[0][0],N.source[1][0],N.source[2][0])}),this.triangles_.forEach(N=>{if(Math.max(N.source[0][0],N.source[1][0],N.source[2][0])-U>this.sourceWorldWidth_/2){const P=[[N.source[0][0],N.source[0][1]],[N.source[1][0],N.source[1][1]],[N.source[2][0],N.source[2][1]]];P[0][0]-U>this.sourceWorldWidth_/2&&(P[0][0]-=this.sourceWorldWidth_),P[1][0]-U>this.sourceWorldWidth_/2&&(P[1][0]-=this.sourceWorldWidth_),P[2][0]-U>this.sourceWorldWidth_/2&&(P[2][0]-=this.sourceWorldWidth_);const j=Math.min(P[0][0],P[1][0],P[2][0]);Math.max(P[0][0],P[1][0],P[2][0])-j<this.sourceWorldWidth_/2&&(N.source=P)}})}g={}}addTriangle_(t,e,r,s,h,c){this.triangles_.push({source:[s,h,c],target:[t,e,r]})}addQuad_(t,e,r,s,h,c,d,g,m){const y=hh([h,c,d,g]),x=this.sourceWorldWidth_?yt(y)/this.sourceWorldWidth_:null,R=this.sourceWorldWidth_,C=this.sourceProj_.canWrapX()&&x>.5&&x<1;let T=!1;if(m>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const M=hh([t,e,r,s]);T=yt(M)/this.targetWorldWidth_>Jh||T}!C&&this.sourceProj_.isGlobal()&&x&&(T=x>Jh||T)}if(!T&&this.maxSourceExtent_&&isFinite(y[0])&&isFinite(y[1])&&isFinite(y[2])&&isFinite(y[3])&&!vi(y,this.maxSourceExtent_))return;let O=0;if(!T&&(!isFinite(h[0])||!isFinite(h[1])||!isFinite(c[0])||!isFinite(c[1])||!isFinite(d[0])||!isFinite(d[1])||!isFinite(g[0])||!isFinite(g[1]))){if(m>0)T=!0;else if(O=(!isFinite(h[0])||!isFinite(h[1])?8:0)+(!isFinite(c[0])||!isFinite(c[1])?4:0)+(!isFinite(d[0])||!isFinite(d[1])?2:0)+(!isFinite(g[0])||!isFinite(g[1])?1:0),O!=1&&O!=2&&O!=4&&O!=8)return}if(m>0){if(!T){const M=[(t[0]+r[0])/2,(t[1]+r[1])/2],F=this.transformInv_(M);let D;C?D=(ui(h[0],R)+ui(d[0],R))/2-ui(F[0],R):D=(h[0]+d[0])/2-F[0];const U=(h[1]+d[1])/2-F[1];T=D*D+U*U>this.errorThresholdSquared_}if(T){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){const M=[(e[0]+r[0])/2,(e[1]+r[1])/2],F=this.transformInv_(M),D=[(s[0]+t[0])/2,(s[1]+t[1])/2],U=this.transformInv_(D);this.addQuad_(t,e,M,D,h,c,F,U,m-1),this.addQuad_(D,M,r,s,U,F,d,g,m-1)}else{const M=[(t[0]+e[0])/2,(t[1]+e[1])/2],F=this.transformInv_(M),D=[(r[0]+s[0])/2,(r[1]+s[1])/2],U=this.transformInv_(D);this.addQuad_(t,M,D,s,h,F,U,g,m-1),this.addQuad_(M,e,r,D,F,c,d,U,m-1)}return}}if(C){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(O&11)==0&&this.addTriangle_(t,r,s,h,d,g),(O&14)==0&&this.addTriangle_(t,r,e,h,d,c),O&&((O&13)==0&&this.addTriangle_(e,s,t,c,g,h),(O&7)==0&&this.addTriangle_(e,s,r,c,g,d))}calculateSourceExtent(){const t=En();return this.triangles_.forEach(function(e,r,s){const h=e.source;as(t,h[0]),as(t,h[1]),as(t,h[2])}),t}getTriangles(){return this.triangles_}}const ka=.5;class cy extends ba{constructor(t,e,r,s,h,c,d,g,m,y,x,R){super(h,K.IDLE,R),this.renderEdges_=x!==void 0?x:!1,this.pixelRatio_=d,this.gutter_=g,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=c||h,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const C=s.getTileCoordExtent(this.wrappedTileCoord_),T=this.targetTileGrid_.getExtent();let O=this.sourceTileGrid_.getExtent();const M=T?pe(C,T):C;if(ur(M)===0){this.state=K.EMPTY;return}const F=t.getExtent();F&&(O?O=pe(O,F):O=F);const D=s.getResolution(this.wrappedTileCoord_[0]),U=pc(t,r,M,D);if(!isFinite(U)||U<=0){this.state=K.EMPTY;return}const N=y!==void 0?y:ka;if(this.triangulation_=new Ga(t,r,M,O,U*N,D),this.triangulation_.getTriangles().length===0){this.state=K.EMPTY;return}this.sourceZ_=e.getZForResolution(U);let P=this.triangulation_.calculateSourceExtent();if(O&&(t.canWrapX()?(P[1]=Kt(P[1],O[1],O[3]),P[3]=Kt(P[3],O[1],O[3])):P=pe(P,O)),!ur(P))this.state=K.EMPTY;else{let j=0,$=0;t.canWrapX()&&(j=yt(F),$=Math.floor((P[0]-F[0])/j)),Ou(P.slice(),t).forEach(H=>{const z=e.getTileRangeForExtentAndZ(H,this.sourceZ_);for(let ht=z.minX;ht<=z.maxX;ht++)for(let it=z.minY;it<=z.maxY;it++){const V=m(this.sourceZ_,ht,it,d);if(V){const st=$*j;this.sourceTiles_.push({tile:V,offset:st})}}++$}),this.sourceTiles_.length===0&&(this.state=K.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var s;const r=e.tile;if(r&&r.getState()==K.LOADED){const h=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);h[0]+=e.offset,h[2]+=e.offset;const c=(s=this.clipExtent_)==null?void 0:s.slice();c&&(c[0]+=e.offset,c[2]+=e.offset),t.push({extent:h,clipExtent:c,image:r.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=K.ERROR;else{const e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),s=typeof r=="number"?r:r[0],h=typeof r=="number"?r:r[1],c=this.targetTileGrid_.getResolution(e),d=this.sourceTileGrid_.getResolution(this.sourceZ_),g=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=mc(s,h,this.pixelRatio_,d,this.sourceTileGrid_.getExtent(),c,g,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=K.LOADED}this.changed()}load(){if(this.state==K.IDLE){this.state=K.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const r=e.getState();if(r==K.IDLE||r==K.LOADING){t++;const s=St(e,ct.CHANGE,h=>{const c=e.getState();(c==K.LOADED||c==K.ERROR||c==K.EMPTY)&&(Gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},r,s){e.getState()==K.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Gt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(xa(this.canvas_.getContext("2d")),di.push(this.canvas_),this.canvas_=null),super.release()}}class fy{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof mr&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const r=this.entries_[t];return Mt(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(t){const e=this.entries_[t];return Mt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.key_;return t}getValues(){const t=new Array(this.count_);let e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Mt(!(t in this.entries_),"Tried to set a value for a key that is used already");const r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}setSize(t){this.highWaterMark=t}}function Ss(i,t,e,r){return r!==void 0?(r[0]=i,r[1]=t,r[2]=e,r):[i,t,e]}function dy(i,t,e){return i+"/"+t+"/"+e}function gy(i,t,e){return(t<<i)+e}function _y(i,t){const e=i[0],r=i[1],s=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const h=t.getFullTileRange(e);return h?h.containsXY(r,s):!0}function Yo(i,t,e,r){return`${i},${dy(t,e,r)}`}function Bo(i,t,e){if(!(e in i))return i[e]=new Set([t]),!0;const r=i[e],s=r.has(t);return s||r.add(t),!s}function py(i,t,e){const r=i[e];return r?r.delete(t):!1}function Qh(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=pe(t,Ze(e.extent,i.viewState.projection)));const r=e.layer.getRenderSource();if(!r.getWrapX()){const s=r.getTileGridForProjection(i.viewState.projection).getExtent();s&&(t=pe(t,s))}return t}class my extends gc{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=En(),this.tempTileRange_=new Na(0,0,0,0),this.tempTileCoord_=Ss(0,0,0);const r=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new fy(r),this.maxStaleKeys=r*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,r,s){const h=this.tileCache_,d=this.getLayer().getSource(),g=Yo(d.getKey(),t,e,r);let m;if(h.containsKey(g))m=h.get(g);else{if(m=d.getTile(t,e,r,s.pixelRatio,s.viewState.projection),!m)return null;h.set(g,m)}return m}getTile(t,e,r,s){const h=this.getOrCreateTile(t,e,r,s);return h||null}getData(t){const e=this.frameState;if(!e)return null;const r=this.getLayer(),s=de(e.pixelToCoordinateTransform,t.slice()),h=r.getExtent();if(h&&!Ds(h,s))return null;const c=e.viewState,d=r.getRenderSource(),g=d.getTileGridForProjection(c.projection),m=d.getTilePixelRatio(e.pixelRatio);for(let y=g.getZForResolution(c.resolution);y>=g.getMinZoom();--y){const x=g.getTileCoordForCoordAndZ(s,y),R=this.getTile(y,x[1],x[2],e);if(!R||R.getState()!==K.LOADED)continue;const C=g.getOrigin(y),T=ne(g.getTileSize(y)),O=g.getResolution(y);let M;if(R instanceof ay||R instanceof cy)M=R.getImage();else if(R instanceof Cs){if(M=Is(R.getData()),!M)continue}else continue;const F=Math.floor(m*((s[0]-C[0])/O-x[1]*T[0])),D=Math.floor(m*((C[1]-s[1])/O-x[2]*T[1])),U=Math.round(m*d.getGutterForProjection(c.projection));return this.getImageData(M,F+U,D+U)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const r=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==r&&(this.renderedRevision_=r,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=r,!0}enqueueTiles(t,e,r,s,h){const c=t.viewState,d=this.getLayer(),g=d.getRenderSource(),m=g.getTileGridForProjection(c.projection),y=ee(g);y in t.wantedTiles||(t.wantedTiles[y]={});const x=t.wantedTiles[y],R=d.getMapInternal(),C=Math.max(r-h,m.getMinZoom(),m.getZForResolution(Math.min(d.getMaxResolution(),R?R.getView().getResolutionForZoom(Math.max(d.getMinZoom(),0)):m.getResolution(0)),g.zDirection)),T=c.rotation,O=T?Au(c.center,c.resolution,T,t.size):void 0;for(let M=r;M>=C;--M){const F=m.getTileRangeForExtentAndZ(e,M,this.tempTileRange_),D=m.getResolution(M);for(let U=F.minX;U<=F.maxX;++U)for(let N=F.minY;N<=F.maxY;++N){if(T&&!m.tileCoordIntersectsViewport([M,U,N],O))continue;const P=this.getTile(M,U,N,t);if(!P||!Bo(s,P,M))continue;const $=P.getKey();if(x[$]=!0,P.getState()===K.IDLE&&!t.tileQueue.isKeyQueued($)){const X=Ss(M,U,N,this.tempTileCoord_);t.tileQueue.enqueue([P,y,m.getTileCoordCenter(X),D])}}}}findStaleTile_(t,e){const r=this.tileCache_,s=t[0],h=t[1],c=t[2],d=this.getStaleKeys();for(let g=0;g<d.length;++g){const m=Yo(d[g],s,h,c);if(r.containsKey(m)){const y=r.peek(m);if(y.getState()===K.LOADED)return y.endTransition(ee(this)),Bo(e,y,s),!0}}return!1}findAltTiles_(t,e,r,s){const h=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!h)return!1;let c=!0;const d=this.tileCache_,m=this.getLayer().getRenderSource().getKey();for(let y=h.minX;y<=h.maxX;++y)for(let x=h.minY;x<=h.maxY;++x){const R=Yo(m,r,y,x);let C=!1;if(d.containsKey(R)){const T=d.peek(R);T.getState()===K.LOADED&&(Bo(s,T,r),C=!0)}C||(c=!1)}return c}renderFrame(t,e){let r=!0;this.renderComplete=!0;const s=t.layerStatesArray[t.layerIndex],h=t.viewState,c=h.projection,d=h.resolution,g=h.center,m=t.pixelRatio,y=this.getLayer(),x=y.getSource(),R=x.getTileGridForProjection(c),C=R.getZForResolution(d,x.zDirection),T=R.getResolution(C),O=x.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==O&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=O):this.renderedSourceKey_=O;let M=t.extent;const F=x.getTilePixelRatio(m);this.prepareContainer(t,e);const D=this.context.canvas.width,U=this.context.canvas.height,N=s.extent&&Ze(s.extent);N&&(M=pe(M,Ze(s.extent)));const P=T*D/2/F,j=T*U/2/F,$=[g[0]-P,g[1]-j,g[0]+P,g[1]+j],X={};this.renderedTiles.length=0;const H=y.getPreload();if(t.nextExtent){const _t=R.getZForResolution(h.nextResolution,x.zDirection),ut=Qh(t,t.nextExtent);this.enqueueTiles(t,ut,_t,X,H)}const z=Qh(t,M);if(this.enqueueTiles(t,z,C,X,0),H>0&&setTimeout(()=>{this.enqueueTiles(t,z,C-1,X,H-1)},0),!(C in X))return this.container;const ht=ee(this),it=t.time;for(const _t of X[C]){const ut=_t.getState();if(ut===K.EMPTY)continue;const Et=_t.tileCoord;if(ut===K.LOADED&&_t.getAlpha(ht,it)===1){_t.endTransition(ht);continue}if(ut!==K.IDLE&&(r=!1),ut!==K.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Et,X)){py(X,_t,C),t.animate=!0;continue}if(this.findAltTiles_(R,Et,C+1,X))continue;const Yt=R.getMinZoom();for(let et=C-1;et>=Yt&&!this.findAltTiles_(R,Et,et,X);--et);}const V=T/d*m/F,st=this.getRenderContext(t);pi(this.tempTransform,D/2,U/2,V,V,0,-D/2,-U/2),s.extent&&this.clipUnrotated(st,t,N),x.getInterpolate()||(st.imageSmoothingEnabled=!1),this.preRender(st,t);const Q=Object.keys(X).map(Number);Q.sort(As);let Rt;const gt=[],Nt=[];for(let _t=Q.length-1;_t>=0;--_t){const ut=Q[_t],Et=x.getTilePixelSize(ut,m,c),wt=R.getResolution(ut)/T,Yt=Et[0]*wt*V,et=Et[1]*wt*V,jt=R.getTileCoordForCoordAndZ(He($),ut),$t=R.getTileCoordExtent(jt),ae=de(this.tempTransform,[F*($t[0]-$[0])/T,F*($[3]-$t[3])/T]),Vt=F*x.getGutterForProjection(c);for(const kt of X[ut]){if(kt.getState()!==K.LOADED)continue;const Nn=kt.tileCoord,xn=jt[1]-Nn[1],Rn=Math.round(ae[0]-(xn-1)*Yt),Ie=jt[2]-Nn[2],Ri=Math.round(ae[1]-(Ie-1)*et),ve=Math.round(ae[0]-xn*Yt),Le=Math.round(ae[1]-Ie*et),Je=Rn-ve,Ge=Ri-Le,Cr=Q.length===1;let wi=!1;Rt=[ve,Le,ve+Je,Le,ve+Je,Le+Ge,ve,Le+Ge];for(let Gn=0,$s=gt.length;Gn<$s;++Gn)if(!Cr&&ut<Nt[Gn]){const le=gt[Gn];vi([ve,Le,ve+Je,Le+Ge],[le[0],le[3],le[4],le[7]])&&(wi||(st.save(),wi=!0),st.beginPath(),st.moveTo(Rt[0],Rt[1]),st.lineTo(Rt[2],Rt[3]),st.lineTo(Rt[4],Rt[5]),st.lineTo(Rt[6],Rt[7]),st.moveTo(le[6],le[7]),st.lineTo(le[4],le[5]),st.lineTo(le[2],le[3]),st.lineTo(le[0],le[1]),st.clip())}gt.push(Rt),Nt.push(ut),this.drawTile(kt,t,ve,Le,Je,Ge,Vt,Cr),wi&&st.restore(),this.renderedTiles.unshift(kt),this.updateUsedTiles(t.usedTiles,x,kt)}}if(this.renderedResolution=T,this.extentChanged=!this.renderedExtent_||!gi(this.renderedExtent_,$),this.renderedExtent_=$,this.renderedPixelRatio=m,this.postRender(this.context,t),s.extent&&st.restore(),st.imageSmoothingEnabled=!0,this.renderComplete){const _t=(ut,Et)=>{const Ht=ee(x),wt=Et.wantedTiles[Ht],Yt=wt?Object.keys(wt).length:0;this.updateCacheSize(Yt),this.tileCache_.expireCache()};t.postRenderFunctions.push(_t)}return!this.renderComplete&&!r&&(t.animate=!0),this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,r,s,h,c,d,g){let m;if(t instanceof Cs){if(m=Is(t.getData()),!m)throw new Error("Rendering array data is not yet supported")}else m=this.getTileImage(t);if(!m)return;const y=this.getRenderContext(e),x=ee(this),R=e.layerStatesArray[e.layerIndex],C=R.opacity*(g?t.getAlpha(x,e.time):1),T=C!==y.globalAlpha;T&&(y.save(),y.globalAlpha=C),y.drawImage(m,d,d,m.width-2*d,m.height-2*d,r,s,h,c),T&&y.restore(),C!==R.opacity?e.animate=!0:g&&t.endTransition(x)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,r){const s=ee(e);s in t||(t[s]={}),t[s][r.getKey()]=!0}}const ss={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class vy extends wr{constructor(t){t=t||{};const e=Object.assign({},t),r=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=r,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(ss.PRELOAD)}setPreload(t){this.set(ss.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(ss.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(ss.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class yy extends vy{constructor(t){super(t)}createRenderer(){return new my(this,{cacheSize:this.getCacheSize()})}}function na(i){return Array.isArray(i)?Math.min(...i):i}class Ey extends Ma{constructor(t,e,r,s,h,c,d){let g=t.getExtent();g&&t.canWrapX()&&(g=g.slice(),g[0]=-1/0,g[2]=1/0);let m=e.getExtent();m&&e.canWrapX()&&(m=m.slice(),m[0]=-1/0,m[2]=1/0);const y=m?pe(r,m):r,x=Ke(y),R=ea(t,e,x,s),C=ka,T=new Ga(t,e,y,g,R*C,s),O=T.calculateSourceExtent(),M=yi(O)?null:c(O,R,h),F=M?J.IDLE:J.EMPTY,D=M?M.getPixelRatio():1;super(r,s,D,F),this.targetProj_=e,this.maxSourceExtent_=g,this.triangulation_=T,this.targetResolution_=s,this.targetExtent_=r,this.sourceImage_=M,this.sourcePixelRatio_=D,this.interpolate_=d,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==J.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==J.LOADED){const e=yt(this.targetExtent_)/this.targetResolution_,r=Wt(this.targetExtent_)/this.targetResolution_;this.canvas_=mc(e,r,this.sourcePixelRatio_,na(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==J.IDLE){this.state=J.LOADING,this.changed();const t=this.sourceImage_.getState();t==J.LOADED||t==J.ERROR?this.reproject_():(this.sourceListenerKey_=St(this.sourceImage_,ct.CHANGE,e=>{const r=this.sourceImage_.getState();(r==J.LOADED||r==J.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){Gt(this.sourceListenerKey_),this.sourceListenerKey_=null}}class Ks extends $e{constructor(t){super(),this.projection=me(t.projection),this.attributions_=tu(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(r,s){e.viewResolver=r,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=tu(t),this.changed()}setState(t){this.state_=t,this.changed()}}function tu(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}const os=4,Uo={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class xy extends Ne{constructor(t,e){super(t),this.image=e}}class vc extends Ks{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const r=Os(e,t,0);t=e[r]}return t}getImage(t,e,r,s){const h=this.getProjection();if(!h||!s||lr(h,s))return h&&(s=h),this.getImageInternal(t,e,r,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&lr(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==e&&gi(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ey(h,s,t,e,r,(c,d,g)=>this.getImageInternal(c,d,g,h),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,r,s){if(this.loader){const h=Ry(t,e,r,1),c=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&Zo(this.wantedExtent_,h)||Zo(this.image.getExtent(),h))&&(this.wantedResolution_&&na(this.wantedResolution_)===c||na(this.image.getResolution())===c)))return this.image;this.wantedProjection_=s,this.wantedExtent_=h,this.wantedResolution_=c,this.image=new Ma(h,c,r,this.loader),this.image.addEventListener(ct.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let r;switch(e.getState()){case J.LOADING:this.loading=!0,r=Uo.IMAGELOADSTART;break;case J.LOADED:this.loading=!1,r=Uo.IMAGELOADEND;break;case J.ERROR:this.loading=!1,r=Uo.IMAGELOADERROR;break;default:return}this.hasListener(r)&&this.dispatchEvent(new xy(r,e))}}function Ry(i,t,e,r){const s=t/e,h=Ke(i),c=_n(yt(i)/s,os),d=_n(Wt(i)/s,os),g=_n((r-1)*c/2,os),m=c+2*g,y=_n((r-1)*d/2,os),x=d+2*y;return ms(h,s,0,[m,x])}const ri=[0,0,0],cn=5;class yc{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Mt(w_(this.resolutions_,(s,h)=>h-s),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,h=this.resolutions_.length-1;s<h;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Mt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const r=t.extent;r!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=He(r)),Mt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Mt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:ya,Mt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=r!==void 0?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,h)=>{const c=new Na(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(r){const d=this.getTileRangeForExtentAndZ(r,h);c.minX=Math.max(d.minX,c.minX),c.maxX=Math.min(d.maxX,c.maxX),c.minY=Math.max(d.minY,c.minY),c.maxY=Math.min(d.maxY,c.maxY)}return c}):r&&this.calculateTileRanges_(r)}forEachTileCoord(t,e,r){const s=this.getTileRangeForExtentAndZ(t,e);for(let h=s.minX,c=s.maxX;h<=c;++h)for(let d=s.minY,g=s.maxY;d<=g;++d)r([e,h,d])}forEachTileCoordParentTileRange(t,e,r,s){let h,c,d,g=null,m=t[0]-1;for(this.zoomFactor_===2?(c=t[1],d=t[2]):g=this.getTileCoordExtent(t,s);m>=this.minZoom;){if(c!==void 0&&d!==void 0?(c=Math.floor(c/2),d=Math.floor(d/2),h=ii(c,c,d,d,r)):h=this.getTileRangeForExtentAndZ(g,m,r),e(m,h))return!0;--m}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,r){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const h=t[1]*2,c=t[2]*2;return ii(h,h+1,c,c+1,e)}const s=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],h=t[1],c=t[2];if(e===s)return ii(h,c,h,c,r);if(this.zoomFactor_){const g=Math.pow(this.zoomFactor_,e-s),m=Math.floor(h*g),y=Math.floor(c*g);if(e<s)return ii(m,m,y,y,r);const x=Math.floor(g*(h+1))-1,R=Math.floor(g*(c+1))-1;return ii(m,x,y,R,r)}const d=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(d,e,r)}getTileRangeForExtentAndZ(t,e,r){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ri);const s=ri[1],h=ri[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ri);const c=ri[1],d=ri[2];return ii(s,c,h,d,r)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=ne(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*r,e[1]-(t[2]+.5)*s[1]*r]}getTileCoordExtent(t,e){const r=this.getOrigin(t[0]),s=this.getResolution(t[0]),h=ne(this.getTileSize(t[0]),this.tmpSize_),c=r[0]+t[1]*h[0]*s,d=r[1]-(t[2]+1)*h[1]*s,g=c+h[0]*s,m=d+h[1]*s;return yr(c,d,g,m,e)}getTileCoordForCoordAndResolution(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)}getTileCoordForXYAndResolution_(t,e,r,s,h){const c=this.getZForResolution(r),d=r/this.getResolution(c),g=this.getOrigin(c),m=ne(this.getTileSize(c),this.tmpSize_);let y=d*(t-g[0])/r/m[0],x=d*(g[1]-e)/r/m[1];return s?(y=_n(y,cn)-1,x=_n(x,cn)-1):(y=Jr(y,cn),x=Jr(x,cn)),Ss(c,y,x,h)}getTileCoordForXYAndZ_(t,e,r,s,h){const c=this.getOrigin(r),d=this.getResolution(r),g=ne(this.getTileSize(r),this.tmpSize_);let m=(t-c[0])/d/g[0],y=(c[1]-e)/d/g[1];return s?(m=_n(m,cn)-1,y=_n(y,cn)-1):(m=Jr(m,cn),y=Jr(y,cn)),Ss(r,m,y,h)}getTileCoordForCoordAndZ(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const r=Os(this.resolutions_,t,e||0);return Kt(r,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Vu(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,r=new Array(e);for(let s=this.minZoom;s<e;++s)r[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=r}}function Ec(i){let t=i.getDefaultTileGrid();return t||(t=Cy(i),i.setDefaultTileGrid(t)),t}function wy(i,t,e){const r=t[0],s=i.getTileCoordCenter(t),h=Xa(e);if(!Ds(h,s)){const c=yt(h),d=Math.ceil((h[0]-s[0])/c);return s[0]+=c*d,i.getTileCoordForCoordAndZ(s,r)}return t}function Ty(i,t,e,r){r=r!==void 0?r:"top-left";const s=xc(i,t,e);return new yc({extent:i,origin:B_(i,r),resolutions:s,tileSize:e})}function Iy(i){const t=i||{},e=t.extent||me("EPSG:3857").getExtent(),r={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:xc(e,t.maxZoom,t.tileSize,t.maxResolution)};return new yc(r)}function xc(i,t,e,r){t=t!==void 0?t:im,e=ne(e!==void 0?e:ya);const s=Wt(i),h=yt(i);r=r>0?r:Math.max(h/e[0],s/e[1]);const c=t+1,d=new Array(c);for(let g=0;g<c;++g)d[g]=r/Math.pow(2,g);return d}function Cy(i,t,e,r){const s=Xa(i);return Ty(s,t,e,r)}function Xa(i){i=me(i);let t=i.getExtent();if(!t){const e=180*aa.degrees/i.getMetersPerUnit();t=yr(-e,-e,e,e)}return t}class Rc extends Ks{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ne(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||ee(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,r,s,h){return Tt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Ec(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,r){const s=this.getTileGridForProjection(r),h=this.getTilePixelRatio(e),c=ne(s.getTileSize(t),this.tmpSize);return h==1?c:Zm(c,h,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const r=e!==void 0?e:this.getProjection(),s=e!==void 0?this.getTileGridForProjection(r):this.tileGrid||this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=wy(s,t,r)),_y(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Sy extends Ne{constructor(t,e){super(t),this.tile=e}}function wc(i){return function(t){const e=t.buffers,r=t.meta,s=t.imageOps,h=t.width,c=t.height,d=e.length,g=e[0].byteLength;if(s){const R=new Array(d);for(let T=0;T<d;++T)R[T]=new ImageData(new Uint8ClampedArray(e[T]),h,c);return i(R,r).data.buffer}const m=new Uint8ClampedArray(g),y=new Array(d),x=new Array(d);for(let R=0;R<d;++R)y[R]=new Uint8ClampedArray(e[R]),x[R]=[0,0,0,0];for(let R=0;R<g;R+=4){for(let T=0;T<d;++T){const O=y[T];x[T][0]=O[R],x[T][1]=O[R+1],x[T][2]=O[R+2],x[T][3]=O[R+3]}const C=i(x,r);m[R]=C[0],m[R+1]=C[1],m[R+2]=C[2],m[R+3]=C[3]}return m.buffer}}function Ay(i,t){const r=Object.keys(i.lib||{}).map(function(h){return"const "+h+" = "+i.lib[h].toString()+";"}).concat(["const __minion__ = ("+wc.toString()+")(",i.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),s=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return s.addEventListener("message",t),s}function Oy(i,t){const e=wc(i.operation);let r=!1;return{postMessage:function(s){setTimeout(function(){r||t({data:{buffer:e(s),meta:s.meta}})},0)},terminate:function(){r=!0}}}class Ly extends mr{constructor(t){super(),this.imageOps_=!!t.imageOps;let e;t.threads===0?e=0:this.imageOps_?e=1:e=t.threads||1;const r=new Array(e);if(e)for(let s=0;s<e;++s)r[s]=Ay(t,this.onWorkerMessage_.bind(this,s));else r[0]=Oy(t,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=t.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(t,e,r){this.enqueue_({inputs:t,meta:e,callback:r}),this.dispatch_()}enqueue_(t){for(this.queue_.push(t);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const t=this.queue_.shift();this.job_=t;const e=t.inputs[0].width,r=t.inputs[0].height,s=t.inputs.map(function(g){return g.data.buffer}),h=this.workers_.length;if(this.running_=h,h===1){this.workers_[0].postMessage({buffers:s,meta:t.meta,imageOps:this.imageOps_,width:e,height:r},s);return}const c=t.inputs[0].data.length,d=4*Math.ceil(c/4/h);for(let g=0;g<h;++g){const m=g*d,y=[];for(let x=0,R=s.length;x<R;++x)y.push(s[x].slice(m,m+d));this.workers_[g].postMessage({buffers:y,meta:t.meta,imageOps:this.imageOps_,width:e,height:r},y)}}onWorkerMessage_(t,e){this.disposed||(this.dataLookup_[t]=e.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const t=this.job_,e=this.workers_.length;let r,s;if(e===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),s=this.dataLookup_[0].meta;else{const h=t.inputs[0].data.length;r=new Uint8ClampedArray(h),s=new Array(e);const c=4*Math.ceil(h/4/e);for(let d=0;d<e;++d){const g=this.dataLookup_[d].buffer,m=d*c;r.set(new Uint8ClampedArray(g),m),s[d]=this.dataLookup_[d].meta}}this.job_=null,this.dataLookup_={},t.callback(null,new ImageData(r,t.inputs[0].width,t.inputs[0].height),s),this.dispatch_()}disposeInternal(){for(let t=0;t<this.workers_.length;++t)this.workers_[t].terminate();this.workers_.length=0}}const eu={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class nu extends Ne{constructor(t,e,r){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=r}}class My extends vc{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=Fy(t.sources);const e=this.changed.bind(this);for(let r=0,s=this.layers_.length;r<s;++r)this.layers_[r].addEventListener(ct.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new xu(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:mn(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:Dy(this.layers_),pixelRatio:1,pixelToCoordinateTransform:mn(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:ee(this),renderTargets:{}},this.setAttributions(function(r){var h;const s=[];for(let c=0,d=t.sources.length;c<d;++c){const g=t.sources[c],m=g instanceof Ks?g:g.getSource();if(!m)continue;const y=(h=m.getAttributions())==null?void 0:h(r);typeof y=="string"?s.push(y):y!==void 0&&s.push(...y)}return s}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new Ly({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,r){const s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);const h=Ke(t);s.size[0]=Math.ceil(yt(t)/e),s.size[1]=Math.ceil(Wt(t)/e),s.extent=[h[0]-s.size[0]*e/2,h[1]-s.size[1]*e/2,h[0]+s.size[0]*e/2,h[1]+s.size[1]*e/2],s.time=Date.now();const c=s.viewState;return c.center=h,c.projection=r,c.resolution=e,s}allSourcesReady_(){let t=!0,e;for(let r=0,s=this.layers_.length;r<s;++r)if(e=this.layers_[r].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,r,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const h=this.updateFrameState_(t,e,s);if(this.requestedFrameState_=h,this.renderedImageCanvas_){const c=this.renderedImageCanvas_.getResolution(),d=this.renderedImageCanvas_.getExtent();(e!==c||!gi(h.extent,d))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),h.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,r=new Array(e);for(let h=0;h<e;++h){t.layerIndex=h,t.renderTargets={};const c=Py(this.layers_[h],t);if(c)r[h]=c;else return}const s={};this.dispatchEvent(new nu(eu.BEFOREOPERATIONS,t,s)),this.processor_.process(r,s,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,r,s){if(e||!r)return;const h=t.extent,c=t.viewState.resolution;if(c!==this.requestedFrameState_.viewState.resolution||!gi(h,this.requestedFrameState_.extent))return;let d;if(this.renderedImageCanvas_)d=this.renderedImageCanvas_.getImage().getContext("2d");else{const g=Math.round(yt(h)/c),m=Math.round(Wt(h)/c);d=Qt(g,m),this.renderedImageCanvas_=new ny(h,c,1,d.canvas)}d.putImageData(r,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new nu(eu.AFTEROPERATIONS,t,s))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let r=0,s=this.layers_.length;r<s&&(e=this.layers_[r].getSource().getResolutions(t),!e);++r);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}let Ln=null;function Py(i,t){const e=i.getRenderer();if(!e)throw new Error("Unsupported layer type: "+i);if(!e.prepareFrame(t))return null;const r=t.size[0],s=t.size[1];if(r===0||s===0)return null;const h=e.renderFrame(t,null);let c;if(h instanceof HTMLCanvasElement)c=h;else{if(h&&(c=h.firstElementChild),!(c instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+c);if(c.width===r&&c.height===s)return c.getContext("2d").getImageData(0,0,r,s)}if(!Ln)Ln=Qt(r,s,void 0,{willReadFrequently:!0});else{const d=Ln.canvas;d.width!==r||d.height!==s?Ln=Qt(r,s,void 0,{willReadFrequently:!0}):Ln.clearRect(0,0,r,s)}return Ln.drawImage(c,0,0,r,s),Ln.getImageData(0,0,r,s)}function Dy(i){return i.map(function(t){return t.getLayerState()})}function Fy(i){const t=i.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=by(i[r]);return e}function by(i){let t;return i instanceof Ks?i instanceof Rc?t=new yy({source:i}):i instanceof vc&&(t=new _c({source:i})):t=i,t}const Ny=/\{z\}/g,Gy=/\{x\}/g,ky=/\{y\}/g,Xy=/\{-y\}/g;function zy(i,t,e,r,s){return i.replace(Ny,t.toString()).replace(Gy,e.toString()).replace(ky,r.toString()).replace(Xy,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-r).toString()})}function Yy(i,t,e,r){const s=gy(t,e,r),h=ui(s,i.length);return i[h]}function By(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const r=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let h;for(h=r;h<=s;++h)t.push(i.replace(e[0],String.fromCharCode(h)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const r=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=r;s++)t.push(i.replace(e[0],s.toString()));return t}return t.push(i),t}function Hs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ia(i,t,e,r,s,h,c){c=c??Hs();const d=1/(i-t),g=1/(e-r),m=1/(s-h);return c[0]=-2*d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*g,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*m,c[11]=0,c[12]=(i+t)*d,c[13]=(r+e)*g,c[14]=(h+s)*m,c[15]=1,c}function iu(i,t,e,r,s){return s=s??Hs(),s[0]=i[0]*t,s[1]=i[1]*t,s[2]=i[2]*t,s[3]=i[3]*t,s[4]=i[4]*e,s[5]=i[5]*e,s[6]=i[6]*e,s[7]=i[7]*e,s[8]=i[8]*r,s[9]=i[9]*r,s[10]=i[10]*r,s[11]=i[11]*r,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Uy(i,t,e,r,s){s=s??Hs();let h,c,d,g,m,y,x,R,C,T,O,M;return i===s?(s[12]=i[0]*t+i[4]*e+i[8]*r+i[12],s[13]=i[1]*t+i[5]*e+i[9]*r+i[13],s[14]=i[2]*t+i[6]*e+i[10]*r+i[14],s[15]=i[3]*t+i[7]*e+i[11]*r+i[15]):(h=i[0],c=i[1],d=i[2],g=i[3],m=i[4],y=i[5],x=i[6],R=i[7],C=i[8],T=i[9],O=i[10],M=i[11],s[0]=h,s[1]=c,s[2]=d,s[3]=g,s[4]=m,s[5]=y,s[6]=x,s[7]=R,s[8]=C,s[9]=T,s[10]=O,s[11]=M,s[12]=h*t+m*e+C*r+i[12],s[13]=c*t+y*e+T*r+i[13],s[14]=d*t+x*e+O*r+i[14],s[15]=g*t+R*e+M*r+i[15]),s}function Wy(i,t,e,r){return r=r??Hs(),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=i,r[13]=t,r[14]=e,r[15]=1,r}const jy=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,Vy=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Zy{constructor(t){this.gl_=t,this.program_=ra(t,Vy,jy),this.positionLocation=t.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=t.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=t.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=t.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positions),t.STATIC_DRAW),this.texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.texcoords),t.STATIC_DRAW)}drawImage(t,e,r,s,h,c,d,g,m,y,x,R,C){const T=this.gl_;g===void 0&&(g=s),m===void 0&&(m=h),c===void 0&&(c=e),d===void 0&&(d=r),y===void 0&&(y=c),x===void 0&&(x=d),R===void 0&&(R=T.canvas.width),C===void 0&&(C=T.canvas.height),T.bindTexture(T.TEXTURE_2D,t),T.useProgram(this.program_),T.bindBuffer(T.ARRAY_BUFFER,this.positionBuffer),T.enableVertexAttribArray(this.positionLocation),T.vertexAttribPointer(this.positionLocation,2,T.FLOAT,!1,0,0),T.bindBuffer(T.ARRAY_BUFFER,this.texcoordBuffer),T.enableVertexAttribArray(this.texcoordLocation),T.vertexAttribPointer(this.texcoordLocation,2,T.FLOAT,!1,0,0);let O=ia(0,R,0,C,-1,1);O=Uy(O,g,m,0),O=iu(O,y,x,1),T.uniformMatrix4fv(this.matrixLocation,!1,O);let M=Wy(s/e,h/r,0);M=iu(M,c/e,d/r,1),T.uniformMatrix4fv(this.textureMatrixLocation,!1,M),T.uniform1i(this.textureLocation,0),T.drawArrays(T.TRIANGLES,0,this.positions.length/2)}}function ru(i,t,e){const r=i.createShader(t);if(r===null)throw new Error("Shader compilation failed");if(i.shaderSource(r,e),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS)){const s=i.getShaderInfoLog(r);throw s===null?new Error("Shader info log creation failed"):new Error(s)}return r}function ra(i,t,e){const r=i.createProgram(),s=ru(i,i.VERTEX_SHADER,e),h=ru(i,i.FRAGMENT_SHADER,t);if(r===null)throw new Error("Program creation failed");if(i.attachShader(r,s),i.attachShader(r,h),i.linkProgram(r),!i.getProgramParameter(r,i.LINK_STATUS))throw i.getProgramInfoLog(r)===null?new Error("Program info log creation failed"):new Error;return r}const Ky=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,Hy=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,$y=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,qy=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Jy(i,t,e,r){let s;return e&&e.length?s=e.shift():vu?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("webgl",r)}function Qy(i){const t=i.canvas;t.width=1,t.height=1,i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}const su=[];function t0(i,t,e,r,s,h,c,d,g,m,y,x,R,C){const T=Math.round(r*t),O=Math.round(r*e);i.canvas.width=T,i.canvas.height=O;let M,F;if(F=i.createTexture(),i.bindTexture(i.TEXTURE_2D,F),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),R?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,T,O,0,i.RGBA,y,null),M=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,M),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,F,0),M===null)throw new Error("Could not create framebuffer");if(F===null)throw new Error("Could not create texture");if(g.length===0)return{width:T,height:O,framebuffer:M,texture:F};const D=En();g.forEach(function(z,ht,it){Iu(D,z.extent)});let U,N,P;const j=1/s;{if(U=i.createTexture(),F===null)throw new Error("Could not create texture");N=Math.round(yt(D)*j),P=Math.round(Wt(D)*j);const z=i.getParameter(i.MAX_TEXTURE_SIZE),ht=Math.max(N,P),it=ht>z?z/ht:1,V=Math.round(N*it),st=Math.round(P*it);i.bindTexture(i.TEXTURE_2D,U),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),R?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,V,st,0,i.RGBA,y,null);const Q=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,Q),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,U,0);const Rt=new Zy(i);g.forEach(function(gt,Nt,_t){const ut=(gt.extent[0]-D[0])*j*it,Et=-(gt.extent[3]-D[3])*j*it,Ht=yt(gt.extent)*j*it,wt=Wt(gt.extent)*j*it;if(i.bindFramebuffer(i.FRAMEBUFFER,Q),i.viewport(0,0,V,st),gt.clipExtent){const Yt=(gt.clipExtent[0]-D[0])*j*it,et=-(gt.clipExtent[3]-D[3])*j*it,jt=yt(gt.clipExtent)*j*it,$t=Wt(gt.clipExtent)*j*it;i.enable(i.SCISSOR_TEST),i.scissor(R?Yt:Math.round(Yt),R?et:Math.round(et),R?jt:Math.round(Yt+jt)-Math.round(Yt),R?$t:Math.round(et+$t)-Math.round(et))}Rt.drawImage(gt.texture,gt.width,gt.height,m,m,gt.width-2*m,gt.height-2*m,R?ut:Math.round(ut),R?Et:Math.round(Et),R?Ht:Math.round(ut+Ht)-Math.round(ut),R?wt:Math.round(Et+wt)-Math.round(Et),V,st),i.disable(i.SCISSOR_TEST)}),i.deleteFramebuffer(Q)}const $=He(c),X=He(D),H=z=>{const ht=(z[0][0]-$[0])/h*r,it=-(z[0][1]-$[1])/h*r,V=(z[1][0]-$[0])/h*r,st=-(z[1][1]-$[1])/h*r,Q=(z[2][0]-$[0])/h*r,Rt=-(z[2][1]-$[1])/h*r;return{u1:V,v1:st,u0:ht,v0:it,u2:Q,v2:Rt}};i.bindFramebuffer(i.FRAMEBUFFER,M),i.viewport(0,0,T,O);{const z=[],ht=[],it=ra(i,qy,$y);i.useProgram(it);const V=i.getUniformLocation(it,"u_texture");i.bindTexture(i.TEXTURE_2D,U),i.uniform1i(V,0),d.getTriangles().forEach(function(ut,Et,Ht){const wt=ut.source,Yt=ut.target,{u1:et,v1:jt,u0:$t,v0:ae,u2:Vt,v2:kt}=H(Yt),Nn=(wt[0][0]-X[0])/s/N,xn=-(wt[0][1]-X[1])/s/P,Rn=(wt[1][0]-X[0])/s/N,Ie=-(wt[1][1]-X[1])/s/P,Ri=(wt[2][0]-X[0])/s/N,ve=-(wt[2][1]-X[1])/s/P;z.push(et,jt,$t,ae,Vt,kt),ht.push(Rn,Ie,Nn,xn,Ri,ve)});const st=ia(0,T,O,0,-1,1),Q=i.getUniformLocation(it,"u_matrix");i.uniformMatrix4fv(Q,!1,st);const Rt=i.getAttribLocation(it,"a_position"),gt=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,gt),i.bufferData(i.ARRAY_BUFFER,new Float32Array(z),i.STATIC_DRAW),i.vertexAttribPointer(Rt,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(Rt);const Nt=i.getAttribLocation(it,"a_texcoord"),_t=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,_t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(ht),i.STATIC_DRAW),i.vertexAttribPointer(Nt,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(Nt),i.drawArrays(i.TRIANGLES,0,z.length/2)}if(x){const z=ra(i,Hy,Ky);i.useProgram(z);const ht=ia(0,T,O,0,-1,1),it=i.getUniformLocation(z,"u_matrix");i.uniformMatrix4fv(it,!1,ht);const V=Array.isArray(x)?x:[0,0,0,255],st=i.getUniformLocation(z,"u_val");i.uniform4fv(st,V);const Q=i.getAttribLocation(z,"a_position"),Rt=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,Rt),i.vertexAttribPointer(Q,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(Q);const gt=d.getTriangles().reduce(function(Nt,_t){const ut=_t.target,{u1:Et,v1:Ht,u0:wt,v0:Yt,u2:et,v2:jt}=H(ut);return Nt.concat([Et,Ht,wt,Yt,wt,Yt,et,jt,et,jt,Et,Ht])},[]);i.bufferData(i.ARRAY_BUFFER,new Float32Array(gt),i.STATIC_DRAW),i.drawArrays(i.LINES,0,gt.length/2)}return{width:T,height:O,framebuffer:M,texture:F}}class e0 extends Cs{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.renderEdges_=t.renderEdges!==void 0?t.renderEdges:!1,this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,r=e.getExtent(),s=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?s?pe(r,s):r:s;const h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),c=this.targetTileGrid_.getExtent();let d=this.sourceTileGrid_.getExtent();const g=c?pe(h,c):h;if(ur(g)===0){this.state=K.EMPTY;return}r&&(d?d=pe(d,r):d=r);const m=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),y=t.targetProj,x=pc(e,y,g,m);if(!isFinite(x)||x<=0){this.state=K.EMPTY;return}const R=t.errorThreshold!==void 0?t.errorThreshold:ka;if(this.triangulation_=new Ga(e,y,g,d,x*R,m,t.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=K.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(x);let C=this.triangulation_.calculateSourceExtent();if(d&&(e.canWrapX()?(C[1]=Kt(C[1],d[1],d[3]),C[3]=Kt(C[3],d[1],d[3])):C=pe(C,d)),!ur(C))this.state=K.EMPTY;else{let T=0,O=0;e.canWrapX()&&(T=yt(r),O=Math.floor((C[0]-r[0])/T)),Ou(C.slice(),e).forEach(F=>{const D=this.sourceTileGrid_.getTileRangeForExtentAndZ(F,this.sourceZ_),U=t.getTileFunction;for(let N=D.minX;N<=D.maxX;N++)for(let P=D.minY;P<=D.maxY;P++){const j=U(this.sourceZ_,N,P,this.pixelRatio_);if(j){const $=O*T;this.sourceTiles_.push({tile:j,offset:$})}}++O}),this.sourceTiles_.length===0&&(this.state=K.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];let e=!1;if(this.sourceTiles_.forEach(N=>{var Et;const P=N.tile;if(!P||P.getState()!==K.LOADED)return;const j=P.getSize(),$=this.gutter_;let X;const H=iy(P.getData());H?X=H:(e=!0,X=sy(Is(P.getData())));const z=[j[0]+2*$,j[1]+2*$],ht=X instanceof Float32Array,it=z[0]*z[1],V=ht?Float32Array:Uint8ClampedArray,st=new V(X.buffer),Q=V.BYTES_PER_ELEMENT,Rt=Q*st.length/it,gt=st.byteLength/z[1],Nt=Math.floor(gt/Q/z[0]),_t=this.sourceTileGrid_.getTileCoordExtent(P.tileCoord);_t[0]+=N.offset,_t[2]+=N.offset;const ut=(Et=this.clipExtent_)==null?void 0:Et.slice();ut&&(ut[0]+=N.offset,ut[2]+=N.offset),t.push({extent:_t,clipExtent:ut,data:st,dataType:V,bytesPerPixel:Rt,pixelSize:z,bandCount:Nt})}),this.sourceTiles_.length=0,t.length===0){this.state=K.ERROR,this.changed();return}const r=this.wrappedTileCoord_[0],s=this.targetTileGrid_.getTileSize(r),h=typeof s=="number"?s:s[0],c=typeof s=="number"?s:s[1],d=h*this.pixelRatio_,g=c*this.pixelRatio_,m=this.targetTileGrid_.getResolution(r),y=this.sourceTileGrid_.getResolution(this.sourceZ_),x=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),R=t[0].bandCount,C=new t[0].dataType(R*d*g),T=Jy(d,g,su,{premultipliedAlpha:!1,antialias:!1});let O;const M=T.RGBA;let F;t[0].dataType==Float32Array?(F=T.FLOAT,T.getExtension("WEBGL_color_buffer_float"),T.getExtension("OES_texture_float"),T.getExtension("EXT_float_blend"),O=T.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(F=T.UNSIGNED_BYTE,O=this.interpolate);const D=4,U=Math.ceil(R/D);for(let N=U-1;N>=0;--N){const P=[];for(let V=0,st=t.length;V<st;++V){const Q=t[V],Rt=Q.pixelSize,gt=Rt[0],Nt=Rt[1],_t=new Q.dataType(D*gt*Nt),ut=Q.data;let Et=N*D;for(let wt=0,Yt=_t.length;wt<Yt;wt+=D)_t[wt]=ut[Et],_t[wt+1]=ut[Et+1],_t[wt+2]=ut[Et+2],_t[wt+3]=ut[Et+3],Et+=R;const Ht=T.createTexture();T.bindTexture(T.TEXTURE_2D,Ht),O?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR)):(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST)),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texImage2D(T.TEXTURE_2D,0,M,gt,Nt,0,M,F,_t),P.push({extent:Q.extent,clipExtent:Q.clipExtent,texture:Ht,width:gt,height:Nt})}const{framebuffer:j,width:$,height:X}=t0(T,h,c,this.pixelRatio_,y,m,x,this.triangulation_,P,this.gutter_,F,this.renderEdges_,O),H=$,z=X*D,ht=new t[0].dataType(H*z);T.bindFramebuffer(T.FRAMEBUFFER,j),T.readPixels(0,0,$,X,T.RGBA,F,ht);let it=N*D;for(let V=0,st=ht.length;V<st;V+=D){const Q=(H-1-(V/z|0))*z+V%z;C[it]=ht[Q],C[it+1]=ht[Q+1],C[it+2]=ht[Q+2],C[it+3]=ht[Q+3],it+=R}}if(Qy(T),su.push(T.canvas),e){const N=Qt(h,c),P=new ImageData(C,h);N.putImageData(P,0,0),this.reprojData_=N.canvas}else this.reprojData_=C;this.reprojSize_=[Math.round(d),Math.round(g)],this.state=K.LOADED,this.changed()}load(){if(this.state!==K.IDLE&&this.state!==K.ERROR)return;this.state=K.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const r=e.getState();if(r!==K.IDLE&&r!==K.LOADING)return;t++;const s=St(e,ct.CHANGE,()=>{const h=e.getState();(h==K.LOADED||h==K.ERROR||h==K.EMPTY)&&(Gt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==K.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Gt),this.sourcesListenerKeys_=null}}const Wo={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class n0 extends Rc{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let r=t.tileGrid;r===void 0&&e&&(r=Iy({extent:Xa(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:r,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?ne(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?ne(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return(!e||lr(e,t))&&!this.transformMatrix?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,r,s,h){const c=this.tileGrid||this.getTileGridForProjection(h||s),d=Math.max.apply(null,c.getResolutions().map((C,T)=>{const O=ne(c.getTileSize(T)),M=this.getTileSize(T);return Math.max(M[0]/O[0],M[1]/O[1])})),g=this.getTileGridForProjection(s),m=[t,e,r],y=this.getTileCoordForTileUrlFunction(m,s),x=Object.assign({sourceProj:h||s,sourceTileGrid:c,targetProj:s,targetTileGrid:g,tileCoord:m,wrappedTileCoord:y,pixelRatio:d,gutter:this.gutter_,getTileFunction:(C,T,O,M)=>this.getTile(C,T,O,M),transformMatrix:this.transformMatrix},this.tileOptions),R=new e0(x);return R.key=this.getKey(),R}getTile(t,e,r,s,h){var U;const c=this.getProjection();if(h&&(c&&!lr(c,h)||this.transformMatrix))return this.getReprojTile_(t,e,r,h,c);const d=this.getTileSize(t),g=this.loader_,m=new AbortController,y={signal:m.signal,crossOrigin:this.crossOrigin_},x=this.getTileCoordForTileUrlFunction([t,e,r]);if(!x)return null;const R=x[0],C=x[1],T=x[2],O=(U=this.getTileGrid())==null?void 0:U.getFullTileRange(R);O&&(y.maxY=O.getHeight()-1);function M(){return sa(function(){return g(R,C,T,y)})}const F=Object.assign({tileCoord:[t,e,r],loader:M,size:d,controller:m},this.tileOptions),D=new Cs(F);return D.key=this.getKey(),D.addEventListener(ct.CHANGE,this.handleTileChange_),D}handleTileChange_(t){const e=t.target,r=ee(e),s=e.getState();let h;s==K.LOADING?(this.tileLoadingKeys_[r]=!0,h=Wo.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],h=s==K.ERROR?Wo.TILELOADERROR:s==K.LOADED?Wo.TILELOADEND:void 0),h&&this.dispatchEvent(new Sy(h,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||lr(e,t))&&!this.transformMatrix)return this.tileGrid;const r=ee(t);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=Ec(t)),this.tileGridForProjection_[r]}setTileGridForProjection(t,e){const r=me(t);if(r){const s=ee(r);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=e)}}}const i0=new Error("Image failed to load");function Tc(i,t,e,r,s){return new Promise((h,c)=>{const d=new Image;d.crossOrigin=s.crossOrigin??null,d.addEventListener("load",()=>h(d)),d.addEventListener("error",()=>c(i0)),d.src=zy(i,t,e,r,s.maxY)})}function ou(i){return function(t,e,r,s){const h=Yy(i,t,e,r);return Tc(h,t,e,r,s)}}function r0(i){return function(t,e,r,s){const h=i(t,e,r,s);return Tc(h,t,e,r,s)}}function au(i){let t;if(Array.isArray(i))t=ou(i);else if(typeof i=="string"){const e=By(i);t=ou(e)}else if(typeof i=="function")t=r0(i);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return t}let lu=0;function hu(i){return Array.isArray(i)?i.join(`
`):typeof i=="string"?i:(++lu,"url-function-key-"+lu)}class s0 extends n0{constructor(t){t=t||{};let e=t.loader,r;t.url&&(e=au(t.url),r=hu(t.url));const s=e?t.state:"loading",h=t.wrapX===void 0?!0:t.wrapX;super({loader:e,key:r,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize,gutter:t.gutter,maxResolution:t.maxResolution,projection:t.projection,tileGrid:t.tileGrid,state:s,wrapX:h,transition:t.transition,interpolate:t.interpolate!==!1,crossOrigin:t.crossOrigin,zDirection:t.zDirection})}setUrl(t){const e=au(t);this.setLoader(e),this.setKey(hu(t)),this.getState()!=="ready"&&this.setState("ready")}}function o0(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ls={exports:{}},a0=ls.exports,uu;function l0(){return uu||(uu=1,function(i,t){(function(e,r){i.exports=r()})(a0,function(){var e=function(){function u(o){this.propagationStopped,this.defaultPrevented,this.type=o,this.target=null}return u.prototype.preventDefault=function(){this.defaultPrevented=!0},u.prototype.stopPropagation=function(){this.propagationStopped=!0},u}(),r=e,s={PROPERTYCHANGE:"propertychange"},h=function(){function u(){this.disposed=!1}return u.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},u.prototype.disposeInternal=function(){},u}(),c=h;function d(u,o){return u>o?1:u<o?-1:0}function g(u,o,n){for(;o<n;){var a=u[o];u[o]=u[n],u[n]=a,++o,--n}}function m(u,o){for(var n=Array.isArray(o)?o:[o],a=n.length,l=0;l<a;l++)u[u.length]=n[l]}function y(u,o){var n=u.length;if(n!==o.length)return!1;for(var a=0;a<n;a++)if(u[a]!==o[a])return!1;return!0}function x(){return!0}function R(){}function C(u){var o=!1,n,a,l;return function(){var f=Array.prototype.slice.call(arguments);return(!o||this!==l||!y(f,a))&&(o=!0,l=this,a=f,n=u.apply(this,arguments)),n}}var T=typeof Object.assign=="function"?Object.assign:function(u,o){if(u==null)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(u),a=1,l=arguments.length;a<l;++a){var f=arguments[a];if(f!=null)for(var _ in f)f.hasOwnProperty(_)&&(n[_]=f[_])}return n};function O(u){for(var o in u)delete u[o]}var M=typeof Object.values=="function"?Object.values:function(u){var o=[];for(var n in u)o.push(u[n]);return o};function F(u){var o;for(o in u)return!1;return!o}var D=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),U=function(u){D(o,u);function o(n){var a=u.call(this)||this;return a.eventTarget_=n,a.pendingRemovals_=null,a.dispatching_=null,a.listeners_=null,a}return o.prototype.addEventListener=function(n,a){if(!(!n||!a)){var l=this.listeners_||(this.listeners_={}),f=l[n]||(l[n]=[]);f.indexOf(a)===-1&&f.push(a)}},o.prototype.dispatchEvent=function(n){var a=typeof n=="string",l=a?n:n.type,f=this.listeners_&&this.listeners_[l];if(f){var _=a?new r(n):n;_.target||(_.target=this.eventTarget_||this);var p=this.dispatching_||(this.dispatching_={}),v=this.pendingRemovals_||(this.pendingRemovals_={});l in p||(p[l]=0,v[l]=0),++p[l];for(var E,w=0,I=f.length;w<I;++w)if("handleEvent"in f[w]?E=f[w].handleEvent(_):E=f[w].call(this,_),E===!1||_.propagationStopped){E=!1;break}if(--p[l]===0){var S=v[l];for(delete v[l];S--;)this.removeEventListener(l,R);delete p[l]}return E}},o.prototype.disposeInternal=function(){this.listeners_&&O(this.listeners_)},o.prototype.getListeners=function(n){return this.listeners_&&this.listeners_[n]||void 0},o.prototype.hasListener=function(n){return this.listeners_?n?n in this.listeners_:Object.keys(this.listeners_).length>0:!1},o.prototype.removeEventListener=function(n,a){var l=this.listeners_&&this.listeners_[n];if(l){var f=l.indexOf(a);f!==-1&&(this.pendingRemovals_&&n in this.pendingRemovals_?(l[f]=R,++this.pendingRemovals_[n]):(l.splice(f,1),l.length===0&&delete this.listeners_[n]))}},o}(c),N=U,P={CHANGE:"change",ERROR:"error",LOAD:"load"};function j(u,o,n,a,l){if(a&&a!==u&&(n=n.bind(a)),l){var f=n;n=function(){u.removeEventListener(o,n),f.apply(this,arguments)}}var _={target:u,type:o,listener:n};return u.addEventListener(o,n),_}function $(u,o,n,a){return j(u,o,n,a,!0)}function X(u){u&&u.target&&(u.target.removeEventListener(u.type,u.listener),O(u))}var H=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),z=function(u){H(o,u);function o(){var n=u.call(this)||this;return n.on=n.onInternal,n.once=n.onceInternal,n.un=n.unInternal,n.revision_=0,n}return o.prototype.changed=function(){++this.revision_,this.dispatchEvent(P.CHANGE)},o.prototype.getRevision=function(){return this.revision_},o.prototype.onInternal=function(n,a){if(Array.isArray(n)){for(var l=n.length,f=new Array(l),_=0;_<l;++_)f[_]=j(this,n[_],a);return f}else return j(this,n,a)},o.prototype.onceInternal=function(n,a){var l;if(Array.isArray(n)){var f=n.length;l=new Array(f);for(var _=0;_<f;++_)l[_]=$(this,n[_],a)}else l=$(this,n,a);return a.ol_key=l,l},o.prototype.unInternal=function(n,a){var l=a.ol_key;if(l)ht(l);else if(Array.isArray(n))for(var f=0,_=n.length;f<_;++f)this.removeEventListener(n[f],a);else this.removeEventListener(n,a)},o}(N);z.prototype.on,z.prototype.once,z.prototype.un;function ht(u){if(Array.isArray(u))for(var o=0,n=u.length;o<n;++o)X(u[o]);else X(u)}var it=z;function V(){return function(){throw new Error("Unimplemented abstract method.")}()}var st=0;function Q(u){return u.ol_uid||(u.ol_uid=String(++st))}var Rt="6.14.1",gt=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Nt=function(u){gt(o,u);function o(n,a,l){var f=u.call(this,n)||this;return f.key=a,f.oldValue=l,f}return o}(r),_t=function(u){gt(o,u);function o(n){var a=u.call(this)||this;return a.on,a.once,a.un,Q(a),a.values_=null,n!==void 0&&a.setProperties(n),a}return o.prototype.get=function(n){var a;return this.values_&&this.values_.hasOwnProperty(n)&&(a=this.values_[n]),a},o.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},o.prototype.getProperties=function(){return this.values_&&T({},this.values_)||{}},o.prototype.hasProperties=function(){return!!this.values_},o.prototype.notify=function(n,a){var l;l="change:".concat(n),this.hasListener(l)&&this.dispatchEvent(new Nt(l,n,a)),l=s.PROPERTYCHANGE,this.hasListener(l)&&this.dispatchEvent(new Nt(l,n,a))},o.prototype.addChangeListener=function(n,a){this.addEventListener("change:".concat(n),a)},o.prototype.removeChangeListener=function(n,a){this.removeEventListener("change:".concat(n),a)},o.prototype.set=function(n,a,l){var f=this.values_||(this.values_={});if(l)f[n]=a;else{var _=f[n];f[n]=a,_!==a&&this.notify(n,_)}},o.prototype.setProperties=function(n,a){for(var l in n)this.set(l,n[l],a)},o.prototype.applyProperties=function(n){n.values_&&T(this.values_||(this.values_={}),n.values_)},o.prototype.unset=function(n,a){if(this.values_&&n in this.values_){var l=this.values_[n];delete this.values_[n],F(this.values_)&&(this.values_=null),a||this.notify(n,l)}},o}(it),ut=_t,Et={ACTIVE:"active"},Ht=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),wt=function(u){Ht(o,u);function o(n){var a=u.call(this)||this;return a.on,a.once,a.un,n&&n.handleEvent&&(a.handleEvent=n.handleEvent),a.map_=null,a.setActive(!0),a}return o.prototype.getActive=function(){return this.get(Et.ACTIVE)},o.prototype.getMap=function(){return this.map_},o.prototype.handleEvent=function(n){return!0},o.prototype.setActive=function(n){this.set(Et.ACTIVE,n)},o.prototype.setMap=function(n){this.map_=n},o}(ut),Yt=wt,et={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"},jt=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),$t=function(u){jt(o,u);function o(n){var a=this,l="v"+Rt.split("-")[0],f="Assertion failed. See https://openlayers.org/en/"+l+"/doc/errors/#"+n+" for details.";return a=u.call(this,f)||this,a.code=n,a.name="AssertionError",a.message=f,a}return o}(Error),ae=$t;function Vt(u,o){if(!u)throw new ae(o)}function kt(u,o,n){return Math.min(Math.max(u,o),n)}var Nn=function(){var u;return"cosh"in Math?u=Math.cosh:u=function(o){var n=Math.exp(o);return(n+1/n)/2},u}();function xn(u,o,n,a){var l=n-u,f=a-o;return l*l+f*f}function Rn(u){return u*Math.PI/180}function Ie(u,o,n){return u+n*(o-u)}var Ri=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ve=function(u){Ri(o,u);function o(n){var a=u.call(this)||this;a.on,a.once,a.un,a.background_=n.background;var l=T({},n);return typeof n.properties=="object"&&(delete l.properties,T(l,n.properties)),l[et.OPACITY]=n.opacity!==void 0?n.opacity:1,Vt(typeof l[et.OPACITY]=="number",64),l[et.VISIBLE]=n.visible!==void 0?n.visible:!0,l[et.Z_INDEX]=n.zIndex,l[et.MAX_RESOLUTION]=n.maxResolution!==void 0?n.maxResolution:1/0,l[et.MIN_RESOLUTION]=n.minResolution!==void 0?n.minResolution:0,l[et.MIN_ZOOM]=n.minZoom!==void 0?n.minZoom:-1/0,l[et.MAX_ZOOM]=n.maxZoom!==void 0?n.maxZoom:1/0,a.className_=l.className!==void 0?l.className:"ol-layer",delete l.className,a.setProperties(l),a.state_=null,a}return o.prototype.getBackground=function(){return this.background_},o.prototype.getClassName=function(){return this.className_},o.prototype.getLayerState=function(n){var a=this.state_||{layer:this,managed:n===void 0?!0:n},l=this.getZIndex();return a.opacity=kt(Math.round(this.getOpacity()*100)/100,0,1),a.visible=this.getVisible(),a.extent=this.getExtent(),a.zIndex=l===void 0&&!a.managed?1/0:l,a.maxResolution=this.getMaxResolution(),a.minResolution=Math.max(this.getMinResolution(),0),a.minZoom=this.getMinZoom(),a.maxZoom=this.getMaxZoom(),this.state_=a,a},o.prototype.getLayersArray=function(n){return V()},o.prototype.getLayerStatesArray=function(n){return V()},o.prototype.getExtent=function(){return this.get(et.EXTENT)},o.prototype.getMaxResolution=function(){return this.get(et.MAX_RESOLUTION)},o.prototype.getMinResolution=function(){return this.get(et.MIN_RESOLUTION)},o.prototype.getMinZoom=function(){return this.get(et.MIN_ZOOM)},o.prototype.getMaxZoom=function(){return this.get(et.MAX_ZOOM)},o.prototype.getOpacity=function(){return this.get(et.OPACITY)},o.prototype.getSourceState=function(){return V()},o.prototype.getVisible=function(){return this.get(et.VISIBLE)},o.prototype.getZIndex=function(){return this.get(et.Z_INDEX)},o.prototype.setBackground=function(n){this.background_=n,this.changed()},o.prototype.setExtent=function(n){this.set(et.EXTENT,n)},o.prototype.setMaxResolution=function(n){this.set(et.MAX_RESOLUTION,n)},o.prototype.setMinResolution=function(n){this.set(et.MIN_RESOLUTION,n)},o.prototype.setMaxZoom=function(n){this.set(et.MAX_ZOOM,n)},o.prototype.setMinZoom=function(n){this.set(et.MIN_ZOOM,n)},o.prototype.setOpacity=function(n){Vt(typeof n=="number",64),this.set(et.OPACITY,n)},o.prototype.setVisible=function(n){this.set(et.VISIBLE,n)},o.prototype.setZIndex=function(n){this.set(et.Z_INDEX,n)},o.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),u.prototype.disposeInternal.call(this)},o}(ut),Le=ve,Je={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose"},Ge={UNDEFINED:"undefined",READY:"ready"},Cr=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),wi=function(u){Cr(o,u);function o(n){var a=this,l=T({},n);delete l.source,a=u.call(this,l)||this,a.on,a.once,a.un,a.mapPrecomposeKey_=null,a.mapRenderKey_=null,a.sourceChangeKey_=null,a.renderer_=null,a.rendered=!1,n.render&&(a.render=n.render),n.map&&a.setMap(n.map),a.addChangeListener(et.SOURCE,a.handleSourcePropertyChange_);var f=n.source?n.source:null;return a.setSource(f),a}return o.prototype.getLayersArray=function(n){var a=n||[];return a.push(this),a},o.prototype.getLayerStatesArray=function(n){var a=n||[];return a.push(this.getLayerState()),a},o.prototype.getSource=function(){return this.get(et.SOURCE)||null},o.prototype.getRenderSource=function(){return this.getSource()},o.prototype.getSourceState=function(){var n=this.getSource();return n?n.getState():Ge.UNDEFINED},o.prototype.handleSourceChange_=function(){this.changed()},o.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(X(this.sourceChangeKey_),this.sourceChangeKey_=null);var n=this.getSource();n&&(this.sourceChangeKey_=j(n,P.CHANGE,this.handleSourceChange_,this)),this.changed()},o.prototype.getFeatures=function(n){return this.renderer_?this.renderer_.getFeatures(n):new Promise(function(a){return a([])})},o.prototype.getData=function(n){return!this.renderer_||!this.rendered?null:this.renderer_.getData(n)},o.prototype.render=function(n,a){var l=this.getRenderer();if(l.prepareFrame(n))return this.rendered=!0,l.renderFrame(n,a)},o.prototype.unrender=function(){this.rendered=!1},o.prototype.setMapInternal=function(n){n||this.unrender(),this.set(et.MAP,n)},o.prototype.getMapInternal=function(){return this.get(et.MAP)},o.prototype.setMap=function(n){this.mapPrecomposeKey_&&(X(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),n||this.changed(),this.mapRenderKey_&&(X(this.mapRenderKey_),this.mapRenderKey_=null),n&&(this.mapPrecomposeKey_=j(n,Je.PRECOMPOSE,function(a){var l=a,f=l.frameState.layerStatesArray,_=this.getLayerState(!1);Vt(!f.some(function(p){return p.layer===_.layer}),67),f.push(_)},this),this.mapRenderKey_=j(this,P.CHANGE,n.render,n),this.changed())},o.prototype.setSource=function(n){this.set(et.SOURCE,n)},o.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},o.prototype.hasRenderer=function(){return!!this.renderer_},o.prototype.createRenderer=function(){return null},o.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),u.prototype.disposeInternal.call(this)},o}(Le),Gn=wi;function $s(u,o,n,a,l){le(u,o,n||0,a||u.length-1,l||Sc)}function le(u,o,n,a,l){for(;a>n;){if(a-n>600){var f=a-n+1,_=o-n+1,p=Math.log(f),v=.5*Math.exp(2*p/3),E=.5*Math.sqrt(p*v*(f-v)/f)*(_-f/2<0?-1:1),w=Math.max(n,Math.floor(o-_*v/f+E)),I=Math.min(a,Math.floor(o+(f-_)*v/f+E));le(u,o,w,I,l)}var S=u[o],A=n,L=a;for(Ti(u,n,o),l(u[a],S)>0&&Ti(u,n,a);A<L;){for(Ti(u,A,L),A++,L--;l(u[A],S)<0;)A++;for(;l(u[L],S)>0;)L--}l(u[n],S)===0?Ti(u,n,L):(L++,Ti(u,L,a)),L<=o&&(n=L+1),o<=L&&(a=L-1)}}function Ti(u,o,n){var a=u[o];u[o]=u[n],u[n]=a}function Sc(u,o){return u<o?-1:u>o?1:0}class ja{constructor(o=9){this._maxEntries=Math.max(4,o),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(o){let n=this.data;const a=[];if(!Ar(o,n))return a;const l=this.toBBox,f=[];for(;n;){for(let _=0;_<n.children.length;_++){const p=n.children[_],v=n.leaf?l(p):p;Ar(o,v)&&(n.leaf?a.push(p):Js(o,v)?this._all(p,a):f.push(p))}n=f.pop()}return a}collides(o){let n=this.data;if(!Ar(o,n))return!1;const a=[];for(;n;){for(let l=0;l<n.children.length;l++){const f=n.children[l],_=n.leaf?this.toBBox(f):f;if(Ar(o,_)){if(n.leaf||Js(o,_))return!0;a.push(f)}}n=a.pop()}return!1}load(o){if(!(o&&o.length))return this;if(o.length<this._minEntries){for(let a=0;a<o.length;a++)this.insert(o[a]);return this}let n=this._build(o.slice(),0,o.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const a=this.data;this.data=n,n=a}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(o){return o&&this._insert(o,this.data.height-1),this}clear(){return this.data=Xn([]),this}remove(o,n){if(!o)return this;let a=this.data;const l=this.toBBox(o),f=[],_=[];let p,v,E;for(;a||f.length;){if(a||(a=f.pop(),v=f[f.length-1],p=_.pop(),E=!0),a.leaf){const w=Ac(o,a.children,n);if(w!==-1)return a.children.splice(w,1),f.push(a),this._condense(f),this}!E&&!a.leaf&&Js(a,l)?(f.push(a),_.push(p),p=0,v=a,a=a.children[0]):v?(p++,a=v.children[p],E=!1):a=null}return this}toBBox(o){return o}compareMinX(o,n){return o.minX-n.minX}compareMinY(o,n){return o.minY-n.minY}toJSON(){return this.data}fromJSON(o){return this.data=o,this}_all(o,n){const a=[];for(;o;)o.leaf?n.push(...o.children):a.push(...o.children),o=a.pop();return n}_build(o,n,a,l){const f=a-n+1;let _=this._maxEntries,p;if(f<=_)return p=Xn(o.slice(n,a+1)),kn(p,this.toBBox),p;l||(l=Math.ceil(Math.log(f)/Math.log(_)),_=Math.ceil(f/Math.pow(_,l-1))),p=Xn([]),p.leaf=!1,p.height=l;const v=Math.ceil(f/_),E=v*Math.ceil(Math.sqrt(_));Va(o,n,a,E,this.compareMinX);for(let w=n;w<=a;w+=E){const I=Math.min(w+E-1,a);Va(o,w,I,v,this.compareMinY);for(let S=w;S<=I;S+=v){const A=Math.min(S+v-1,I);p.children.push(this._build(o,S,A,l-1))}}return kn(p,this.toBBox),p}_chooseSubtree(o,n,a,l){for(;l.push(n),!(n.leaf||l.length-1===a);){let f=1/0,_=1/0,p;for(let v=0;v<n.children.length;v++){const E=n.children[v],w=qs(E),I=Mc(o,E)-w;I<_?(_=I,f=w<f?w:f,p=E):I===_&&w<f&&(f=w,p=E)}n=p||n.children[0]}return n}_insert(o,n,a){const l=a?o:this.toBBox(o),f=[],_=this._chooseSubtree(l,this.data,n,f);for(_.children.push(o),Ci(_,l);n>=0&&f[n].children.length>this._maxEntries;)this._split(f,n),n--;this._adjustParentBBoxes(l,f,n)}_split(o,n){const a=o[n],l=a.children.length,f=this._minEntries;this._chooseSplitAxis(a,f,l);const _=this._chooseSplitIndex(a,f,l),p=Xn(a.children.splice(_,a.children.length-_));p.height=a.height,p.leaf=a.leaf,kn(a,this.toBBox),kn(p,this.toBBox),n?o[n-1].children.push(p):this._splitRoot(a,p)}_splitRoot(o,n){this.data=Xn([o,n]),this.data.height=o.height+1,this.data.leaf=!1,kn(this.data,this.toBBox)}_chooseSplitIndex(o,n,a){let l,f=1/0,_=1/0;for(let p=n;p<=a-n;p++){const v=Ii(o,0,p,this.toBBox),E=Ii(o,p,a,this.toBBox),w=Pc(v,E),I=qs(v)+qs(E);w<f?(f=w,l=p,_=I<_?I:_):w===f&&I<_&&(_=I,l=p)}return l||a-n}_chooseSplitAxis(o,n,a){const l=o.leaf?this.compareMinX:Oc,f=o.leaf?this.compareMinY:Lc,_=this._allDistMargin(o,n,a,l),p=this._allDistMargin(o,n,a,f);_<p&&o.children.sort(l)}_allDistMargin(o,n,a,l){o.children.sort(l);const f=this.toBBox,_=Ii(o,0,n,f),p=Ii(o,a-n,a,f);let v=Sr(_)+Sr(p);for(let E=n;E<a-n;E++){const w=o.children[E];Ci(_,o.leaf?f(w):w),v+=Sr(_)}for(let E=a-n-1;E>=n;E--){const w=o.children[E];Ci(p,o.leaf?f(w):w),v+=Sr(p)}return v}_adjustParentBBoxes(o,n,a){for(let l=a;l>=0;l--)Ci(n[l],o)}_condense(o){for(let n=o.length-1,a;n>=0;n--)o[n].children.length===0?n>0?(a=o[n-1].children,a.splice(a.indexOf(o[n]),1)):this.clear():kn(o[n],this.toBBox)}}function Ac(u,o,n){if(!n)return o.indexOf(u);for(let a=0;a<o.length;a++)if(n(u,o[a]))return a;return-1}function kn(u,o){Ii(u,0,u.children.length,o,u)}function Ii(u,o,n,a,l){l||(l=Xn(null)),l.minX=1/0,l.minY=1/0,l.maxX=-1/0,l.maxY=-1/0;for(let f=o;f<n;f++){const _=u.children[f];Ci(l,u.leaf?a(_):_)}return l}function Ci(u,o){return u.minX=Math.min(u.minX,o.minX),u.minY=Math.min(u.minY,o.minY),u.maxX=Math.max(u.maxX,o.maxX),u.maxY=Math.max(u.maxY,o.maxY),u}function Oc(u,o){return u.minX-o.minX}function Lc(u,o){return u.minY-o.minY}function qs(u){return(u.maxX-u.minX)*(u.maxY-u.minY)}function Sr(u){return u.maxX-u.minX+(u.maxY-u.minY)}function Mc(u,o){return(Math.max(o.maxX,u.maxX)-Math.min(o.minX,u.minX))*(Math.max(o.maxY,u.maxY)-Math.min(o.minY,u.minY))}function Pc(u,o){const n=Math.max(u.minX,o.minX),a=Math.max(u.minY,o.minY),l=Math.min(u.maxX,o.maxX),f=Math.min(u.maxY,o.maxY);return Math.max(0,l-n)*Math.max(0,f-a)}function Js(u,o){return u.minX<=o.minX&&u.minY<=o.minY&&o.maxX<=u.maxX&&o.maxY<=u.maxY}function Ar(u,o){return o.minX<=u.maxX&&o.minY<=u.maxY&&o.maxX>=u.minX&&o.maxY>=u.minY}function Xn(u){return{children:u,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Va(u,o,n,a,l){const f=[o,n];for(;f.length;){if(n=f.pop(),o=f.pop(),n-o<=a)continue;const _=o+Math.ceil((n-o)/a/2)*a;$s(u,_,o,n,l),f.push(o,_,_,n)}}var Pt={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function Za(u,o){return Array.isArray(u)?u:(o===void 0?o=[u,u]:(o[0]=u,o[1]=u),o)}var Dc=function(){function u(o){this.opacity_=o.opacity,this.rotateWithView_=o.rotateWithView,this.rotation_=o.rotation,this.scale_=o.scale,this.scaleArray_=Za(o.scale),this.displacement_=o.displacement}return u.prototype.clone=function(){var o=this.getScale();return new u({opacity:this.getOpacity(),scale:Array.isArray(o)?o.slice():o,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},u.prototype.getOpacity=function(){return this.opacity_},u.prototype.getRotateWithView=function(){return this.rotateWithView_},u.prototype.getRotation=function(){return this.rotation_},u.prototype.getScale=function(){return this.scale_},u.prototype.getScaleArray=function(){return this.scaleArray_},u.prototype.getDisplacement=function(){return this.displacement_},u.prototype.getAnchor=function(){return V()},u.prototype.getImage=function(o){return V()},u.prototype.getHitDetectionImage=function(){return V()},u.prototype.getPixelRatio=function(o){return 1},u.prototype.getImageState=function(){return V()},u.prototype.getImageSize=function(){return V()},u.prototype.getOrigin=function(){return V()},u.prototype.getSize=function(){return V()},u.prototype.setDisplacement=function(o){this.displacement_=o},u.prototype.setOpacity=function(o){this.opacity_=o},u.prototype.setRotateWithView=function(o){this.rotateWithView_=o},u.prototype.setRotation=function(o){this.rotation_=o},u.prototype.setScale=function(o){this.scale_=o,this.scaleArray_=Za(o)},u.prototype.listenImageChange=function(o){V()},u.prototype.load=function(){V()},u.prototype.unlistenImageChange=function(o){V()},u}(),Ka=Dc,Fc=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,bc=/^([a-z]*)$|^hsla?\(.*\)$/i;function Ha(u){return typeof u=="string"?u:qa(u)}function Nc(u){var o=document.createElement("div");if(o.style.color=u,o.style.color!==""){document.body.appendChild(o);var n=getComputedStyle(o).color;return document.body.removeChild(o),n}else return""}var Gc=function(){var u=1024,o={},n=0;return function(a){var l;if(o.hasOwnProperty(a))l=o[a];else{if(n>=u){var f=0;for(var _ in o)(f++&3)===0&&(delete o[_],--n)}l=kc(a),o[a]=l,++n}return l}}();function Or(u){return Array.isArray(u)?u:Gc(u)}function kc(u){var o,n,a,l,f;if(bc.exec(u)&&(u=Nc(u)),Fc.exec(u)){var _=u.length-1,p=void 0;_<=4?p=1:p=2;var v=_===4||_===8;o=parseInt(u.substr(1+0*p,p),16),n=parseInt(u.substr(1+1*p,p),16),a=parseInt(u.substr(1+2*p,p),16),v?l=parseInt(u.substr(1+3*p,p),16):l=255,p==1&&(o=(o<<4)+o,n=(n<<4)+n,a=(a<<4)+a,v&&(l=(l<<4)+l)),f=[o,n,a,l/255]}else u.indexOf("rgba(")==0?(f=u.slice(5,-1).split(",").map(Number),$a(f)):u.indexOf("rgb(")==0?(f=u.slice(4,-1).split(",").map(Number),f.push(1),$a(f)):Vt(!1,14);return f}function $a(u){return u[0]=kt(u[0]+.5|0,0,255),u[1]=kt(u[1]+.5|0,0,255),u[2]=kt(u[2]+.5|0,0,255),u[3]=kt(u[3],0,1),u}function qa(u){var o=u[0];o!=(o|0)&&(o=o+.5|0);var n=u[1];n!=(n|0)&&(n=n+.5|0);var a=u[2];a!=(a|0)&&(a=a+.5|0);var l=u[3]===void 0?1:Math.round(u[3]*100)/100;return"rgba("+o+","+n+","+a+","+l+")"}function Me(u){return Array.isArray(u)?qa(u):u}var Qe=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";Qe.indexOf("firefox");var Xc=Qe.indexOf("safari")!==-1&&Qe.indexOf("chrom")==-1;Xc&&(Qe.indexOf("version/15.4")>=0||Qe.match(/cpu (os|iphone os) 15_4 like mac os x/)),Qe.indexOf("webkit")!==-1&&Qe.indexOf("edge")==-1,Qe.indexOf("macintosh");var Lr=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,zc=typeof Image<"u"&&Image.prototype.decode;(function(){var u=!1;try{var o=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("_",null,o),window.removeEventListener("_",null,o)}catch{}return u})();function ke(u,o,n,a){var l;return Lr?l=new OffscreenCanvas(u||300,o||300):l=document.createElement("canvas"),u&&(l.width=u),o&&(l.height=o),l.getContext("2d",a)}var Yc=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Ja=["style","variant","weight","size","lineHeight","family"],Qa=function(u){var o=u.match(Yc);if(!o)return null;for(var n={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},a=0,l=Ja.length;a<l;++a){var f=o[a+1];f!==void 0&&(n[Ja[a]]=f)}return n.families=n.family.split(/,\s?/),n};function Bc(u){return u===1?"":String(Math.round(u*100)/100)}var tl="10px sans-serif",Xe="#000",Mr="round",Si=[],Ai=0,zn="round",Oi=10,Li="#000",Mi="center",Pr="middle",wn=[0,0,0,0],Pi=1,tn=new ut,Uc=new N;Uc.setSize=function(){console.warn("labelCache is deprecated.")};var Yn=null,Qs,to={},Wc=function(){var u=100,o="32px ",n=["monospace","serif"],a=n.length,l="wmytzilWMYTZIL@#/&?$%10",f,_;function p(E,w,I){for(var S=!0,A=0;A<a;++A){var L=n[A];if(_=Dr(E+" "+w+" "+o+L,l),I!=L){var G=Dr(E+" "+w+" "+o+I+","+L,l);S=S&&G!=_}}return!!S}function v(){for(var E=!0,w=tn.getKeys(),I=0,S=w.length;I<S;++I){var A=w[I];tn.get(A)<u&&(p.apply(this,A.split(`
`))?(O(to),Yn=null,Qs=void 0,tn.set(A,u)):(tn.set(A,tn.get(A)+1,!0),E=!1))}E&&(clearInterval(f),f=void 0)}return function(E){var w=Qa(E);if(w)for(var I=w.families,S=0,A=I.length;S<A;++S){var L=I[S],G=w.style+`
`+w.weight+`
`+L;tn.get(G)===void 0&&(tn.set(G,u,!0),p(w.style,w.weight,L)||(tn.set(G,0,!0),f===void 0&&(f=setInterval(v,32))))}}}(),jc=function(){var u;return function(o){var n=to[o];if(n==null){if(Lr){var a=Qa(o),l=el(o,"Žg"),f=isNaN(Number(a.lineHeight))?1.2:Number(a.lineHeight);n=f*(l.actualBoundingBoxAscent+l.actualBoundingBoxDescent)}else u||(u=document.createElement("div"),u.innerHTML="M",u.style.minHeight="0",u.style.maxHeight="none",u.style.height="auto",u.style.padding="0",u.style.border="none",u.style.position="absolute",u.style.display="block",u.style.left="-99999px"),u.style.font=o,document.body.appendChild(u),n=u.offsetHeight,document.body.removeChild(u);to[o]=n}return n}}();function el(u,o){return Yn||(Yn=ke(1,1)),u!=Qs&&(Yn.font=u,Qs=Yn.font),Yn.measureText(o)}function Dr(u,o){return el(u,o).width}function nl(u,o,n){if(o in n)return n[o];var a=Dr(u,o);return n[o]=a,a}function Vc(u,o){for(var n=[],a=[],l=[],f=0,_=0,p=0,v=0,E=0,w=o.length;E<=w;E+=2){var I=o[E];if(I===`
`||E===w){f=Math.max(f,_),l.push(_),_=0,p+=v;continue}var S=o[E+1]||u.font,A=Dr(S,I);n.push(A),_+=A;var L=jc(S);a.push(L),v=Math.max(v,L)}return{width:f,height:p,widths:n,heights:a,lineWidths:l}}function Zc(u,o,n,a,l,f,_,p,v,E,w){u.save(),n!==1&&(u.globalAlpha*=n),o&&u.setTransform.apply(u,o),a.contextInstructions?(u.translate(v,E),u.scale(w[0],w[1]),Kc(a,u)):w[0]<0||w[1]<0?(u.translate(v,E),u.scale(w[0],w[1]),u.drawImage(a,l,f,_,p,0,0,_,p)):u.drawImage(a,l,f,_,p,v,E,_*w[0],p*w[1]),u.restore()}function Kc(u,o){for(var n=u.contextInstructions,a=0,l=n.length;a<l;a+=2)Array.isArray(n[a+1])?o[n[a]].apply(o,n[a+1]):o[n[a]]=n[a+1]}var Hc=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),$c=function(u){Hc(o,u);function o(n){var a=this,l=n.rotateWithView!==void 0?n.rotateWithView:!1;return a=u.call(this,{opacity:1,rotateWithView:l,rotation:n.rotation!==void 0?n.rotation:0,scale:n.scale!==void 0?n.scale:1,displacement:n.displacement!==void 0?n.displacement:[0,0]})||this,a.canvas_=void 0,a.hitDetectionCanvas_=null,a.fill_=n.fill!==void 0?n.fill:null,a.origin_=[0,0],a.points_=n.points,a.radius_=n.radius!==void 0?n.radius:n.radius1,a.radius2_=n.radius2,a.angle_=n.angle!==void 0?n.angle:0,a.stroke_=n.stroke!==void 0?n.stroke:null,a.size_=null,a.renderOptions_=null,a.render(),a}return o.prototype.clone=function(){var n=this.getScale(),a=new o({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(n)?n.slice():n,displacement:this.getDisplacement().slice()});return a.setOpacity(this.getOpacity()),a},o.prototype.getAnchor=function(){var n=this.size_;if(!n)return null;var a=this.getDisplacement();return[n[0]/2-a[0],n[1]/2+a[1]]},o.prototype.getAngle=function(){return this.angle_},o.prototype.getFill=function(){return this.fill_},o.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},o.prototype.getImage=function(n){var a=this.canvas_[n];if(!a){var l=this.renderOptions_,f=ke(l.size*n,l.size*n);this.draw_(l,f,n),a=f.canvas,this.canvas_[n]=a}return a},o.prototype.getPixelRatio=function(n){return n},o.prototype.getImageSize=function(){return this.size_},o.prototype.getImageState=function(){return Pt.LOADED},o.prototype.getOrigin=function(){return this.origin_},o.prototype.getPoints=function(){return this.points_},o.prototype.getRadius=function(){return this.radius_},o.prototype.getRadius2=function(){return this.radius2_},o.prototype.getSize=function(){return this.size_},o.prototype.getStroke=function(){return this.stroke_},o.prototype.listenImageChange=function(n){},o.prototype.load=function(){},o.prototype.unlistenImageChange=function(n){},o.prototype.calculateLineJoinSize_=function(n,a,l){if(a===0||this.points_===1/0||n!=="bevel"&&n!=="miter")return a;var f=this.radius_,_=this.radius2_===void 0?f:this.radius2_;if(f<_){var p=f;f=_,_=p}var v=this.radius2_===void 0?this.points_:this.points_*2,E=2*Math.PI/v,w=_*Math.sin(E),I=Math.sqrt(_*_-w*w),S=f-I,A=Math.sqrt(w*w+S*S),L=A/w;if(n==="miter"&&L<=l)return L*a;var G=a/2/L,k=a/2*(S/A),W=Math.sqrt((f+G)*(f+G)+k*k),Y=W-f;if(this.radius2_===void 0||n==="bevel")return Y*2;var Z=f*Math.sin(E),ot=Math.sqrt(f*f-Z*Z),nt=_-ot,q=Math.sqrt(Z*Z+nt*nt),at=q/Z;if(at<=l){var tt=at*a/2-_-f;return 2*Math.max(Y,tt)}return Y*2},o.prototype.createRenderOptions=function(){var n=zn,a=0,l=null,f=0,_,p=0;this.stroke_&&(_=this.stroke_.getColor(),_===null&&(_=Li),_=Me(_),p=this.stroke_.getWidth(),p===void 0&&(p=Pi),l=this.stroke_.getLineDash(),f=this.stroke_.getLineDashOffset(),n=this.stroke_.getLineJoin(),n===void 0&&(n=zn),a=this.stroke_.getMiterLimit(),a===void 0&&(a=Oi));var v=this.calculateLineJoinSize_(n,p,a),E=Math.max(this.radius_,this.radius2_||0),w=Math.ceil(2*E+v);return{strokeStyle:_,strokeWidth:p,size:w,lineDash:l,lineDashOffset:f,lineJoin:n,miterLimit:a}},o.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var n=this.renderOptions_.size;this.canvas_={},this.size_=[n,n]},o.prototype.draw_=function(n,a,l){if(a.scale(l,l),a.translate(n.size/2,n.size/2),this.createPath_(a),this.fill_){var f=this.fill_.getColor();f===null&&(f=Xe),a.fillStyle=Me(f),a.fill()}this.stroke_&&(a.strokeStyle=n.strokeStyle,a.lineWidth=n.strokeWidth,a.setLineDash&&n.lineDash&&(a.setLineDash(n.lineDash),a.lineDashOffset=n.lineDashOffset),a.lineJoin=n.lineJoin,a.miterLimit=n.miterLimit,a.stroke())},o.prototype.createHitDetectionCanvas_=function(n){if(this.fill_){var a=this.fill_.getColor(),l=0;if(typeof a=="string"&&(a=Or(a)),a===null?l=1:Array.isArray(a)&&(l=a.length===4?a[3]:1),l===0){var f=ke(n.size,n.size);this.hitDetectionCanvas_=f.canvas,this.drawHitDetectionCanvas_(n,f)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},o.prototype.createPath_=function(n){var a=this.points_,l=this.radius_;if(a===1/0)n.arc(0,0,l,0,2*Math.PI);else{var f=this.radius2_===void 0?l:this.radius2_;this.radius2_!==void 0&&(a*=2);for(var _=this.angle_-Math.PI/2,p=2*Math.PI/a,v=0;v<a;v++){var E=_+v*p,w=v%2===0?l:f;n.lineTo(w*Math.cos(E),w*Math.sin(E))}n.closePath()}},o.prototype.drawHitDetectionCanvas_=function(n,a){a.translate(n.size/2,n.size/2),this.createPath_(a),a.fillStyle=Xe,a.fill(),this.stroke_&&(a.strokeStyle=n.strokeStyle,a.lineWidth=n.strokeWidth,n.lineDash&&(a.setLineDash(n.lineDash),a.lineDashOffset=n.lineDashOffset),a.lineJoin=n.lineJoin,a.miterLimit=n.miterLimit,a.stroke())},o}(Ka),qc=$c,Jc=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Qc=function(u){Jc(o,u);function o(n){var a=n||{};return u.call(this,{points:1/0,fill:a.fill,radius:a.radius,stroke:a.stroke,scale:a.scale!==void 0?a.scale:1,rotation:a.rotation!==void 0?a.rotation:0,rotateWithView:a.rotateWithView!==void 0?a.rotateWithView:!1,displacement:a.displacement!==void 0?a.displacement:[0,0]})||this}return o.prototype.clone=function(){var n=this.getScale(),a=new o({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(n)?n.slice():n,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return a.setOpacity(this.getOpacity()),a},o.prototype.setRadius=function(n){this.radius_=n,this.render()},o}(qc),tf=Qc,ef=function(){function u(o){var n=o||{};this.color_=n.color!==void 0?n.color:null}return u.prototype.clone=function(){var o=this.getColor();return new u({color:Array.isArray(o)?o.slice():o||void 0})},u.prototype.getColor=function(){return this.color_},u.prototype.setColor=function(o){this.color_=o},u}(),nf=ef,pt={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},rf=function(){function u(o){var n=o||{};this.color_=n.color!==void 0?n.color:null,this.lineCap_=n.lineCap,this.lineDash_=n.lineDash!==void 0?n.lineDash:null,this.lineDashOffset_=n.lineDashOffset,this.lineJoin_=n.lineJoin,this.miterLimit_=n.miterLimit,this.width_=n.width}return u.prototype.clone=function(){var o=this.getColor();return new u({color:Array.isArray(o)?o.slice():o||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},u.prototype.getColor=function(){return this.color_},u.prototype.getLineCap=function(){return this.lineCap_},u.prototype.getLineDash=function(){return this.lineDash_},u.prototype.getLineDashOffset=function(){return this.lineDashOffset_},u.prototype.getLineJoin=function(){return this.lineJoin_},u.prototype.getMiterLimit=function(){return this.miterLimit_},u.prototype.getWidth=function(){return this.width_},u.prototype.setColor=function(o){this.color_=o},u.prototype.setLineCap=function(o){this.lineCap_=o},u.prototype.setLineDash=function(o){this.lineDash_=o},u.prototype.setLineDashOffset=function(o){this.lineDashOffset_=o},u.prototype.setLineJoin=function(o){this.lineJoin_=o},u.prototype.setMiterLimit=function(o){this.miterLimit_=o},u.prototype.setWidth=function(o){this.width_=o},u}(),sf=rf,of=function(){function u(o){var n=o||{};this.geometry_=null,this.geometryFunction_=il,n.geometry!==void 0&&this.setGeometry(n.geometry),this.fill_=n.fill!==void 0?n.fill:null,this.image_=n.image!==void 0?n.image:null,this.renderer_=n.renderer!==void 0?n.renderer:null,this.hitDetectionRenderer_=n.hitDetectionRenderer!==void 0?n.hitDetectionRenderer:null,this.stroke_=n.stroke!==void 0?n.stroke:null,this.text_=n.text!==void 0?n.text:null,this.zIndex_=n.zIndex}return u.prototype.clone=function(){var o=this.getGeometry();return o&&typeof o=="object"&&(o=o.clone()),new u({geometry:o,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},u.prototype.getRenderer=function(){return this.renderer_},u.prototype.setRenderer=function(o){this.renderer_=o},u.prototype.setHitDetectionRenderer=function(o){this.hitDetectionRenderer_=o},u.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},u.prototype.getGeometry=function(){return this.geometry_},u.prototype.getGeometryFunction=function(){return this.geometryFunction_},u.prototype.getFill=function(){return this.fill_},u.prototype.setFill=function(o){this.fill_=o},u.prototype.getImage=function(){return this.image_},u.prototype.setImage=function(o){this.image_=o},u.prototype.getStroke=function(){return this.stroke_},u.prototype.setStroke=function(o){this.stroke_=o},u.prototype.getText=function(){return this.text_},u.prototype.setText=function(o){this.text_=o},u.prototype.getZIndex=function(){return this.zIndex_},u.prototype.setGeometry=function(o){typeof o=="function"?this.geometryFunction_=o:typeof o=="string"?this.geometryFunction_=function(n){return n.get(o)}:o?o!==void 0&&(this.geometryFunction_=function(){return o}):this.geometryFunction_=il,this.geometry_=o},u.prototype.setZIndex=function(o){this.zIndex_=o},u}();function af(u){var o;if(typeof u=="function")o=u;else{var n;if(Array.isArray(u))n=u;else{Vt(typeof u.getZIndex=="function",41);var a=u;n=[a]}o=function(){return n}}return o}var eo=null;function lf(u,o){if(!eo){var n=new nf({color:"rgba(255,255,255,0.4)"}),a=new sf({color:"#3399CC",width:1.25});eo=[new of({image:new tf({fill:n,stroke:a,radius:5}),fill:n,stroke:a})]}return eo}function il(u){return u.getGeometry()}var hf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),rl={RENDER_ORDER:"renderOrder"},uf=function(u){hf(o,u);function o(n){var a=this,l=n||{},f=T({},l);return delete f.style,delete f.renderBuffer,delete f.updateWhileAnimating,delete f.updateWhileInteracting,a=u.call(this,f)||this,a.declutter_=l.declutter!==void 0?l.declutter:!1,a.renderBuffer_=l.renderBuffer!==void 0?l.renderBuffer:100,a.style_=null,a.styleFunction_=void 0,a.setStyle(l.style),a.updateWhileAnimating_=l.updateWhileAnimating!==void 0?l.updateWhileAnimating:!1,a.updateWhileInteracting_=l.updateWhileInteracting!==void 0?l.updateWhileInteracting:!1,a}return o.prototype.getDeclutter=function(){return this.declutter_},o.prototype.getFeatures=function(n){return u.prototype.getFeatures.call(this,n)},o.prototype.getRenderBuffer=function(){return this.renderBuffer_},o.prototype.getRenderOrder=function(){return this.get(rl.RENDER_ORDER)},o.prototype.getStyle=function(){return this.style_},o.prototype.getStyleFunction=function(){return this.styleFunction_},o.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},o.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},o.prototype.renderDeclutter=function(n){n.declutterTree||(n.declutterTree=new ja(9)),this.getRenderer().renderDeclutter(n)},o.prototype.setRenderOrder=function(n){this.set(rl.RENDER_ORDER,n)},o.prototype.setStyle=function(n){this.style_=n!==void 0?n:lf,this.styleFunction_=n===null?void 0:af(this.style_),this.changed()},o}(Gn),cf=uf,Di={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Fr=[Di.FILL],en=[Di.STROKE],Tn=[Di.BEGIN_PATH],sl=[Di.CLOSE_PATH],rt=Di,nn={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},ff=function(){function u(){}return u.prototype.drawCustom=function(o,n,a,l){},u.prototype.drawGeometry=function(o){},u.prototype.setStyle=function(o){},u.prototype.drawCircle=function(o,n){},u.prototype.drawFeature=function(o,n){},u.prototype.drawGeometryCollection=function(o,n){},u.prototype.drawLineString=function(o,n){},u.prototype.drawMultiLineString=function(o,n){},u.prototype.drawMultiPoint=function(o,n){},u.prototype.drawMultiPolygon=function(o,n){},u.prototype.drawPoint=function(o,n){},u.prototype.drawPolygon=function(o,n){},u.prototype.drawText=function(o,n){},u.prototype.setFillStrokeStyle=function(o,n){},u.prototype.setImageStyle=function(o,n){},u.prototype.setTextStyle=function(o,n){},u}(),ol=ff;function no(u,o,n){return n?(n[0]=u[0]-o,n[1]=u[1]-o,n[2]=u[2]+o,n[3]=u[3]+o,n):[u[0]-o,u[1]-o,u[2]+o,u[3]+o]}function df(u,o){return u.slice()}function gf(u,o,n){var a,l;return o<u[0]?a=u[0]-o:u[2]<o?a=o-u[2]:a=0,n<u[1]?l=u[1]-n:u[3]<n?l=n-u[3]:l=0,a*a+l*l}function al(u,o){return io(u,o[0],o[1])}function Fi(u,o){return u[0]<=o[0]&&o[2]<=u[2]&&u[1]<=o[1]&&o[3]<=u[3]}function io(u,o,n){return u[0]<=o&&o<=u[2]&&u[1]<=n&&n<=u[3]}function _f(u,o){var n=u[0],a=u[1],l=u[2],f=u[3],_=o[0],p=o[1],v=nn.UNKNOWN;return _<n?v=v|nn.LEFT:_>l&&(v=v|nn.RIGHT),p<a?v=v|nn.BELOW:p>f&&(v=v|nn.ABOVE),v===nn.UNKNOWN&&(v=nn.INTERSECTING),v}function bi(){return[1/0,1/0,-1/0,-1/0]}function Ni(u,o,n,a,l){return l?(l[0]=u,l[1]=o,l[2]=n,l[3]=a,l):[u,o,n,a]}function ll(u){return Ni(1/0,1/0,-1/0,-1/0,u)}function pf(u,o){var n=u[0],a=u[1];return Ni(n,a,n,a,o)}function mf(u,o,n,a,l){var f=ll(l);return yf(f,u,o,n,a)}function hl(u,o){return u[0]==o[0]&&u[2]==o[2]&&u[1]==o[1]&&u[3]==o[3]}function vf(u,o){o[0]<u[0]&&(u[0]=o[0]),o[0]>u[2]&&(u[2]=o[0]),o[1]<u[1]&&(u[1]=o[1]),o[1]>u[3]&&(u[3]=o[1])}function yf(u,o,n,a,l){for(;n<a;n+=l)Ef(u,o[n],o[n+1]);return u}function Ef(u,o,n){u[0]=Math.min(u[0],o),u[1]=Math.min(u[1],n),u[2]=Math.max(u[2],o),u[3]=Math.max(u[3],n)}function xf(u){return[u[0],u[1]]}function Rf(u){return[u[2],u[1]]}function ro(u){return[(u[0]+u[2])/2,(u[1]+u[3])/2]}function br(u){return u[3]-u[1]}function wf(u){return[u[0],u[3]]}function Tf(u){return[u[2],u[3]]}function In(u){return u[2]-u[0]}function Pe(u,o){return u[0]<=o[2]&&u[2]>=o[0]&&u[1]<=o[3]&&u[3]>=o[1]}function If(u,o){return o?(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o):u}function Cf(u,o){var n=o.getExtent(),a=ro(u);if(o.canWrapX()&&(a[0]<n[0]||a[0]>=n[2])){var l=In(n),f=Math.floor((a[0]-n[0])/l),_=f*l;u[0]-=_,u[2]-=_}return u}function Bn(u,o,n,a,l){for(var f=l!==void 0?l:[],_=0,p=o;p<n;p+=a)f[_++]=u.slice(p,p+a);return f.length=_,f}function so(u,o,n,a,l){for(var f=l!==void 0?l:[],_=0,p=0,v=n.length;p<v;++p){var E=n[p];f[_++]=Bn(u,o,E,a,f[_]),o=E}return f.length=_,f}function ul(u,o,n,a,l){for(var f=l!==void 0?l:[],_=0,p=0,v=n.length;p<v;++p){var E=n[p];f[_++]=so(u,o,E,a,f[_]),o=E[E.length-1]}return f.length=_,f}var Sf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Af=function(u){Sf(o,u);function o(n,a,l,f){var _=u.call(this)||this;return _.tolerance=n,_.maxExtent=a,_.pixelRatio=f,_.maxLineWidth=0,_.resolution=l,_.beginGeometryInstruction1_=null,_.beginGeometryInstruction2_=null,_.bufferedMaxExtent_=null,_.instructions=[],_.coordinates=[],_.tmpCoordinate_=[],_.hitDetectionInstructions=[],_.state={},_}return o.prototype.applyPixelRatio=function(n){var a=this.pixelRatio;return a==1?n:n.map(function(l){return l*a})},o.prototype.appendFlatPointCoordinates=function(n,a){for(var l=this.getBufferedMaxExtent(),f=this.tmpCoordinate_,_=this.coordinates,p=_.length,v=0,E=n.length;v<E;v+=a)f[0]=n[v],f[1]=n[v+1],al(l,f)&&(_[p++]=f[0],_[p++]=f[1]);return p},o.prototype.appendFlatLineCoordinates=function(n,a,l,f,_,p){var v=this.coordinates,E=v.length,w=this.getBufferedMaxExtent();p&&(a+=f);var I=n[a],S=n[a+1],A=this.tmpCoordinate_,L=!0,G,k,W;for(G=a+f;G<l;G+=f)A[0]=n[G],A[1]=n[G+1],W=_f(w,A),W!==k?(L&&(v[E++]=I,v[E++]=S,L=!1),v[E++]=A[0],v[E++]=A[1]):W===nn.INTERSECTING?(v[E++]=A[0],v[E++]=A[1],L=!1):L=!0,I=A[0],S=A[1],k=W;return(_&&L||G===a+f)&&(v[E++]=I,v[E++]=S),E},o.prototype.drawCustomCoordinates_=function(n,a,l,f,_){for(var p=0,v=l.length;p<v;++p){var E=l[p],w=this.appendFlatLineCoordinates(n,a,E,f,!1,!1);_.push(w),a=E}return a},o.prototype.drawCustom=function(n,a,l,f){this.beginGeometry(n,a);var _=n.getType(),p=n.getStride(),v=this.coordinates.length,E,w,I,S,A;switch(_){case pt.MULTI_POLYGON:E=n.getOrientedFlatCoordinates(),S=[];var L=n.getEndss();A=0;for(var G=0,k=L.length;G<k;++G){var W=[];A=this.drawCustomCoordinates_(E,A,L[G],p,W),S.push(W)}this.instructions.push([rt.CUSTOM,v,S,n,l,ul]),this.hitDetectionInstructions.push([rt.CUSTOM,v,S,n,f||l,ul]);break;case pt.POLYGON:case pt.MULTI_LINE_STRING:I=[],E=_==pt.POLYGON?n.getOrientedFlatCoordinates():n.getFlatCoordinates(),A=this.drawCustomCoordinates_(E,0,n.getEnds(),p,I),this.instructions.push([rt.CUSTOM,v,I,n,l,so]),this.hitDetectionInstructions.push([rt.CUSTOM,v,I,n,f||l,so]);break;case pt.LINE_STRING:case pt.CIRCLE:E=n.getFlatCoordinates(),w=this.appendFlatLineCoordinates(E,0,E.length,p,!1,!1),this.instructions.push([rt.CUSTOM,v,w,n,l,Bn]),this.hitDetectionInstructions.push([rt.CUSTOM,v,w,n,f||l,Bn]);break;case pt.MULTI_POINT:E=n.getFlatCoordinates(),w=this.appendFlatPointCoordinates(E,p),w>v&&(this.instructions.push([rt.CUSTOM,v,w,n,l,Bn]),this.hitDetectionInstructions.push([rt.CUSTOM,v,w,n,f||l,Bn]));break;case pt.POINT:E=n.getFlatCoordinates(),this.coordinates.push(E[0],E[1]),w=this.coordinates.length,this.instructions.push([rt.CUSTOM,v,w,n,l]),this.hitDetectionInstructions.push([rt.CUSTOM,v,w,n,f||l]);break}this.endGeometry(a)},o.prototype.beginGeometry=function(n,a){this.beginGeometryInstruction1_=[rt.BEGIN_GEOMETRY,a,0,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[rt.BEGIN_GEOMETRY,a,0,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},o.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},o.prototype.reverseHitDetectionInstructions=function(){var n=this.hitDetectionInstructions;n.reverse();var a,l=n.length,f,_,p=-1;for(a=0;a<l;++a)f=n[a],_=f[0],_==rt.END_GEOMETRY?p=a:_==rt.BEGIN_GEOMETRY&&(f[2]=a,g(this.hitDetectionInstructions,p,a),p=-1)},o.prototype.setFillStrokeStyle=function(n,a){var l=this.state;if(n){var f=n.getColor();l.fillStyle=Me(f||Xe)}else l.fillStyle=void 0;if(a){var _=a.getColor();l.strokeStyle=Me(_||Li);var p=a.getLineCap();l.lineCap=p!==void 0?p:Mr;var v=a.getLineDash();l.lineDash=v?v.slice():Si;var E=a.getLineDashOffset();l.lineDashOffset=E||Ai;var w=a.getLineJoin();l.lineJoin=w!==void 0?w:zn;var I=a.getWidth();l.lineWidth=I!==void 0?I:Pi;var S=a.getMiterLimit();l.miterLimit=S!==void 0?S:Oi,l.lineWidth>this.maxLineWidth&&(this.maxLineWidth=l.lineWidth,this.bufferedMaxExtent_=null)}else l.strokeStyle=void 0,l.lineCap=void 0,l.lineDash=null,l.lineDashOffset=void 0,l.lineJoin=void 0,l.lineWidth=void 0,l.miterLimit=void 0},o.prototype.createFill=function(n){var a=n.fillStyle,l=[rt.SET_FILL_STYLE,a];return typeof a!="string"&&l.push(!0),l},o.prototype.applyStroke=function(n){this.instructions.push(this.createStroke(n))},o.prototype.createStroke=function(n){return[rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth*this.pixelRatio,n.lineCap,n.lineJoin,n.miterLimit,this.applyPixelRatio(n.lineDash),n.lineDashOffset*this.pixelRatio]},o.prototype.updateFillStyle=function(n,a){var l=n.fillStyle;(typeof l!="string"||n.currentFillStyle!=l)&&(l!==void 0&&this.instructions.push(a.call(this,n)),n.currentFillStyle=l)},o.prototype.updateStrokeStyle=function(n,a){var l=n.strokeStyle,f=n.lineCap,_=n.lineDash,p=n.lineDashOffset,v=n.lineJoin,E=n.lineWidth,w=n.miterLimit;(n.currentStrokeStyle!=l||n.currentLineCap!=f||_!=n.currentLineDash&&!y(n.currentLineDash,_)||n.currentLineDashOffset!=p||n.currentLineJoin!=v||n.currentLineWidth!=E||n.currentMiterLimit!=w)&&(l!==void 0&&a.call(this,n),n.currentStrokeStyle=l,n.currentLineCap=f,n.currentLineDash=_,n.currentLineDashOffset=p,n.currentLineJoin=v,n.currentLineWidth=E,n.currentMiterLimit=w)},o.prototype.endGeometry=function(n){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var a=[rt.END_GEOMETRY,n];this.instructions.push(a),this.hitDetectionInstructions.push(a)},o.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=df(this.maxExtent),this.maxLineWidth>0)){var n=this.resolution*(this.maxLineWidth+1)/2;no(this.bufferedMaxExtent_,n,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},o}(ol),Gi=Af,Of=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Lf=function(u){Of(o,u);function o(n,a,l,f){var _=u.call(this,n,a,l,f)||this;return _.hitDetectionImage_=null,_.image_=null,_.imagePixelRatio_=void 0,_.anchorX_=void 0,_.anchorY_=void 0,_.height_=void 0,_.opacity_=void 0,_.originX_=void 0,_.originY_=void 0,_.rotateWithView_=void 0,_.rotation_=void 0,_.scale_=void 0,_.width_=void 0,_.declutterImageWithText_=void 0,_}return o.prototype.drawPoint=function(n,a){if(this.image_){this.beginGeometry(n,a);var l=n.getFlatCoordinates(),f=n.getStride(),_=this.coordinates.length,p=this.appendFlatPointCoordinates(l,f);this.instructions.push([rt.DRAW_IMAGE,_,p,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,_,p,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(a)}},o.prototype.drawMultiPoint=function(n,a){if(this.image_){this.beginGeometry(n,a);var l=n.getFlatCoordinates(),f=n.getStride(),_=this.coordinates.length,p=this.appendFlatPointCoordinates(l,f);this.instructions.push([rt.DRAW_IMAGE,_,p,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,_,p,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(a)}},o.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,u.prototype.finish.call(this)},o.prototype.setImageStyle=function(n,a){var l=n.getAnchor(),f=n.getSize(),_=n.getHitDetectionImage(),p=n.getImage(this.pixelRatio),v=n.getOrigin();this.imagePixelRatio_=n.getPixelRatio(this.pixelRatio),this.anchorX_=l[0],this.anchorY_=l[1],this.hitDetectionImage_=_,this.image_=p,this.height_=f[1],this.opacity_=n.getOpacity(),this.originX_=v[0]*this.imagePixelRatio_,this.originY_=v[1]*this.imagePixelRatio_,this.rotateWithView_=n.getRotateWithView(),this.rotation_=n.getRotation(),this.scale_=n.getScaleArray(),this.width_=f[0],this.declutterImageWithText_=a},o}(Gi),Mf=Lf,Pf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Df=function(u){Pf(o,u);function o(n,a,l,f){return u.call(this,n,a,l,f)||this}return o.prototype.drawFlatCoordinates_=function(n,a,l,f){var _=this.coordinates.length,p=this.appendFlatLineCoordinates(n,a,l,f,!1,!1),v=[rt.MOVE_TO_LINE_TO,_,p];return this.instructions.push(v),this.hitDetectionInstructions.push(v),l},o.prototype.drawLineString=function(n,a){var l=this.state,f=l.strokeStyle,_=l.lineWidth;if(!(f===void 0||_===void 0)){this.updateStrokeStyle(l,this.applyStroke),this.beginGeometry(n,a),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,Si,Ai],Tn);var p=n.getFlatCoordinates(),v=n.getStride();this.drawFlatCoordinates_(p,0,p.length,v),this.hitDetectionInstructions.push(en),this.endGeometry(a)}},o.prototype.drawMultiLineString=function(n,a){var l=this.state,f=l.strokeStyle,_=l.lineWidth;if(!(f===void 0||_===void 0)){this.updateStrokeStyle(l,this.applyStroke),this.beginGeometry(n,a),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset],Tn);for(var p=n.getEnds(),v=n.getFlatCoordinates(),E=n.getStride(),w=0,I=0,S=p.length;I<S;++I)w=this.drawFlatCoordinates_(v,w,p[I],E);this.hitDetectionInstructions.push(en),this.endGeometry(a)}},o.prototype.finish=function(){var n=this.state;return n.lastStroke!=null&&n.lastStroke!=this.coordinates.length&&this.instructions.push(en),this.reverseHitDetectionInstructions(),this.state=null,u.prototype.finish.call(this)},o.prototype.applyStroke=function(n){n.lastStroke!=null&&n.lastStroke!=this.coordinates.length&&(this.instructions.push(en),n.lastStroke=this.coordinates.length),n.lastStroke=0,u.prototype.applyStroke.call(this,n),this.instructions.push(Tn)},o}(Gi),Ff=Df;function bf(u,o){return o*Math.round(u/o)}var Nf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Gf=function(u){Nf(o,u);function o(n,a,l,f){return u.call(this,n,a,l,f)||this}return o.prototype.drawFlatCoordinatess_=function(n,a,l,f){var _=this.state,p=_.fillStyle!==void 0,v=_.strokeStyle!==void 0,E=l.length;this.instructions.push(Tn),this.hitDetectionInstructions.push(Tn);for(var w=0;w<E;++w){var I=l[w],S=this.coordinates.length,A=this.appendFlatLineCoordinates(n,a,I,f,!0,!v),L=[rt.MOVE_TO_LINE_TO,S,A];this.instructions.push(L),this.hitDetectionInstructions.push(L),v&&(this.instructions.push(sl),this.hitDetectionInstructions.push(sl)),a=I}return p&&(this.instructions.push(Fr),this.hitDetectionInstructions.push(Fr)),v&&(this.instructions.push(en),this.hitDetectionInstructions.push(en)),a},o.prototype.drawCircle=function(n,a){var l=this.state,f=l.fillStyle,_=l.strokeStyle;if(!(f===void 0&&_===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(n,a),l.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Xe]),l.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset]);var p=n.getFlatCoordinates(),v=n.getStride(),E=this.coordinates.length;this.appendFlatLineCoordinates(p,0,p.length,v,!1,!1);var w=[rt.CIRCLE,E];this.instructions.push(Tn,w),this.hitDetectionInstructions.push(Tn,w),l.fillStyle!==void 0&&(this.instructions.push(Fr),this.hitDetectionInstructions.push(Fr)),l.strokeStyle!==void 0&&(this.instructions.push(en),this.hitDetectionInstructions.push(en)),this.endGeometry(a)}},o.prototype.drawPolygon=function(n,a){var l=this.state,f=l.fillStyle,_=l.strokeStyle;if(!(f===void 0&&_===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(n,a),l.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Xe]),l.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset]);var p=n.getEnds(),v=n.getOrientedFlatCoordinates(),E=n.getStride();this.drawFlatCoordinatess_(v,0,p,E),this.endGeometry(a)}},o.prototype.drawMultiPolygon=function(n,a){var l=this.state,f=l.fillStyle,_=l.strokeStyle;if(!(f===void 0&&_===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(n,a),l.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Xe]),l.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,l.strokeStyle,l.lineWidth,l.lineCap,l.lineJoin,l.miterLimit,l.lineDash,l.lineDashOffset]);for(var p=n.getEndss(),v=n.getOrientedFlatCoordinates(),E=n.getStride(),w=0,I=0,S=p.length;I<S;++I)w=this.drawFlatCoordinatess_(v,w,p[I],E);this.endGeometry(a)}},o.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var n=this.tolerance;if(n!==0)for(var a=this.coordinates,l=0,f=a.length;l<f;++l)a[l]=bf(a[l],n);return u.prototype.finish.call(this)},o.prototype.setFillStrokeStyles_=function(){var n=this.state,a=n.fillStyle;a!==void 0&&this.updateFillStyle(n,this.createFill),n.strokeStyle!==void 0&&this.updateStrokeStyle(n,this.applyStroke)},o}(Gi),cl=Gf,kf={LINE:"line"};function Xf(u,o,n,a,l){var f=n,_=n,p=0,v=0,E=n,w,I,S,A,L,G,k,W,Y,Z;for(I=n;I<a;I+=l){var ot=o[I],nt=o[I+1];L!==void 0&&(Y=ot-L,Z=nt-G,A=Math.sqrt(Y*Y+Z*Z),k!==void 0&&(v+=S,w=Math.acos((k*Y+W*Z)/(S*A)),w>u&&(v>p&&(p=v,f=E,_=I),v=0,E=I-l)),S=A,k=Y,W=Z),L=ot,G=nt}return v+=A,v>p?[E,I]:[f,_]}var zf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Nr={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Yf=function(u){zf(o,u);function o(n,a,l,f){var _=u.call(this,n,a,l,f)||this;return _.labels_=null,_.text_="",_.textOffsetX_=0,_.textOffsetY_=0,_.textRotateWithView_=void 0,_.textRotation_=0,_.textFillState_=null,_.fillStates={},_.textStrokeState_=null,_.strokeStates={},_.textState_={},_.textStates={},_.textKey_="",_.fillKey_="",_.strokeKey_="",_.declutterImageWithText_=void 0,_}return o.prototype.finish=function(){var n=u.prototype.finish.call(this);return n.textStates=this.textStates,n.fillStates=this.fillStates,n.strokeStates=this.strokeStates,n},o.prototype.drawText=function(n,a){var l=this.textFillState_,f=this.textStrokeState_,_=this.textState_;if(!(this.text_===""||!_||!l&&!f)){var p=this.coordinates,v=p.length,E=n.getType(),w=null,I=n.getStride();if(_.placement===kf.LINE&&(E==pt.LINE_STRING||E==pt.MULTI_LINE_STRING||E==pt.POLYGON||E==pt.MULTI_POLYGON)){if(!Pe(this.getBufferedMaxExtent(),n.getExtent()))return;var S=void 0;if(w=n.getFlatCoordinates(),E==pt.LINE_STRING)S=[w.length];else if(E==pt.MULTI_LINE_STRING)S=n.getEnds();else if(E==pt.POLYGON)S=n.getEnds().slice(0,1);else if(E==pt.MULTI_POLYGON){var A=n.getEndss();S=[];for(var L=0,G=A.length;L<G;++L)S.push(A[L][0])}this.beginGeometry(n,a);for(var k=_.textAlign,W=0,Y=void 0,Z=0,ot=S.length;Z<ot;++Z){if(k==null){var nt=Xf(_.maxAngle,w,W,S[Z],I);W=nt[0],Y=nt[1]}else Y=S[Z];for(var L=W;L<Y;L+=I)p.push(w[L],w[L+1]);var q=p.length;W=S[Z],this.drawChars_(v,q),v=q}this.endGeometry(a)}else{var at=_.overflow?null:[];switch(E){case pt.POINT:case pt.MULTI_POINT:w=n.getFlatCoordinates();break;case pt.LINE_STRING:w=n.getFlatMidpoint();break;case pt.CIRCLE:w=n.getCenter();break;case pt.MULTI_LINE_STRING:w=n.getFlatMidpoints(),I=2;break;case pt.POLYGON:w=n.getFlatInteriorPoint(),_.overflow||at.push(w[2]/this.resolution),I=3;break;case pt.MULTI_POLYGON:var tt=n.getFlatInteriorPoints();w=[];for(var L=0,G=tt.length;L<G;L+=3)_.overflow||at.push(tt[L+2]/this.resolution),w.push(tt[L],tt[L+1]);if(w.length===0)return;I=2;break}var q=this.appendFlatPointCoordinates(w,I);if(q===v)return;if(at&&(q-v)/2!==w.length/I){var ft=v/2;at=at.filter(function(zt,Lt){var Ft=p[(ft+Lt)*2]===w[Lt*I]&&p[(ft+Lt)*2+1]===w[Lt*I+1];return Ft||--ft,Ft})}this.saveTextStates_(),(_.backgroundFill||_.backgroundStroke)&&(this.setFillStrokeStyle(_.backgroundFill,_.backgroundStroke),_.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),_.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(n,a);var At=_.padding;if(At!=wn&&(_.scale[0]<0||_.scale[1]<0)){var Dt=_.padding[0],mt=_.padding[1],xt=_.padding[2],bt=_.padding[3];_.scale[0]<0&&(mt=-mt,bt=-bt),_.scale[1]<0&&(Dt=-Dt,xt=-xt),At=[Dt,mt,xt,bt]}var Zt=this.pixelRatio;this.instructions.push([rt.DRAW_IMAGE,v,q,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,At==wn?wn:At.map(function(zt){return zt*Zt}),!!_.backgroundFill,!!_.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,at]);var Bt=1/Zt;this.hitDetectionInstructions.push([rt.DRAW_IMAGE,v,q,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[Bt,Bt],NaN,this.declutterImageWithText_,At,!!_.backgroundFill,!!_.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,at]),this.endGeometry(a)}}},o.prototype.saveTextStates_=function(){var n=this.textStrokeState_,a=this.textState_,l=this.textFillState_,f=this.strokeKey_;n&&(f in this.strokeStates||(this.strokeStates[f]={strokeStyle:n.strokeStyle,lineCap:n.lineCap,lineDashOffset:n.lineDashOffset,lineWidth:n.lineWidth,lineJoin:n.lineJoin,miterLimit:n.miterLimit,lineDash:n.lineDash}));var _=this.textKey_;_ in this.textStates||(this.textStates[_]={font:a.font,textAlign:a.textAlign||Mi,textBaseline:a.textBaseline||Pr,scale:a.scale});var p=this.fillKey_;l&&(p in this.fillStates||(this.fillStates[p]={fillStyle:l.fillStyle}))},o.prototype.drawChars_=function(n,a){var l=this.textStrokeState_,f=this.textState_,_=this.strokeKey_,p=this.textKey_,v=this.fillKey_;this.saveTextStates_();var E=this.pixelRatio,w=Nr[f.textBaseline],I=this.textOffsetY_*E,S=this.text_,A=l?l.lineWidth*Math.abs(f.scale[0])/2:0;this.instructions.push([rt.DRAW_CHARS,n,a,w,f.overflow,v,f.maxAngle,E,I,_,A*E,S,p,1]),this.hitDetectionInstructions.push([rt.DRAW_CHARS,n,a,w,f.overflow,v,f.maxAngle,1,I,_,A,S,p,1/E])},o.prototype.setTextStyle=function(n,a){var l,f,_;if(!n)this.text_="";else{var p=n.getFill();p?(f=this.textFillState_,f||(f={},this.textFillState_=f),f.fillStyle=Me(p.getColor()||Xe)):(f=null,this.textFillState_=f);var v=n.getStroke();if(!v)_=null,this.textStrokeState_=_;else{_=this.textStrokeState_,_||(_={},this.textStrokeState_=_);var E=v.getLineDash(),w=v.getLineDashOffset(),I=v.getWidth(),S=v.getMiterLimit();_.lineCap=v.getLineCap()||Mr,_.lineDash=E?E.slice():Si,_.lineDashOffset=w===void 0?Ai:w,_.lineJoin=v.getLineJoin()||zn,_.lineWidth=I===void 0?Pi:I,_.miterLimit=S===void 0?Oi:S,_.strokeStyle=Me(v.getColor()||Li)}l=this.textState_;var A=n.getFont()||tl;Wc(A);var L=n.getScaleArray();l.overflow=n.getOverflow(),l.font=A,l.maxAngle=n.getMaxAngle(),l.placement=n.getPlacement(),l.textAlign=n.getTextAlign(),l.textBaseline=n.getTextBaseline()||Pr,l.backgroundFill=n.getBackgroundFill(),l.backgroundStroke=n.getBackgroundStroke(),l.padding=n.getPadding()||wn,l.scale=L===void 0?[1,1]:L;var G=n.getOffsetX(),k=n.getOffsetY(),W=n.getRotateWithView(),Y=n.getRotation();this.text_=n.getText()||"",this.textOffsetX_=G===void 0?0:G,this.textOffsetY_=k===void 0?0:k,this.textRotateWithView_=W===void 0?!1:W,this.textRotation_=Y===void 0?0:Y,this.strokeKey_=_?(typeof _.strokeStyle=="string"?_.strokeStyle:Q(_.strokeStyle))+_.lineCap+_.lineDashOffset+"|"+_.lineWidth+_.lineJoin+_.miterLimit+"["+_.lineDash.join()+"]":"",this.textKey_=l.font+l.scale+(l.textAlign||"?")+(l.textBaseline||"?"),this.fillKey_=f?typeof f.fillStyle=="string"?f.fillStyle:"|"+Q(f.fillStyle):""}this.declutterImageWithText_=a},o}(Gi),Bf=Yf,Uf={Circle:cl,Default:Gi,Image:Mf,LineString:Ff,Polygon:cl,Text:Bf},Wf=function(){function u(o,n,a,l){this.tolerance_=o,this.maxExtent_=n,this.pixelRatio_=l,this.resolution_=a,this.buildersByZIndex_={}}return u.prototype.finish=function(){var o={};for(var n in this.buildersByZIndex_){o[n]=o[n]||{};var a=this.buildersByZIndex_[n];for(var l in a){var f=a[l].finish();o[n][l]=f}}return o},u.prototype.getBuilder=function(o,n){var a=o!==void 0?o.toString():"0",l=this.buildersByZIndex_[a];l===void 0&&(l={},this.buildersByZIndex_[a]=l);var f=l[n];if(f===void 0){var _=Uf[n];f=new _(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),l[n]=f}return f},u}(),fl=Wf,jf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Vf=function(u){jf(o,u);function o(n){var a=u.call(this)||this;return a.ready=!0,a.boundHandleImageChange_=a.handleImageChange_.bind(a),a.layer_=n,a.declutterExecutorGroup=null,a}return o.prototype.getFeatures=function(n){return V()},o.prototype.getData=function(n){return null},o.prototype.prepareFrame=function(n){return V()},o.prototype.renderFrame=function(n,a){return V()},o.prototype.loadedTileCallback=function(n,a,l){n[a]||(n[a]={}),n[a][l.tileCoord.toString()]=l},o.prototype.createLoadedTileFinder=function(n,a,l){return(function(f,_){var p=this.loadedTileCallback.bind(this,l,f);return n.forEachLoadedTile(a,f,_,p)}).bind(this)},o.prototype.forEachFeatureAtCoordinate=function(n,a,l,f,_){},o.prototype.getDataAtPixel=function(n,a,l){return null},o.prototype.getLayer=function(){return this.layer_},o.prototype.handleFontsChanged=function(){},o.prototype.handleImageChange_=function(n){var a=n.target;a.getState()===Pt.LOADED&&this.renderIfReadyAndVisible()},o.prototype.loadImage=function(n){var a=n.getState();return a!=Pt.LOADED&&a!=Pt.ERROR&&n.addEventListener(P.CHANGE,this.boundHandleImageChange_),a==Pt.IDLE&&(n.load(),a=n.getState()),a==Pt.LOADED},o.prototype.renderIfReadyAndVisible=function(){var n=this.getLayer();n.getVisible()&&n.getSourceState()==Ge.READY&&n.changed()},o.prototype.disposeInternal=function(){delete this.layer_,u.prototype.disposeInternal.call(this)},o}(it),Zf=Vf,Kf=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Hf=function(u){Kf(o,u);function o(n,a,l,f){var _=u.call(this,n)||this;return _.inversePixelTransform=a,_.frameState=l,_.context=f,_}return o}(r),$f=Hf;new Array(6);function rn(){return[1,0,0,1,0,0]}function qf(u,o,n,a,l,f,_){return u[0]=o,u[1]=n,u[2]=a,u[3]=l,u[4]=f,u[5]=_,u}function Jf(u,o){return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u}function re(u,o){var n=o[0],a=o[1];return o[0]=u[0]*n+u[2]*a+u[4],o[1]=u[1]*n+u[3]*a+u[5],o}function Qf(u,o,n){return qf(u,o,0,0,n,0,0)}function Un(u,o,n,a,l,f,_,p){var v=Math.sin(f),E=Math.cos(f);return u[0]=a*E,u[1]=l*v,u[2]=-a*v,u[3]=l*E,u[4]=_*a*E-p*a*v+o,u[5]=_*l*v+p*l*E+n,u}function td(u,o){var n=ed(o);Vt(n!==0,32);var a=o[0],l=o[1],f=o[2],_=o[3],p=o[4],v=o[5];return u[0]=_/n,u[1]=-l/n,u[2]=-f/n,u[3]=a/n,u[4]=(f*v-_*p)/n,u[5]=-(a*v-l*p)/n,u}function ed(u){return u[0]*u[3]-u[1]*u[2]}var dl;function nd(u){var o="matrix("+u.join(", ")+")";if(Lr)return o;var n=dl||(dl=document.createElement("div"));return n.style.transform=o,n.style.transform}var id=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ki=null;function rd(){var u=document.createElement("canvas");u.width=1,u.height=1,ki=u.getContext("2d")}var sd=function(u){id(o,u);function o(n){var a=u.call(this,n)||this;return a.container=null,a.renderedResolution,a.tempTransform=rn(),a.pixelTransform=rn(),a.inversePixelTransform=rn(),a.context=null,a.containerReused=!1,a.pixelContext_=null,a.frameState=null,a}return o.prototype.getImageData=function(n,a,l){ki||rd(),ki.clearRect(0,0,1,1);var f;try{ki.drawImage(n,a,l,1,1,0,0,1,1),f=ki.getImageData(0,0,1,1).data}catch{return null}return f},o.prototype.getBackground=function(n){var a=this.getLayer(),l=a.getBackground();return typeof l=="function"&&(l=l(n.viewState.resolution)),l||void 0},o.prototype.useContainer=function(n,a,l,f){var _=this.getLayer().getClassName(),p,v;if(n&&n.className===_&&n.style.opacity===""&&l===1&&(!f||n.style.backgroundColor&&y(Or(n.style.backgroundColor),Or(f)))){var E=n.firstElementChild;E instanceof HTMLCanvasElement&&(v=E.getContext("2d"))}if(v&&v.canvas.style.transform===a?(this.container=n,this.context=v,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){p=document.createElement("div"),p.className=_;var w=p.style;w.position="absolute",w.width="100%",w.height="100%",f&&(w.backgroundColor=f),v=ke();var E=v.canvas;p.appendChild(E),w=E.style,w.position="absolute",w.left="0",w.transformOrigin="top left",this.container=p,this.context=v}},o.prototype.clipUnrotated=function(n,a,l){var f=wf(l),_=Tf(l),p=Rf(l),v=xf(l);re(a.coordinateToPixelTransform,f),re(a.coordinateToPixelTransform,_),re(a.coordinateToPixelTransform,p),re(a.coordinateToPixelTransform,v);var E=this.inversePixelTransform;re(E,f),re(E,_),re(E,p),re(E,v),n.save(),n.beginPath(),n.moveTo(Math.round(f[0]),Math.round(f[1])),n.lineTo(Math.round(_[0]),Math.round(_[1])),n.lineTo(Math.round(p[0]),Math.round(p[1])),n.lineTo(Math.round(v[0]),Math.round(v[1])),n.clip()},o.prototype.dispatchRenderEvent_=function(n,a,l){var f=this.getLayer();if(f.hasListener(n)){var _=new $f(n,this.inversePixelTransform,l,a);f.dispatchEvent(_)}},o.prototype.preRender=function(n,a){this.frameState=a,this.dispatchRenderEvent_(Je.PRERENDER,n,a)},o.prototype.postRender=function(n,a){this.dispatchRenderEvent_(Je.POSTRENDER,n,a)},o.prototype.getRenderTransform=function(n,a,l,f,_,p,v){var E=_/2,w=p/2,I=f/a,S=-I,A=-n[0]+v,L=-n[1];return Un(this.tempTransform,E,w,I,S,-l,A,L)},o.prototype.getDataAtPixel=function(n,a,l){var f=re(this.inversePixelTransform,n.slice()),_=this.context,p=this.getLayer(),v=p.getExtent();if(v){var E=re(a.pixelToCoordinateTransform,n.slice());if(!al(v,E))return null}var w=Math.round(f[0]),I=Math.round(f[1]),S=this.pixelContext_;if(!S){var A=document.createElement("canvas");A.width=1,A.height=1,S=A.getContext("2d"),this.pixelContext_=S}S.clearRect(0,0,1,1);var L;try{S.drawImage(_.canvas,w,I,1,1,0,0,1,1),L=S.getImageData(0,0,1,1).data}catch(G){return G.name==="SecurityError"?(this.pixelContext_=null,new Uint8Array):L}return L[3]===0?null:L},o.prototype.disposeInternal=function(){delete this.frameState,u.prototype.disposeInternal.call(this)},o}(Zf),od=sd,Xt={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function Cn(u,o,n,a,l,f){for(var _=f||[],p=0,v=o;v<n;v+=a){var E=u[v],w=u[v+1];_[p++]=l[0]*E+l[2]*w+l[4],_[p++]=l[1]*E+l[3]*w+l[5]}return f&&_.length!=p&&(_.length=p),_}function gl(u,o,n,a,l,f,_){for(var p=_||[],v=Math.cos(l),E=Math.sin(l),w=f[0],I=f[1],S=0,A=o;A<n;A+=a){var L=u[A]-w,G=u[A+1]-I;p[S++]=w+L*v-G*E,p[S++]=I+L*E+G*v;for(var k=A+2;k<A+a;++k)p[S++]=u[k]}return _&&p.length!=S&&(p.length=S),p}function ad(u,o,n,a,l,f,_,p){for(var v=p||[],E=_[0],w=_[1],I=0,S=o;S<n;S+=a){var A=u[S]-E,L=u[S+1]-w;v[I++]=E+l*A,v[I++]=w+f*L;for(var G=S+2;G<S+a;++G)v[I++]=u[G]}return p&&v.length!=I&&(v.length=I),v}function ld(u,o,n,a,l,f,_){for(var p=_||[],v=0,E=o;E<n;E+=a){p[v++]=u[E]+l,p[v++]=u[E+1]+f;for(var w=E+2;w<E+a;++w)p[v++]=u[w]}return _&&p.length!=v&&(p.length=v),p}function hd(u,o,n,a,l,f,_,p,v,E,w,I){var S=u[o],A=u[o+1],L=0,G=0,k=0,W=0;function Y(){L=S,G=A,o+=a,S=u[o],A=u[o+1],W+=k,k=Math.sqrt((S-L)*(S-L)+(A-G)*(A-G))}do Y();while(o<n-a&&W+k<f);for(var Z=k===0?0:(f-W)/k,ot=Ie(L,S,Z),nt=Ie(G,A,Z),q=o-a,at=W,tt=f+p*v(E,l,w);o<n-a&&W+k<tt;)Y();Z=k===0?0:(tt-W)/k;var ft=Ie(L,S,Z),At=Ie(G,A,Z),Dt;if(I){var mt=[ot,nt,ft,At];gl(mt,0,4,2,I,mt,mt),Dt=mt[0]>mt[2]}else Dt=ot>ft;var xt=Math.PI,bt=[],Zt=q+a===o;o=q,k=0,W=at,S=u[o],A=u[o+1];var Bt;if(Zt){Y(),Bt=Math.atan2(A-G,S-L),Dt&&(Bt+=Bt>0?-xt:xt);var It=(ft+ot)/2,zt=(At+nt)/2;return bt[0]=[It,zt,(tt-f)/2,Bt,l],bt}for(var Lt=0,Ft=l.length;Lt<Ft;){Y();var qt=Math.atan2(A-G,S-L);if(Dt&&(qt+=qt>0?-xt:xt),Bt!==void 0){var B=qt-Bt;if(B+=B>xt?-2*xt:B<-xt?2*xt:0,Math.abs(B)>_)return null}Bt=qt;for(var ue=Lt,Ee=0;Lt<Ft;++Lt){var Wi=Dt?Ft-Lt-1:Lt,Ur=p*v(E,l[Wi],w);if(o+a<n&&W+k<f+Ee+Ur/2)break;Ee+=Ur}if(Lt!==ue){var go=Dt?l.substring(Ft-ue,Ft-Lt):l.substring(ue,Lt);Z=k===0?0:(f+Ee/2-W)/k;var It=Ie(L,S,Z),zt=Ie(G,A,Z);bt.push([It,zt,Ee/2,qt,go]),f+=Ee}}return bt}function ud(u,o,n,a){for(var l=u[o],f=u[o+1],_=0,p=o+a;p<n;p+=a){var v=u[p],E=u[p+1];_+=Math.sqrt((v-l)*(v-l)+(E-f)*(E-f)),l=v,f=E}return _}var Wn=bi(),sn=[],ze=[],Ye=[],on=[];function _l(u){return u[3].declutterBox}var cd=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function pl(u,o){return(o==="start"||o==="end")&&!cd.test(u)&&(o=o==="start"?"left":"right"),Nr[o]}function fd(u,o,n){return n>0&&u.push(`
`,""),u.push(o,""),u}var dd=function(){function u(o,n,a,l){this.overlaps=a,this.pixelRatio=n,this.resolution=o,this.alignFill_,this.instructions=l.instructions,this.coordinates=l.coordinates,this.coordinateCache_={},this.renderedTransform_=rn(),this.hitDetectionInstructions=l.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=l.fillStates||{},this.strokeStates=l.strokeStates||{},this.textStates=l.textStates||{},this.widths_={},this.labels_={}}return u.prototype.createLabel=function(o,n,a,l){var f=o+n+a+l;if(this.labels_[f])return this.labels_[f];var _=l?this.strokeStates[l]:null,p=a?this.fillStates[a]:null,v=this.textStates[n],E=this.pixelRatio,w=[v.scale[0]*E,v.scale[1]*E],I=Array.isArray(o),S=pl(I?o[0]:o,v.textAlign||Mi),A=l&&_.lineWidth?_.lineWidth:0,L=I?o:o.split(`
`).reduce(fd,[]),G=Vc(v,L),k=G.width,W=G.height,Y=G.widths,Z=G.heights,ot=G.lineWidths,nt=k+A,q=[],at=(nt+2)*w[0],tt=(W+A)*w[1],ft={width:at<0?Math.floor(at):Math.ceil(at),height:tt<0?Math.floor(tt):Math.ceil(tt),contextInstructions:q};if((w[0]!=1||w[1]!=1)&&q.push("scale",w),l){q.push("strokeStyle",_.strokeStyle),q.push("lineWidth",A),q.push("lineCap",_.lineCap),q.push("lineJoin",_.lineJoin),q.push("miterLimit",_.miterLimit);var At=Lr?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;At.prototype.setLineDash&&(q.push("setLineDash",[_.lineDash]),q.push("lineDashOffset",_.lineDashOffset))}a&&q.push("fillStyle",p.fillStyle),q.push("textBaseline","middle"),q.push("textAlign","center");for(var Dt=.5-S,mt=S*nt+Dt*A,xt=[],bt=[],Zt=0,Bt=0,It=0,zt=0,Lt,Ft=0,qt=L.length;Ft<qt;Ft+=2){var B=L[Ft];if(B===`
`){Bt+=Zt,Zt=0,mt=S*nt+Dt*A,++zt;continue}var ue=L[Ft+1]||v.font;ue!==Lt&&(l&&xt.push("font",ue),a&&bt.push("font",ue),Lt=ue),Zt=Math.max(Zt,Z[It]);var Ee=[B,mt+Dt*Y[It]+S*(Y[It]-ot[zt]),.5*(A+Zt)+Bt];mt+=Y[It],l&&xt.push("strokeText",Ee),a&&bt.push("fillText",Ee),++It}return Array.prototype.push.apply(q,xt),Array.prototype.push.apply(q,bt),this.labels_[f]=ft,ft},u.prototype.replayTextBackground_=function(o,n,a,l,f,_,p){o.beginPath(),o.moveTo.apply(o,n),o.lineTo.apply(o,a),o.lineTo.apply(o,l),o.lineTo.apply(o,f),o.lineTo.apply(o,n),_&&(this.alignFill_=_[2],this.fill_(o)),p&&(this.setStrokeStyle_(o,p),o.stroke())},u.prototype.calculateImageOrLabelDimensions_=function(o,n,a,l,f,_,p,v,E,w,I,S,A,L,G,k){p*=S[0],v*=S[1];var W=a-p,Y=l-v,Z=f+E>o?o-E:f,ot=_+w>n?n-w:_,nt=L[3]+Z*S[0]+L[1],q=L[0]+ot*S[1]+L[2],at=W-L[3],tt=Y-L[0];(G||I!==0)&&(sn[0]=at,on[0]=at,sn[1]=tt,ze[1]=tt,ze[0]=at+nt,Ye[0]=ze[0],Ye[1]=tt+q,on[1]=Ye[1]);var ft;return I!==0?(ft=Un(rn(),a,l,1,1,I,-a,-l),re(ft,sn),re(ft,ze),re(ft,Ye),re(ft,on),Ni(Math.min(sn[0],ze[0],Ye[0],on[0]),Math.min(sn[1],ze[1],Ye[1],on[1]),Math.max(sn[0],ze[0],Ye[0],on[0]),Math.max(sn[1],ze[1],Ye[1],on[1]),Wn)):Ni(Math.min(at,at+nt),Math.min(tt,tt+q),Math.max(at,at+nt),Math.max(tt,tt+q),Wn),A&&(W=Math.round(W),Y=Math.round(Y)),{drawImageX:W,drawImageY:Y,drawImageW:Z,drawImageH:ot,originX:E,originY:w,declutterBox:{minX:Wn[0],minY:Wn[1],maxX:Wn[2],maxY:Wn[3],value:k},canvasTransform:ft,scale:S}},u.prototype.replayImageOrLabel_=function(o,n,a,l,f,_,p){var v=!!(_||p),E=l.declutterBox,w=o.canvas,I=p?p[2]*l.scale[0]/2:0,S=E.minX-I<=w.width/n&&E.maxX+I>=0&&E.minY-I<=w.height/n&&E.maxY+I>=0;return S&&(v&&this.replayTextBackground_(o,sn,ze,Ye,on,_,p),Zc(o,l.canvasTransform,f,a,l.originX,l.originY,l.drawImageW,l.drawImageH,l.drawImageX,l.drawImageY,l.scale)),!0},u.prototype.fill_=function(o){if(this.alignFill_){var n=re(this.renderedTransform_,[0,0]),a=512*this.pixelRatio;o.save(),o.translate(n[0]%a,n[1]%a),o.rotate(this.viewRotation_)}o.fill(),this.alignFill_&&o.restore()},u.prototype.setStrokeStyle_=function(o,n){o.strokeStyle=n[1],o.lineWidth=n[2],o.lineCap=n[3],o.lineJoin=n[4],o.miterLimit=n[5],o.setLineDash&&(o.lineDashOffset=n[7],o.setLineDash(n[6]))},u.prototype.drawLabelWithPointPlacement_=function(o,n,a,l){var f=this.textStates[n],_=this.createLabel(o,n,l,a),p=this.strokeStates[a],v=this.pixelRatio,E=pl(Array.isArray(o)?o[0]:o,f.textAlign||Mi),w=Nr[f.textBaseline||Pr],I=p&&p.lineWidth?p.lineWidth:0,S=_.width/v-2*f.scale[0],A=E*S+2*(.5-E)*I,L=w*_.height/v+2*(.5-w)*I;return{label:_,anchorX:A,anchorY:L}},u.prototype.execute_=function(o,n,a,l,f,_,p,v){var E;this.pixelCoordinates_&&y(a,this.renderedTransform_)?E=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),E=Cn(this.coordinates,0,this.coordinates.length,2,a,this.pixelCoordinates_),Jf(this.renderedTransform_,a));for(var w=0,I=l.length,S=0,A,L,G,k,W,Y,Z,ot,nt,q,at,tt,ft=0,At=0,Dt=null,mt=null,xt=this.coordinateCache_,bt=this.viewRotation_,Zt=Math.round(Math.atan2(-a[1],a[0])*1e12)/1e12,Bt={context:o,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:bt},It=this.instructions!=l||this.overlaps?0:200,zt,Lt,Ft,qt;w<I;){var B=l[w],ue=B[0];switch(ue){case rt.BEGIN_GEOMETRY:zt=B[1],qt=B[3],zt.getGeometry()?p!==void 0&&!Pe(p,qt.getExtent())?w=B[2]+1:++w:w=B[2];break;case rt.BEGIN_PATH:ft>It&&(this.fill_(o),ft=0),At>It&&(o.stroke(),At=0),!ft&&!At&&(o.beginPath(),k=NaN,W=NaN),++w;break;case rt.CIRCLE:S=B[1];var Ee=E[S],Wi=E[S+1],Ur=E[S+2],go=E[S+3],Wl=Ur-Ee,jl=go-Wi,Vl=Math.sqrt(Wl*Wl+jl*jl);o.moveTo(Ee+Vl,Wi),o.arc(Ee,Wi,Vl,0,2*Math.PI,!0),++w;break;case rt.CLOSE_PATH:o.closePath(),++w;break;case rt.CUSTOM:S=B[1],A=B[2];var o_=B[3],a_=B[4],Zl=B.length==6?B[5]:void 0;Bt.geometry=o_,Bt.feature=zt,w in xt||(xt[w]=[]);var ji=xt[w];Zl?Zl(E,S,A,2,ji):(ji[0]=E[S],ji[1]=E[S+1],ji.length=2),a_(ji,Bt),++w;break;case rt.DRAW_IMAGE:S=B[1],A=B[2],ot=B[3],L=B[4],G=B[5];var _o=B[6],l_=B[7],h_=B[8],u_=B[9],Kl=B[10],po=B[11],c_=B[12],Wr=B[13],Vi=B[14];if(!ot&&B.length>=19){nt=B[18],q=B[19],at=B[20],tt=B[21];var mo=this.drawLabelWithPointPlacement_(nt,q,at,tt);ot=mo.label,B[3]=ot;var f_=B[22];L=(mo.anchorX-f_)*this.pixelRatio,B[4]=L;var d_=B[23];G=(mo.anchorY-d_)*this.pixelRatio,B[5]=G,_o=ot.height,B[6]=_o,Wr=ot.width,B[13]=Wr}var vo=void 0;B.length>24&&(vo=B[24]);var yo=void 0,jr=void 0,Vr=void 0;B.length>16?(yo=B[15],jr=B[16],Vr=B[17]):(yo=wn,jr=!1,Vr=!1),Kl&&Zt?po+=bt:!Kl&&!Zt&&(po-=bt);for(var g_=0;S<A;S+=2)if(!(vo&&vo[g_++]<Wr/this.pixelRatio)){var Ue=this.calculateImageOrLabelDimensions_(ot.width,ot.height,E[S],E[S+1],Wr,_o,L,G,h_,u_,po,c_,f,yo,jr||Vr,zt),Hl=[o,n,ot,Ue,l_,jr?Dt:null,Vr?mt:null],Zr=void 0,Eo=void 0;if(v&&Vi){var Kr=A-S;if(!Vi[Kr]){Vi[Kr]=Hl;continue}if(Zr=Vi[Kr],delete Vi[Kr],Eo=_l(Zr),v.collides(Eo))continue}v&&v.collides(Ue.declutterBox)||(Zr&&(v&&v.insert(Eo),this.replayImageOrLabel_.apply(this,Zr)),v&&v.insert(Ue.declutterBox),this.replayImageOrLabel_.apply(this,Hl))}++w;break;case rt.DRAW_CHARS:var $l=B[1],ql=B[2],xo=B[3],__=B[4];tt=B[5];var p_=B[6],Jl=B[7],Ql=B[8];at=B[9];var Ro=B[10];nt=B[11],q=B[12];var th=[B[13],B[13]],wo=this.textStates[q],Zi=wo.font,Ki=[wo.scale[0]*Jl,wo.scale[1]*Jl],Hi=void 0;Zi in this.widths_?Hi=this.widths_[Zi]:(Hi={},this.widths_[Zi]=Hi);var eh=ud(E,$l,ql,2),nh=Math.abs(Ki[0])*nl(Zi,nt,Hi);if(__||nh<=eh){var m_=this.textStates[q].textAlign,v_=(eh-nh)*Nr[m_],$i=hd(E,$l,ql,2,nt,v_,p_,Math.abs(Ki[0]),nl,Zi,Hi,Zt?0:this.viewRotation_);t:if($i){var qi=[],hn=void 0,Hr=void 0,$r=void 0,ce=void 0,xe=void 0;if(at)for(hn=0,Hr=$i.length;hn<Hr;++hn){xe=$i[hn],$r=xe[4],ce=this.createLabel($r,q,"",at),L=xe[2]+(Ki[0]<0?-Ro:Ro),G=xo*ce.height+(.5-xo)*2*Ro*Ki[1]/Ki[0]-Ql;var Ue=this.calculateImageOrLabelDimensions_(ce.width,ce.height,xe[0],xe[1],ce.width,ce.height,L,G,0,0,xe[3],th,!1,wn,!1,zt);if(v&&v.collides(Ue.declutterBox))break t;qi.push([o,n,ce,Ue,1,null,null])}if(tt)for(hn=0,Hr=$i.length;hn<Hr;++hn){xe=$i[hn],$r=xe[4],ce=this.createLabel($r,q,tt,""),L=xe[2],G=xo*ce.height-Ql;var Ue=this.calculateImageOrLabelDimensions_(ce.width,ce.height,xe[0],xe[1],ce.width,ce.height,L,G,0,0,xe[3],th,!1,wn,!1,zt);if(v&&v.collides(Ue.declutterBox))break t;qi.push([o,n,ce,Ue,1,null,null])}v&&v.load(qi.map(_l));for(var To=0,y_=qi.length;To<y_;++To)this.replayImageOrLabel_.apply(this,qi[To])}}++w;break;case rt.END_GEOMETRY:if(_!==void 0){zt=B[1];var ih=_(zt,qt);if(ih)return ih}++w;break;case rt.FILL:It?ft++:this.fill_(o),++w;break;case rt.MOVE_TO_LINE_TO:for(S=B[1],A=B[2],Lt=E[S],Ft=E[S+1],Y=Lt+.5|0,Z=Ft+.5|0,(Y!==k||Z!==W)&&(o.moveTo(Lt,Ft),k=Y,W=Z),S+=2;S<A;S+=2)Lt=E[S],Ft=E[S+1],Y=Lt+.5|0,Z=Ft+.5|0,(S==A-2||Y!==k||Z!==W)&&(o.lineTo(Lt,Ft),k=Y,W=Z);++w;break;case rt.SET_FILL_STYLE:Dt=B,this.alignFill_=B[2],ft&&(this.fill_(o),ft=0,At&&(o.stroke(),At=0)),o.fillStyle=B[1],++w;break;case rt.SET_STROKE_STYLE:mt=B,At&&(o.stroke(),At=0),this.setStrokeStyle_(o,B),++w;break;case rt.STROKE:It?At++:o.stroke(),++w;break;default:++w;break}}ft&&this.fill_(o),At&&o.stroke()},u.prototype.execute=function(o,n,a,l,f,_){this.viewRotation_=l,this.execute_(o,n,a,this.instructions,f,void 0,void 0,_)},u.prototype.executeHitDetection=function(o,n,a,l,f){return this.viewRotation_=a,this.execute_(o,1,n,this.hitDetectionInstructions,!0,l,f)},u}(),gd=dd,oo=[Xt.POLYGON,Xt.CIRCLE,Xt.LINE_STRING,Xt.IMAGE,Xt.TEXT,Xt.DEFAULT],_d=function(){function u(o,n,a,l,f,_){this.maxExtent_=o,this.overlaps_=l,this.pixelRatio_=a,this.resolution_=n,this.renderBuffer_=_,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=rn(),this.createExecutors_(f)}return u.prototype.clip=function(o,n){var a=this.getClipCoords(n);o.beginPath(),o.moveTo(a[0],a[1]),o.lineTo(a[2],a[3]),o.lineTo(a[4],a[5]),o.lineTo(a[6],a[7]),o.clip()},u.prototype.createExecutors_=function(o){for(var n in o){var a=this.executorsByZIndex_[n];a===void 0&&(a={},this.executorsByZIndex_[n]=a);var l=o[n];for(var f in l){var _=l[f];a[f]=new gd(this.resolution_,this.pixelRatio_,this.overlaps_,_)}}},u.prototype.hasExecutors=function(o){for(var n in this.executorsByZIndex_)for(var a=this.executorsByZIndex_[n],l=0,f=o.length;l<f;++l)if(o[l]in a)return!0;return!1},u.prototype.forEachFeatureAtCoordinate=function(o,n,a,l,f,_){l=Math.round(l);var p=l*2+1,v=Un(this.hitDetectionTransform_,l+.5,l+.5,1/n,-1/n,-a,-o[0],-o[1]),E=!this.hitDetectionContext_;E&&(this.hitDetectionContext_=ke(p,p));var w=this.hitDetectionContext_;w.canvas.width!==p||w.canvas.height!==p?(w.canvas.width=p,w.canvas.height=p):E||w.clearRect(0,0,p,p);var I;this.renderBuffer_!==void 0&&(I=bi(),vf(I,o),no(I,n*(this.renderBuffer_+l),I));var S=pd(l),A;function L(q,at){for(var tt=w.getImageData(0,0,p,p).data,ft=0,At=S.length;ft<At;ft++)if(tt[S[ft]]>0){if(!_||A!==Xt.IMAGE&&A!==Xt.TEXT||_.indexOf(q)!==-1){var Dt=(S[ft]-3)/4,mt=l-Dt%p,xt=l-(Dt/p|0),bt=f(q,at,mt*mt+xt*xt);if(bt)return bt}w.clearRect(0,0,p,p);break}}var G=Object.keys(this.executorsByZIndex_).map(Number);G.sort(d);var k,W,Y,Z,ot;for(k=G.length-1;k>=0;--k){var nt=G[k].toString();for(Y=this.executorsByZIndex_[nt],W=oo.length-1;W>=0;--W)if(A=oo[W],Z=Y[A],Z!==void 0&&(ot=Z.executeHitDetection(w,v,a,L,I),ot))return ot}},u.prototype.getClipCoords=function(o){var n=this.maxExtent_;if(!n)return null;var a=n[0],l=n[1],f=n[2],_=n[3],p=[a,l,a,_,f,_,f,l];return Cn(p,0,8,2,o,p),p},u.prototype.isEmpty=function(){return F(this.executorsByZIndex_)},u.prototype.execute=function(o,n,a,l,f,_,p){var v=Object.keys(this.executorsByZIndex_).map(Number);v.sort(d),this.maxExtent_&&(o.save(),this.clip(o,a));var E=_||oo,w,I,S,A,L,G;for(p&&v.reverse(),w=0,I=v.length;w<I;++w){var k=v[w].toString();for(L=this.executorsByZIndex_[k],S=0,A=E.length;S<A;++S){var W=E[S];G=L[W],G!==void 0&&G.execute(o,n,a,l,f,p)}}this.maxExtent_&&o.restore()},u}(),ao={};function pd(u){if(ao[u]!==void 0)return ao[u];for(var o=u*2+1,n=u*u,a=new Array(n+1),l=0;l<=u;++l)for(var f=0;f<=u;++f){var _=l*l+f*f;if(_>n)break;var p=a[_];p||(p=[],a[_]=p),p.push(((u+l)*o+(u+f))*4+3),l>0&&p.push(((u-l)*o+(u+f))*4+3),f>0&&(p.push(((u+l)*o+(u-f))*4+3),l>0&&p.push(((u-l)*o+(u-f))*4+3))}for(var v=[],l=0,E=a.length;l<E;++l)a[l]&&v.push.apply(v,a[l]);return ao[u]=v,v}var ml=_d,Gr={ANIMATING:0,INTERACTING:1},jn={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Vn={};Vn[jn.RADIANS]=6370997/(2*Math.PI),Vn[jn.DEGREES]=2*Math.PI*6370997/360,Vn[jn.FEET]=.3048,Vn[jn.METERS]=1,Vn[jn.USFEET]=1200/3937;var lo=jn,md=function(){function u(o){this.code_=o.code,this.units_=o.units,this.extent_=o.extent!==void 0?o.extent:null,this.worldExtent_=o.worldExtent!==void 0?o.worldExtent:null,this.axisOrientation_=o.axisOrientation!==void 0?o.axisOrientation:"enu",this.global_=o.global!==void 0?o.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=o.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=o.metersPerUnit}return u.prototype.canWrapX=function(){return this.canWrapX_},u.prototype.getCode=function(){return this.code_},u.prototype.getExtent=function(){return this.extent_},u.prototype.getUnits=function(){return this.units_},u.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Vn[this.units_]},u.prototype.getWorldExtent=function(){return this.worldExtent_},u.prototype.getAxisOrientation=function(){return this.axisOrientation_},u.prototype.isGlobal=function(){return this.global_},u.prototype.setGlobal=function(o){this.global_=o,this.canWrapX_=!!(o&&this.extent_)},u.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},u.prototype.setDefaultTileGrid=function(o){this.defaultTileGrid_=o},u.prototype.setExtent=function(o){this.extent_=o,this.canWrapX_=!!(this.global_&&o)},u.prototype.setWorldExtent=function(o){this.worldExtent_=o},u.prototype.setGetPointResolution=function(o){this.getPointResolutionFunc_=o},u.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},u}(),vl=md,vd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Xi=6378137,Zn=Math.PI*Xi,yd=[-Zn,-Zn,Zn,Zn],Ed=[-180,-85,180,85],kr=Xi*Math.log(Math.tan(Math.PI/2)),Kn=function(u){vd(o,u);function o(n){return u.call(this,{code:n,units:lo.METERS,extent:yd,global:!0,worldExtent:Ed,getPointResolution:function(a,l){return a/Nn(l[1]/Xi)}})||this}return o}(vl),yl=[new Kn("EPSG:3857"),new Kn("EPSG:102100"),new Kn("EPSG:102113"),new Kn("EPSG:900913"),new Kn("http://www.opengis.net/def/crs/EPSG/0/3857"),new Kn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function xd(u,o,n){var a=u.length,l=n>1?n:2,f=o;f===void 0&&(l>2?f=u.slice():f=new Array(a));for(var _=0;_<a;_+=l){f[_]=Zn*u[_]/180;var p=Xi*Math.log(Math.tan(Math.PI*(+u[_+1]+90)/360));p>kr?p=kr:p<-kr&&(p=-kr),f[_+1]=p}return f}function Rd(u,o,n){var a=u.length,l=n>1?n:2,f=o;f===void 0&&(l>2?f=u.slice():f=new Array(a));for(var _=0;_<a;_+=l)f[_]=180*u[_]/Zn,f[_+1]=360*Math.atan(Math.exp(u[_+1]/Xi))/Math.PI-90;return f}var wd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Td=6378137,El=[-180,-90,180,90],Id=Math.PI*Td/180,Sn=function(u){wd(o,u);function o(n,a){return u.call(this,{code:n,units:lo.DEGREES,extent:El,axisOrientation:a,global:!0,metersPerUnit:Id,worldExtent:El})||this}return o}(vl),xl=[new Sn("CRS:84"),new Sn("EPSG:4326","neu"),new Sn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Sn("urn:ogc:def:crs:OGC:2:84"),new Sn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Sn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Sn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],ho={};function Cd(u){return ho[u]||ho[u.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Sd(u,o){ho[u]=o}var Hn={};function Xr(u,o,n){var a=u.getCode(),l=o.getCode();a in Hn||(Hn[a]={}),Hn[a][l]=n}function Ad(u,o){var n;return u in Hn&&o in Hn[u]&&(n=Hn[u][o]),n}function Od(u,o){if(o.canWrapX()){var n=In(o.getExtent()),a=Ld(u,o,n);a&&(u[0]-=a*n)}return u}function Ld(u,o,n){var a=o.getExtent(),l=0;if(o.canWrapX()&&(u[0]<a[0]||u[0]>a[2])){var f=n||In(a);l=Math.floor((u[0]-a[0])/f)}return l}var Md=63710088e-1;function zi(u,o,n){var a=Md,l=Rn(u[1]),f=Rn(o[1]),_=(f-l)/2,p=Rn(o[0]-u[0])/2,v=Math.sin(_)*Math.sin(_)+Math.sin(p)*Math.sin(p)*Math.cos(l)*Math.cos(f);return 2*a*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))}function Rl(u,o,n){var a;if(o!==void 0){for(var l=0,f=u.length;l<f;++l)o[l]=u[l];a=o}else a=u.slice();return a}function Pd(u,o,n){if(o!==void 0&&u!==o){for(var a=0,l=u.length;a<l;++a)o[a]=u[a];u=o}return u}function Dd(u){Sd(u.getCode(),u),Xr(u,u,Rl)}function Fd(u){u.forEach(Dd)}function zr(u){return typeof u=="string"?Cd(u):u||null}function wl(u){Fd(u),u.forEach(function(o){u.forEach(function(n){o!==n&&Xr(o,n,Rl)})})}function bd(u,o,n,a){u.forEach(function(l){o.forEach(function(f){Xr(l,f,n),Xr(f,l,a)})})}function Nd(u,o){var n=u.getCode(),a=o.getCode(),l=Ad(n,a);return l||(l=Pd),l}function uo(u,o){var n=zr(u),a=zr(o);return Nd(n,a)}function Tl(u,o,n){var a=uo(o,n);return a(u,void 0,u.length)}function Gd(u,o){return u}function kd(u,o){return u}function Xd(){wl(yl),wl(xl),bd(xl,yl,xd,Rd)}Xd();var zd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Il=rn(),Yd=function(u){zd(o,u);function o(){var n=u.call(this)||this;return n.extent_=bi(),n.extentRevision_=-1,n.simplifiedGeometryMaxMinSquaredTolerance=0,n.simplifiedGeometryRevision=0,n.simplifyTransformedInternal=C(function(a,l,f){if(!f)return this.getSimplifiedGeometry(l);var _=this.clone();return _.applyTransform(f),_.getSimplifiedGeometry(l)}),n}return o.prototype.simplifyTransformed=function(n,a){return this.simplifyTransformedInternal(this.getRevision(),n,a)},o.prototype.clone=function(){return V()},o.prototype.closestPointXY=function(n,a,l,f){return V()},o.prototype.containsXY=function(n,a){var l=this.getClosestPoint([n,a]);return l[0]===n&&l[1]===a},o.prototype.getClosestPoint=function(n,a){var l=a||[NaN,NaN];return this.closestPointXY(n[0],n[1],l,1/0),l},o.prototype.intersectsCoordinate=function(n){return this.containsXY(n[0],n[1])},o.prototype.computeExtent=function(n){return V()},o.prototype.getExtent=function(n){if(this.extentRevision_!=this.getRevision()){var a=this.computeExtent(this.extent_);(isNaN(a[0])||isNaN(a[1]))&&ll(a),this.extentRevision_=this.getRevision()}return If(this.extent_,n)},o.prototype.rotate=function(n,a){V()},o.prototype.scale=function(n,a,l){V()},o.prototype.simplify=function(n){return this.getSimplifiedGeometry(n*n)},o.prototype.getSimplifiedGeometry=function(n){return V()},o.prototype.getType=function(){return V()},o.prototype.applyTransform=function(n){V()},o.prototype.intersectsExtent=function(n){return V()},o.prototype.translate=function(n,a){V()},o.prototype.transform=function(n,a){var l=zr(n),f=l.getUnits()==lo.TILE_PIXELS?function(_,p,v){var E=l.getExtent(),w=l.getWorldExtent(),I=br(w)/br(E);return Un(Il,w[0],w[3],I,-I,0,0,0),Cn(_,0,_.length,v,Il,p),uo(l,a)(_,p,v)}:uo(l,a);return this.applyTransform(f),this},o}(ut),Bd=Yd,Be={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},Ud=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Wd=function(u){Ud(o,u);function o(){var n=u.call(this)||this;return n.layout=Be.XY,n.stride=2,n.flatCoordinates=null,n}return o.prototype.computeExtent=function(n){return mf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,n)},o.prototype.getCoordinates=function(){return V()},o.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},o.prototype.getFlatCoordinates=function(){return this.flatCoordinates},o.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},o.prototype.getLayout=function(){return this.layout},o.prototype.getSimplifiedGeometry=function(n){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),n<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&n<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var a=this.getSimplifiedGeometryInternal(n),l=a.getFlatCoordinates();return l.length<this.flatCoordinates.length?a:(this.simplifiedGeometryMaxMinSquaredTolerance=n,this)},o.prototype.getSimplifiedGeometryInternal=function(n){return this},o.prototype.getStride=function(){return this.stride},o.prototype.setFlatCoordinates=function(n,a){this.stride=Cl(n),this.layout=n,this.flatCoordinates=a},o.prototype.setCoordinates=function(n,a){V()},o.prototype.setLayout=function(n,a,l){var f;if(n)f=Cl(n);else{for(var _=0;_<l;++_)if(a.length===0){this.layout=Be.XY,this.stride=2;return}else a=a[0];f=a.length,n=jd(f)}this.layout=n,this.stride=f},o.prototype.applyTransform=function(n){this.flatCoordinates&&(n(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},o.prototype.rotate=function(n,a){var l=this.getFlatCoordinates();if(l){var f=this.getStride();gl(l,0,l.length,f,n,a,l),this.changed()}},o.prototype.scale=function(n,a,l){var f=a;f===void 0&&(f=n);var _=l;_||(_=ro(this.getExtent()));var p=this.getFlatCoordinates();if(p){var v=this.getStride();ad(p,0,p.length,v,n,f,_,p),this.changed()}},o.prototype.translate=function(n,a){var l=this.getFlatCoordinates();if(l){var f=this.getStride();ld(l,0,l.length,f,n,a,l),this.changed()}},o}(Bd);function jd(u){var o;return u==2?o=Be.XY:u==3?o=Be.XYZ:u==4&&(o=Be.XYZM),o}function Cl(u){var o;return u==Be.XY?o=2:u==Be.XYZ||u==Be.XYM?o=3:u==Be.XYZM&&(o=4),o}function Vd(u,o,n){var a=u.getFlatCoordinates();if(a){var l=u.getStride();return Cn(a,0,a.length,l,o,n)}else return null}var Sl=Wd,Zd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Kd=function(u){Zd(o,u);function o(n,a,l,f,_,p,v){var E=u.call(this)||this;return E.context_=n,E.pixelRatio_=a,E.extent_=l,E.transform_=f,E.viewRotation_=_,E.squaredTolerance_=p,E.userTransform_=v,E.contextFillState_=null,E.contextStrokeState_=null,E.contextTextState_=null,E.fillState_=null,E.strokeState_=null,E.image_=null,E.imageAnchorX_=0,E.imageAnchorY_=0,E.imageHeight_=0,E.imageOpacity_=0,E.imageOriginX_=0,E.imageOriginY_=0,E.imageRotateWithView_=!1,E.imageRotation_=0,E.imageScale_=[0,0],E.imageWidth_=0,E.text_="",E.textOffsetX_=0,E.textOffsetY_=0,E.textRotateWithView_=!1,E.textRotation_=0,E.textScale_=[0,0],E.textFillState_=null,E.textStrokeState_=null,E.textState_=null,E.pixelCoordinates_=[],E.tmpLocalTransform_=rn(),E}return o.prototype.drawImages_=function(n,a,l,f){if(this.image_){var _=Cn(n,a,l,f,this.transform_,this.pixelCoordinates_),p=this.context_,v=this.tmpLocalTransform_,E=p.globalAlpha;this.imageOpacity_!=1&&(p.globalAlpha=E*this.imageOpacity_);var w=this.imageRotation_;this.imageRotateWithView_&&(w+=this.viewRotation_);for(var I=0,S=_.length;I<S;I+=2){var A=_[I]-this.imageAnchorX_,L=_[I+1]-this.imageAnchorY_;if(w!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var G=A+this.imageAnchorX_,k=L+this.imageAnchorY_;Un(v,G,k,1,1,w,-G,-k),p.setTransform.apply(p,v),p.translate(G,k),p.scale(this.imageScale_[0],this.imageScale_[1]),p.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),p.setTransform(1,0,0,1,0,0)}else p.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,A,L,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(p.globalAlpha=E)}},o.prototype.drawText_=function(n,a,l,f){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var _=Cn(n,a,l,f,this.transform_,this.pixelCoordinates_),p=this.context_,v=this.textRotation_;for(this.textRotateWithView_&&(v+=this.viewRotation_);a<l;a+=f){var E=_[a]+this.textOffsetX_,w=_[a+1]+this.textOffsetY_;if(v!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var I=Un(this.tmpLocalTransform_,E,w,1,1,v,-E,-w);p.setTransform.apply(p,I),p.translate(E,w),p.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&p.strokeText(this.text_,0,0),this.textFillState_&&p.fillText(this.text_,0,0),p.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&p.strokeText(this.text_,E,w),this.textFillState_&&p.fillText(this.text_,E,w)}}},o.prototype.moveToLineTo_=function(n,a,l,f,_){var p=this.context_,v=Cn(n,a,l,f,this.transform_,this.pixelCoordinates_);p.moveTo(v[0],v[1]);var E=v.length;_&&(E-=2);for(var w=2;w<E;w+=2)p.lineTo(v[w],v[w+1]);return _&&p.closePath(),l},o.prototype.drawRings_=function(n,a,l,f){for(var _=0,p=l.length;_<p;++_)a=this.moveToLineTo_(n,a,l[_],f,!0);return a},o.prototype.drawCircle=function(n){if(Pe(this.extent_,n.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var a=Vd(n,this.transform_,this.pixelCoordinates_),l=a[2]-a[0],f=a[3]-a[1],_=Math.sqrt(l*l+f*f),p=this.context_;p.beginPath(),p.arc(a[0],a[1],_,0,2*Math.PI),this.fillState_&&p.fill(),this.strokeState_&&p.stroke()}this.text_!==""&&this.drawText_(n.getCenter(),0,2,2)}},o.prototype.setStyle=function(n){this.setFillStrokeStyle(n.getFill(),n.getStroke()),this.setImageStyle(n.getImage()),this.setTextStyle(n.getText())},o.prototype.setTransform=function(n){this.transform_=n},o.prototype.drawGeometry=function(n){var a=n.getType();switch(a){case pt.POINT:this.drawPoint(n);break;case pt.LINE_STRING:this.drawLineString(n);break;case pt.POLYGON:this.drawPolygon(n);break;case pt.MULTI_POINT:this.drawMultiPoint(n);break;case pt.MULTI_LINE_STRING:this.drawMultiLineString(n);break;case pt.MULTI_POLYGON:this.drawMultiPolygon(n);break;case pt.GEOMETRY_COLLECTION:this.drawGeometryCollection(n);break;case pt.CIRCLE:this.drawCircle(n);break}},o.prototype.drawFeature=function(n,a){var l=a.getGeometryFunction()(n);!l||!Pe(this.extent_,l.getExtent())||(this.setStyle(a),this.drawGeometry(l))},o.prototype.drawGeometryCollection=function(n){for(var a=n.getGeometriesArray(),l=0,f=a.length;l<f;++l)this.drawGeometry(a[l])},o.prototype.drawPoint=function(n){this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var a=n.getFlatCoordinates(),l=n.getStride();this.image_&&this.drawImages_(a,0,a.length,l),this.text_!==""&&this.drawText_(a,0,a.length,l)},o.prototype.drawMultiPoint=function(n){this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var a=n.getFlatCoordinates(),l=n.getStride();this.image_&&this.drawImages_(a,0,a.length,l),this.text_!==""&&this.drawText_(a,0,a.length,l)},o.prototype.drawLineString=function(n){if(this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pe(this.extent_,n.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var a=this.context_,l=n.getFlatCoordinates();a.beginPath(),this.moveToLineTo_(l,0,l.length,n.getStride(),!1),a.stroke()}if(this.text_!==""){var f=n.getFlatMidpoint();this.drawText_(f,0,2,2)}}},o.prototype.drawMultiLineString=function(n){this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var a=n.getExtent();if(Pe(this.extent_,a)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var l=this.context_,f=n.getFlatCoordinates(),_=0,p=n.getEnds(),v=n.getStride();l.beginPath();for(var E=0,w=p.length;E<w;++E)_=this.moveToLineTo_(f,_,p[E],v,!1);l.stroke()}if(this.text_!==""){var I=n.getFlatMidpoints();this.drawText_(I,0,I.length,2)}}},o.prototype.drawPolygon=function(n){if(this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pe(this.extent_,n.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var a=this.context_;a.beginPath(),this.drawRings_(n.getOrientedFlatCoordinates(),0,n.getEnds(),n.getStride()),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}if(this.text_!==""){var l=n.getFlatInteriorPoint();this.drawText_(l,0,2,2)}}},o.prototype.drawMultiPolygon=function(n){if(this.squaredTolerance_&&(n=n.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pe(this.extent_,n.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var a=this.context_,l=n.getOrientedFlatCoordinates(),f=0,_=n.getEndss(),p=n.getStride();a.beginPath();for(var v=0,E=_.length;v<E;++v){var w=_[v];f=this.drawRings_(l,f,w,p)}this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}if(this.text_!==""){var I=n.getFlatInteriorPoints();this.drawText_(I,0,I.length,2)}}},o.prototype.setContextFillState_=function(n){var a=this.context_,l=this.contextFillState_;l?l.fillStyle!=n.fillStyle&&(l.fillStyle=n.fillStyle,a.fillStyle=n.fillStyle):(a.fillStyle=n.fillStyle,this.contextFillState_={fillStyle:n.fillStyle})},o.prototype.setContextStrokeState_=function(n){var a=this.context_,l=this.contextStrokeState_;l?(l.lineCap!=n.lineCap&&(l.lineCap=n.lineCap,a.lineCap=n.lineCap),a.setLineDash&&(y(l.lineDash,n.lineDash)||a.setLineDash(l.lineDash=n.lineDash),l.lineDashOffset!=n.lineDashOffset&&(l.lineDashOffset=n.lineDashOffset,a.lineDashOffset=n.lineDashOffset)),l.lineJoin!=n.lineJoin&&(l.lineJoin=n.lineJoin,a.lineJoin=n.lineJoin),l.lineWidth!=n.lineWidth&&(l.lineWidth=n.lineWidth,a.lineWidth=n.lineWidth),l.miterLimit!=n.miterLimit&&(l.miterLimit=n.miterLimit,a.miterLimit=n.miterLimit),l.strokeStyle!=n.strokeStyle&&(l.strokeStyle=n.strokeStyle,a.strokeStyle=n.strokeStyle)):(a.lineCap=n.lineCap,a.setLineDash&&(a.setLineDash(n.lineDash),a.lineDashOffset=n.lineDashOffset),a.lineJoin=n.lineJoin,a.lineWidth=n.lineWidth,a.miterLimit=n.miterLimit,a.strokeStyle=n.strokeStyle,this.contextStrokeState_={lineCap:n.lineCap,lineDash:n.lineDash,lineDashOffset:n.lineDashOffset,lineJoin:n.lineJoin,lineWidth:n.lineWidth,miterLimit:n.miterLimit,strokeStyle:n.strokeStyle})},o.prototype.setContextTextState_=function(n){var a=this.context_,l=this.contextTextState_,f=n.textAlign?n.textAlign:Mi;l?(l.font!=n.font&&(l.font=n.font,a.font=n.font),l.textAlign!=f&&(l.textAlign=f,a.textAlign=f),l.textBaseline!=n.textBaseline&&(l.textBaseline=n.textBaseline,a.textBaseline=n.textBaseline)):(a.font=n.font,a.textAlign=f,a.textBaseline=n.textBaseline,this.contextTextState_={font:n.font,textAlign:f,textBaseline:n.textBaseline})},o.prototype.setFillStrokeStyle=function(n,a){var l=this;if(!n)this.fillState_=null;else{var f=n.getColor();this.fillState_={fillStyle:Me(f||Xe)}}if(!a)this.strokeState_=null;else{var _=a.getColor(),p=a.getLineCap(),v=a.getLineDash(),E=a.getLineDashOffset(),w=a.getLineJoin(),I=a.getWidth(),S=a.getMiterLimit(),A=v||Si;this.strokeState_={lineCap:p!==void 0?p:Mr,lineDash:this.pixelRatio_===1?A:A.map(function(L){return L*l.pixelRatio_}),lineDashOffset:(E||Ai)*this.pixelRatio_,lineJoin:w!==void 0?w:zn,lineWidth:(I!==void 0?I:Pi)*this.pixelRatio_,miterLimit:S!==void 0?S:Oi,strokeStyle:Me(_||Li)}}},o.prototype.setImageStyle=function(n){var a;if(!n||!(a=n.getSize())){this.image_=null;return}var l=n.getAnchor(),f=n.getOrigin();this.image_=n.getImage(this.pixelRatio_),this.imageAnchorX_=l[0]*this.pixelRatio_,this.imageAnchorY_=l[1]*this.pixelRatio_,this.imageHeight_=a[1]*this.pixelRatio_,this.imageOpacity_=n.getOpacity(),this.imageOriginX_=f[0],this.imageOriginY_=f[1],this.imageRotateWithView_=n.getRotateWithView(),this.imageRotation_=n.getRotation(),this.imageScale_=n.getScaleArray(),this.imageWidth_=a[0]*this.pixelRatio_},o.prototype.setTextStyle=function(n){if(!n)this.text_="";else{var a=n.getFill();if(!a)this.textFillState_=null;else{var l=a.getColor();this.textFillState_={fillStyle:Me(l||Xe)}}var f=n.getStroke();if(!f)this.textStrokeState_=null;else{var _=f.getColor(),p=f.getLineCap(),v=f.getLineDash(),E=f.getLineDashOffset(),w=f.getLineJoin(),I=f.getWidth(),S=f.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Mr,lineDash:v||Si,lineDashOffset:E||Ai,lineJoin:w!==void 0?w:zn,lineWidth:I!==void 0?I:Pi,miterLimit:S!==void 0?S:Oi,strokeStyle:Me(_||Li)}}var A=n.getFont(),L=n.getOffsetX(),G=n.getOffsetY(),k=n.getRotateWithView(),W=n.getRotation(),Y=n.getScaleArray(),Z=n.getText(),ot=n.getTextAlign(),nt=n.getTextBaseline();this.textState_={font:A!==void 0?A:tl,textAlign:ot!==void 0?ot:Mi,textBaseline:nt!==void 0?nt:Pr},this.text_=Z!==void 0?Array.isArray(Z)?Z.reduce(function(q,at,tt){return q+=tt%2?" ":at},""):Z:"",this.textOffsetX_=L!==void 0?this.pixelRatio_*L:0,this.textOffsetY_=G!==void 0?this.pixelRatio_*G:0,this.textRotateWithView_=k!==void 0?k:!1,this.textRotation_=W!==void 0?W:0,this.textScale_=[this.pixelRatio_*Y[0],this.pixelRatio_*Y[1]]}},o}(ol),Hd=Kd,an={FRACTION:"fraction",PIXELS:"pixels"},ye={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},$d=function(){function u(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return u.prototype.clear=function(){this.cache_={},this.cacheSize_=0},u.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},u.prototype.expire=function(){if(this.canExpireCache()){var o=0;for(var n in this.cache_){var a=this.cache_[n];(o++&3)===0&&!a.hasListener()&&(delete this.cache_[n],--this.cacheSize_)}}},u.prototype.get=function(o,n,a){var l=Al(o,n,a);return l in this.cache_?this.cache_[l]:null},u.prototype.set=function(o,n,a,l){var f=Al(o,n,a);this.cache_[f]=l,++this.cacheSize_},u.prototype.setSize=function(o){this.maxCacheSize_=o,this.expire()},u}();function Al(u,o,n){var a=n?Ha(n):"null";return o+":"+u+":"+a}var Ol=new $d,qd=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Jd=function(u){qd(o,u);function o(n,a,l,f){var _=u.call(this)||this;return _.extent=n,_.pixelRatio_=l,_.resolution=a,_.state=f,_}return o.prototype.changed=function(){this.dispatchEvent(P.CHANGE)},o.prototype.getExtent=function(){return this.extent},o.prototype.getImage=function(){return V()},o.prototype.getPixelRatio=function(){return this.pixelRatio_},o.prototype.getResolution=function(){return this.resolution},o.prototype.getState=function(){return this.state},o.prototype.load=function(){V()},o}(N),Qd=Jd,tg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();(function(u){tg(o,u);function o(n,a,l,f,_,p){var v=u.call(this,n,a,l,Pt.IDLE)||this;return v.src_=f,v.image_=new Image,_!==null&&(v.image_.crossOrigin=_),v.unlisten_=null,v.state=Pt.IDLE,v.imageLoadFunction_=p,v}return o.prototype.getImage=function(){return this.image_},o.prototype.handleImageError_=function(){this.state=Pt.ERROR,this.unlistenImage_(),this.changed()},o.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=br(this.extent)/this.image_.height),this.state=Pt.LOADED,this.unlistenImage_(),this.changed()},o.prototype.load=function(){(this.state==Pt.IDLE||this.state==Pt.ERROR)&&(this.state=Pt.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Ll(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},o.prototype.setImage=function(n){this.image_=n,this.resolution=br(this.extent)/this.image_.height},o.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},o})(Qd);function Ll(u,o,n){var a=u,l=!0,f=!1,_=!1,p=[$(a,P.LOAD,function(){_=!0,f||o()})];return a.src&&zc?(f=!0,a.decode().then(function(){l&&o()}).catch(function(v){l&&(_?o():n())})):p.push($(a,P.ERROR,n)),function(){l=!1,p.forEach(X)}}var eg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Yi=null,ng=function(u){eg(o,u);function o(n,a,l,f,_,p){var v=u.call(this)||this;return v.hitDetectionImage_=null,v.image_=n||new Image,f!==null&&(v.image_.crossOrigin=f),v.canvas_={},v.color_=p,v.unlisten_=null,v.imageState_=_,v.size_=l,v.src_=a,v.tainted_,v}return o.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===Pt.LOADED){Yi||(Yi=ke(1,1)),Yi.drawImage(this.image_,0,0);try{Yi.getImageData(0,0,1,1),this.tainted_=!1}catch{Yi=null,this.tainted_=!0}}return this.tainted_===!0},o.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(P.CHANGE)},o.prototype.handleImageError_=function(){this.imageState_=Pt.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},o.prototype.handleImageLoad_=function(){this.imageState_=Pt.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},o.prototype.getImage=function(n){return this.replaceColor_(n),this.canvas_[n]?this.canvas_[n]:this.image_},o.prototype.getPixelRatio=function(n){return this.replaceColor_(n),this.canvas_[n]?n:1},o.prototype.getImageState=function(){return this.imageState_},o.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var n=this.size_[0],a=this.size_[1],l=ke(n,a);l.fillRect(0,0,n,a),this.hitDetectionImage_=l.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},o.prototype.getSize=function(){return this.size_},o.prototype.getSrc=function(){return this.src_},o.prototype.load=function(){if(this.imageState_==Pt.IDLE){this.imageState_=Pt.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Ll(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},o.prototype.replaceColor_=function(n){if(!(!this.color_||this.canvas_[n]||this.imageState_!==Pt.LOADED)){var a=document.createElement("canvas");this.canvas_[n]=a,a.width=Math.ceil(this.image_.width*n),a.height=Math.ceil(this.image_.height*n);var l=a.getContext("2d");if(l.scale(n,n),l.drawImage(this.image_,0,0),l.globalCompositeOperation="multiply",l.globalCompositeOperation==="multiply"||this.isTainted_())l.fillStyle=Ha(this.color_),l.fillRect(0,0,a.width/n,a.height/n),l.globalCompositeOperation="destination-in",l.drawImage(this.image_,0,0);else{for(var f=l.getImageData(0,0,a.width,a.height),_=f.data,p=this.color_[0]/255,v=this.color_[1]/255,E=this.color_[2]/255,w=this.color_[3],I=0,S=_.length;I<S;I+=4)_[I]*=p,_[I+1]*=v,_[I+2]*=E,_[I+3]*=w;l.putImageData(f,0,0)}}},o.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},o}(N);function ig(u,o,n,a,l,f){var _=Ol.get(o,a,f);return _||(_=new ng(u,o,n,a,l,f),Ol.set(o,a,f,_)),_}var rg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),sg=function(u){rg(o,u);function o(n){var a=this,l=n||{},f=l.opacity!==void 0?l.opacity:1,_=l.rotation!==void 0?l.rotation:0,p=l.scale!==void 0?l.scale:1,v=l.rotateWithView!==void 0?l.rotateWithView:!1;a=u.call(this,{opacity:f,rotation:_,scale:p,displacement:l.displacement!==void 0?l.displacement:[0,0],rotateWithView:v})||this,a.anchor_=l.anchor!==void 0?l.anchor:[.5,.5],a.normalizedAnchor_=null,a.anchorOrigin_=l.anchorOrigin!==void 0?l.anchorOrigin:ye.TOP_LEFT,a.anchorXUnits_=l.anchorXUnits!==void 0?l.anchorXUnits:an.FRACTION,a.anchorYUnits_=l.anchorYUnits!==void 0?l.anchorYUnits:an.FRACTION,a.crossOrigin_=l.crossOrigin!==void 0?l.crossOrigin:null;var E=l.img!==void 0?l.img:null;a.imgSize_=l.imgSize;var w=l.src;Vt(!(w!==void 0&&E),4),Vt(!E||E&&a.imgSize_,5),(w===void 0||w.length===0)&&E&&(w=E.src||Q(E)),Vt(w!==void 0&&w.length>0,6);var I=l.src!==void 0?Pt.IDLE:Pt.LOADED;return a.color_=l.color!==void 0?Or(l.color):null,a.iconImage_=ig(E,w,a.imgSize_!==void 0?a.imgSize_:null,a.crossOrigin_,I,a.color_),a.offset_=l.offset!==void 0?l.offset:[0,0],a.offsetOrigin_=l.offsetOrigin!==void 0?l.offsetOrigin:ye.TOP_LEFT,a.origin_=null,a.size_=l.size!==void 0?l.size:null,a}return o.prototype.clone=function(){var n=this.getScale();return new o({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(n)?n.slice():n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc()})},o.prototype.getAnchor=function(){var n=this.normalizedAnchor_;if(!n){n=this.anchor_;var a=this.getSize();if(this.anchorXUnits_==an.FRACTION||this.anchorYUnits_==an.FRACTION){if(!a)return null;n=this.anchor_.slice(),this.anchorXUnits_==an.FRACTION&&(n[0]*=a[0]),this.anchorYUnits_==an.FRACTION&&(n[1]*=a[1])}if(this.anchorOrigin_!=ye.TOP_LEFT){if(!a)return null;n===this.anchor_&&(n=this.anchor_.slice()),(this.anchorOrigin_==ye.TOP_RIGHT||this.anchorOrigin_==ye.BOTTOM_RIGHT)&&(n[0]=-n[0]+a[0]),(this.anchorOrigin_==ye.BOTTOM_LEFT||this.anchorOrigin_==ye.BOTTOM_RIGHT)&&(n[1]=-n[1]+a[1])}this.normalizedAnchor_=n}var l=this.getDisplacement();return[n[0]-l[0],n[1]+l[1]]},o.prototype.setAnchor=function(n){this.anchor_=n,this.normalizedAnchor_=null},o.prototype.getColor=function(){return this.color_},o.prototype.getImage=function(n){return this.iconImage_.getImage(n)},o.prototype.getPixelRatio=function(n){return this.iconImage_.getPixelRatio(n)},o.prototype.getImageSize=function(){return this.iconImage_.getSize()},o.prototype.getImageState=function(){return this.iconImage_.getImageState()},o.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},o.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var n=this.offset_;if(this.offsetOrigin_!=ye.TOP_LEFT){var a=this.getSize(),l=this.iconImage_.getSize();if(!a||!l)return null;n=n.slice(),(this.offsetOrigin_==ye.TOP_RIGHT||this.offsetOrigin_==ye.BOTTOM_RIGHT)&&(n[0]=l[0]-a[0]-n[0]),(this.offsetOrigin_==ye.BOTTOM_LEFT||this.offsetOrigin_==ye.BOTTOM_RIGHT)&&(n[1]=l[1]-a[1]-n[1])}return this.origin_=n,this.origin_},o.prototype.getSrc=function(){return this.iconImage_.getSrc()},o.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},o.prototype.listenImageChange=function(n){this.iconImage_.addEventListener(P.CHANGE,n)},o.prototype.load=function(){this.iconImage_.load()},o.prototype.unlistenImageChange=function(n){this.iconImage_.removeEventListener(P.CHANGE,n)},o}(Ka),og=sg,De=.5;function ag(u,o,n,a,l,f,_){var p=u[0]*De,v=u[1]*De,E=ke(p,v);E.imageSmoothingEnabled=!1;for(var w=E.canvas,I=new Hd(E,De,l,null,_),S=n.length,A=Math.floor((256*256*256-1)/S),L={},G=1;G<=S;++G){var k=n[G-1],W=k.getStyleFunction()||a;if(a){var Y=W(k,f);if(Y){Array.isArray(Y)||(Y=[Y]);for(var Z=G*A,ot="#"+("000000"+Z.toString(16)).slice(-6),nt=0,q=Y.length;nt<q;++nt){var at=Y[nt],tt=at.getGeometryFunction()(k);if(!(!tt||!Pe(l,tt.getExtent()))){var ft=at.clone(),At=ft.getFill();At&&At.setColor(ot);var Dt=ft.getStroke();Dt&&(Dt.setColor(ot),Dt.setLineDash(null)),ft.setText(void 0);var mt=at.getImage();if(mt&&mt.getOpacity()!==0){var xt=mt.getImageSize();if(!xt)continue;var bt=ke(xt[0],xt[1],void 0,{alpha:!1}),Zt=bt.canvas;bt.fillStyle=ot,bt.fillRect(0,0,Zt.width,Zt.height),ft.setImage(new og({img:Zt,imgSize:xt,anchor:mt.getAnchor(),anchorXUnits:an.PIXELS,anchorYUnits:an.PIXELS,offset:mt.getOrigin(),opacity:1,size:mt.getSize(),scale:mt.getScale(),rotation:mt.getRotation(),rotateWithView:mt.getRotateWithView()}))}var Bt=ft.getZIndex()||0,It=L[Bt];It||(It={},L[Bt]=It,It[pt.POLYGON]=[],It[pt.CIRCLE]=[],It[pt.LINE_STRING]=[],It[pt.POINT]=[]),It[tt.getType().replace("Multi","")].push(tt,ft)}}}}}for(var zt=Object.keys(L).map(Number).sort(d),G=0,Lt=zt.length;G<Lt;++G){var It=L[zt[G]];for(var Ft in It)for(var qt=It[Ft],nt=0,q=qt.length;nt<q;nt+=2){I.setStyle(qt[nt+1]);for(var B=0,ue=o.length;B<ue;++B)I.setTransform(o[B]),I.drawGeometry(qt[nt])}}return E.getImageData(0,0,w.width,w.height)}function lg(u,o,n){var a=[];if(n){var l=Math.floor(Math.round(u[0])*De),f=Math.floor(Math.round(u[1])*De),_=(kt(l,0,n.width-1)+kt(f,0,n.height-1)*n.width)*4,p=n.data[_],v=n.data[_+1],E=n.data[_+2],w=E+256*(v+256*p),I=Math.floor((256*256*256-1)/o.length);w&&w%I===0&&a.push(o[w/I-1])}return a}var hg=.5,Ml={Point:vg,LineString:_g,Polygon:Eg,MultiPoint:yg,MultiLineString:pg,MultiPolygon:mg,GeometryCollection:gg,Circle:fg};function ug(u,o){return parseInt(Q(u),10)-parseInt(Q(o),10)}function cg(u,o){var n=co(u,o);return n*n}function co(u,o){return hg*u/o}function fg(u,o,n,a,l){var f=n.getFill(),_=n.getStroke();if(f||_){var p=u.getBuilder(n.getZIndex(),Xt.CIRCLE);p.setFillStrokeStyle(f,_),p.drawCircle(o,a)}var v=n.getText();if(v&&v.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(v),E.drawText(o,a)}}function Pl(u,o,n,a,l,f,_){var p=!1,v=n.getImage();if(v){var E=v.getImageState();E==Pt.LOADED||E==Pt.ERROR?v.unlistenImageChange(l):(E==Pt.IDLE&&v.load(),E=v.getImageState(),v.listenImageChange(l),p=!0)}return dg(u,o,n,a,f,_),p}function dg(u,o,n,a,l,f){var _=n.getGeometryFunction()(o);if(_){var p=_.simplifyTransformed(a,l),v=n.getRenderer();if(v)Dl(u,p,n,o);else{var E=Ml[p.getType()];E(u,p,n,o,f)}}}function Dl(u,o,n,a){if(o.getType()==pt.GEOMETRY_COLLECTION){for(var l=o.getGeometries(),f=0,_=l.length;f<_;++f)Dl(u,l[f],n,a);return}var p=u.getBuilder(n.getZIndex(),Xt.DEFAULT);p.drawCustom(o,a,n.getRenderer(),n.getHitDetectionRenderer())}function gg(u,o,n,a,l){var f=o.getGeometriesArray(),_,p;for(_=0,p=f.length;_<p;++_){var v=Ml[f[_].getType()];v(u,f[_],n,a,l)}}function _g(u,o,n,a,l){var f=n.getStroke();if(f){var _=u.getBuilder(n.getZIndex(),Xt.LINE_STRING);_.setFillStrokeStyle(null,f),_.drawLineString(o,a)}var p=n.getText();if(p&&p.getText()){var v=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);v.setTextStyle(p),v.drawText(o,a)}}function pg(u,o,n,a,l){var f=n.getStroke();if(f){var _=u.getBuilder(n.getZIndex(),Xt.LINE_STRING);_.setFillStrokeStyle(null,f),_.drawMultiLineString(o,a)}var p=n.getText();if(p&&p.getText()){var v=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);v.setTextStyle(p),v.drawText(o,a)}}function mg(u,o,n,a,l){var f=n.getFill(),_=n.getStroke();if(_||f){var p=u.getBuilder(n.getZIndex(),Xt.POLYGON);p.setFillStrokeStyle(f,_),p.drawMultiPolygon(o,a)}var v=n.getText();if(v&&v.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(v),E.drawText(o,a)}}function vg(u,o,n,a,l){var f=n.getImage(),_=n.getText(),p;if(l&&(u=l,p=f&&_&&_.getText()?{}:void 0),f){if(f.getImageState()!=Pt.LOADED)return;var v=u.getBuilder(n.getZIndex(),Xt.IMAGE);v.setImageStyle(f,p),v.drawPoint(o,a)}if(_&&_.getText()){var E=u.getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(_,p),E.drawText(o,a)}}function yg(u,o,n,a,l){var f=n.getImage(),_=n.getText(),p;if(l&&(u=l,p=f&&_&&_.getText()?{}:void 0),f){if(f.getImageState()!=Pt.LOADED)return;var v=u.getBuilder(n.getZIndex(),Xt.IMAGE);v.setImageStyle(f,p),v.drawMultiPoint(o,a)}if(_&&_.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(_,p),E.drawText(o,a)}}function Eg(u,o,n,a,l){var f=n.getFill(),_=n.getStroke();if(f||_){var p=u.getBuilder(n.getZIndex(),Xt.POLYGON);p.setFillStrokeStyle(f,_),p.drawPolygon(o,a)}var v=n.getText();if(v&&v.getText()){var E=(l||u).getBuilder(n.getZIndex(),Xt.TEXT);E.setTextStyle(v),E.drawText(o,a)}}var xg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Rg=function(u){xg(o,u);function o(n){var a=u.call(this,n)||this;return a.boundHandleStyleImageChange_=a.handleStyleImageChange_.bind(a),a.animatingOrInteracting_,a.dirty_=!1,a.hitDetectionImageData_=null,a.renderedFeatures_=null,a.renderedRevision_=-1,a.renderedResolution_=NaN,a.renderedExtent_=bi(),a.wrappedRenderedExtent_=bi(),a.renderedRotation_,a.renderedCenter_=null,a.renderedProjection_=null,a.renderedRenderOrder_=null,a.replayGroup_=null,a.replayGroupChanged=!0,a.declutterExecutorGroup=null,a.clipping=!0,a}return o.prototype.renderWorlds=function(n,a,l){var f=a.extent,_=a.viewState,p=_.center,v=_.resolution,E=_.projection,w=_.rotation,I=E.getExtent(),S=this.getLayer().getSource(),A=a.pixelRatio,L=a.viewHints,G=!(L[Gr.ANIMATING]||L[Gr.INTERACTING]),k=this.context,W=Math.round(a.size[0]*A),Y=Math.round(a.size[1]*A),Z=S.getWrapX()&&E.canWrapX(),ot=Z?In(I):null,nt=Z?Math.ceil((f[2]-I[2])/ot)+1:1,q=Z?Math.floor((f[0]-I[0])/ot):0;do{var at=this.getRenderTransform(p,v,w,A,W,Y,q*ot);n.execute(k,1,at,w,G,void 0,l)}while(++q<nt)},o.prototype.renderDeclutter=function(n){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,n,n.declutterTree)},o.prototype.renderFrame=function(n,a){var l=n.pixelRatio,f=n.layerStatesArray[n.layerIndex];Qf(this.pixelTransform,1/l,1/l),td(this.inversePixelTransform,this.pixelTransform);var _=nd(this.pixelTransform);this.useContainer(a,_,f.opacity,this.getBackground(n));var p=this.context,v=p.canvas,E=this.replayGroup_,w=this.declutterExecutorGroup;if((!E||E.isEmpty())&&(!w||w.isEmpty()))return null;var I=Math.round(n.size[0]*l),S=Math.round(n.size[1]*l);v.width!=I||v.height!=S?(v.width=I,v.height=S,v.style.transform!==_&&(v.style.transform=_)):this.containerReused||p.clearRect(0,0,I,S),this.preRender(p,n);var A=n.viewState;A.projection;var L=!1,G=!0;if(f.extent&&this.clipping){var k=kd(f.extent);G=Pe(k,n.extent),L=G&&!Fi(k,n.extent),L&&this.clipUnrotated(p,n,k)}G&&this.renderWorlds(E,n),L&&p.restore(),this.postRender(p,n);var W=Bc(f.opacity),Y=this.container;return W!==Y.style.opacity&&(Y.style.opacity=W),this.renderedRotation_!==A.rotation&&(this.renderedRotation_=A.rotation,this.hitDetectionImageData_=null),this.container},o.prototype.getFeatures=function(n){return new Promise((function(a){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var l=[this.context.canvas.width,this.context.canvas.height];re(this.pixelTransform,l);var f=this.renderedCenter_,_=this.renderedResolution_,p=this.renderedRotation_,v=this.renderedProjection_,E=this.wrappedRenderedExtent_,w=this.getLayer(),I=[],S=l[0]*De,A=l[1]*De;I.push(this.getRenderTransform(f,_,p,De,S,A,0).slice());var L=w.getSource(),G=v.getExtent();if(L.getWrapX()&&v.canWrapX()&&!Fi(G,E)){for(var k=E[0],W=In(G),Y=0,Z=void 0;k<G[0];)--Y,Z=W*Y,I.push(this.getRenderTransform(f,_,p,De,S,A,Z).slice()),k+=W;for(Y=0,k=E[2];k>G[2];)++Y,Z=W*Y,I.push(this.getRenderTransform(f,_,p,De,S,A,Z).slice()),k-=W}this.hitDetectionImageData_=ag(l,I,this.renderedFeatures_,w.getStyleFunction(),E,_,p)}a(lg(n,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))},o.prototype.forEachFeatureAtCoordinate=function(n,a,l,f,_){var p=this;if(this.replayGroup_){var v=a.viewState.resolution,E=a.viewState.rotation,w=this.getLayer(),I={},S=function(G,k,W){var Y=Q(G),Z=I[Y];if(Z){if(Z!==!0&&W<Z.distanceSq){if(W===0)return I[Y]=!0,_.splice(_.lastIndexOf(Z),1),f(G,w,k);Z.geometry=k,Z.distanceSq=W}}else{if(W===0)return I[Y]=!0,f(G,w,k);_.push(I[Y]={feature:G,layer:w,geometry:k,distanceSq:W,callback:f})}},A,L=[this.replayGroup_];return this.declutterExecutorGroup&&L.push(this.declutterExecutorGroup),L.some(function(G){return A=G.forEachFeatureAtCoordinate(n,v,E,l,S,G===p.declutterExecutorGroup&&a.declutterTree?a.declutterTree.all().map(function(k){return k.value}):null)}),A}},o.prototype.handleFontsChanged=function(){var n=this.getLayer();n.getVisible()&&this.replayGroup_&&n.changed()},o.prototype.handleStyleImageChange_=function(n){this.renderIfReadyAndVisible()},o.prototype.prepareFrame=function(n){var a=this.getLayer(),l=a.getSource();if(!l)return!1;var f=n.viewHints[Gr.ANIMATING],_=n.viewHints[Gr.INTERACTING],p=a.getUpdateWhileAnimating(),v=a.getUpdateWhileInteracting();if(!this.dirty_&&!p&&f||!v&&_)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var E=n.extent,w=n.viewState,I=w.projection,S=w.resolution,A=n.pixelRatio,L=a.getRevision(),G=a.getRenderBuffer(),k=a.getRenderOrder();k===void 0&&(k=ug);var W=w.center.slice(),Y=no(E,G*S),Z=Y.slice(),ot=[Y.slice()],nt=I.getExtent();if(l.getWrapX()&&I.canWrapX()&&!Fi(nt,n.extent)){var q=In(nt),at=Math.max(In(Y)/2,q);Y[0]=nt[0]-at,Y[2]=nt[2]+at,Od(W,I);var tt=Cf(ot[0],I);tt[0]<nt[0]&&tt[2]<nt[2]?ot.push([tt[0]+q,tt[1],tt[2]+q,tt[3]]):tt[0]>nt[0]&&tt[2]>nt[2]&&ot.push([tt[0]-q,tt[1],tt[2]-q,tt[3]])}if(!this.dirty_&&this.renderedResolution_==S&&this.renderedRevision_==L&&this.renderedRenderOrder_==k&&Fi(this.wrappedRenderedExtent_,Y))return y(this.renderedExtent_,Z)||(this.hitDetectionImageData_=null,this.renderedExtent_=Z),this.renderedCenter_=W,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var ft=new fl(co(S,A),Y,S,A),At;this.getLayer().getDeclutter()&&(At=new fl(co(S,A),Y,S,A));for(var Dt,mt,xt,mt=0,xt=ot.length;mt<xt;++mt)l.loadFeatures(ot[mt],S,I);var bt=cg(S,A),Zt=(function(Ft){var qt,B=Ft.getStyleFunction()||a.getStyleFunction();if(B&&(qt=B(Ft,S)),qt){var ue=this.renderFeature(Ft,bt,qt,ft,Dt,At);this.dirty_=this.dirty_||ue}}).bind(this),Bt=Gd(Y),It=l.getFeaturesInExtent(Bt);k&&It.sort(k);for(var mt=0,xt=It.length;mt<xt;++mt)Zt(It[mt]);this.renderedFeatures_=It;var zt=ft.finish(),Lt=new ml(Y,S,A,l.getOverlaps(),zt,a.getRenderBuffer());return At&&(this.declutterExecutorGroup=new ml(Y,S,A,l.getOverlaps(),At.finish(),a.getRenderBuffer())),this.renderedResolution_=S,this.renderedRevision_=L,this.renderedRenderOrder_=k,this.renderedExtent_=Z,this.wrappedRenderedExtent_=Y,this.renderedCenter_=W,this.renderedProjection_=I,this.replayGroup_=Lt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},o.prototype.renderFeature=function(n,a,l,f,_,p){if(!l)return!1;var v=!1;if(Array.isArray(l))for(var E=0,w=l.length;E<w;++E)v=Pl(f,n,l[E],a,this.boundHandleStyleImageChange_,_,p)||v;else v=Pl(f,n,l,a,this.boundHandleStyleImageChange_,_,p);return v},o}(od),wg=Rg,Tg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ig=function(u){Tg(o,u);function o(n){return u.call(this,n)||this}return o.prototype.createRenderer=function(){return new wg(this)},o}(cf),Cg=Ig,$n={ADD:"add",REMOVE:"remove"},Fl=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),bl={LENGTH:"length"},Yr=function(u){Fl(o,u);function o(n,a,l){var f=u.call(this,n)||this;return f.element=a,f.index=l,f}return o}(r),Sg=function(u){Fl(o,u);function o(n,a){var l=u.call(this)||this;l.on,l.once,l.un;var f=a||{};if(l.unique_=!!f.unique,l.array_=n||[],l.unique_)for(var _=0,p=l.array_.length;_<p;++_)l.assertUnique_(l.array_[_],_);return l.updateLength_(),l}return o.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},o.prototype.extend=function(n){for(var a=0,l=n.length;a<l;++a)this.push(n[a]);return this},o.prototype.forEach=function(n){for(var a=this.array_,l=0,f=a.length;l<f;++l)n(a[l],l,a)},o.prototype.getArray=function(){return this.array_},o.prototype.item=function(n){return this.array_[n]},o.prototype.getLength=function(){return this.get(bl.LENGTH)},o.prototype.insertAt=function(n,a){this.unique_&&this.assertUnique_(a),this.array_.splice(n,0,a),this.updateLength_(),this.dispatchEvent(new Yr($n.ADD,a,n))},o.prototype.pop=function(){return this.removeAt(this.getLength()-1)},o.prototype.push=function(n){this.unique_&&this.assertUnique_(n);var a=this.getLength();return this.insertAt(a,n),this.getLength()},o.prototype.remove=function(n){for(var a=this.array_,l=0,f=a.length;l<f;++l)if(a[l]===n)return this.removeAt(l)},o.prototype.removeAt=function(n){var a=this.array_[n];return this.array_.splice(n,1),this.updateLength_(),this.dispatchEvent(new Yr($n.REMOVE,a,n)),a},o.prototype.setAt=function(n,a){var l=this.getLength();if(n<l){this.unique_&&this.assertUnique_(a,n);var f=this.array_[n];this.array_[n]=a,this.dispatchEvent(new Yr($n.REMOVE,f,n)),this.dispatchEvent(new Yr($n.ADD,a,n))}else{for(var _=l;_<n;++_)this.insertAt(_,void 0);this.insertAt(n,a)}},o.prototype.updateLength_=function(){this.set(bl.LENGTH,this.array_.length)},o.prototype.assertUnique_=function(n,a){for(var l=0,f=this.array_.length;l<f;++l)if(this.array_[l]===n&&l!==a)throw new ae(58)},o}(ut),Ag=Sg,Og=function(){function u(o){this.rbush_=new ja(o),this.items_={}}return u.prototype.insert=function(o,n){var a={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:n};this.rbush_.insert(a),this.items_[Q(n)]=a},u.prototype.load=function(o,n){for(var a=new Array(n.length),l=0,f=n.length;l<f;l++){var _=o[l],p=n[l],v={minX:_[0],minY:_[1],maxX:_[2],maxY:_[3],value:p};a[l]=v,this.items_[Q(p)]=v}this.rbush_.load(a)},u.prototype.remove=function(o){var n=Q(o),a=this.items_[n];return delete this.items_[n],this.rbush_.remove(a)!==null},u.prototype.update=function(o,n){var a=this.items_[Q(n)],l=[a.minX,a.minY,a.maxX,a.maxY];hl(l,o)||(this.remove(n),this.insert(o,n))},u.prototype.getAll=function(){var o=this.rbush_.all();return o.map(function(n){return n.value})},u.prototype.getInExtent=function(o){var n={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]},a=this.rbush_.search(n);return a.map(function(l){return l.value})},u.prototype.forEach=function(o){return this.forEach_(this.getAll(),o)},u.prototype.forEachInExtent=function(o,n){return this.forEach_(this.getInExtent(o),n)},u.prototype.forEach_=function(o,n){for(var a,l=0,f=o.length;l<f;l++)if(a=n(o[l]),a)return a;return a},u.prototype.isEmpty=function(){return F(this.items_)},u.prototype.clear=function(){this.rbush_.clear(),this.items_={}},u.prototype.getExtent=function(o){var n=this.rbush_.toJSON();return Ni(n.minX,n.minY,n.maxX,n.maxY,o)},u.prototype.concat=function(o){this.rbush_.load(o.rbush_.all());for(var n in o.items_)this.items_[n]=o.items_[n]},u}(),Nl=Og,Lg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Mg=function(u){Lg(o,u);function o(n){var a=u.call(this)||this;a.projection=zr(n.projection),a.attributions_=Gl(n.attributions),a.attributionsCollapsible_=n.attributionsCollapsible!==void 0?n.attributionsCollapsible:!0,a.loading=!1,a.state_=n.state!==void 0?n.state:Ge.READY,a.wrapX_=n.wrapX!==void 0?n.wrapX:!1,a.interpolate_=!!n.interpolate,a.viewResolver=null,a.viewRejector=null;var l=a;return a.viewPromise_=new Promise(function(f,_){l.viewResolver=f,l.viewRejector=_}),a}return o.prototype.getAttributions=function(){return this.attributions_},o.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},o.prototype.getProjection=function(){return this.projection},o.prototype.getResolutions=function(){return V()},o.prototype.getView=function(){return this.viewPromise_},o.prototype.getState=function(){return this.state_},o.prototype.getWrapX=function(){return this.wrapX_},o.prototype.getInterpolate=function(){return this.interpolate_},o.prototype.refresh=function(){this.changed()},o.prototype.setAttributions=function(n){this.attributions_=Gl(n),this.changed()},o.prototype.setState=function(n){this.state_=n,this.changed()},o}(ut);function Gl(u){return u?Array.isArray(u)?function(o){return u}:typeof u=="function"?u:function(o){return[u]}:null}var Pg=Mg,Ce={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Dg(u,o){return[[-1/0,-1/0,1/0,1/0]]}var Bi={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},Fg=!1;function bg(u,o,n,a,l,f,_){var p=new XMLHttpRequest;p.open("GET",typeof u=="function"?u(n,a,l):u,!0),o.getType()==Bi.ARRAY_BUFFER&&(p.responseType="arraybuffer"),p.withCredentials=Fg,p.onload=function(v){if(!p.status||p.status>=200&&p.status<300){var E=o.getType(),w=void 0;E==Bi.JSON||E==Bi.TEXT?w=p.responseText:E==Bi.XML?(w=p.responseXML,w||(w=new DOMParser().parseFromString(p.responseText,"application/xml"))):E==Bi.ARRAY_BUFFER&&(w=p.response),w?f(o.readFeatures(w,{extent:n,featureProjection:l}),o.readProjection(w)):_()}else _()},p.onerror=_,p.send()}function kl(u,o){return function(n,a,l,f,_){var p=this;bg(u,o,n,a,l,function(v,E){p.addFeatures(v),f!==void 0&&f(v)},_||R)}}var Xl=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),ln=function(u){Xl(o,u);function o(n,a,l){var f=u.call(this,n)||this;return f.feature=a,f.features=l,f}return o}(r),Ng=function(u){Xl(o,u);function o(n){var a=this,l=n||{};a=u.call(this,{attributions:l.attributions,interpolate:!0,projection:void 0,state:Ge.READY,wrapX:l.wrapX!==void 0?l.wrapX:!0})||this,a.on,a.once,a.un,a.loader_=R,a.format_=l.format,a.overlaps_=l.overlaps===void 0?!0:l.overlaps,a.url_=l.url,l.loader!==void 0?a.loader_=l.loader:a.url_!==void 0&&(Vt(a.format_,7),a.loader_=kl(a.url_,a.format_)),a.strategy_=l.strategy!==void 0?l.strategy:Dg;var f=l.useSpatialIndex!==void 0?l.useSpatialIndex:!0;a.featuresRtree_=f?new Nl:null,a.loadedExtentsRtree_=new Nl,a.loadingExtentsCount_=0,a.nullGeometryFeatures_={},a.idIndex_={},a.uidIndex_={},a.featureChangeKeys_={},a.featuresCollection_=null;var _,p;return Array.isArray(l.features)?p=l.features:l.features&&(_=l.features,p=_.getArray()),!f&&_===void 0&&(_=new Ag(p)),p!==void 0&&a.addFeaturesInternal(p),_!==void 0&&a.bindFeaturesCollection_(_),a}return o.prototype.addFeature=function(n){this.addFeatureInternal(n),this.changed()},o.prototype.addFeatureInternal=function(n){var a=Q(n);if(!this.addToIndex_(a,n)){this.featuresCollection_&&this.featuresCollection_.remove(n);return}this.setupChangeEvents_(a,n);var l=n.getGeometry();if(l){var f=l.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(f,n)}else this.nullGeometryFeatures_[a]=n;this.dispatchEvent(new ln(Ce.ADDFEATURE,n))},o.prototype.setupChangeEvents_=function(n,a){this.featureChangeKeys_[n]=[j(a,P.CHANGE,this.handleFeatureChange_,this),j(a,s.PROPERTYCHANGE,this.handleFeatureChange_,this)]},o.prototype.addToIndex_=function(n,a){var l=!0,f=a.getId();return f!==void 0&&(f.toString()in this.idIndex_?l=!1:this.idIndex_[f.toString()]=a),l&&(Vt(!(n in this.uidIndex_),30),this.uidIndex_[n]=a),l},o.prototype.addFeatures=function(n){this.addFeaturesInternal(n),this.changed()},o.prototype.addFeaturesInternal=function(n){for(var a=[],l=[],f=[],_=0,p=n.length;_<p;_++){var v=n[_],E=Q(v);this.addToIndex_(E,v)&&l.push(v)}for(var _=0,w=l.length;_<w;_++){var v=l[_],E=Q(v);this.setupChangeEvents_(E,v);var I=v.getGeometry();if(I){var S=I.getExtent();a.push(S),f.push(v)}else this.nullGeometryFeatures_[E]=v}if(this.featuresRtree_&&this.featuresRtree_.load(a,f),this.hasListener(Ce.ADDFEATURE))for(var _=0,A=l.length;_<A;_++)this.dispatchEvent(new ln(Ce.ADDFEATURE,l[_]))},o.prototype.bindFeaturesCollection_=function(n){var a=!1;this.addEventListener(Ce.ADDFEATURE,function(l){a||(a=!0,n.push(l.feature),a=!1)}),this.addEventListener(Ce.REMOVEFEATURE,function(l){a||(a=!0,n.remove(l.feature),a=!1)}),n.addEventListener($n.ADD,(function(l){a||(a=!0,this.addFeature(l.element),a=!1)}).bind(this)),n.addEventListener($n.REMOVE,(function(l){a||(a=!0,this.removeFeature(l.element),a=!1)}).bind(this)),this.featuresCollection_=n},o.prototype.clear=function(n){if(n){for(var a in this.featureChangeKeys_){var l=this.featureChangeKeys_[a];l.forEach(X)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var f=(function(v){this.removeFeatureInternal(v)}).bind(this);this.featuresRtree_.forEach(f);for(var _ in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[_])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var p=new ln(Ce.CLEAR);this.dispatchEvent(p),this.changed()},o.prototype.forEachFeature=function(n){if(this.featuresRtree_)return this.featuresRtree_.forEach(n);this.featuresCollection_&&this.featuresCollection_.forEach(n)},o.prototype.forEachFeatureAtCoordinateDirect=function(n,a){var l=[n[0],n[1],n[0],n[1]];return this.forEachFeatureInExtent(l,function(f){var _=f.getGeometry();if(_.intersectsCoordinate(n))return a(f)})},o.prototype.forEachFeatureInExtent=function(n,a){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(n,a);this.featuresCollection_&&this.featuresCollection_.forEach(a)},o.prototype.forEachFeatureIntersectingExtent=function(n,a){return this.forEachFeatureInExtent(n,function(l){var f=l.getGeometry();if(f.intersectsExtent(n)){var _=a(l);if(_)return _}})},o.prototype.getFeaturesCollection=function(){return this.featuresCollection_},o.prototype.getFeatures=function(){var n;return this.featuresCollection_?n=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(n=this.featuresRtree_.getAll(),F(this.nullGeometryFeatures_)||m(n,M(this.nullGeometryFeatures_))),n},o.prototype.getFeaturesAtCoordinate=function(n){var a=[];return this.forEachFeatureAtCoordinateDirect(n,function(l){a.push(l)}),a},o.prototype.getFeaturesInExtent=function(n){return this.featuresRtree_?this.featuresRtree_.getInExtent(n):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},o.prototype.getClosestFeatureToCoordinate=function(n,a){var l=n[0],f=n[1],_=null,p=[NaN,NaN],v=1/0,E=[-1/0,-1/0,1/0,1/0],w=a||x;return this.featuresRtree_.forEachInExtent(E,function(I){if(w(I)){var S=I.getGeometry(),A=v;if(v=S.closestPointXY(l,f,p,v),v<A){_=I;var L=Math.sqrt(v);E[0]=l-L,E[1]=f-L,E[2]=l+L,E[3]=f+L}}}),_},o.prototype.getExtent=function(n){return this.featuresRtree_.getExtent(n)},o.prototype.getFeatureById=function(n){var a=this.idIndex_[n.toString()];return a!==void 0?a:null},o.prototype.getFeatureByUid=function(n){var a=this.uidIndex_[n];return a!==void 0?a:null},o.prototype.getFormat=function(){return this.format_},o.prototype.getOverlaps=function(){return this.overlaps_},o.prototype.getUrl=function(){return this.url_},o.prototype.handleFeatureChange_=function(n){var a=n.target,l=Q(a),f=a.getGeometry();if(!f)l in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(a),this.nullGeometryFeatures_[l]=a);else{var _=f.getExtent();l in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[l],this.featuresRtree_&&this.featuresRtree_.insert(_,a)):this.featuresRtree_&&this.featuresRtree_.update(_,a)}var p=a.getId();if(p!==void 0){var v=p.toString();this.idIndex_[v]!==a&&(this.removeFromIdIndex_(a),this.idIndex_[v]=a)}else this.removeFromIdIndex_(a),this.uidIndex_[l]=a;this.changed(),this.dispatchEvent(new ln(Ce.CHANGEFEATURE,a))},o.prototype.hasFeature=function(n){var a=n.getId();return a!==void 0?a in this.idIndex_:Q(n)in this.uidIndex_},o.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&F(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0},o.prototype.loadFeatures=function(n,a,l){for(var f=this.loadedExtentsRtree_,_=this.strategy_(n,a,l),p=function(I,S){var A=_[I],L=f.forEachInExtent(A,function(G){return Fi(G.extent,A)});L||(++v.loadingExtentsCount_,v.dispatchEvent(new ln(Ce.FEATURESLOADSTART)),v.loader_.call(v,A,a,l,(function(G){--this.loadingExtentsCount_,this.dispatchEvent(new ln(Ce.FEATURESLOADEND,void 0,G))}).bind(v),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new ln(Ce.FEATURESLOADERROR))}).bind(v)),f.insert(A,{extent:A.slice()}))},v=this,E=0,w=_.length;E<w;++E)p(E);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},o.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),u.prototype.refresh.call(this)},o.prototype.removeLoadedExtent=function(n){var a=this.loadedExtentsRtree_,l;a.forEachInExtent(n,function(f){if(hl(f.extent,n))return l=f,!0}),l&&a.remove(l)},o.prototype.removeFeature=function(n){if(n){var a=Q(n);a in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[a]:this.featuresRtree_&&this.featuresRtree_.remove(n);var l=this.removeFeatureInternal(n);l&&this.changed()}},o.prototype.removeFeatureInternal=function(n){var a=Q(n),l=this.featureChangeKeys_[a];if(l){l.forEach(X),delete this.featureChangeKeys_[a];var f=n.getId();return f!==void 0&&delete this.idIndex_[f.toString()],delete this.uidIndex_[a],this.dispatchEvent(new ln(Ce.REMOVEFEATURE,n)),n}},o.prototype.removeFromIdIndex_=function(n){var a=!1;for(var l in this.idIndex_)if(this.idIndex_[l]===n){delete this.idIndex_[l],a=!0;break}return a},o.prototype.setLoader=function(n){this.loader_=n},o.prototype.setUrl=function(n){Vt(this.format_,7),this.url_=n,this.setLoader(kl(n,this.format_))},o}(Pg),Gg=Ng,kg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Xg=function(u){kg(o,u);function o(n){var a=u.call(this)||this;if(a.on,a.once,a.un,a.id_=void 0,a.geometryName_="geometry",a.style_=null,a.styleFunction_=void 0,a.geometryChangeKey_=null,a.addChangeListener(a.geometryName_,a.handleGeometryChanged_),n)if(typeof n.getSimplifiedGeometry=="function"){var l=n;a.setGeometry(l)}else{var f=n;a.setProperties(f)}return a}return o.prototype.clone=function(){var n=new o(this.hasProperties()?this.getProperties():null);n.setGeometryName(this.getGeometryName());var a=this.getGeometry();a&&n.setGeometry(a.clone());var l=this.getStyle();return l&&n.setStyle(l),n},o.prototype.getGeometry=function(){return this.get(this.geometryName_)},o.prototype.getId=function(){return this.id_},o.prototype.getGeometryName=function(){return this.geometryName_},o.prototype.getStyle=function(){return this.style_},o.prototype.getStyleFunction=function(){return this.styleFunction_},o.prototype.handleGeometryChange_=function(){this.changed()},o.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(X(this.geometryChangeKey_),this.geometryChangeKey_=null);var n=this.getGeometry();n&&(this.geometryChangeKey_=j(n,P.CHANGE,this.handleGeometryChange_,this)),this.changed()},o.prototype.setGeometry=function(n){this.set(this.geometryName_,n)},o.prototype.setStyle=function(n){this.style_=n,this.styleFunction_=n?zg(n):void 0,this.changed()},o.prototype.setId=function(n){this.id_=n,this.changed()},o.prototype.setGeometryName=function(n){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=n,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},o}(ut);function zg(u){if(typeof u=="function")return u;var o;if(Array.isArray(u))o=u;else{Vt(typeof u.getZIndex=="function",41);var n=u;o=[n]}return function(){return o}}var Yg=Xg;function Bg(u,o,n,a){for(var l=0,f=n.length;l<f;++l)u[o++]=n[l];return o}function Ug(u,o,n,a){for(var l=0,f=n.length;l<f;++l)for(var _=n[l],p=0;p<a;++p)u[o++]=_[p];return o}var Wg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),jg=function(u){Wg(o,u);function o(n,a){var l=u.call(this)||this;return l.setCoordinates(n,a),l}return o.prototype.clone=function(){var n=new o(this.flatCoordinates.slice(),this.layout);return n.applyProperties(this),n},o.prototype.closestPointXY=function(n,a,l,f){var _=this.flatCoordinates,p=xn(n,a,_[0],_[1]);if(p<f){for(var v=this.stride,E=0;E<v;++E)l[E]=_[E];return l.length=v,p}else return f},o.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},o.prototype.computeExtent=function(n){return pf(this.flatCoordinates,n)},o.prototype.getType=function(){return pt.POINT},o.prototype.intersectsExtent=function(n){return io(n,this.flatCoordinates[0],this.flatCoordinates[1])},o.prototype.setCoordinates=function(n,a){this.setLayout(a,n,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bg(this.flatCoordinates,0,n,this.stride),this.changed()},o}(Sl),Br=jg,Vg=function(){var u=function(o,n){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f])},u(o,n)};return function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");u(o,n);function a(){this.constructor=o}o.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),Zg=function(u){Vg(o,u);function o(n,a){var l=u.call(this)||this;return a&&!Array.isArray(n[0])?l.setFlatCoordinates(a,n):l.setCoordinates(n,a),l}return o.prototype.appendPoint=function(n){this.flatCoordinates?m(this.flatCoordinates,n.getFlatCoordinates()):this.flatCoordinates=n.getFlatCoordinates().slice(),this.changed()},o.prototype.clone=function(){var n=new o(this.flatCoordinates.slice(),this.layout);return n.applyProperties(this),n},o.prototype.closestPointXY=function(n,a,l,f){if(f<gf(this.getExtent(),n,a))return f;for(var _=this.flatCoordinates,p=this.stride,v=0,E=_.length;v<E;v+=p){var w=xn(n,a,_[v],_[v+1]);if(w<f){f=w;for(var I=0;I<p;++I)l[I]=_[v+I];l.length=p}}return f},o.prototype.getCoordinates=function(){return Bn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},o.prototype.getPoint=function(n){var a=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return n<0||a<=n?null:new Br(this.flatCoordinates.slice(n*this.stride,(n+1)*this.stride),this.layout)},o.prototype.getPoints=function(){for(var n=this.flatCoordinates,a=this.layout,l=this.stride,f=[],_=0,p=n.length;_<p;_+=l){var v=new Br(n.slice(_,_+l),a);f.push(v)}return f},o.prototype.getType=function(){return pt.MULTI_POINT},o.prototype.intersectsExtent=function(n){for(var a=this.flatCoordinates,l=this.stride,f=0,_=a.length;f<_;f+=l){var p=a[f],v=a[f+1];if(io(n,p,v))return!0}return!1},o.prototype.setCoordinates=function(n,a){this.setLayout(a,n,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ug(this.flatCoordinates,0,n,this.stride),this.changed()},o}(Sl),Kg=Zg;const Hg=[0,0],zl=10,$g=64;class qg extends Yt{constructor(o){const n=o||{};super(n),this.originCoordinate=n.originCoordinate||Hg,this.rotationAnchorCoordinate=n.rotationAnchorCoordinate||null,this.xGridSize=n.xGridSize||zl,this.yGridSize=n.yGridSize||zl,this.maxPointsPerSide=n.maxPointsPerSide||$g,this.overlay_=new Cg({source:s_(),style:n.style,updateWhileInteracting:!0}),this.gridFeature_=new Yg({geometry:new Kg([])}),this.updateGridDescription_(),this.overlay_.getSource().addFeature(this.gridFeature_),this.overlay_.on("postrender",this.handleGridLayerPostRender_.bind(this)),this.addEventListener("change:active",this.updateState_)}getGridFeature(){return this.gridFeature_}setOriginPoint(o){this.originCoordinate=o,this.updateGridDescription_()}setRotationControlPoint(o){this.rotationAnchorCoordinate=o,this.updateGridDescription_()}setXGridSize(o){this.xGridSize=o,this.updateGridDescription_()}setYGridSize(o){this.yGridSize=o,this.updateGridDescription_()}setMaxPointsPerSide(o){this.maxPointsPerSide=o,this.changed()}setStyle(o){this.overlay_.setStyle(o)}setMap(o){super.setMap(o),this.updateState_()}updateState_(){const o=this.getMap(),n=this.getActive();this.overlay_.setMap(n?o:null),this.updateGridDescription_()}updateGridDescription_(){const o=this.getMap();if(!o||!this.originCoordinate||!this.xGridSize||!this.yGridSize||!this.getActive()){this.gridDescription_=null,this.lastGridDescription_=null,this.gridFeature_.getGeometry().setCoordinates([]),this.changed();return}const n=o.getView().getProjection(),a=Tl(this.originCoordinate,n,"EPSG:4326"),l=this.rotationAnchorCoordinate||fo(this.originCoordinate,[1,0]),f=Tl(l,n,"EPSG:4326"),_=[a[0],f[1]],p=[f[0],a[1]],v=zi(a,f);let E=zi(a,_),w=zi(a,p);a[0]>f[0]&&(w*=-1),a[1]>f[1]&&(E*=-1);const I=E/v,S=w/v;this.gridDescription_,this.gridDescription_={originCoordinate:this.originCoordinate,riseFactor:I,runFactor:S,xDim:this.xGridSize,yDim:this.yGridSize},this.changed()}changed(){super.changed(),this.overlay_.changed()}handleGridLayerPostRender_(o){const n=this.getMap(),a=this.gridDescription_;if(!a)return;const l=n.getView().calculateExtent(n.getSize()),f=a===this.lastGridDescription_||JSON.stringify(a)===JSON.stringify(this.lastGridDescription_),_=l===this.lastViewExtent_||JSON.stringify(l)===JSON.stringify(this.lastViewExtent_);if(f&&_)return;const p=a.originCoordinate;let v=[a.xDim*a.runFactor,a.xDim*a.riseFactor],E=[a.yDim*-1*a.riseFactor,a.yDim*a.runFactor];const w=this.calculateLocalSphereNormalizationCoefficients(new Br(a.originCoordinate));v=Ul(v,w),E=Ul(E,w);const I=ro(l),S=Ui(p,v,E,I),A=fo(p,Yl([v,E],S)),L=new Br(A),G=i_(A,v,E,l),k=r_(l,L,G,v,E,this.maxPointsPerSide);this.lastGridDescription_=a,this.lastViewExtent_=l,this.gridFeature_.getGeometry().setCoordinates(k)}calculateLocalSphereNormalizationCoefficients(o){const n=this.getMap().getView().getProjection().getCode();function a(v){return v.transform(n,"EPSG:4326").getCoordinates()}function l(v,E,w){const I=v.clone();return I.translate(E,w),I}const f=a(o.clone()),_=a(l(o,1,0)),p=a(l(o,0,1));return[1/zi(f,_),1/zi(f,p)]}}function Jg(u,o,n,a,l){const f=Bl(a,o),_=Bl(l,n),p=u.clone();return p.setCoordinates(fo(u.getCoordinates(),f,_)),p}function Qg(u){const o=u[0][0],n=u[0][1],a=u[1][0],l=u[1][1],f=o*l-n*a;return[[l/f,-n/f],[-a/f,o/f]]}function Yl(u,o){const n=u[0][0],a=u[0][1],l=u[1][0],f=u[1][1],_=o[0],p=o[1];return[n*_+l*p,a*_+f*p]}function t_(u,o,n){const a=Qg([u,o]);return Yl(a,n)}function e_(u,o,n,a){const l=a||Math.round,f=t_(u,o,n);return[l(f[0]),l(f[1])]}function n_(u,o){return[u[0]-o[0],u[1]-o[1]]}function fo(u,o,n){return n?[u[0]+o[0]+n[0],u[1]+o[1]+n[1]]:[u[0]+o[0],u[1]+o[1]]}function Bl(u,o){return[u[0]*o,u[1]*o]}function Ul(u,o){return[u[0]*o[0],u[1]*o[1]]}function Ui(u,o,n,a,l){const f=n_(a,u);return e_(o,n,f,l)}function i_(u,o,n,a){return[Ui(u,o,n,[a[0],a[1]],Math.ceil),Ui(u,o,n,[a[2],a[3]],Math.ceil),Ui(u,o,n,[a[0],a[3]],Math.ceil),Ui(u,o,n,[a[2],a[1]],Math.ceil)]}function r_(u,o,n,a,l,f){const _=n[0][0],p=n[0][1],v=n[1][0],E=n[1][1],w=n[2][0],I=n[2][1],S=n[3][0],A=n[3][1],L=Math.min(_,v,w,S),G=Math.min(p,E,I,A),k=Math.max(_,v,w,S),W=Math.max(p,E,I,A),Y=k-L,Z=W-G,ot=Math.max(1,Math.floor(Y/f)),nt=Math.max(1,Math.floor(Z/f)),q=[];for(let at=L;at<=k;at+=ot)for(let tt=G;tt<=W;tt+=nt){const ft=Jg(o,at,tt,a,l);ft.intersectsExtent(u)&&q.push(ft.getCoordinates())}return q}function s_(){const u=new Gg({useSpatialIndex:!1,features:[],wrapX:!1});return u.getFeaturesInExtent=u.getFeatures,u}return qg})}(ls)),ls.exports}var h0=l0();const u0=o0(h0),za=.95047,Ya=1,Ba=1.08883,Ua=4/29,Dn=6/29,Wa=3*Dn*Dn,Ic=Dn*Dn*Dn,Cc=2*Math.PI;function cu(i){const t=255-i[0],e=255-i[1],r=255-i[2];return i[0]=t,i[1]=e,i[2]=r,i}function fu(i){const t=cs(i[0]),e=cs(i[1]),r=cs(i[2]),s=hs((.4124564*t+.3575761*e+.1804375*r)/za),h=hs((.2126729*t+.7151522*e+.072175*r)/Ya),c=hs((.0193339*t+.119192*e+.9503041*r)/Ba),d=116*h-16,g=500*(s-h),m=200*(h-c),y=Math.sqrt(g*g+m*m);let x=Math.atan2(m,g);return x<0&&(x+=Cc),i[0]=x,i[1]=y,i[2]=d,i}function du(i){const t=i[0],e=i[1],r=i[2],s=Math.cos(t)*e,h=Math.sin(t)*e;let c=(r+16)/116,d=isNaN(s)?c:c+s/500,g=isNaN(h)?c:c-h/200;return c=Ya*us(c),d=za*us(d),g=Ba*us(g),i[0]=fs(3.2404542*d-1.5371385*c-.4985314*g),i[1]=fs(-.969266*d+1.8760108*c+.041556*g),i[2]=fs(.0556434*d-.2040259*c+1.0572252*g),i}function hs(i){return i>Ic?Math.pow(i,1/3):i/Wa+Ua}function us(i){return i>Dn?i*i*i:Wa*(i-Ua)}function cs(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function fs(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}const c0=new My({sources:[new s0({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})],operation:function(i){const t=fu(i[0]);return t[0]=0,t[1]*=0,t[2]*=1,cu(du(t))},lib:{rgb2hcl:fu,hcl2rgb:du,rgb2xyz:cs,lab2xyz:us,xyz2lab:hs,xyz2rgb:fs,Xn:za,Yn:Ya,Zn:Ba,t0:Ua,t1:Dn,t2:Wa,t3:Ic,twoPi:Cc,invert_color:cu}}),f0=new Kv({layers:[new _c({source:c0})],target:"map",view:new Fe({center:[11834170421e-3,1879590664e-3],zoom:6,maxZoom:18})});let d0=new vn({image:new Ws({color:"white",scale:1.5,crossOrigin:"anonymous",src:"assets/cross.svg"})});f0.addInteraction(new u0({originCoordinate:[0,0],rotationAnchorCoordinate:[0,1],xGridSize:25e4,yGridSize:25e4,style:d0}));
